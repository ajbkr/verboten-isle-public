(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function i(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=i(s);fetch(s.href,r)}})();/**
 * @preserve
 * Kontra.js v10.0.2
 */function te(e,t){let i=Math.sin(t),n=Math.cos(t);return{x:e.x*n-e.y*i,y:e.x*i+e.y*n}}function B(e,t,i){return Math.min(Math.max(e,i),t)}function Wt(e){let{x:t=0,y:i=0,width:n,height:s,radius:r}=e.world||e;return e.mapwidth&&(n=e.mapwidth,s=e.mapheight),r&&(n=r.x*2,s=r.y*2),e.anchor&&(t-=n*e.anchor.x,i-=s*e.anchor.y),n<0&&(t+=n,n*=-1),s<0&&(i+=s,s*=-1),{x:t,y:i,width:n,height:s}}let tt=()=>{};function Yt(e,t){let i=e.indexOf(t);if(i!=-1)return e.splice(i,1),!0}function ee(e,t){let{x:i,y:n,width:s,height:r}=Wt(t);do i-=t.sx||0,n-=t.sy||0;while(t=t.parent);let a=e.x-Math.max(i,Math.min(e.x,i+s)),o=e.y-Math.max(n,Math.min(e.y,n+r));return a*a+o*o<e.radius*e.radius}let Z={};function K(e,t){Z[e]=Z[e]||[],Z[e].push(t)}function O(e,...t){(Z[e]||[]).map(i=>i(...t))}let A,j,Dt={get(e,t){return t=="_proxy"?!0:tt}};function H(){return A}function S(){return j}function ie(e,{contextless:t=!1}={}){if(A=document.getElementById(e)||e||document.querySelector("canvas"),t&&(A=A||new Proxy({},Dt)),!A)throw Error("You must provide a canvas element for the game");return j=A.getContext("2d")||new Proxy({},Dt),j.imageSmoothingEnabled=!1,O("init"),{canvas:A,context:j}}class wt{constructor({spriteSheet:t,frames:i,frameRate:n,loop:s=!0,name:r}){let{width:a,height:o,spacing:l=0,margin:h=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:i,frameRate:n,loop:s,name:r,width:a,height:o,spacing:l,margin:h,isStopped:!1,_f:0,_a:0})}clone(){return new wt(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped){if(!this.loop&&this._f==this.frames.length-1){this.stop();return}for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}}render({x:t,y:i,width:n=this.width,height:s=this.height,context:r=S()}){let a=this.frames[this._f]/this.spriteSheet._f|0,o=this.frames[this._f]%this.spriteSheet._f|0;r.drawImage(this.spriteSheet.image,this.margin+o*this.width+(o*2+1)*this.spacing,this.margin+a*this.height+(a*2+1)*this.spacing,this.width,this.height,t,i,n,s)}}function ne(){return new wt(...arguments)}let se=/(jpeg|jpg|gif|png|webp)$/,re=/(wav|mp3|ogg|aac)$/,ae=/^\//,oe=/\/$/,Gt=new WeakMap,he="",le="",de="";function at(e,t){return new URL(e,t).href}function gt(e,t){return[e.replace(oe,""),t].filter(i=>i).join("/")}function mt(e){return e.split(".").pop()}function _t(e){let t=e.replace("."+mt(e),"");return t.split("/").length==2?t.replace(ae,""):t}function ce(e){return{wav:e.canPlayType('audio/wav; codecs="1"'),mp3:e.canPlayType("audio/mpeg;"),ogg:e.canPlayType('audio/ogg; codecs="vorbis"'),aac:e.canPlayType("audio/aac;")}}let b={},G={},M={};function yt(){window.__k||(window.__k={dm:Gt,u:at,d:M,i:b})}function fe(e){return yt(),new Promise((t,i)=>{let n,s,r;if(n=gt(he,e),b[n])return t(b[n]);s=new Image,s.onload=function(){r=at(n,window.location.href),b[_t(e)]=b[n]=b[r]=this,O("assetLoaded",this,e),t(this)},s.onerror=function(){i("Unable to load image "+n)},s.src=n})}function ue(e){return new Promise((t,i)=>{let n=e,s,r,a,o;if(s=new Audio,r=ce(s),e=[].concat(e).reduce((l,h)=>l||(r[mt(h)]?h:null),0),!e)return i("cannot play any of the audio formats provided "+n);if(a=gt(le,e),G[a])return t(G[a]);s.addEventListener("canplay",function(){o=at(a,window.location.href),G[_t(e)]=G[a]=G[o]=this,O("assetLoaded",this,e),t(this)}),s.onerror=function(){i("Unable to load audio "+a)},s.src=a,s.load()})}function pe(e){yt();let t,i;return t=gt(de,e),M[t]?Promise.resolve(M[t]):fetch(t).then(n=>{if(!n.ok)throw n;return n.clone().json().catch(()=>n.text())}).then(n=>(i=at(t,window.location.href),typeof n=="object"&&Gt.set(n,i),M[_t(e)]=M[t]=M[i]=n,O("assetLoaded",n,e),n))}function we(...e){return yt(),Promise.all(e.map(t=>{let i=mt([].concat(t)[0]);return i.match(se)?fe(t):i.match(re)?ue(t):pe(t)}))}class I{constructor(t=0,i=0,n={}){t.x!=null?(this.x=t.x,this.y=t.y):(this.x=t,this.y=i),n._c&&(this.clamp(n._a,n._b,n._d,n._e),this.x=t,this.y=i)}set(t){this.x=t.x,this.y=t.y}add(t){return new I(this.x+t.x,this.y+t.y,this)}subtract(t){return new I(this.x-t.x,this.y-t.y,this)}scale(t){return new I(this.x*t,this.y*t)}normalize(t=this.length()||1){return new I(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,i,n,s){this._c=!0,this._a=t,this._b=i,this._d=n,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?B(this._a,this._d,t):t}set y(t){this._y=this._c?B(this._b,this._e,t):t}}function lt(){return new I(...arguments)}class ge{constructor(t){return this.init(t)}init(t={}){this.position=lt(),this.velocity=lt(),this.acceleration=lt(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let i=this.acceleration;t&&(i=i.scale(t)),this.velocity=this.velocity.add(i);let n=this.velocity;t&&(n=n.scale(t)),this.position=this.position.add(n),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}class Ut extends ge{init({width:t=0,height:i=0,context:n=S(),render:s=this.draw,update:r=this.advance,children:a=[],anchor:o={x:0,y:0},opacity:l=1,rotation:h=0,drotation:f=0,ddrotation:d=0,scaleX:c=1,scaleY:p=1,...u}={}){this._c=[],super.init({width:t,height:i,context:n,anchor:o,opacity:l,rotation:h,drotation:f,ddrotation:d,scaleX:c,scaleY:p,...u}),this._di=!0,this._uw(),this.addChild(a),this._rf=s,this._uf=r,K("init",()=>{this.context??(this.context=S())})}update(t){this._uf(t),this.children.map(i=>i.update&&i.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let i=this.width,n=this.height;this.radius&&(i=n=this.radius*2);let s=-i*this.anchor.x,r=-n*this.anchor.y;(s||r)&&t.translate(s,r),this.context.globalAlpha=this.opacity,this._rf(),(s||r)&&t.translate(-s,-r),this.children.map(o=>o.render&&o.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:i=0,_wo:n=1,_wrot:s=0,_wsx:r=1,_wsy:a=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this.radius&&(this._wrx=this.radius,this._wry=this.radius),this._wo=n*this.opacity,this._wsx=r*this.scaleX,this._wsy=a*this.scaleY,this._wx=this._wx*r,this._wy=this._wy*a,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this.radius&&(this._wrx=this.radius*this._wsx,this._wry=this.radius*this._wsy),this._wrot=s+this.rotation;let{x:o,y:l}=te({x:this._wx,y:this._wy},s);this._wx=o,this._wy=l,this._wx+=t,this._wy+=i}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,radius:this.radius?{x:this._wrx,y:this._wry}:void 0,opacity:this._wo,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(i=>{this.children.push(i),i.parent=this,i._pc=i._pc||tt,i._pc()})}removeChild(...t){t.flat().map(i=>{Yt(this.children,i)&&(i.parent=null,i._pc())})}get radius(){return this._r}set radius(t){this._r=t,this._pc()}get opacity(){return this._opa}set opacity(t){this._opa=B(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}advance(t){super.advance(t),this.drotation+=this.ddrotation,this.rotation+=this.drotation}setScale(t,i=t){this.scaleX=t,this.scaleY=i}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class me extends Ut{init({image:t,width:i=t?t.width:void 0,height:n=t?t.height:void 0,...s}={}){super.init({image:t,width:i,height:n,...s})}get animations(){return this._a}set animations(t){let i,n;this._a={};for(i in t)this._a[i]=t[i].clone(),n=n||this._a[i];this.currentAnimation=n,this.width=this.width||n.width,this.height=this.height||n.height}playAnimation(t){var i;(i=this.currentAnimation)==null||i.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){var i;super.advance(t),(i=this.currentAnimation)==null||i.update(t)}draw(){if(this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color){if(this.context.fillStyle=this.color,this.radius){this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.context.fill();return}this.context.fillRect(0,0,this.width,this.height)}}}function F(){return new me(...arguments)}let _e=/(\d+)(\w+)/;function ye(e){if(!e)return{computed:0};let t=e.match(_e),i=+t[1],n=t[2];return{size:i,unit:n,computed:i}}class xe extends Ut{init({text:t="",textAlign:i="",lineHeight:n=1,font:s=(a=>(a=S())==null?void 0:a.font)(),...r}={}){t=""+t,super.init({text:t,textAlign:i,lineHeight:n,font:s,...r}),this.context&&this._p(),K("init",()=>{this.font??(this.font=S().font),this._p()})}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=ye(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context,i=[this.text];if(t.font=this.font,i=this.text.split(`
`),this._fw&&i.map(n=>{let s=n.split(" "),r=s.shift(),a=r;s.map(o=>{a+=" "+o,t.measureText(a).width>this._fw&&(this._s.push(r),a=o),r=a}),this._s.push(a)}),!this._s.length&&this.text.includes(`
`)){let n=0;i.map(s=>{this._s.push(s),n=Math.max(n,t.measureText(s).width)}),this._w=this._fw||n}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,i=this.textAlign,n=this.context;i=this.textAlign||(n.canvas.dir=="rtl"?"right":"left"),t=i=="right"?this.width:i=="center"?this.width/2|0:0,this._s.map((s,r)=>{n.textBaseline="top",n.textAlign=i,n.fillStyle=this.color,n.font=this.font,this.strokeColor&&(n.strokeStyle=this.strokeColor,n.lineWidth=this.lineWidth??1,n.strokeText(s,t,this._fs*this.lineHeight*r)),n.fillText(s,t,this._fs*this.lineHeight*r)})}}function kt(){return new xe(...arguments)}let z=new WeakMap,At={},xt={},Nt={0:"left",1:"middle",2:"right"};function Ee(e){let t=e._lf.length?e._lf:e._cf;for(let i=t.length-1;i>=0;i--){let n=t[i];if(n.collidesWithPointer?n.collidesWithPointer(e):ee(e,n))return n}}function v(e,t){return parseFloat(e.getPropertyValue(t))||0}function ve(e){let{canvas:t,_s:i}=e,n=t.getBoundingClientRect(),s=i.transform!="none"?i.transform.replace("matrix(","").split(","):[1,1,1,1],r=parseFloat(s[0]),a=parseFloat(s[3]),o=(v(i,"border-left-width")+v(i,"border-right-width"))*r,l=(v(i,"border-top-width")+v(i,"border-bottom-width"))*a,h=(v(i,"padding-left")+v(i,"padding-right"))*r,f=(v(i,"padding-top")+v(i,"padding-bottom"))*a;return{scaleX:(n.width-o-h)/t.width,scaleY:(n.height-l-f)/t.height,offsetX:n.left+(v(i,"border-left-width")+v(i,"padding-left"))*r,offsetY:n.top+(v(i,"border-top-width")+v(i,"padding-top"))*a}}function Ot(e){let t=e.button!=null?Nt[e.button]:"left";xt[t]=!0,Et(e,"onDown")}function dt(e){let t=e.button!=null?Nt[e.button]:"left";xt[t]=!1,Et(e,"onUp")}function Lt(e){Et(e,"onOver")}function Ce(e){let t=z.get(e.target);t._oo=null,xt={}}function Pt(e,t,i){let n=Ee(e);n&&n[t]&&n[t](i),At[t]&&At[t](i,n),t=="onOver"&&(n!=e._oo&&e._oo&&e._oo.onOut&&e._oo.onOut(i),e._oo=n)}function Et(e,t){e.preventDefault();let i=e.target,n=z.get(i),{scaleX:s,scaleY:r,offsetX:a,offsetY:o}=ve(n);e.type.includes("touch")?(Array.from(e.touches).map(({clientX:h,clientY:f,identifier:d})=>{let c=n.touches[d];c||(c=n.touches[d]={start:{x:(h-a)/s,y:(f-o)/r}},n.touches.length++),c.changed=!1}),Array.from(e.changedTouches).map(({clientX:h,clientY:f,identifier:d})=>{let c=n.touches[d];c.changed=!0,c.x=n.x=(h-a)/s,c.y=n.y=(f-o)/r,Pt(n,t,e),O("touchChanged",e,n.touches),t=="onUp"&&(delete n.touches[d],n.touches.length--,n.touches.length||O("touchEnd"))})):(n.x=(e.clientX-a)/s,n.y=(e.clientY-o)/r,Pt(n,t,e))}function Se({radius:e=5,canvas:t=H()}={}){let i=z.get(t);if(!i){let n=window.getComputedStyle(t);i={x:0,y:0,radius:e,touches:{length:0},canvas:t,_cf:[],_lf:[],_o:[],_oo:null,_s:n},z.set(t,i)}return t.addEventListener("mousedown",Ot),t.addEventListener("touchstart",Ot),t.addEventListener("mouseup",dt),t.addEventListener("touchend",dt),t.addEventListener("touchcancel",dt),t.addEventListener("blur",Ce),t.addEventListener("mousemove",Lt),t.addEventListener("touchmove",Lt),i._t||(i._t=!0,K("tick",()=>{i._lf.length=0,i._cf.map(n=>{i._lf.push(n)}),i._cf.length=0})),i}function R(...e){e.flat().map(t=>{let i=t.context?t.context.canvas:H(),n=z.get(i);if(!n)throw new ReferenceError("Pointer events not initialized for the objects canvas");t.__r||(t.__r=t.render,t.render=function(){n._cf.push(this),this.__r()},n._o.push(t))})}function Te(e){let t=e.canvas;e.clearRect(0,0,t.width,t.height)}function be({fps:e=60,clearCanvas:t=!0,update:i=tt,render:n,context:s=S(),blur:r=!1}={}){if(!n)throw Error("You must provide a render() function");let a=0,o=1e3/e,l=1/e,h=t?Te:tt,f,d,c,p,u,g=!0;r||(window.addEventListener("focus",()=>{g=!0}),window.addEventListener("blur",()=>{g=!1})),K("init",()=>{u.context??(u.context=S())});function w(){if(d=requestAnimationFrame(w),!!g&&(c=performance.now(),p=c-f,f=c,!(p>1e3))){for(a+=p;a>=o;)O("tick"),u.update(l),a-=o;h(u.context),u.render()}}return u={update:i,render:n,isStopped:!0,context:s,start(){this.isStopped&&(f=performance.now(),this.isStopped=!1,requestAnimationFrame(w))},stop(){this.isStopped=!0,cancelAnimationFrame(d)},_frame:w,set _last(C){f=C}},u}let T;function vt(){T??(T=Date.now()),T|=0,T=T+2654435769|0;let e=T^T>>>16;return e=Math.imul(e,569420461),e=e^e>>>15,e=Math.imul(e,1935289751),((e=e^e>>>15)>>>0)/4294967296}function Ct(e=Date.now()){if(T=e,typeof e=="string"){for(var t=0,i=1779033703^e.length;t<e.length;t++)i=Math.imul(i^e.charCodeAt(t),3432918353),i=i<<13|i>>>19;i=Math.imul(i^i>>>16,2246822507),i=Math.imul(i^i>>>13,3266489909),T=(i^=i>>>16)>>>0}}function De(e){if(+e==e)return e;let t=[],i=e.split(".."),n=+i[0],s=+i[1],r=n;if(n<s)for(;r<=s;r++)t.push(r);else for(;r>=s;r--)t.push(r);return t}class ke{constructor({image:t,frameWidth:i,frameHeight:n,spacing:s=0,margin:r=0,animations:a}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:i,height:n,spacing:s,margin:r},this._f=(t.width-r)/i|0,this.createAnimations(a)}createAnimations(t){let i,n;for(n in t){let{frames:s,frameRate:r,loop:a}=t[n];if(i=[],s==null)throw Error("Animation "+n+" must provide a frames property");[].concat(s).map(o=>{i=i.concat(De(o))}),this.animations[n]=ne({spriteSheet:this,frames:i,frameRate:r,loop:a,name:n})}}}function Ae(){return new ke(...arguments)}let Oe=2147483648,Le=1073741824,Rt=536870912;function U(e,t){return e/t|0}function N(e,t){return e/t|0}class Pe{constructor(t={}){let{width:i,height:n,tilewidth:s,tileheight:r,tilesets:a}=t,o=i*s,l=n*r,h=document.createElement("canvas");h.width=o,h.height=l,this._c=h,this._ctx=h.getContext("2d"),a.map(f=>{let{__k:d,location:c}=window,p=(d?d.dm.get(t):"")||c.href,{source:u}=f;if(u){if(!d)throw Error('You must use "load" or "loadData" to resolve tileset.source');let w=d.d[d.u(u,p)];if(!w)throw Error(`You must load the tileset source "${u}" before loading the tileset`);Object.keys(w).map(C=>{f[C]=w[C]})}let{image:g}=f;if(""+g===g){if(!d)throw Error('You must use "load" or "loadImage" to resolve tileset.image');let w=d.i[d.u(g,p)];if(!w)throw Error(`You must load the image "${g}" before loading the tileset`);f.image=w}}),Object.assign(this,{context:S(),layerMap:{},layerCanvases:{},mapwidth:o,mapheight:l,_sx:0,_sy:0,_o:[],...t}),this.context&&this._p(),K("init",()=>{this.context??(this.context=S()),this._p()})}get sx(){return this._sx}get sy(){return this._sy}set sx(t){let i=Math.max(0,this.mapwidth-H().width);this._sx=B(0,i,t)}set sy(t){let i=Math.max(0,this.mapheight-H().height);this._sy=B(0,i,t)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map(i=>{this._o.push(i),i.parent=this})}remove(...t){t.flat().map(i=>{Yt(this._o,i),i.parent=null})}getPosition(t){let i=H().getBoundingClientRect(),n=t.x-i.x,s=t.y-i.y;return n+=this.sx,s+=this.sy,{x:n,y:s,row:U(s,this.tileheight),col:N(n,this.tilewidth)}}setTileAtLayer(t,i,n){let{layerMap:s,tileheight:r,tilewidth:a,width:o}=this,{row:l,col:h,x:f,y:d}=i,c=l??U(d,r),p=h??N(f,a);s[t]&&(this._d=!0,s[t]._d=!0,s[t].data[c*o+p]=n)}setLayer(t,i){let{layerMap:n}=this;n[t]&&(this._d=!0,n[t]._d=!0,n[t].data=i)}layerCollidesWith(t,i){let{tilewidth:n,tileheight:s,layerMap:r}=this,{x:a,y:o,width:l,height:h}=Wt(i),f=U(o,s),d=N(a,n),c=U(o+h,s),p=N(a+l,n),u=r[t];for(let g=f;g<=c;g++)for(let w=d;w<=p;w++)if(u.data[w+g*this.width])return!0;return!1}tileAtLayer(t,i){let{layerMap:n,tileheight:s,tilewidth:r,width:a}=this,{row:o,col:l,x:h,y:f}=i,d=o??U(f,s),c=l??N(h,r);return n[t]?n[t].data[d*a+c]:-1}render(t=this._c,i=!0){let{_d:n,context:s,sx:r=0,sy:a=0}=this;n&&this._p();let{width:o,height:l}=H(),h=Math.min(t.width,o),f=Math.min(t.height,l);s.drawImage(t,r,a,h,f,0,0,h,f),i&&(s.save(),(r||a)&&s.translate(-r,-a),this.objects.map(d=>d.render&&d.render()),s.restore())}renderLayer(t){let{layerCanvases:i,layerMap:n}=this,s=n[t],r=i[t],a=r==null?void 0:r.getContext("2d");if(!r){let{mapwidth:o,mapheight:l}=this;r=document.createElement("canvas"),a=r.getContext("2d"),r.width=o,r.height=l,i[t]=r,this._rl(s,a)}s._d&&(s._d=!1,a.clearRect(0,0,r.width,r.height),this._rl(s,a)),this.render(r,!1)}_p(){let{_ctx:t,layers:i=[],layerMap:n}=this;this._d=!1,i.map(s=>{let{name:r,data:a,visible:o}=s;s._d=!1,n[r]=s,a&&o!=!1&&this._rl(s,t)})}_rl(t,i){let{opacity:n,data:s=[]}=t,{tilesets:r,width:a,tilewidth:o,tileheight:l}=this;i.save(),i.globalAlpha=n,s.map((h,f)=>{if(!h)return;let d=0,c=0,p=h&Oe,u=h&Le,g=0,w=0,C=0,D=0,Y=0;d=p||u,h&=1073741823,Y=h&Rt,Y&&(p&&u?C=1:p?g=1:u?w=1:D=1,c=g||w||C||D,h&=~Rt);let J;for(let ht=r.length-1;ht>=0&&(J=r[ht],!(h/J.firstgid>=1));ht--);let{image:m,spacing:y=0,margin:x=0,firstgid:E,columns:_}=J,Tt=h-E,bt=_??m.width/(o+y)|0,L=f%a*o,P=(f/a|0)*l,Zt=x+Tt%bt*(o+y),jt=x+(Tt/bt|0)*(l+y);c?(i.save(),i.translate(L+o/2,P+l/2),w||D?i.rotate(-Math.PI/2):(g||C)&&i.rotate(Math.PI/2),(C||D)&&i.scale(-1,1),L=-o/2,P=-l/2):d&&(i.save(),i.translate(L+(p?o:0),P+(u?l:0)),i.scale(p?-1:1,u?-1:1),L=d?0:L,P=d?0:P),i.drawImage(m,Zt,jt,o,l,L,P,o,l),(d||c)&&i.restore()}),i.restore()}}function Re(){return new Pe(...arguments)}function Me(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ct={exports:{}},ft,Mt;function He(){return Mt||(Mt=1,ft=function(e,t){this.reset=function(){this.cards=e.slice(0),this.length=this.cards.length},this.shuffle=function(){i(this.cards)},this.reset(),this.shuffle(),this.deal=function(n,s){for(var r=0;r<n;r++)for(var a=0;a<s.length;a++){if(!s[a]||!s[a].push)throw new Error("Deck#deal | Undefined Hand");s[a].push(this.cards.pop())}this.length=this.cards.length},this.draw=function(n){if(!n||n<=1)return this.length=this.cards.length-1,this.cards.pop();for(var s=[],r=0;r<n;r++)s.push(this.cards.pop());return this.length=this.cards.length,s},this.drawFromBottomOfDeck=function(n){(!n||n<1)&&(n=1);for(var s=[],r=0;r<n;r++)s.push(this.cards.shift());return this.length=this.cards.length,s.length===1?s[0]:s},this.drawRandom=function(n){var s=function(){var o=Math.floor(t()*this.cards.length),l=this.cards[o];return this.cards.splice(o,1),this.length=this.cards.length,l};if(!n||n<=1)return s.apply(this);for(var r=[],a=0;a<n;a++)r.push(s.apply(this));return r},this.putOnTopOfDeck=function(n){if(!n instanceof Array)this.cards.push(n);else for(var s=0;s<n.length;s++)this.cards.push(n[s]);this.length=this.cards.length},this.putOnBottomOfDeck=function(n){if(!n instanceof Array)this.cards.unshift(n);else for(var s=0;s<n.length;s++)this.cards.unshift(n[s]);this.length=this.cards.length};function i(n){var s=n.length;if(s===0)return!1;for(;--s;){var r=Math.floor(t()*(s+1)),a=n[s],o=n[r];n[s]=o,n[r]=a}}}),ft}var ut,Ht;function Ie(){return Ht||(Ht=1,ut=function(e,t,i){this.suit=e,this.description=t,this.sort=i,this.toString=function(){return this.description+" of "+this.suit+"s"},this.toShortDisplayString=function(){var n=this.suit.substring(0,1),s;switch(this.sort){case 11:s="J";break;case 12:s="Q";break;case 13:s="K";break;case 14:s="A";break;default:s=this.sort}return s+n}}),ut}var pt,It;function Fe(){if(It)return pt;It=1;var e=Ie();return pt=function(){this.cards=[new e("Club","Two",2),new e("Club","Three",3),new e("Club","Four",4),new e("Club","Five",5),new e("Club","Six",6),new e("Club","Seven",7),new e("Club","Eight",8),new e("Club","Nine",9),new e("Club","Ten",10),new e("Club","Jack",11),new e("Club","Queen",12),new e("Club","King",13),new e("Club","Ace",14),new e("Diamond","Two",2),new e("Diamond","Three",3),new e("Diamond","Four",4),new e("Diamond","Five",5),new e("Diamond","Six",6),new e("Diamond","Seven",7),new e("Diamond","Eight",8),new e("Diamond","Nine",9),new e("Diamond","Ten",10),new e("Diamond","Jack",11),new e("Diamond","Queen",12),new e("Diamond","King",13),new e("Diamond","Ace",14),new e("Heart","Two",2),new e("Heart","Three",3),new e("Heart","Four",4),new e("Heart","Five",5),new e("Heart","Six",6),new e("Heart","Seven",7),new e("Heart","Eight",8),new e("Heart","Nine",9),new e("Heart","Ten",10),new e("Heart","Jack",11),new e("Heart","Queen",12),new e("Heart","King",13),new e("Heart","Ace",14),new e("Spade","Two",2),new e("Spade","Three",3),new e("Spade","Four",4),new e("Spade","Five",5),new e("Spade","Six",6),new e("Spade","Seven",7),new e("Spade","Eight",8),new e("Spade","Nine",9),new e("Spade","Ten",10),new e("Spade","Jack",11),new e("Spade","Queen",12),new e("Spade","King",13),new e("Spade","Ace",14)]},pt}var Ft;function $e(){if(Ft)return ct.exports;Ft=1;var e=He(),t=Fe(),i=ct.exports={},n={deck:new t().cards,numberOfDecks:1,random:function(){return Math.random()}};return i.playingCards=function(){return new t().cards},i.shuffle=function(s){if(s||(s=n),s.deck||(s.deck=n.deck),s.numberOfDecks)for(var r=s.deck,a=0;a<s.numberOfDecks-1;a++)s.deck=s.deck.concat(r);return s.random||(s.random=n.random),new e(s.deck,s.random)},ct.exports}var We=$e();const ot=Me(We),Ye=[{name:"Messenger",color:"silver",type:"adventurer"},{name:"Pilot",color:"blue",type:"adventurer"},{name:"Engineer",color:"red",type:"adventurer"},{name:"Explorer",color:"green",type:"adventurer"},{name:"Diver",color:"black",type:"adventurer"},{name:"Navigator",color:"yellow",type:"adventurer"}],Ge=[{name:"Fools' Landing",type:"flood"},{name:"Cave of Shadows",type:"flood"},{name:"Temple of the Moon",type:"flood"},{name:"Copper Gate",type:"flood"},{name:"Whispering Garden",type:"flood"},{name:"Dunes of Deception",type:"flood"},{name:"Silver Gate",type:"flood"},{name:"Observatory",type:"flood"},{name:"Breakers Bridge",type:"flood"},{name:"Twilight Hollow",type:"flood"},{name:"Lost Lagoon",type:"flood"},{name:"Bronze Gate",type:"flood"},{name:"Phantom Rock",type:"flood"},{name:"Watchtower",type:"flood"},{name:"Cliffs of Abandon",type:"flood"},{name:"Misty Marsh",type:"flood"},{name:"Coral Palace",type:"flood"},{name:"Howling Garden",type:"flood"},{name:"Iron Gate",type:"flood"},{name:"Gold Gate",type:"flood"},{name:"Crimson Forest",type:"flood"},{name:"Temple of the Sun",type:"flood"},{name:"Cave of Embers",type:"flood"},{name:"Tidal Palace",type:"flood"}];function k(e,t){const i=[];for(let n=0;n<e;++n)i.push(t);return i}const Ue=[...k(5,{name:"The Earth Stone",type:"treasure"}),...k(5,{name:"The Statue of the Wind",type:"treasure"}),...k(5,{name:"The Crystal of Fire",type:"treasure"}),...k(5,{name:"The Ocean's Chalice",type:"treasure"}),...k(3,{name:"Waters Rise!",type:"treasure"}),...k(3,{name:"Helicopter Lift",type:"treasure"}),...k(3,{name:"Sandbags",type:"treasure"})],Ne=[...Ye,...Ge,...Ue],W=2,X=640*W,St=320*W,et=32*W,$=32*W,Q=24*W,V=24*W,Xe="aqua",qe="adventurer-deck",Be="flood-deck",ze="island-tiles-deck",Ke=6;Ct(qe);const Je=ot.shuffle({deck:Ne.filter(({type:e})=>e==="adventurer"),random:vt}),Xt=1,qt=2,Bt=3,zt=4,Kt=5,Jt=6,Qt=""+new URL("spritesheet-Yod2c8eG.png",import.meta.url).href,Vt=""+new URL("tilesheet-C_zpU0l5.png",import.meta.url).href,Qe=[Qt,Vt],Ve=e=>we(...Qe),it=1,nt=2,st=3,rt=4,q=[{id:1,name:"Fools' Landing",flooded:!1,adventurer:Jt},{id:2,name:"Cave of Shadows",flooded:!1,treasure:st},{id:3,name:"Temple of the Moon",flooded:!1,treasure:it},{id:4,name:"Copper Gate",flooded:!1,adventurer:Bt},{id:5,name:"Whispering Garden",flooded:!1,treasure:nt},{id:6,name:"Dunes of Deception",flooded:!1},{id:7,name:"Silver Gate",flooded:!1,adventurer:zt},{id:8,name:"Observatory",flooded:!1},{id:9,name:"Breakers Bridge",flooded:!1},{id:10,name:"Twilight Hollow",flooded:!1},{id:11,name:"Lost Lagoon",flooded:!1},{id:12,name:"Bronze Gate",flooded:!1,adventurer:qt},{id:13,name:"Phantom Rock",flooded:!1},{id:14,name:"Watchtower",flooded:!1},{id:15,name:"Cliffs of Abandon",flooded:!1},{id:16,name:"Misty Marsh",flooded:!1},{id:17,name:"Coral Palace",flooded:!1,treasure:rt},{id:18,name:"Howling Garden",flooded:!1,treasure:nt},{id:19,name:"Iron Gate",flooded:!1,adventurer:Xt},{id:20,name:"Gold Gate",flooded:!1,adventurer:Kt},{id:21,name:"Crimson Forest",flooded:!1},{id:22,name:"Temple of the Sun",flooded:!1,treasure:it},{id:23,name:"Cave of Embers",flooded:!1,treasure:st},{id:24,name:"Tidal Palace",flooded:!1,treasure:rt}];Ct(Be);const Ze=ot.shuffle({deck:q,random:vt});function je(){const e=Ae({image:b[Qt],frameWidth:et,frameHeight:$,animations:q.map((i,n)=>({[n]:{frames:n*2,frameRate:1},[`${n}-flooded`]:{frames:[n*2+1],frameRate:1}})).reduce((i,n)=>({...i,...n}))}),t=[];for(let i=0;i<q.length;++i){const n=F({animations:e.animations,id:1+i,flooded:q[i].flooded});n.playAnimation(i),t.push(n)}return t}async function ti(){try{const e=b[Vt];return Re({tilewidth:et,tileheight:$,width:8,height:8,tilesets:[{firstgid:0,image:e}],layers:[{name:"ground",data:[0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,0,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0]}]})}catch(e){return console.error(e),null}}function ei(){const e=F({color:"brown",width:Q,height:V,id:it}),t=F({color:"yellow",width:Q,height:V,id:nt}),i=F({color:"red",width:Q,height:V,id:st}),n=F({color:"blue",width:Q,height:V,id:rt});return{theCrystalOfFire:i,theEarthStone:e,theOceansChalice:n,theStatueOfTheWind:t}}function ii(){return F({x:0,y:0,color:Xe,width:X,height:St})}Ct(ze);const ni=ot.shuffle({deck:q,random:vt});function si(e){return function(){const{innerWidth:t,innerHeight:i}=window,n=t/i,s=X/St;n<s?(e.style.width=`${t}px`,e.style.height=`${t/s}px`):(e.style.width=`${i*s}px`,e.style.height=`${i}px`)}}const ri=18.75,ai="0.0.20",$t={hours:ri,version:ai};async function oi(){const{canvas:e,context:t}=ie();e.width=X,e.height=St;const i=si(e);i(),window.addEventListener("resize",i),Se();const n=`v${$t.version}`,s=`${$t.hours}h`,r=kt({text:`${n}
${s}`,font:`${$/4}px Courier`,color:"white",x:X-et/4*Math.max(n.length,s.length),y:$/4}),a=kt({font:`${$}px Arial`,color:"blue",x:X/2-et,y:$});await Ve();const o=await ti();if(o===null)return 1;const l=ii();l.onDown=l.onOver=()=>{a.text=""},R(l);const h=je(),f=o.layers.find(({name:m})=>m==="ground");if(f!==void 0){for(let m=0;m<o.height;++m)for(let y=0;y<o.width;++y)if(f.data[m*o.width+y]!==0){const x=ni.draw(),E=h[x.id-1];E.x=y*E.width,E.y=m*E.height,E.onDown=E.onOver=()=>{let _=x.name;if(E.flooded&&(_+=`
FLOODED!`),x.adventurer!==void 0)switch(x.adventurer){case Xt:_+=`
(Diver)`;break;case qt:_+=`
(Engineer)`;break;case Bt:_+=`
(Explorer)`;break;case zt:_+=`
(Messenger)`;break;case Kt:_+=`
(Navigator)`;break;case Jt:_+=`
(Pilot)`}if(x.treasure!==void 0)switch(x.treasure){case st:_+=`
(The Crystal of Fire)`;break;case it:_+=`
(The Earth Stone)`;break;case rt:_+=`
(The Ocean's Chalice)`;break;case nt:_+=`
(The Statue of the Wind)`}a.text=_},R(E),o.add(E)}}const{theCrystalOfFire:d,theEarthStone:c,theOceansChalice:p,theStatueOfTheWind:u}=ei();c.x=h[0].width+(h[0].width-c.width)/2,c.y=h[0].height+(h[0].height-c.height)/2,c.onDown=c.onOver=()=>{a.text="The Earth Stone"},R(c),o.add(c),u.x=h[0].width+(h[0].width-u.width)/2,u.y=h[0].height*6+(h[0].height-u.height)/2,u.onDown=u.onOver=()=>{a.text="The Statue of the Wind"},R(u),o.add(u),d.x=h[0].width*6+(h[0].width-d.width)/2,d.y=h[0].height+(h[0].height-d.height)/2,d.onDown=d.onOver=()=>{a.text="The Crystal of Fire"},R(d),o.add(d),p.x=h[0].width*6+(h[0].width-p.width)/2,p.y=h[0].height*6+(h[0].height-p.height)/2,p.onDown=p.onOver=()=>{a.text="The Ocean's Chalice"},R(p),o.add(p);const g={...Ze},w=[];for(let m=0;m<6;++m){const y=g.draw(),x=h.find(({id:E})=>E===y.id);x.flooded=!0,x.playAnimation(`${x.id-1}-flooded`),w.push(y)}ot.shuffle({deck:[]}).putOnTopOfDeck(w);const D=[];for(let m=0;m<Ke;++m)D.push({name:`Player ${m+1}`,adventurerCard:Je.draw(),cards:[]});const Y=()=>{a.text=D.map(({name:m,adventurerCard:y})=>`${m}: ${y.name}`).join(`
`)};return Y(),l.onDown=l.onOver=Y,be({render(){l.render(),o.render(),t.fillStyle="black",t.fillRect(r.x,r.y,r.width,r.height),r.render(),a.render()},update(){}}).start(),0}oi();
