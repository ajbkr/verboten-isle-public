(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();/**
 * @preserve
 * Kontra.js v10.0.2
 */function de(e,t){let n=Math.sin(t),i=Math.cos(t);return{x:e.x*i-e.y*n,y:e.x*n+e.y*i}}function q(e,t,n){return Math.min(Math.max(e,n),t)}function ee(e){let{x:t=0,y:n=0,width:i,height:s,radius:r}=e.world||e;return e.mapwidth&&(i=e.mapwidth,s=e.mapheight),r&&(i=r.x*2,s=r.y*2),e.anchor&&(t-=i*e.anchor.x,n-=s*e.anchor.y),i<0&&(t+=i,i*=-1),s<0&&(n+=s,s*=-1),{x:t,y:n,width:i,height:s}}let _t=()=>{};function ie(e,t){let n=e.indexOf(t);if(n!=-1)return e.splice(n,1),!0}function ce(e,t){let{x:n,y:i,width:s,height:r}=ee(t);do n-=t.sx||0,i-=t.sy||0;while(t=t.parent);let a=e.x-Math.max(n,Math.min(e.x,n+s)),o=e.y-Math.max(i,Math.min(e.y,i+r));return a*a+o*o<e.radius*e.radius}let mt={};function dt(e,t){mt[e]=mt[e]||[],mt[e].push(t)}function X(e,...t){(mt[e]||[]).map(n=>n(...t))}let G,yt,Nt={get(e,t){return t=="_proxy"?!0:_t}};function N(){return G}function H(){return yt}function fe(e,{contextless:t=!1}={}){if(G=document.getElementById(e)||e||document.querySelector("canvas"),t&&(G=G||new Proxy({},Nt)),!G)throw Error("You must provide a canvas element for the game");return yt=G.getContext("2d")||new Proxy({},Nt),yt.imageSmoothingEnabled=!1,X("init"),{canvas:G,context:yt}}class Mt{constructor({spriteSheet:t,frames:n,frameRate:i,loop:s=!0,name:r}){let{width:a,height:o,spacing:l=0,margin:c=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:n,frameRate:i,loop:s,name:r,width:a,height:o,spacing:l,margin:c,isStopped:!1,_f:0,_a:0})}clone(){return new Mt(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped){if(!this.loop&&this._f==this.frames.length-1){this.stop();return}for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}}render({x:t,y:n,width:i=this.width,height:s=this.height,context:r=H()}){let a=this.frames[this._f]/this.spriteSheet._f|0,o=this.frames[this._f]%this.spriteSheet._f|0;r.drawImage(this.spriteSheet.image,this.margin+o*this.width+(o*2+1)*this.spacing,this.margin+a*this.height+(a*2+1)*this.spacing,this.width,this.height,t,n,i,s)}}function ue(){return new Mt(...arguments)}let we=/(jpeg|jpg|gif|png|webp)$/,pe=/(wav|mp3|ogg|aac)$/,ge=/^\//,me=/\/$/,ne=new WeakMap,ye="",_e="",xe="";function Ct(e,t){return new URL(e,t).href}function Ht(e,t){return[e.replace(me,""),t].filter(n=>n).join("/")}function Wt(e){return e.split(".").pop()}function Ft(e){let t=e.replace("."+Wt(e),"");return t.split("/").length==2?t.replace(ge,""):t}function Ee(e){return{wav:e.canPlayType('audio/wav; codecs="1"'),mp3:e.canPlayType("audio/mpeg;"),ogg:e.canPlayType('audio/ogg; codecs="vorbis"'),aac:e.canPlayType("audio/aac;")}}let Y={},tt={},V={};function $t(){window.__k||(window.__k={dm:ne,u:Ct,d:V,i:Y})}function ve(e){return $t(),new Promise((t,n)=>{let i,s,r;if(i=Ht(ye,e),Y[i])return t(Y[i]);s=new Image,s.onload=function(){r=Ct(i,window.location.href),Y[Ft(e)]=Y[i]=Y[r]=this,X("assetLoaded",this,e),t(this)},s.onerror=function(){n("Unable to load image "+i)},s.src=i})}function Te(e){return new Promise((t,n)=>{let i=e,s,r,a,o;if(s=new Audio,r=Ee(s),e=[].concat(e).reduce((l,c)=>l||(r[Wt(c)]?c:null),0),!e)return n("cannot play any of the audio formats provided "+i);if(a=Ht(_e,e),tt[a])return t(tt[a]);s.addEventListener("canplay",function(){o=Ct(a,window.location.href),tt[Ft(e)]=tt[a]=tt[o]=this,X("assetLoaded",this,e),t(this)}),s.onerror=function(){n("Unable to load audio "+a)},s.src=a,s.load()})}function Ce(e){$t();let t,n;return t=Ht(xe,e),V[t]?Promise.resolve(V[t]):fetch(t).then(i=>{if(!i.ok)throw i;return i.clone().json().catch(()=>i.text())}).then(i=>(n=Ct(t,window.location.href),typeof i=="object"&&ne.set(i,n),V[Ft(e)]=V[t]=V[n]=i,X("assetLoaded",i,e),i))}function Se(...e){return $t(),Promise.all(e.map(t=>{let n=Wt([].concat(t)[0]);return n.match(we)?ve(t):n.match(pe)?Te(t):Ce(t)}))}class J{constructor(t=0,n=0,i={}){t.x!=null?(this.x=t.x,this.y=t.y):(this.x=t,this.y=n),i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=n)}set(t){this.x=t.x,this.y=t.y}add(t){return new J(this.x+t.x,this.y+t.y,this)}subtract(t){return new J(this.x-t.x,this.y-t.y,this)}scale(t){return new J(this.x*t,this.y*t)}normalize(t=this.length()||1){return new J(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,n,i,s){this._c=!0,this._a=t,this._b=n,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?q(this._a,this._d,t):t}set y(t){this._y=this._c?q(this._b,this._e,t):t}}function Lt(){return new J(...arguments)}class De{constructor(t){return this.init(t)}init(t={}){this.position=Lt(),this.velocity=Lt(),this.acceleration=Lt(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let n=this.acceleration;t&&(n=n.scale(t)),this.velocity=this.velocity.add(n);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}class se extends De{init({width:t=0,height:n=0,context:i=H(),render:s=this.draw,update:r=this.advance,children:a=[],anchor:o={x:0,y:0},opacity:l=1,rotation:c=0,drotation:d=0,ddrotation:f=0,scaleX:p=1,scaleY:u=1,..._}={}){this._c=[],super.init({width:t,height:n,context:i,anchor:o,opacity:l,rotation:c,drotation:d,ddrotation:f,scaleX:p,scaleY:u,..._}),this._di=!0,this._uw(),this.addChild(a),this._rf=s,this._uf=r,dt("init",()=>{this.context??=H()})}update(t){this._uf(t),this.children.map(n=>n.update&&n.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let n=this.width,i=this.height;this.radius&&(n=i=this.radius*2);let s=-n*this.anchor.x,r=-i*this.anchor.y;(s||r)&&t.translate(s,r),this.context.globalAlpha=this.opacity,this._rf(),(s||r)&&t.translate(-s,-r),this.children.map(o=>o.render&&o.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:n=0,_wo:i=1,_wrot:s=0,_wsx:r=1,_wsy:a=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this.radius&&(this._wrx=this.radius,this._wry=this.radius),this._wo=i*this.opacity,this._wsx=r*this.scaleX,this._wsy=a*this.scaleY,this._wx=this._wx*r,this._wy=this._wy*a,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this.radius&&(this._wrx=this.radius*this._wsx,this._wry=this.radius*this._wsy),this._wrot=s+this.rotation;let{x:o,y:l}=de({x:this._wx,y:this._wy},s);this._wx=o,this._wy=l,this._wx+=t,this._wy+=n}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,radius:this.radius?{x:this._wrx,y:this._wry}:void 0,opacity:this._wo,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(n=>{this.children.push(n),n.parent=this,n._pc=n._pc||_t,n._pc()})}removeChild(...t){t.flat().map(n=>{ie(this.children,n)&&(n.parent=null,n._pc())})}get radius(){return this._r}set radius(t){this._r=t,this._pc()}get opacity(){return this._opa}set opacity(t){this._opa=q(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}advance(t){super.advance(t),this.drotation+=this.ddrotation,this.rotation+=this.drotation}setScale(t,n=t){this.scaleX=t,this.scaleY=n}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class be extends se{init({image:t,width:n=t?t.width:void 0,height:i=t?t.height:void 0,...s}={}){super.init({image:t,width:n,height:i,...s})}get animations(){return this._a}set animations(t){let n,i;this._a={};for(n in t)this._a[n]=t[n].clone(),i=i||this._a[n];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){this.currentAnimation?.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){super.advance(t),this.currentAnimation?.update(t)}draw(){if(this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color){if(this.context.fillStyle=this.color,this.radius){this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.context.fill();return}this.context.fillRect(0,0,this.width,this.height)}}}function D(){return new be(...arguments)}let ke=/(\d+)(\w+)/;function Le(e){if(!e)return{computed:0};let t=e.match(ke),n=+t[1],i=t[2];return{size:n,unit:i,computed:n}}class Pe extends se{init({text:t="",textAlign:n="",lineHeight:i=1,font:s=H()?.font,...r}={}){t=""+t,super.init({text:t,textAlign:n,lineHeight:i,font:s,...r}),this.context&&this._p(),dt("init",()=>{this.font??=H().font,this._p()})}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=Le(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context,n=[this.text];if(t.font=this.font,n=this.text.split(`
`),this._fw&&n.map(i=>{let s=i.split(" "),r=s.shift(),a=r;s.map(o=>{a+=" "+o,t.measureText(a).width>this._fw&&(this._s.push(r),a=o),r=a}),this._s.push(a)}),!this._s.length&&this.text.includes(`
`)){let i=0;n.map(s=>{this._s.push(s),i=Math.max(i,t.measureText(s).width)}),this._w=this._fw||i}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,n=this.textAlign,i=this.context;n=this.textAlign||(i.canvas.dir=="rtl"?"right":"left"),t=n=="right"?this.width:n=="center"?this.width/2|0:0,this._s.map((s,r)=>{i.textBaseline="top",i.textAlign=n,i.fillStyle=this.color,i.font=this.font,this.strokeColor&&(i.strokeStyle=this.strokeColor,i.lineWidth=this.lineWidth??1,i.strokeText(s,t,this._fs*this.lineHeight*r)),i.fillText(s,t,this._fs*this.lineHeight*r)})}}function Bt(){return new Pe(...arguments)}let Z=new WeakMap,qt={},Yt={},re={0:"left",1:"middle",2:"right"};function Ae(e=N()){return Z.get(e)}function Re(e){let t=e._lf.length?e._lf:e._cf;for(let n=t.length-1;n>=0;n--){let i=t[n];if(i.collidesWithPointer?i.collidesWithPointer(e):ce(e,i))return i}}function P(e,t){return parseFloat(e.getPropertyValue(t))||0}function Oe(e){let{canvas:t,_s:n}=e,i=t.getBoundingClientRect(),s=n.transform!="none"?n.transform.replace("matrix(","").split(","):[1,1,1,1],r=parseFloat(s[0]),a=parseFloat(s[3]),o=(P(n,"border-left-width")+P(n,"border-right-width"))*r,l=(P(n,"border-top-width")+P(n,"border-bottom-width"))*a,c=(P(n,"padding-left")+P(n,"padding-right"))*r,d=(P(n,"padding-top")+P(n,"padding-bottom"))*a;return{scaleX:(i.width-o-c)/t.width,scaleY:(i.height-l-d)/t.height,offsetX:i.left+(P(n,"border-left-width")+P(n,"padding-left"))*r,offsetY:i.top+(P(n,"border-top-width")+P(n,"padding-top"))*a}}function Xt(e){let t=e.button!=null?re[e.button]:"left";Yt[t]=!0,Ut(e,"onDown")}function Pt(e){let t=e.button!=null?re[e.button]:"left";Yt[t]=!1,Ut(e,"onUp")}function zt(e){Ut(e,"onOver")}function Ie(e){let t=Z.get(e.target);t._oo=null,Yt={}}function Kt(e,t,n){let i=Re(e);i&&i[t]&&i[t](n),qt[t]&&qt[t](n,i),t=="onOver"&&(i!=e._oo&&e._oo&&e._oo.onOut&&e._oo.onOut(n),e._oo=i)}function Ut(e,t){e.preventDefault();let n=e.target,i=Z.get(n),{scaleX:s,scaleY:r,offsetX:a,offsetY:o}=Oe(i);e.type.includes("touch")?(Array.from(e.touches).map(({clientX:c,clientY:d,identifier:f})=>{let p=i.touches[f];p||(p=i.touches[f]={start:{x:(c-a)/s,y:(d-o)/r}},i.touches.length++),p.changed=!1}),Array.from(e.changedTouches).map(({clientX:c,clientY:d,identifier:f})=>{let p=i.touches[f];p.changed=!0,p.x=i.x=(c-a)/s,p.y=i.y=(d-o)/r,Kt(i,t,e),X("touchChanged",e,i.touches),t=="onUp"&&(delete i.touches[f],i.touches.length--,i.touches.length||X("touchEnd"))})):(i.x=(e.clientX-a)/s,i.y=(e.clientY-o)/r,Kt(i,t,e))}function Me({radius:e=5,canvas:t=N()}={}){let n=Z.get(t);if(!n){let i=window.getComputedStyle(t);n={x:0,y:0,radius:e,touches:{length:0},canvas:t,_cf:[],_lf:[],_o:[],_oo:null,_s:i},Z.set(t,n)}return t.addEventListener("mousedown",Xt),t.addEventListener("touchstart",Xt),t.addEventListener("mouseup",Pt),t.addEventListener("touchend",Pt),t.addEventListener("touchcancel",Pt),t.addEventListener("blur",Ie),t.addEventListener("mousemove",zt),t.addEventListener("touchmove",zt),n._t||(n._t=!0,dt("tick",()=>{n._lf.length=0,n._cf.map(i=>{n._lf.push(i)}),n._cf.length=0})),n}function S(...e){e.flat().map(t=>{let n=t.context?t.context.canvas:N(),i=Z.get(n);if(!i)throw new ReferenceError("Pointer events not initialized for the objects canvas");t.__r||(t.__r=t.render,t.render=function(){i._cf.push(this),this.__r()},i._o.push(t))})}function He(e){let t=e.canvas;e.clearRect(0,0,t.width,t.height)}function We({fps:e=60,clearCanvas:t=!0,update:n=_t,render:i,context:s=H(),blur:r=!1}={}){if(!i)throw Error("You must provide a render() function");let a=0,o=1e3/e,l=1/e,c=t?He:_t,d,f,p,u,_,y=!0;r||(window.addEventListener("focus",()=>{y=!0}),window.addEventListener("blur",()=>{y=!1})),dt("init",()=>{_.context??=H()});function g(){if(f=requestAnimationFrame(g),!!y&&(p=performance.now(),u=p-d,d=p,!(u>1e3))){for(a+=u;a>=o;)X("tick"),_.update(l),a-=o;c(_.context),_.render()}}return _={update:n,render:i,isStopped:!0,context:s,start(){this.isStopped&&(d=performance.now(),this.isStopped=!1,requestAnimationFrame(g))},stop(){this.isStopped=!0,cancelAnimationFrame(f)},_frame:g,set _last(E){d=E}},_}let $;function St(){$??=Date.now(),$|=0,$=$+2654435769|0;let e=$^$>>>16;return e=Math.imul(e,569420461),e=e^e>>>15,e=Math.imul(e,1935289751),((e=e^e>>>15)>>>0)/4294967296}function Dt(e=Date.now()){if($=e,typeof e=="string"){for(var t=0,n=1779033703^e.length;t<e.length;t++)n=Math.imul(n^e.charCodeAt(t),3432918353),n=n<<13|n>>>19;n=Math.imul(n^n>>>16,2246822507),n=Math.imul(n^n>>>13,3266489909),$=(n^=n>>>16)>>>0}}function Fe(e){if(+e==e)return e;let t=[],n=e.split(".."),i=+n[0],s=+n[1],r=i;if(i<s)for(;r<=s;r++)t.push(r);else for(;r>=s;r--)t.push(r);return t}class $e{constructor({image:t,frameWidth:n,frameHeight:i,spacing:s=0,margin:r=0,animations:a}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:n,height:i,spacing:s,margin:r},this._f=(t.width-r)/n|0,this.createAnimations(a)}createAnimations(t){let n,i;for(i in t){let{frames:s,frameRate:r,loop:a}=t[i];if(n=[],s==null)throw Error("Animation "+i+" must provide a frames property");[].concat(s).map(o=>{n=n.concat(Fe(o))}),this.animations[i]=ue({spriteSheet:this,frames:n,frameRate:r,loop:a,name:i})}}}function Ye(){return new $e(...arguments)}let Ue=2147483648,Ge=1073741824,Vt=536870912;function et(e,t){return e/t|0}function it(e,t){return e/t|0}class Ne{constructor(t={}){let{width:n,height:i,tilewidth:s,tileheight:r,tilesets:a}=t,o=n*s,l=i*r,c=document.createElement("canvas");c.width=o,c.height=l,this._c=c,this._ctx=c.getContext("2d"),a.map(d=>{let{__k:f,location:p}=window,u=(f?f.dm.get(t):"")||p.href,{source:_}=d;if(_){if(!f)throw Error('You must use "load" or "loadData" to resolve tileset.source');let g=f.d[f.u(_,u)];if(!g)throw Error(`You must load the tileset source "${_}" before loading the tileset`);Object.keys(g).map(E=>{d[E]=g[E]})}let{image:y}=d;if(""+y===y){if(!f)throw Error('You must use "load" or "loadImage" to resolve tileset.image');let g=f.i[f.u(y,u)];if(!g)throw Error(`You must load the image "${y}" before loading the tileset`);d.image=g}}),Object.assign(this,{context:H(),layerMap:{},layerCanvases:{},mapwidth:o,mapheight:l,_sx:0,_sy:0,_o:[],...t}),this.context&&this._p(),dt("init",()=>{this.context??=H(),this._p()})}get sx(){return this._sx}get sy(){return this._sy}set sx(t){let n=Math.max(0,this.mapwidth-N().width);this._sx=q(0,n,t)}set sy(t){let n=Math.max(0,this.mapheight-N().height);this._sy=q(0,n,t)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map(n=>{this._o.push(n),n.parent=this})}remove(...t){t.flat().map(n=>{ie(this._o,n),n.parent=null})}getPosition(t){let n=N().getBoundingClientRect(),i=t.x-n.x,s=t.y-n.y;return i+=this.sx,s+=this.sy,{x:i,y:s,row:et(s,this.tileheight),col:it(i,this.tilewidth)}}setTileAtLayer(t,n,i){let{layerMap:s,tileheight:r,tilewidth:a,width:o}=this,{row:l,col:c,x:d,y:f}=n,p=l??et(f,r),u=c??it(d,a);s[t]&&(this._d=!0,s[t]._d=!0,s[t].data[p*o+u]=i)}setLayer(t,n){let{layerMap:i}=this;i[t]&&(this._d=!0,i[t]._d=!0,i[t].data=n)}layerCollidesWith(t,n){let{tilewidth:i,tileheight:s,layerMap:r}=this,{x:a,y:o,width:l,height:c}=ee(n),d=et(o,s),f=it(a,i),p=et(o+c,s),u=it(a+l,i),_=r[t];for(let y=d;y<=p;y++)for(let g=f;g<=u;g++)if(_.data[g+y*this.width])return!0;return!1}tileAtLayer(t,n){let{layerMap:i,tileheight:s,tilewidth:r,width:a}=this,{row:o,col:l,x:c,y:d}=n,f=o??et(d,s),p=l??it(c,r);return i[t]?i[t].data[f*a+p]:-1}render(t=this._c,n=!0){let{_d:i,context:s,sx:r=0,sy:a=0}=this;i&&this._p();let{width:o,height:l}=N(),c=Math.min(t.width,o),d=Math.min(t.height,l);s.drawImage(t,r,a,c,d,0,0,c,d),n&&(s.save(),(r||a)&&s.translate(-r,-a),this.objects.map(f=>f.render&&f.render()),s.restore())}renderLayer(t){let{layerCanvases:n,layerMap:i}=this,s=i[t],r=n[t],a=r?.getContext("2d");if(!r){let{mapwidth:o,mapheight:l}=this;r=document.createElement("canvas"),a=r.getContext("2d"),r.width=o,r.height=l,n[t]=r,this._rl(s,a)}s._d&&(s._d=!1,a.clearRect(0,0,r.width,r.height),this._rl(s,a)),this.render(r,!1)}_p(){let{_ctx:t,layers:n=[],layerMap:i}=this;this._d=!1,n.map(s=>{let{name:r,data:a,visible:o}=s;s._d=!1,i[r]=s,a&&o!=!1&&this._rl(s,t)})}_rl(t,n){let{opacity:i,data:s=[]}=t,{tilesets:r,width:a,tilewidth:o,tileheight:l}=this;n.save(),n.globalAlpha=i,s.map((c,d)=>{if(!c)return;let f=0,p=0,u=c&Ue,_=c&Ge,y=0,g=0,E=0,b=0,ft=0;f=u||_,c&=1073741823,ft=c&Vt,ft&&(u&&_?E=1:u?y=1:_?g=1:b=1,p=y||g||E||b,c&=~Vt);let z;for(let ut=r.length-1;ut>=0&&(z=r[ut],!(c/z.firstgid>=1));ut--);let{image:kt,spacing:R=0,margin:O=0,firstgid:W,columns:F}=z,I=c-W,M=F??kt.width/(o+R)|0,k=d%a*o,L=(d/a|0)*l,Gt=O+I%M*(o+R),K=O+(I/M|0)*(l+R);p?(n.save(),n.translate(k+o/2,L+l/2),g||b?n.rotate(-Math.PI/2):(y||E)&&n.rotate(Math.PI/2),(E||b)&&n.scale(-1,1),k=-o/2,L=-l/2):f&&(n.save(),n.translate(k+(u?o:0),L+(_?l:0)),n.scale(u?-1:1,_?-1:1),k=f?0:k,L=f?0:L),n.drawImage(kt,Gt,K,o,l,k,L,o,l),(f||p)&&n.restore()}),n.restore()}}function Be(){return new Ne(...arguments)}function qe(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var At={exports:{}},Rt,Jt;function Xe(){return Jt||(Jt=1,Rt=function(e,t){this.reset=function(){this.cards=e.slice(0),this.length=this.cards.length},this.shuffle=function(){n(this.cards)},this.reset(),this.shuffle(),this.deal=function(i,s){for(var r=0;r<i;r++)for(var a=0;a<s.length;a++){if(!s[a]||!s[a].push)throw new Error("Deck#deal | Undefined Hand");s[a].push(this.cards.pop())}this.length=this.cards.length},this.draw=function(i){if(!i||i<=1)return this.length=this.cards.length-1,this.cards.pop();for(var s=[],r=0;r<i;r++)s.push(this.cards.pop());return this.length=this.cards.length,s},this.drawFromBottomOfDeck=function(i){(!i||i<1)&&(i=1);for(var s=[],r=0;r<i;r++)s.push(this.cards.shift());return this.length=this.cards.length,s.length===1?s[0]:s},this.drawRandom=function(i){var s=function(){var o=Math.floor(t()*this.cards.length),l=this.cards[o];return this.cards.splice(o,1),this.length=this.cards.length,l};if(!i||i<=1)return s.apply(this);for(var r=[],a=0;a<i;a++)r.push(s.apply(this));return r},this.putOnTopOfDeck=function(i){if(!i instanceof Array)this.cards.push(i);else for(var s=0;s<i.length;s++)this.cards.push(i[s]);this.length=this.cards.length},this.putOnBottomOfDeck=function(i){if(!i instanceof Array)this.cards.unshift(i);else for(var s=0;s<i.length;s++)this.cards.unshift(i[s]);this.length=this.cards.length};function n(i){var s=i.length;if(s===0)return!1;for(;--s;){var r=Math.floor(t()*(s+1)),a=i[s],o=i[r];i[s]=o,i[r]=a}}}),Rt}var Ot,Qt;function ze(){return Qt||(Qt=1,Ot=function(e,t,n){this.suit=e,this.description=t,this.sort=n,this.toString=function(){return this.description+" of "+this.suit+"s"},this.toShortDisplayString=function(){var i=this.suit.substring(0,1),s;switch(this.sort){case 11:s="J";break;case 12:s="Q";break;case 13:s="K";break;case 14:s="A";break;default:s=this.sort}return s+i}}),Ot}var It,jt;function Ke(){if(jt)return It;jt=1;var e=ze();return It=function(){this.cards=[new e("Club","Two",2),new e("Club","Three",3),new e("Club","Four",4),new e("Club","Five",5),new e("Club","Six",6),new e("Club","Seven",7),new e("Club","Eight",8),new e("Club","Nine",9),new e("Club","Ten",10),new e("Club","Jack",11),new e("Club","Queen",12),new e("Club","King",13),new e("Club","Ace",14),new e("Diamond","Two",2),new e("Diamond","Three",3),new e("Diamond","Four",4),new e("Diamond","Five",5),new e("Diamond","Six",6),new e("Diamond","Seven",7),new e("Diamond","Eight",8),new e("Diamond","Nine",9),new e("Diamond","Ten",10),new e("Diamond","Jack",11),new e("Diamond","Queen",12),new e("Diamond","King",13),new e("Diamond","Ace",14),new e("Heart","Two",2),new e("Heart","Three",3),new e("Heart","Four",4),new e("Heart","Five",5),new e("Heart","Six",6),new e("Heart","Seven",7),new e("Heart","Eight",8),new e("Heart","Nine",9),new e("Heart","Ten",10),new e("Heart","Jack",11),new e("Heart","Queen",12),new e("Heart","King",13),new e("Heart","Ace",14),new e("Spade","Two",2),new e("Spade","Three",3),new e("Spade","Four",4),new e("Spade","Five",5),new e("Spade","Six",6),new e("Spade","Seven",7),new e("Spade","Eight",8),new e("Spade","Nine",9),new e("Spade","Ten",10),new e("Spade","Jack",11),new e("Spade","Queen",12),new e("Spade","King",13),new e("Spade","Ace",14)]},It}var Zt;function Ve(){if(Zt)return At.exports;Zt=1;var e=Xe(),t=Ke(),n=At.exports={},i={deck:new t().cards,numberOfDecks:1,random:function(){return Math.random()}};return n.playingCards=function(){return new t().cards},n.shuffle=function(s){if(s||(s=i),s.deck||(s.deck=i.deck),s.numberOfDecks)for(var r=s.deck,a=0;a<s.numberOfDecks-1;a++)s.deck=s.deck.concat(r);return s.random||(s.random=i.random),new e(s.deck,s.random)},At.exports}var Je=Ve();const ct=qe(Je),st=1,rt=2,at=3,ot=4,ht=5,lt=6,xt=1,Et=2,vt=3,Tt=4,Q=[{id:1,name:"Fools' Landing",flooded:!1,adventurer:lt},{id:2,name:"Cave of Shadows",flooded:!1,treasure:vt},{id:3,name:"Temple of the Moon",flooded:!1,treasure:xt},{id:4,name:"Copper Gate",flooded:!1,adventurer:at},{id:5,name:"Whispering Garden",flooded:!1,treasure:Et},{id:6,name:"Dunes of Deception",flooded:!1},{id:7,name:"Silver Gate",flooded:!1,adventurer:ot},{id:8,name:"Observatory",flooded:!1},{id:9,name:"Breakers Bridge",flooded:!1},{id:10,name:"Twilight Hollow",flooded:!1},{id:11,name:"Lost Lagoon",flooded:!1},{id:12,name:"Bronze Gate",flooded:!1,adventurer:rt},{id:13,name:"Phantom Rock",flooded:!1},{id:14,name:"Watchtower",flooded:!1},{id:15,name:"Cliffs of Abandon",flooded:!1},{id:16,name:"Misty Marsh",flooded:!1},{id:17,name:"Coral Palace",flooded:!1,treasure:Tt},{id:18,name:"Howling Garden",flooded:!1,treasure:Et},{id:19,name:"Iron Gate",flooded:!1,adventurer:st},{id:20,name:"Gold Gate",flooded:!1,adventurer:ht},{id:21,name:"Crimson Forest",flooded:!1},{id:22,name:"Temple of the Sun",flooded:!1,treasure:xt},{id:23,name:"Cave of Embers",flooded:!1,treasure:vt},{id:24,name:"Tidal Palace",flooded:!1,treasure:Tt}],Qe=[{id:ot,name:"Messenger",color:"silver",type:"adventurer"},{id:lt,name:"Pilot",color:"blue",type:"adventurer"},{id:rt,name:"Engineer",color:"red",type:"adventurer"},{id:at,name:"Explorer",color:"green",type:"adventurer"},{id:st,name:"Diver",color:"black",type:"adventurer"},{id:ht,name:"Navigator",color:"yellow",type:"adventurer"}],je=[{name:"Fools' Landing",type:"flood"},{name:"Cave of Shadows",type:"flood"},{name:"Temple of the Moon",type:"flood"},{name:"Copper Gate",type:"flood"},{name:"Whispering Garden",type:"flood"},{name:"Dunes of Deception",type:"flood"},{name:"Silver Gate",type:"flood"},{name:"Observatory",type:"flood"},{name:"Breakers Bridge",type:"flood"},{name:"Twilight Hollow",type:"flood"},{name:"Lost Lagoon",type:"flood"},{name:"Bronze Gate",type:"flood"},{name:"Phantom Rock",type:"flood"},{name:"Watchtower",type:"flood"},{name:"Cliffs of Abandon",type:"flood"},{name:"Misty Marsh",type:"flood"},{name:"Coral Palace",type:"flood"},{name:"Howling Garden",type:"flood"},{name:"Iron Gate",type:"flood"},{name:"Gold Gate",type:"flood"},{name:"Crimson Forest",type:"flood"},{name:"Temple of the Sun",type:"flood"},{name:"Cave of Embers",type:"flood"},{name:"Tidal Palace",type:"flood"}];function U(e,t){const n=[];for(let i=0;i<e;++i)n.push(t);return n}const Ze=[...U(5,{name:"The Earth Stone",type:"treasure"}),...U(5,{name:"The Statue of the Wind",type:"treasure"}),...U(5,{name:"The Crystal of Fire",type:"treasure"}),...U(5,{name:"The Ocean's Chalice",type:"treasure"}),...U(3,{name:"Waters Rise!",type:"treasure"}),...U(3,{name:"Helicopter Lift",type:"treasure"}),...U(3,{name:"Sandbags",type:"treasure"})],ae=[...Qe,...je,...Ze],oe=0,ti=1,ei=2,ii=3,bt=2,B=512,j=256,A=32*bt,x=32*bt,wt=24*bt,pt=24*bt,v=A/4/2,ni="lime",si=2,ri="aqua",ai="adventurer-deck",oi="flood-deck",hi="island-tiles-deck",li="treasure-deck",di=6,ci=oe;Dt(ai);const fi=ct.shuffle({deck:ae.filter(({type:e})=>e==="adventurer"),random:St}),he=""+new URL("spritesheet-Dm4BmPvg.png",import.meta.url).href,le=""+new URL("tilesheet-C_zpU0l5.png",import.meta.url).href,ui=[he,le],wi=e=>Se(...ui);Dt(oi);const pi=ct.shuffle({deck:Q,random:St});function gi(){function e(){this.context.fillStyle=this.color,this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,2*Math.PI),this.context.fill(),this.context.lineWidth=2,this.context.strokeStyle="white",this.context.stroke()}const t=D({color:"black",id:st,radius:v,render(){e.call(this)}}),n=D({color:"red",id:rt,radius:v,render(){e.call(this)}}),i=D({color:"green",id:at,radius:v,render(){e.call(this)}}),s=D({color:"silver",id:ot,radius:v,render(){e.call(this)}}),r=D({color:"yellow",id:ht,radius:v,render(){e.call(this)}}),a=D({color:"blue",id:lt,radius:v,render(){e.call(this)}});return{diverPawn:t,engineerPawn:n,explorerPawn:i,messengerPawn:s,navigatorPawn:r,pilotPawn:a}}function mi(){return D({color:ni,render(){if(this.context.beginPath(),this.radius!==void 0)this.context.arc(this.radius,this.radius,this.radius,0,2*Math.PI);else if(this.width!==void 0&&this.height!==void 0)this.context.rect(0,0,this.width,this.height);else return;this.context.lineWidth=si,this.context.strokeStyle=this.color,this.context.stroke()}})}function yi(){const e=Ye({image:Y[he],frameWidth:A,frameHeight:x,animations:Q.map((n,i)=>({[i]:{frames:i*2,frameRate:1},[`${i}-flooded`]:{frames:[i*2+1],frameRate:1}})).reduce((n,i)=>({...n,...i}))}),t=[];for(let n=0;n<Q.length;++n){const i=D({animations:e.animations,id:1+n,flooded:Q[n].flooded});i.playAnimation(n),t.push(i)}return t}async function _i(){try{const e=Y[le];return Be({tilewidth:A,tileheight:x,width:8,height:8,tilesets:[{firstgid:0,image:e}],layers:[{name:"ground",data:[0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,0,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0]}]})}catch(e){return console.error(e),null}}function xi(){const e=D({color:"brown",width:wt,height:pt,id:xt}),t=D({color:"yellow",width:wt,height:pt,id:Et}),n=D({color:"red",width:wt,height:pt,id:vt}),i=D({color:"blue",width:wt,height:pt,id:Tt});return{theCrystalOfFire:n,theEarthStone:e,theOceansChalice:i,theStatueOfTheWind:t}}function Ei(){return D({x:0,y:0,color:ri,width:B,height:j})}const nt=Object.freeze([{cardsToDraw:2,difficultyLevel:oe},{cardsToDraw:2,difficultyLevel:ti},{cardsToDraw:3,difficultyLevel:ei},{cardsToDraw:3,difficultyLevel:ii},{cardsToDraw:3},{cardsToDraw:4},{cardsToDraw:4},{cardsToDraw:5},{cardsToDraw:5}]);function vi(e=ci){const t=nt.findIndex(i=>i.difficultyLevel===e);if(t===-1)throw new Error("Invalid starting water level");return D({color:"white",x:-B,backgroundColor:"teal",font:`${x/2}px Arial`,startingWaterLevel:t,text:`${nt[t].cardsToDraw}`,waterLevel:t,render(){const i=this.text.split(`
`);if(i.length===0)return;this.context.font=this.font,this.context.textBaseline="top";let s=-1;for(let r=0;r<i.length;++r){const a=this.context.measureText(i[r]),o=a.actualBoundingBoxRight+a.actualBoundingBoxLeft;o>s&&(s=o)}this.width=Math.ceil(s),this.height=i.length*x/2,this.x=B-this.width,this.y=j-this.height,this.context.fillStyle=this.backgroundColor,this.context.fillRect(0,0,this.width,this.height),this.context.fillStyle=this.color;for(let r=0;r<i.length;++r)this.context.fillText(i[r],0,r*x/2)},increment(){this.waterLevel<nt.length-1&&(++this.waterLevel,this.text=`${nt[this.waterLevel].cardsToDraw}`)},reset(){this.waterLevel=this.startingWaterLevel,this.text=`${nt[this.waterLevel].cardsToDraw}`}})}Dt(hi);const Ti=ct.shuffle({deck:Q,random:St});function Ci(e){return function(){const{innerWidth:t,innerHeight:n}=window,i=t/n,s=B/j;i<s?(e.style.width=`${t}px`,e.style.height=`${t/s}px`):(e.style.width=`${n*s}px`,e.style.height=`${n}px`)}}function Si(e,t=`
`){const n={};for(const s of e)n[s.name]===void 0?n[s.name]=1:++n[s.name];const i=[];for(const[s,r]of Object.entries(n))i.push(`${r} x ${s}`);return i.join(t)}Dt(li);const gt=ct.shuffle({deck:ae.filter(({type:e})=>e==="treasure"),random:St}),Di=29.25,bi="0.0.38",te={hours:Di,version:bi};async function ki(){const{canvas:e,context:t}=fe();e.width=B,e.height=j;const n=Ci(e);n(),window.addEventListener("resize",n),Me();const i=`v${te.version}`,s=`${te.hours}h`,r=Bt({text:`${i}
${s}`,font:`${x/4}px Courier`,color:"white",x:B-A/4*Math.max(i.length,s.length),y:x/4}),a=Bt({font:`${x/4}px Arial`,color:"white",x:A/4,y:x/4});await wi();const o=await _i();if(o===null)return 1;o.sx=(A*8-B)/2,o.sy=(x*8-j)/2;const l=()=>{const{y:h}=Ae();if(h<x){let w=o.sy-x;w=q(0,o.mapheight-x-1,w),o.sy=w}else if(h>j-x-1){let w=o.sy+x;w=q(0,o.mapheight-x-1,w),o.sy=w}};o.onDown=()=>{l(),p(),a.text=""},S(o);const c=Ei();c.onDown=()=>{l(),p(),a.text=""},S(c);const d=mi(),f=h=>{d.x=h.x,d.y=h.y,h.radius?(d.radius=h.radius,d.width=d.height=void 0):(d.width=h.width,d.height=h.height,d.radius=void 0)},p=()=>{d.width=d.height=d.radius=void 0},u=yi(),_=o.layers.find(({name:h})=>h==="ground");if(_!==void 0){for(let h=0;h<o.height;++h)for(let w=0;w<o.width;++w)if(_.data[h*o.width+w]!==0){const m=Ti.draw(),T=u[m.id-1];T.x=w*T.width,T.y=h*T.height,T.onDown=()=>{l();let C=m.name;if(T.flooded&&(C+=`
FLOODED!`),m.adventurer!==void 0)switch(m.adventurer){case st:C+=`
(Diver)`;break;case rt:C+=`
(Engineer)`;break;case at:C+=`
(Explorer)`;break;case ot:C+=`
(Messenger)`;break;case ht:C+=`
(Navigator)`;break;case lt:C+=`
(Pilot)`}if(m.treasure!==void 0)switch(m.treasure){case vt:C+=`
(The Crystal of Fire)`;break;case xt:C+=`
(The Earth Stone)`;break;case Tt:C+=`
(The Ocean's Chalice)`;break;case Et:C+=`
(The Statue of the Wind)`}f(T),a.text=C},S(T),o.add(T)}}const{theCrystalOfFire:y,theEarthStone:g,theOceansChalice:E,theStatueOfTheWind:b}=xi();g.x=u[0].width+(u[0].width-g.width)/2,g.y=u[0].height+(u[0].height-g.height)/2,g.onDown=()=>{f(g),a.text="The Earth Stone"},S(g),o.add(g),b.x=u[0].width+(u[0].width-b.width)/2,b.y=u[0].height*6+(u[0].height-b.height)/2,b.onDown=()=>{f(b),a.text="The Statue of the Wind"},S(b),o.add(b),y.x=u[0].width*6+(u[0].width-y.width)/2,y.y=u[0].height+(u[0].height-y.height)/2,y.onDown=()=>{f(y),a.text="The Crystal of Fire"},S(y),o.add(y),E.x=u[0].width*6+(u[0].width-E.width)/2,E.y=u[0].height*6+(u[0].height-E.height)/2,E.onDown=()=>{f(E),a.text="The Ocean's Chalice"},S(E),o.add(E);const ft={...pi},z=[];for(let h=0;h<6;++h){const w=ft.draw(),m=u.find(({id:T})=>T===w.id);m.flooded=!0,m.playAnimation(`${m.id-1}-flooded`),z.push(w)}ct.shuffle({deck:[]}).putOnTopOfDeck(z);const R=[];for(let h=0;h<di;++h)R.push({name:`Player ${h+1}`,adventurerCard:fi.draw(),cards:[]});const O=h=>()=>{f(h);const w=R.find(({adventurerCard:T})=>T.id===h.id);if(w===void 0)return;const m=`${w.name}: ${w.adventurerCard.name}
Cards:
${Si(w.cards)}`;a.text=m},{diverPawn:W,engineerPawn:F,explorerPawn:I,messengerPawn:M,navigatorPawn:k,pilotPawn:L}=gi();for(const h of u){const w=Q.find(({id:m})=>m===h.id);if(w!==void 0&&!(w.adventurer!==void 0&&!R.map(({adventurerCard:m})=>m.id).includes(w.adventurer)))switch(w.adventurer){case st:W.x=h.x+(A-v*2)/2,W.y=h.y+(x-v*2)/2,W.onDown=O(W),S(W),o.add(W);break;case rt:F.x=h.x+(A-v*2)/2,F.y=h.y+(x-v*2)/2,F.onDown=O(F),S(F),o.add(F);break;case at:I.x=h.x+(A-v*2)/2,I.y=h.y+(x-v*2)/2,I.onDown=O(I),S(I),o.add(I);break;case ot:M.x=h.x+(A-v*2)/2,M.y=h.y+(x-v*2)/2,M.onDown=O(M),S(M),o.add(M);break;case ht:k.x=h.x+(A-v*2)/2,k.y=h.y+(x-v*2)/2,k.onDown=O(k),S(k),o.add(k);break;case lt:L.x=h.x+(A-v*2)/2,L.y=h.y+(x-v*2)/2,L.onDown=O(L),S(L),o.add(L);break}}o.add(d),gt.deal(2,R.map(({cards:h})=>h));for(const h of R){let w=h.cards.filter(({name:m})=>m==="Waters Rise!").length;for(;w>0;){console.log("Waters Rise! Replacement card required");for(let m=0;m<h.cards.length;++m)if(h.cards[m].name==="Waters Rise!"){const T=h.cards[m],C=gt.draw();h.cards[m]=C,gt.putOnTopOfDeck(T),gt.shuffle()}w=h.cards.filter(({name:m})=>m==="Waters Rise!").length}}(()=>{a.text=R.map(({name:h,adventurerCard:w})=>`${h}: ${w.name}`).join(`
`)})();const K=vi();return K.onDown=()=>{p(),a.text=`Water level: ${K.waterLevel}`},S(K),We({render(){c.render(),o.render(),K.render(),t.fillStyle="rgba(0, 0, 0, 0.67)",t.fillRect(r.x,r.y,r.width,r.height),r.render(),t.fillStyle="rgba(0, 0, 0, 0.67)",t.fillRect(a.x,a.y,a.width,a.height),a.render()},update(){}}).start(),0}ki();
