(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();/**
 * @preserve
 * Kontra.js v10.0.2
 */function Be(t,e){let n=Math.sin(e),r=Math.cos(e);return{x:t.x*r-t.y*n,y:t.x*n+t.y*r}}function st(t,e,n){return Math.min(Math.max(t,n),e)}function Ee(t){let{x:e=0,y:n=0,width:r,height:i,radius:s}=t.world||t;return t.mapwidth&&(r=t.mapwidth,i=t.mapheight),s&&(r=s.x*2,i=s.y*2),t.anchor&&(e-=r*t.anchor.x,n-=i*t.anchor.y),r<0&&(e+=r,r*=-1),i<0&&(n+=i,i*=-1),{x:e,y:n,width:r,height:i}}let Nt=()=>{};function Te(t,e){let n=t.indexOf(e);if(n!=-1)return t.splice(n,1),!0}function Ge(t,e){let{x:n,y:r,width:i,height:s}=Ee(e);do n-=e.sx||0,r-=e.sy||0;while(e=e.parent);let o=t.x-Math.max(n,Math.min(t.x,n+i)),a=t.y-Math.max(r,Math.min(t.y,r+s));return o*o+a*a<t.radius*t.radius}let Ft={};function Ct(t,e){Ft[t]=Ft[t]||[],Ft[t].push(e)}function ot(t,...e){(Ft[t]||[]).map(n=>n(...e))}let nt,Rt,ce={get(t,e){return e=="_proxy"?!0:Nt}};function rt(){return nt}function X(){return Rt}function ze(t,{contextless:e=!1}={}){if(nt=document.getElementById(t)||t||document.querySelector("canvas"),e&&(nt=nt||new Proxy({},ce)),!nt)throw Error("You must provide a canvas element for the game");return Rt=nt.getContext("2d")||new Proxy({},ce),Rt.imageSmoothingEnabled=!1,ot("init"),{canvas:nt,context:Rt}}class re{constructor({spriteSheet:e,frames:n,frameRate:r,loop:i=!0,name:s}){let{width:o,height:a,spacing:l=0,margin:h=0}=e.frame;Object.assign(this,{spriteSheet:e,frames:n,frameRate:r,loop:i,name:s,width:o,height:a,spacing:l,margin:h,isStopped:!1,_f:0,_a:0})}clone(){return new re(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(e=1/60){if(!this.isStopped){if(!this.loop&&this._f==this.frames.length-1){this.stop();return}for(this._a+=e;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}}render({x:e,y:n,width:r=this.width,height:i=this.height,context:s=X()}){let o=this.frames[this._f]/this.spriteSheet._f|0,a=this.frames[this._f]%this.spriteSheet._f|0;s.drawImage(this.spriteSheet.image,this.margin+a*this.width+(a*2+1)*this.spacing,this.margin+o*this.height+(o*2+1)*this.spacing,this.width,this.height,e,n,r,i)}}function We(){return new re(...arguments)}let qe=/(jpeg|jpg|gif|png|webp)$/,Ue=/(wav|mp3|ogg|aac)$/,Ye=/^\//,je=/\/$/,Se=new WeakMap,Xe="",Ke="",Je="";function zt(t,e){return new URL(t,e).href}function ie(t,e){return[t.replace(je,""),e].filter(n=>n).join("/")}function se(t){return t.split(".").pop()}function oe(t){let e=t.replace("."+se(t),"");return e.split("/").length==2?e.replace(Ye,""):e}function Ve(t){return{wav:t.canPlayType('audio/wav; codecs="1"'),mp3:t.canPlayType("audio/mpeg;"),ogg:t.canPlayType('audio/ogg; codecs="vorbis"'),aac:t.canPlayType("audio/aac;")}}let Q={},wt={},ct={};function ae(){window.__k||(window.__k={dm:Se,u:zt,d:ct,i:Q})}function Ze(t){return ae(),new Promise((e,n)=>{let r,i,s;if(r=ie(Xe,t),Q[r])return e(Q[r]);i=new Image,i.onload=function(){s=zt(r,window.location.href),Q[oe(t)]=Q[r]=Q[s]=this,ot("assetLoaded",this,t),e(this)},i.onerror=function(){n("Unable to load image "+r)},i.src=r})}function Qe(t){return new Promise((e,n)=>{let r=t,i,s,o,a;if(i=new Audio,s=Ve(i),t=[].concat(t).reduce((l,h)=>l||(s[se(h)]?h:null),0),!t)return n("cannot play any of the audio formats provided "+r);if(o=ie(Ke,t),wt[o])return e(wt[o]);i.addEventListener("canplay",function(){a=zt(o,window.location.href),wt[oe(t)]=wt[o]=wt[a]=this,ot("assetLoaded",this,t),e(this)}),i.onerror=function(){n("Unable to load audio "+o)},i.src=o,i.load()})}function tn(t){ae();let e,n;return e=ie(Je,t),ct[e]?Promise.resolve(ct[e]):fetch(e).then(r=>{if(!r.ok)throw r;return r.clone().json().catch(()=>r.text())}).then(r=>(n=zt(e,window.location.href),typeof r=="object"&&Se.set(r,n),ct[oe(t)]=ct[e]=ct[n]=r,ot("assetLoaded",r,t),r))}function en(...t){return ae(),Promise.all(t.map(e=>{let n=se([].concat(e)[0]);return n.match(qe)?Ze(e):n.match(Ue)?Qe(e):tn(e)}))}class ut{constructor(e=0,n=0,r={}){e.x!=null?(this.x=e.x,this.y=e.y):(this.x=e,this.y=n),r._c&&(this.clamp(r._a,r._b,r._d,r._e),this.x=e,this.y=n)}set(e){this.x=e.x,this.y=e.y}add(e){return new ut(this.x+e.x,this.y+e.y,this)}subtract(e){return new ut(this.x-e.x,this.y-e.y,this)}scale(e){return new ut(this.x*e,this.y*e)}normalize(e=this.length()||1){return new ut(this.x/e,this.y/e)}dot(e){return this.x*e.x+this.y*e.y}length(){return Math.hypot(this.x,this.y)}distance(e){return Math.hypot(this.x-e.x,this.y-e.y)}angle(e){return Math.acos(this.dot(e)/(this.length()*e.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(e,n,r,i){this._c=!0,this._a=e,this._b=n,this._d=r,this._e=i}get x(){return this._x}get y(){return this._y}set x(e){this._x=this._c?st(this._a,this._d,e):e}set y(e){this._y=this._c?st(this._b,this._e,e):e}}function jt(){return new ut(...arguments)}class nn{constructor(e){return this.init(e)}init(e={}){this.position=jt(),this.velocity=jt(),this.acceleration=jt(),this.ttl=1/0,Object.assign(this,e)}update(e){this.advance(e)}advance(e){let n=this.acceleration;e&&(n=n.scale(e)),this.velocity=this.velocity.add(n);let r=this.velocity;e&&(r=r.scale(e)),this.position=this.position.add(r),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(e){this.velocity.x=e}set dy(e){this.velocity.y=e}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(e){this.acceleration.x=e}set ddy(e){this.acceleration.y=e}isAlive(){return this.ttl>0}_pc(){}}class Ce extends nn{init({width:e=0,height:n=0,context:r=X(),render:i=this.draw,update:s=this.advance,children:o=[],anchor:a={x:0,y:0},opacity:l=1,rotation:h=0,drotation:c=0,ddrotation:u=0,scaleX:d=1,scaleY:w=1,...f}={}){this._c=[],super.init({width:e,height:n,context:r,anchor:a,opacity:l,rotation:h,drotation:c,ddrotation:u,scaleX:d,scaleY:w,...f}),this._di=!0,this._uw(),this.addChild(o),this._rf=i,this._uf=s,Ct("init",()=>{this.context??=X()})}update(e){this._uf(e),this.children.map(n=>n.update&&n.update(e))}render(){let e=this.context;e.save(),(this.x||this.y)&&e.translate(this.x,this.y),this.rotation&&e.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&e.scale(this.scaleX,this.scaleY);let n=this.width,r=this.height;this.radius&&(n=r=this.radius*2);let i=-n*this.anchor.x,s=-r*this.anchor.y;(i||s)&&e.translate(i,s),this.context.globalAlpha=this.opacity,this._rf(),(i||s)&&e.translate(-i,-s),this.children.map(a=>a.render&&a.render()),e.restore()}draw(){}_pc(){this._uw(),this.children.map(e=>e._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(e){this.position.x=e,this._pc()}set y(e){this.position.y=e,this._pc()}get width(){return this._w}set width(e){this._w=e,this._pc()}get height(){return this._h}set height(e){this._h=e,this._pc()}_uw(){if(!this._di)return;let{_wx:e=0,_wy:n=0,_wo:r=1,_wrot:i=0,_wsx:s=1,_wsy:o=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this.radius&&(this._wrx=this.radius,this._wry=this.radius),this._wo=r*this.opacity,this._wsx=s*this.scaleX,this._wsy=o*this.scaleY,this._wx=this._wx*s,this._wy=this._wy*o,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this.radius&&(this._wrx=this.radius*this._wsx,this._wry=this.radius*this._wsy),this._wrot=i+this.rotation;let{x:a,y:l}=Be({x:this._wx,y:this._wy},i);this._wx=a,this._wy=l,this._wx+=e,this._wy+=n}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,radius:this.radius?{x:this._wrx,y:this._wry}:void 0,opacity:this._wo,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}set children(e){this.removeChild(this._c),this.addChild(e)}get children(){return this._c}addChild(...e){e.flat().map(n=>{this.children.push(n),n.parent=this,n._pc=n._pc||Nt,n._pc()})}removeChild(...e){e.flat().map(n=>{Te(this.children,n)&&(n.parent=null,n._pc())})}get radius(){return this._r}set radius(e){this._r=e,this._pc()}get opacity(){return this._opa}set opacity(e){this._opa=st(0,1,e),this._pc()}get rotation(){return this._rot}set rotation(e){this._rot=e,this._pc()}advance(e){super.advance(e),this.drotation+=this.ddrotation,this.rotation+=this.drotation}setScale(e,n=e){this.scaleX=e,this.scaleY=n}get scaleX(){return this._scx}set scaleX(e){this._scx=e,this._pc()}get scaleY(){return this._scy}set scaleY(e){this._scy=e,this._pc()}}class rn extends Ce{init({image:e,width:n=e?e.width:void 0,height:r=e?e.height:void 0,...i}={}){super.init({image:e,width:n,height:r,...i})}get animations(){return this._a}set animations(e){let n,r;this._a={};for(n in e)this._a[n]=e[n].clone(),r=r||this._a[n];this.currentAnimation=r,this.width=this.width||r.width,this.height=this.height||r.height}playAnimation(e){this.currentAnimation?.stop(),this.currentAnimation=this.animations[e],this.currentAnimation.start()}advance(e){super.advance(e),this.currentAnimation?.update(e)}draw(){if(this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color){if(this.context.fillStyle=this.color,this.radius){this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.context.fill();return}this.context.fillRect(0,0,this.width,this.height)}}}function $(){return new rn(...arguments)}let sn=/(\d+)(\w+)/;function on(t){if(!t)return{computed:0};let e=t.match(sn),n=+e[1],r=e[2];return{size:n,unit:r,computed:n}}class an extends Ce{init({text:e="",textAlign:n="",lineHeight:r=1,font:i=X()?.font,...s}={}){e=""+e,super.init({text:e,textAlign:n,lineHeight:r,font:i,...s}),this.context&&this._p(),Ct("init",()=>{this.font??=X().font,this._p()})}get width(){return this._w}set width(e){this._d=!0,this._w=e,this._fw=e}get text(){return this._t}set text(e){this._d=!0,this._t=""+e}get font(){return this._f}set font(e){this._d=!0,this._f=e,this._fs=on(e).computed}get lineHeight(){return this._lh}set lineHeight(e){this._d=!0,this._lh=e}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let e=this.context,n=[this.text];if(e.font=this.font,n=this.text.split(`
`),this._fw&&n.map(r=>{let i=r.split(" "),s=i.shift(),o=s;i.map(a=>{o+=" "+a,e.measureText(o).width>this._fw&&(this._s.push(s),o=a),s=o}),this._s.push(o)}),!this._s.length&&this.text.includes(`
`)){let r=0;n.map(i=>{this._s.push(i),r=Math.max(r,e.measureText(i).width)}),this._w=this._fw||r}this._s.length||(this._s.push(this.text),this._w=this._fw||e.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let e=0,n=this.textAlign,r=this.context;n=this.textAlign||(r.canvas.dir=="rtl"?"right":"left"),e=n=="right"?this.width:n=="center"?this.width/2|0:0,this._s.map((i,s)=>{r.textBaseline="top",r.textAlign=n,r.fillStyle=this.color,r.font=this.font,this.strokeColor&&(r.strokeStyle=this.strokeColor,r.lineWidth=this.lineWidth??1,r.strokeText(i,e,this._fs*this.lineHeight*s)),r.fillText(i,e,this._fs*this.lineHeight*s)})}}function ue(){return new an(...arguments)}let mt=new WeakMap,fe={},le={},De={0:"left",1:"middle",2:"right"};function ln(t=rt()){return mt.get(t)}function hn(t){let e=t._lf.length?t._lf:t._cf;for(let n=e.length-1;n>=0;n--){let r=e[n];if(r.collidesWithPointer?r.collidesWithPointer(t):Ge(t,r))return r}}function G(t,e){return parseFloat(t.getPropertyValue(e))||0}function cn(t){let{canvas:e,_s:n}=t,r=e.getBoundingClientRect(),i=n.transform!="none"?n.transform.replace("matrix(","").split(","):[1,1,1,1],s=parseFloat(i[0]),o=parseFloat(i[3]),a=(G(n,"border-left-width")+G(n,"border-right-width"))*s,l=(G(n,"border-top-width")+G(n,"border-bottom-width"))*o,h=(G(n,"padding-left")+G(n,"padding-right"))*s,c=(G(n,"padding-top")+G(n,"padding-bottom"))*o;return{scaleX:(r.width-a-h)/e.width,scaleY:(r.height-l-c)/e.height,offsetX:r.left+(G(n,"border-left-width")+G(n,"padding-left"))*s,offsetY:r.top+(G(n,"border-top-width")+G(n,"padding-top"))*o}}function de(t){let e=t.button!=null?De[t.button]:"left";le[e]=!0,he(t,"onDown")}function Xt(t){let e=t.button!=null?De[t.button]:"left";le[e]=!1,he(t,"onUp")}function pe(t){he(t,"onOver")}function un(t){let e=mt.get(t.target);e._oo=null,le={}}function ge(t,e,n){let r=hn(t);r&&r[e]&&r[e](n),fe[e]&&fe[e](n,r),e=="onOver"&&(r!=t._oo&&t._oo&&t._oo.onOut&&t._oo.onOut(n),t._oo=r)}function he(t,e){t.preventDefault();let n=t.target,r=mt.get(n),{scaleX:i,scaleY:s,offsetX:o,offsetY:a}=cn(r);t.type.includes("touch")?(Array.from(t.touches).map(({clientX:h,clientY:c,identifier:u})=>{let d=r.touches[u];d||(d=r.touches[u]={start:{x:(h-o)/i,y:(c-a)/s}},r.touches.length++),d.changed=!1}),Array.from(t.changedTouches).map(({clientX:h,clientY:c,identifier:u})=>{let d=r.touches[u];d.changed=!0,d.x=r.x=(h-o)/i,d.y=r.y=(c-a)/s,ge(r,e,t),ot("touchChanged",t,r.touches),e=="onUp"&&(delete r.touches[u],r.touches.length--,r.touches.length||ot("touchEnd"))})):(r.x=(t.clientX-o)/i,r.y=(t.clientY-a)/s,ge(r,e,t))}function fn({radius:t=5,canvas:e=rt()}={}){let n=mt.get(e);if(!n){let r=window.getComputedStyle(e);n={x:0,y:0,radius:t,touches:{length:0},canvas:e,_cf:[],_lf:[],_o:[],_oo:null,_s:r},mt.set(e,n)}return e.addEventListener("mousedown",de),e.addEventListener("touchstart",de),e.addEventListener("mouseup",Xt),e.addEventListener("touchend",Xt),e.addEventListener("touchcancel",Xt),e.addEventListener("blur",un),e.addEventListener("mousemove",pe),e.addEventListener("touchmove",pe),n._t||(n._t=!0,Ct("tick",()=>{n._lf.length=0,n._cf.map(r=>{n._lf.push(r)}),n._cf.length=0})),n}function N(...t){t.flat().map(e=>{let n=e.context?e.context.canvas:rt(),r=mt.get(n);if(!r)throw new ReferenceError("Pointer events not initialized for the objects canvas");e.__r||(e.__r=e.render,e.render=function(){r._cf.push(this),this.__r()},r._o.push(e))})}function dn(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}function pn({fps:t=60,clearCanvas:e=!0,update:n=Nt,render:r,context:i=X(),blur:s=!1}={}){if(!r)throw Error("You must provide a render() function");let o=0,a=1e3/t,l=1/t,h=e?dn:Nt,c,u,d,w,f,_=!0;s||(window.addEventListener("focus",()=>{_=!0}),window.addEventListener("blur",()=>{_=!1})),Ct("init",()=>{f.context??=X()});function g(){if(u=requestAnimationFrame(g),!!_&&(d=performance.now(),w=d-c,c=d,!(w>1e3))){for(o+=w;o>=a;)ot("tick"),f.update(l),o-=a;h(f.context),f.render()}}return f={update:n,render:r,isStopped:!0,context:i,start(){this.isStopped&&(c=performance.now(),this.isStopped=!1,requestAnimationFrame(g))},stop(){this.isStopped=!0,cancelAnimationFrame(u)},_frame:g,set _last(y){c=y}},f}let Z;function Wt(){Z??=Date.now(),Z|=0,Z=Z+2654435769|0;let t=Z^Z>>>16;return t=Math.imul(t,569420461),t=t^t>>>15,t=Math.imul(t,1935289751),((t=t^t>>>15)>>>0)/4294967296}function qt(t=Date.now()){if(Z=t,typeof t=="string"){for(var e=0,n=1779033703^t.length;e<t.length;e++)n=Math.imul(n^t.charCodeAt(e),3432918353),n=n<<13|n>>>19;n=Math.imul(n^n>>>16,2246822507),n=Math.imul(n^n>>>13,3266489909),Z=(n^=n>>>16)>>>0}}function gn(t){if(+t==t)return t;let e=[],n=t.split(".."),r=+n[0],i=+n[1],s=r;if(r<i)for(;s<=i;s++)e.push(s);else for(;s>=i;s--)e.push(s);return e}class mn{constructor({image:e,frameWidth:n,frameHeight:r,spacing:i=0,margin:s=0,animations:o}={}){if(!e)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=e,this.frame={width:n,height:r,spacing:i,margin:s},this._f=(e.width-s)/n|0,this.createAnimations(o)}createAnimations(e){let n,r;for(r in e){let{frames:i,frameRate:s,loop:o}=e[r];if(n=[],i==null)throw Error("Animation "+r+" must provide a frames property");[].concat(i).map(a=>{n=n.concat(gn(a))}),this.animations[r]=We({spriteSheet:this,frames:n,frameRate:s,loop:o,name:r})}}}function wn(){return new mn(...arguments)}let yn=2147483648,_n=1073741824,me=536870912;function yt(t,e){return t/e|0}function _t(t,e){return t/e|0}class bn{constructor(e={}){let{width:n,height:r,tilewidth:i,tileheight:s,tilesets:o}=e,a=n*i,l=r*s,h=document.createElement("canvas");h.width=a,h.height=l,this._c=h,this._ctx=h.getContext("2d"),o.map(c=>{let{__k:u,location:d}=window,w=(u?u.dm.get(e):"")||d.href,{source:f}=c;if(f){if(!u)throw Error('You must use "load" or "loadData" to resolve tileset.source');let g=u.d[u.u(f,w)];if(!g)throw Error(`You must load the tileset source "${f}" before loading the tileset`);Object.keys(g).map(y=>{c[y]=g[y]})}let{image:_}=c;if(""+_===_){if(!u)throw Error('You must use "load" or "loadImage" to resolve tileset.image');let g=u.i[u.u(_,w)];if(!g)throw Error(`You must load the image "${_}" before loading the tileset`);c.image=g}}),Object.assign(this,{context:X(),layerMap:{},layerCanvases:{},mapwidth:a,mapheight:l,_sx:0,_sy:0,_o:[],...e}),this.context&&this._p(),Ct("init",()=>{this.context??=X(),this._p()})}get sx(){return this._sx}get sy(){return this._sy}set sx(e){let n=Math.max(0,this.mapwidth-rt().width);this._sx=st(0,n,e)}set sy(e){let n=Math.max(0,this.mapheight-rt().height);this._sy=st(0,n,e)}set objects(e){this.remove(this._o),this.add(e)}get objects(){return this._o}add(...e){e.flat().map(n=>{this._o.push(n),n.parent=this})}remove(...e){e.flat().map(n=>{Te(this._o,n),n.parent=null})}getPosition(e){let n=rt().getBoundingClientRect(),r=e.x-n.x,i=e.y-n.y;return r+=this.sx,i+=this.sy,{x:r,y:i,row:yt(i,this.tileheight),col:_t(r,this.tilewidth)}}setTileAtLayer(e,n,r){let{layerMap:i,tileheight:s,tilewidth:o,width:a}=this,{row:l,col:h,x:c,y:u}=n,d=l??yt(u,s),w=h??_t(c,o);i[e]&&(this._d=!0,i[e]._d=!0,i[e].data[d*a+w]=r)}setLayer(e,n){let{layerMap:r}=this;r[e]&&(this._d=!0,r[e]._d=!0,r[e].data=n)}layerCollidesWith(e,n){let{tilewidth:r,tileheight:i,layerMap:s}=this,{x:o,y:a,width:l,height:h}=Ee(n),c=yt(a,i),u=_t(o,r),d=yt(a+h,i),w=_t(o+l,r),f=s[e];for(let _=c;_<=d;_++)for(let g=u;g<=w;g++)if(f.data[g+_*this.width])return!0;return!1}tileAtLayer(e,n){let{layerMap:r,tileheight:i,tilewidth:s,width:o}=this,{row:a,col:l,x:h,y:c}=n,u=a??yt(c,i),d=l??_t(h,s);return r[e]?r[e].data[u*o+d]:-1}render(e=this._c,n=!0){let{_d:r,context:i,sx:s=0,sy:o=0}=this;r&&this._p();let{width:a,height:l}=rt(),h=Math.min(e.width,a),c=Math.min(e.height,l);i.drawImage(e,s,o,h,c,0,0,h,c),n&&(i.save(),(s||o)&&i.translate(-s,-o),this.objects.map(u=>u.render&&u.render()),i.restore())}renderLayer(e){let{layerCanvases:n,layerMap:r}=this,i=r[e],s=n[e],o=s?.getContext("2d");if(!s){let{mapwidth:a,mapheight:l}=this;s=document.createElement("canvas"),o=s.getContext("2d"),s.width=a,s.height=l,n[e]=s,this._rl(i,o)}i._d&&(i._d=!1,o.clearRect(0,0,s.width,s.height),this._rl(i,o)),this.render(s,!1)}_p(){let{_ctx:e,layers:n=[],layerMap:r}=this;this._d=!1,n.map(i=>{let{name:s,data:o,visible:a}=i;i._d=!1,r[s]=i,o&&a!=!1&&this._rl(i,e)})}_rl(e,n){let{opacity:r,data:i=[]}=e,{tilesets:s,width:o,tilewidth:a,tileheight:l}=this;n.save(),n.globalAlpha=r,i.map((h,c)=>{if(!h)return;let u=0,d=0,w=h&yn,f=h&_n,_=0,g=0,y=0,b=0,O=0;u=w||f,h&=1073741823,O=h&me,O&&(w&&f?y=1:w?_=1:f?g=1:b=1,d=_||g||y||b,h&=~me);let K;for(let lt=s.length-1;lt>=0&&(K=s[lt],!(h/K.firstgid>=1));lt--);let{image:J,spacing:at=0,margin:H=0,firstgid:U,columns:q}=K,B=h-U,R=q??J.width/(a+at)|0,E=c%o*a,P=(c/o|0)*l,Y=H+B%R*(a+at),V=H+(B/R|0)*(l+at);d?(n.save(),n.translate(E+a/2,P+l/2),g||b?n.rotate(-Math.PI/2):(_||y)&&n.rotate(Math.PI/2),(y||b)&&n.scale(-1,1),E=-a/2,P=-l/2):u&&(n.save(),n.translate(E+(w?a:0),P+(f?l:0)),n.scale(w?-1:1,f?-1:1),E=u?0:E,P=u?0:P),n.drawImage(J,Y,V,a,l,E,P,a,l),(u||d)&&n.restore()}),n.restore()}}function xn(){return new bn(...arguments)}function Ae(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Kt={exports:{}},Jt,we;function vn(){return we||(we=1,Jt=function(t,e){this.reset=function(){this.cards=t.slice(0),this.length=this.cards.length},this.shuffle=function(){n(this.cards)},this.reset(),this.shuffle(),this.deal=function(r,i){for(var s=0;s<r;s++)for(var o=0;o<i.length;o++){if(!i[o]||!i[o].push)throw new Error("Deck#deal | Undefined Hand");i[o].push(this.cards.pop())}this.length=this.cards.length},this.draw=function(r){if(!r||r<=1)return this.length=this.cards.length-1,this.cards.pop();for(var i=[],s=0;s<r;s++)i.push(this.cards.pop());return this.length=this.cards.length,i},this.drawFromBottomOfDeck=function(r){(!r||r<1)&&(r=1);for(var i=[],s=0;s<r;s++)i.push(this.cards.shift());return this.length=this.cards.length,i.length===1?i[0]:i},this.drawRandom=function(r){var i=function(){var a=Math.floor(e()*this.cards.length),l=this.cards[a];return this.cards.splice(a,1),this.length=this.cards.length,l};if(!r||r<=1)return i.apply(this);for(var s=[],o=0;o<r;o++)s.push(i.apply(this));return s},this.putOnTopOfDeck=function(r){if(!r instanceof Array)this.cards.push(r);else for(var i=0;i<r.length;i++)this.cards.push(r[i]);this.length=this.cards.length},this.putOnBottomOfDeck=function(r){if(!r instanceof Array)this.cards.unshift(r);else for(var i=0;i<r.length;i++)this.cards.unshift(r[i]);this.length=this.cards.length};function n(r){var i=r.length;if(i===0)return!1;for(;--i;){var s=Math.floor(e()*(i+1)),o=r[i],a=r[s];r[i]=a,r[s]=o}}}),Jt}var Vt,ye;function kn(){return ye||(ye=1,Vt=function(t,e,n){this.suit=t,this.description=e,this.sort=n,this.toString=function(){return this.description+" of "+this.suit+"s"},this.toShortDisplayString=function(){var r=this.suit.substring(0,1),i;switch(this.sort){case 11:i="J";break;case 12:i="Q";break;case 13:i="K";break;case 14:i="A";break;default:i=this.sort}return i+r}}),Vt}var Zt,_e;function Mn(){if(_e)return Zt;_e=1;var t=kn();return Zt=function(){this.cards=[new t("Club","Two",2),new t("Club","Three",3),new t("Club","Four",4),new t("Club","Five",5),new t("Club","Six",6),new t("Club","Seven",7),new t("Club","Eight",8),new t("Club","Nine",9),new t("Club","Ten",10),new t("Club","Jack",11),new t("Club","Queen",12),new t("Club","King",13),new t("Club","Ace",14),new t("Diamond","Two",2),new t("Diamond","Three",3),new t("Diamond","Four",4),new t("Diamond","Five",5),new t("Diamond","Six",6),new t("Diamond","Seven",7),new t("Diamond","Eight",8),new t("Diamond","Nine",9),new t("Diamond","Ten",10),new t("Diamond","Jack",11),new t("Diamond","Queen",12),new t("Diamond","King",13),new t("Diamond","Ace",14),new t("Heart","Two",2),new t("Heart","Three",3),new t("Heart","Four",4),new t("Heart","Five",5),new t("Heart","Six",6),new t("Heart","Seven",7),new t("Heart","Eight",8),new t("Heart","Nine",9),new t("Heart","Ten",10),new t("Heart","Jack",11),new t("Heart","Queen",12),new t("Heart","King",13),new t("Heart","Ace",14),new t("Spade","Two",2),new t("Spade","Three",3),new t("Spade","Four",4),new t("Spade","Five",5),new t("Spade","Six",6),new t("Spade","Seven",7),new t("Spade","Eight",8),new t("Spade","Nine",9),new t("Spade","Ten",10),new t("Spade","Jack",11),new t("Spade","Queen",12),new t("Spade","King",13),new t("Spade","Ace",14)]},Zt}var be;function En(){if(be)return Kt.exports;be=1;var t=vn(),e=Mn(),n=Kt.exports={},r={deck:new e().cards,numberOfDecks:1,random:function(){return Math.random()}};return n.playingCards=function(){return new e().cards},n.shuffle=function(i){if(i||(i=r),i.deck||(i.deck=r.deck),i.numberOfDecks)for(var s=i.deck,o=0;o<i.numberOfDecks-1;o++)i.deck=i.deck.concat(s);return i.random||(i.random=r.random),new t(i.deck,i.random)},Kt.exports}var Tn=En();const Dt=Ae(Tn),vt=1,kt=2,Mt=3,Et=4,Tt=5,St=6,$t=1,Ht=2,Bt=3,Gt=4,ft=[{id:1,name:"Fools' Landing",flooded:!1,adventurer:St},{id:2,name:"Cave of Shadows",flooded:!1,treasure:Bt},{id:3,name:"Temple of the Moon",flooded:!1,treasure:$t},{id:4,name:"Copper Gate",flooded:!1,adventurer:Mt},{id:5,name:"Whispering Garden",flooded:!1,treasure:Ht},{id:6,name:"Dunes of Deception",flooded:!1},{id:7,name:"Silver Gate",flooded:!1,adventurer:Et},{id:8,name:"Observatory",flooded:!1},{id:9,name:"Breakers Bridge",flooded:!1},{id:10,name:"Twilight Hollow",flooded:!1},{id:11,name:"Lost Lagoon",flooded:!1},{id:12,name:"Bronze Gate",flooded:!1,adventurer:kt},{id:13,name:"Phantom Rock",flooded:!1},{id:14,name:"Watchtower",flooded:!1},{id:15,name:"Cliffs of Abandon",flooded:!1},{id:16,name:"Misty Marsh",flooded:!1},{id:17,name:"Coral Palace",flooded:!1,treasure:Gt},{id:18,name:"Howling Garden",flooded:!1,treasure:Ht},{id:19,name:"Iron Gate",flooded:!1,adventurer:vt},{id:20,name:"Gold Gate",flooded:!1,adventurer:Tt},{id:21,name:"Crimson Forest",flooded:!1},{id:22,name:"Temple of the Sun",flooded:!1,treasure:$t},{id:23,name:"Cave of Embers",flooded:!1,treasure:Bt},{id:24,name:"Tidal Palace",flooded:!1,treasure:Gt}],Sn=[{id:Et,name:"Messenger",color:"silver",type:"adventurer"},{id:St,name:"Pilot",color:"blue",type:"adventurer"},{id:kt,name:"Engineer",color:"firebrick",type:"adventurer"},{id:Mt,name:"Explorer",color:"green",type:"adventurer"},{id:vt,name:"Diver",color:"black",type:"adventurer"},{id:Tt,name:"Navigator",color:"yellow",type:"adventurer"}],Cn=[{name:"Fools' Landing",type:"flood"},{name:"Cave of Shadows",type:"flood"},{name:"Temple of the Moon",type:"flood"},{name:"Copper Gate",type:"flood"},{name:"Whispering Garden",type:"flood"},{name:"Dunes of Deception",type:"flood"},{name:"Silver Gate",type:"flood"},{name:"Observatory",type:"flood"},{name:"Breakers Bridge",type:"flood"},{name:"Twilight Hollow",type:"flood"},{name:"Lost Lagoon",type:"flood"},{name:"Bronze Gate",type:"flood"},{name:"Phantom Rock",type:"flood"},{name:"Watchtower",type:"flood"},{name:"Cliffs of Abandon",type:"flood"},{name:"Misty Marsh",type:"flood"},{name:"Coral Palace",type:"flood"},{name:"Howling Garden",type:"flood"},{name:"Iron Gate",type:"flood"},{name:"Gold Gate",type:"flood"},{name:"Crimson Forest",type:"flood"},{name:"Temple of the Sun",type:"flood"},{name:"Cave of Embers",type:"flood"},{name:"Tidal Palace",type:"flood"}];function et(t,e){const n=[];for(let r=0;r<t;++r)n.push(e);return n}const Dn=Object.freeze([...et(5,{name:"The Earth Stone",type:"treasure"}),...et(5,{name:"The Statue of the Wind",type:"treasure"}),...et(5,{name:"The Crystal of Fire",type:"treasure"}),...et(5,{name:"The Ocean's Chalice",type:"treasure"}),...et(3,{name:"Waters Rise!",type:"treasure"}),...et(3,{name:"Helicopter Lift",type:"treasure"}),...et(3,{name:"Sandbags",type:"treasure"})]),Le=Object.freeze([...Sn,...Cn,...Dn]),Oe=0,An=1,Ln=2,On=3,Ut=2,it=512,dt=256,z=32*Ut,M=32*Ut,At=24*Ut,Lt=24*Ut,C=z/4/2,Pn="hotpink",Fn=2,Rn="aqua",In="adventurer-deck",Nn="flood-deck",$n="island-tiles-deck",Hn="treasure-deck",Pe=6,Bn=Oe;qt(In);const Gn=Dt.shuffle({deck:Le.filter(({type:t})=>t==="adventurer"),random:Wt}),Fe=""+new URL("spritesheet-Dm4BmPvg.png",import.meta.url).href,Re=""+new URL("tilesheet-C_zpU0l5.png",import.meta.url).href,zn=[Fe,Re],Wn=t=>en(...zn),W={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Ie=Object.create(null);for(const t in W)Object.hasOwn(W,t)&&(Ie[W[t]]=t);const S={to:{},get:{}};S.get=function(t){const e=t.slice(0,3).toLowerCase();let n,r;switch(e){case"hsl":{n=S.get.hsl(t),r="hsl";break}case"hwb":{n=S.get.hwb(t),r="hwb";break}default:{n=S.get.rgb(t),r="rgb";break}}return n?{model:r,value:n}:null};S.get.rgb=function(t){if(!t)return null;const e=/^#([a-f\d]{3,4})$/i,n=/^#([a-f\d]{6})([a-f\d]{2})?$/i,r=/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[\s,|/]\s*([+-]?[\d.]+)(%?)\s*)?\)$/,i=/^rgba?\(\s*([+-]?[\d.]+)%\s*,?\s*([+-]?[\d.]+)%\s*,?\s*([+-]?[\d.]+)%\s*(?:[\s,|/]\s*([+-]?[\d.]+)(%?)\s*)?\)$/,s=/^(\w+)$/;let o=[0,0,0,1],a,l,h;if(a=t.match(n)){for(h=a[2],a=a[1],l=0;l<3;l++){const c=l*2;o[l]=Number.parseInt(a.slice(c,c+2),16)}h&&(o[3]=Number.parseInt(h,16)/255)}else if(a=t.match(e)){for(a=a[1],h=a[3],l=0;l<3;l++)o[l]=Number.parseInt(a[l]+a[l],16);h&&(o[3]=Number.parseInt(h+h,16)/255)}else if(a=t.match(r)){for(l=0;l<3;l++)o[l]=Number.parseInt(a[l+1],10);a[4]&&(o[3]=a[5]?Number.parseFloat(a[4])*.01:Number.parseFloat(a[4]))}else if(a=t.match(i)){for(l=0;l<3;l++)o[l]=Math.round(Number.parseFloat(a[l+1])*2.55);a[4]&&(o[3]=a[5]?Number.parseFloat(a[4])*.01:Number.parseFloat(a[4]))}else return(a=t.match(s))?a[1]==="transparent"?[0,0,0,0]:Object.hasOwn(W,a[1])?(o=W[a[1]],o[3]=1,o):null:null;for(l=0;l<3;l++)o[l]=tt(o[l],0,255);return o[3]=tt(o[3],0,1),o};S.get.hsl=function(t){if(!t)return null;const e=/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d.]+)%\s*,?\s*([+-]?[\d.]+)%\s*(?:[,|/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/,n=t.match(e);if(n){const r=Number.parseFloat(n[4]),i=(Number.parseFloat(n[1])%360+360)%360,s=tt(Number.parseFloat(n[2]),0,100),o=tt(Number.parseFloat(n[3]),0,100),a=tt(Number.isNaN(r)?1:r,0,1);return[i,s,o,a]}return null};S.get.hwb=function(t){if(!t)return null;const e=/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*[\s,]\s*([+-]?[\d.]+)%\s*[\s,]\s*([+-]?[\d.]+)%\s*(?:[\s,]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/,n=t.match(e);if(n){const r=Number.parseFloat(n[4]),i=(Number.parseFloat(n[1])%360+360)%360,s=tt(Number.parseFloat(n[2]),0,100),o=tt(Number.parseFloat(n[3]),0,100),a=tt(Number.isNaN(r)?1:r,0,1);return[i,s,o,a]}return null};S.to.hex=function(...t){return"#"+Ot(t[0])+Ot(t[1])+Ot(t[2])+(t[3]<1?Ot(Math.round(t[3]*255)):"")};S.to.rgb=function(...t){return t.length<4||t[3]===1?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"};S.to.rgb.percent=function(...t){const e=Math.round(t[0]/255*100),n=Math.round(t[1]/255*100),r=Math.round(t[2]/255*100);return t.length<4||t[3]===1?"rgb("+e+"%, "+n+"%, "+r+"%)":"rgba("+e+"%, "+n+"%, "+r+"%, "+t[3]+")"};S.to.hsl=function(...t){return t.length<4||t[3]===1?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"};S.to.hwb=function(...t){let e="";return t.length>=4&&t[3]!==1&&(e=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+e+")"};S.to.keyword=function(...t){return Ie[t.slice(0,3)]};function tt(t,e,n){return Math.min(Math.max(e,t),n)}function Ot(t){const e=Math.round(t).toString(16).toUpperCase();return e.length<2?"0"+e:e}const Ne={};for(const t of Object.keys(W))Ne[W[t]]=t;const p={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},oklab:{channels:3,labels:["okl","oka","okb"]},lch:{channels:3,labels:"lch"},oklch:{channels:3,labels:["okl","okc","okh"]},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}},j=(6/29)**3;function pt(t){const e=t>.0031308?1.055*t**.4166666666666667-.055:t*12.92;return Math.min(Math.max(0,e),1)}function gt(t){return t>.04045?((t+.055)/1.055)**2.4:t/12.92}for(const t of Object.keys(p)){if(!("channels"in p[t]))throw new Error("missing channels property: "+t);if(!("labels"in p[t]))throw new Error("missing channel labels property: "+t);if(p[t].labels.length!==p[t].channels)throw new Error("channel and label counts mismatch: "+t);const{channels:e,labels:n}=p[t];delete p[t].channels,delete p[t].labels,Object.defineProperty(p[t],"channels",{value:e}),Object.defineProperty(p[t],"labels",{value:n})}p.rgb.hsl=function(t){const e=t[0]/255,n=t[1]/255,r=t[2]/255,i=Math.min(e,n,r),s=Math.max(e,n,r),o=s-i;let a,l;switch(s){case i:{a=0;break}case e:{a=(n-r)/o;break}case n:{a=2+(r-e)/o;break}case r:{a=4+(e-n)/o;break}}a=Math.min(a*60,360),a<0&&(a+=360);const h=(i+s)/2;return s===i?l=0:h<=.5?l=o/(s+i):l=o/(2-s-i),[a,l*100,h*100]};p.rgb.hsv=function(t){let e,n,r,i,s;const o=t[0]/255,a=t[1]/255,l=t[2]/255,h=Math.max(o,a,l),c=h-Math.min(o,a,l),u=function(d){return(h-d)/6/c+1/2};if(c===0)i=0,s=0;else{switch(s=c/h,e=u(o),n=u(a),r=u(l),h){case o:{i=r-n;break}case a:{i=1/3+e-r;break}case l:{i=2/3+n-e;break}}i<0?i+=1:i>1&&(i-=1)}return[i*360,s*100,h*100]};p.rgb.hwb=function(t){const e=t[0],n=t[1];let r=t[2];const i=p.rgb.hsl(t)[0],s=1/255*Math.min(e,Math.min(n,r));return r=1-1/255*Math.max(e,Math.max(n,r)),[i,s*100,r*100]};p.rgb.oklab=function(t){const e=gt(t[0]/255),n=gt(t[1]/255),r=gt(t[2]/255),i=Math.cbrt(.4122214708*e+.5363325363*n+.0514459929*r),s=Math.cbrt(.2119034982*e+.6806995451*n+.1073969566*r),o=Math.cbrt(.0883024619*e+.2817188376*n+.6299787005*r),a=.2104542553*i+.793617785*s-.0040720468*o,l=1.9779984951*i-2.428592205*s+.4505937099*o,h=.0259040371*i+.7827717662*s-.808675766*o;return[a*100,l*100,h*100]};p.rgb.cmyk=function(t){const e=t[0]/255,n=t[1]/255,r=t[2]/255,i=Math.min(1-e,1-n,1-r),s=(1-e-i)/(1-i)||0,o=(1-n-i)/(1-i)||0,a=(1-r-i)/(1-i)||0;return[s*100,o*100,a*100,i*100]};function qn(t,e){return(t[0]-e[0])**2+(t[1]-e[1])**2+(t[2]-e[2])**2}p.rgb.keyword=function(t){const e=Ne[t];if(e)return e;let n=Number.POSITIVE_INFINITY,r;for(const i of Object.keys(W)){const s=W[i],o=qn(t,s);o<n&&(n=o,r=i)}return r};p.keyword.rgb=function(t){return W[t]};p.rgb.xyz=function(t){const e=gt(t[0]/255),n=gt(t[1]/255),r=gt(t[2]/255),i=e*.4124564+n*.3575761+r*.1804375,s=e*.2126729+n*.7151522+r*.072175,o=e*.0193339+n*.119192+r*.9503041;return[i*100,s*100,o*100]};p.rgb.lab=function(t){const e=p.rgb.xyz(t);let n=e[0],r=e[1],i=e[2];n/=95.047,r/=100,i/=108.883,n=n>j?n**(1/3):7.787*n+16/116,r=r>j?r**(1/3):7.787*r+16/116,i=i>j?i**(1/3):7.787*i+16/116;const s=116*r-16,o=500*(n-r),a=200*(r-i);return[s,o,a]};p.hsl.rgb=function(t){const e=t[0]/360,n=t[1]/100,r=t[2]/100;let i,s;if(n===0)return s=r*255,[s,s,s];const o=r<.5?r*(1+n):r+n-r*n,a=2*r-o,l=[0,0,0];for(let h=0;h<3;h++)i=e+1/3*-(h-1),i<0&&i++,i>1&&i--,6*i<1?s=a+(o-a)*6*i:2*i<1?s=o:3*i<2?s=a+(o-a)*(2/3-i)*6:s=a,l[h]=s*255;return l};p.hsl.hsv=function(t){const e=t[0];let n=t[1]/100,r=t[2]/100,i=n;const s=Math.max(r,.01);r*=2,n*=r<=1?r:2-r,i*=s<=1?s:2-s;const o=(r+n)/2,a=r===0?2*i/(s+i):2*n/(r+n);return[e,a*100,o*100]};p.hsv.rgb=function(t){const e=t[0]/60,n=t[1]/100;let r=t[2]/100;const i=Math.floor(e)%6,s=e-Math.floor(e),o=255*r*(1-n),a=255*r*(1-n*s),l=255*r*(1-n*(1-s));switch(r*=255,i){case 0:return[r,l,o];case 1:return[a,r,o];case 2:return[o,r,l];case 3:return[o,a,r];case 4:return[l,o,r];case 5:return[r,o,a]}};p.hsv.hsl=function(t){const e=t[0],n=t[1]/100,r=t[2]/100,i=Math.max(r,.01);let s,o;o=(2-n)*r;const a=(2-n)*i;return s=n*i,s/=a<=1?a:2-a,s=s||0,o/=2,[e,s*100,o*100]};p.hwb.rgb=function(t){const e=t[0]/360;let n=t[1]/100,r=t[2]/100;const i=n+r;let s;i>1&&(n/=i,r/=i);const o=Math.floor(6*e),a=1-r;s=6*e-o,(o&1)!==0&&(s=1-s);const l=n+s*(a-n);let h,c,u;switch(o){default:case 6:case 0:{h=a,c=l,u=n;break}case 1:{h=l,c=a,u=n;break}case 2:{h=n,c=a,u=l;break}case 3:{h=n,c=l,u=a;break}case 4:{h=l,c=n,u=a;break}case 5:{h=a,c=n,u=l;break}}return[h*255,c*255,u*255]};p.cmyk.rgb=function(t){const e=t[0]/100,n=t[1]/100,r=t[2]/100,i=t[3]/100,s=1-Math.min(1,e*(1-i)+i),o=1-Math.min(1,n*(1-i)+i),a=1-Math.min(1,r*(1-i)+i);return[s*255,o*255,a*255]};p.xyz.rgb=function(t){const e=t[0]/100,n=t[1]/100,r=t[2]/100;let i,s,o;return i=e*3.2404542+n*-1.5371385+r*-.4985314,s=e*-.969266+n*1.8760108+r*.041556,o=e*.0556434+n*-.2040259+r*1.0572252,i=pt(i),s=pt(s),o=pt(o),[i*255,s*255,o*255]};p.xyz.lab=function(t){let e=t[0],n=t[1],r=t[2];e/=95.047,n/=100,r/=108.883,e=e>j?e**(1/3):7.787*e+16/116,n=n>j?n**(1/3):7.787*n+16/116,r=r>j?r**(1/3):7.787*r+16/116;const i=116*n-16,s=500*(e-n),o=200*(n-r);return[i,s,o]};p.xyz.oklab=function(t){const e=t[0]/100,n=t[1]/100,r=t[2]/100,i=Math.cbrt(.8189330101*e+.3618667424*n-.1288597137*r),s=Math.cbrt(.0329845436*e+.9293118715*n+.0361456387*r),o=Math.cbrt(.0482003018*e+.2643662691*n+.633851707*r),a=.2104542553*i+.793617785*s-.0040720468*o,l=1.9779984951*i-2.428592205*s+.4505937099*o,h=.0259040371*i+.7827717662*s-.808675766*o;return[a*100,l*100,h*100]};p.oklab.oklch=function(t){return p.lab.lch(t)};p.oklab.xyz=function(t){const e=t[0]/100,n=t[1]/100,r=t[2]/100,i=(.999999998*e+.396337792*n+.215803758*r)**3,s=(1.000000008*e-.105561342*n-.063854175*r)**3,o=(1.000000055*e-.089484182*n-1.291485538*r)**3,a=1.227013851*i-.55779998*s+.281256149*o,l=-.040580178*i+1.11225687*s-.071676679*o,h=-.076381285*i-.421481978*s+1.58616322*o;return[a*100,l*100,h*100]};p.oklab.rgb=function(t){const e=t[0]/100,n=t[1]/100,r=t[2]/100,i=(e+.3963377774*n+.2158037573*r)**3,s=(e-.1055613458*n-.0638541728*r)**3,o=(e-.0894841775*n-1.291485548*r)**3,a=pt(4.0767416621*i-3.3077115913*s+.2309699292*o),l=pt(-1.2684380046*i+2.6097574011*s-.3413193965*o),h=pt(-.0041960863*i-.7034186147*s+1.707614701*o);return[a*255,l*255,h*255]};p.oklch.oklab=function(t){return p.lch.lab(t)};p.lab.xyz=function(t){const e=t[0],n=t[1],r=t[2];let i,s,o;s=(e+16)/116,i=n/500+s,o=s-r/200;const a=s**3,l=i**3,h=o**3;return s=a>j?a:(s-16/116)/7.787,i=l>j?l:(i-16/116)/7.787,o=h>j?h:(o-16/116)/7.787,i*=95.047,s*=100,o*=108.883,[i,s,o]};p.lab.lch=function(t){const e=t[0],n=t[1],r=t[2];let i;i=Math.atan2(r,n)*360/2/Math.PI,i<0&&(i+=360);const o=Math.sqrt(n*n+r*r);return[e,o,i]};p.lch.lab=function(t){const e=t[0],n=t[1],i=t[2]/360*2*Math.PI,s=n*Math.cos(i),o=n*Math.sin(i);return[e,s,o]};p.rgb.ansi16=function(t,e=null){const[n,r,i]=t;let s=e===null?p.rgb.hsv(t)[2]:e;if(s=Math.round(s/50),s===0)return 30;let o=30+(Math.round(i/255)<<2|Math.round(r/255)<<1|Math.round(n/255));return s===2&&(o+=60),o};p.hsv.ansi16=function(t){return p.rgb.ansi16(p.hsv.rgb(t),t[2])};p.rgb.ansi256=function(t){const e=t[0],n=t[1],r=t[2];return e>>4===n>>4&&n>>4===r>>4?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(n/255*5)+Math.round(r/255*5)};p.ansi16.rgb=function(t){t=t[0];let e=t%10;if(e===0||e===7)return t>50&&(e+=3.5),e=e/10.5*255,[e,e,e];const n=(Math.trunc(t>50)+1)*.5,r=(e&1)*n*255,i=(e>>1&1)*n*255,s=(e>>2&1)*n*255;return[r,i,s]};p.ansi256.rgb=function(t){if(t=t[0],t>=232){const s=(t-232)*10+8;return[s,s,s]}t-=16;let e;const n=Math.floor(t/36)/5*255,r=Math.floor((e=t%36)/6)/5*255,i=e%6/5*255;return[n,r,i]};p.rgb.hex=function(t){const n=(((Math.round(t[0])&255)<<16)+((Math.round(t[1])&255)<<8)+(Math.round(t[2])&255)).toString(16).toUpperCase();return"000000".slice(n.length)+n};p.hex.rgb=function(t){const e=t.toString(16).match(/[a-f\d]{6}|[a-f\d]{3}/i);if(!e)return[0,0,0];let n=e[0];e[0].length===3&&(n=[...n].map(a=>a+a).join(""));const r=Number.parseInt(n,16),i=r>>16&255,s=r>>8&255,o=r&255;return[i,s,o]};p.rgb.hcg=function(t){const e=t[0]/255,n=t[1]/255,r=t[2]/255,i=Math.max(Math.max(e,n),r),s=Math.min(Math.min(e,n),r),o=i-s;let a;const l=o<1?s/(1-o):0;return o<=0?a=0:i===e?a=(n-r)/o%6:i===n?a=2+(r-e)/o:a=4+(e-n)/o,a/=6,a%=1,[a*360,o*100,l*100]};p.hsl.hcg=function(t){const e=t[1]/100,n=t[2]/100,r=n<.5?2*e*n:2*e*(1-n);let i=0;return r<1&&(i=(n-.5*r)/(1-r)),[t[0],r*100,i*100]};p.hsv.hcg=function(t){const e=t[1]/100,n=t[2]/100,r=e*n;let i=0;return r<1&&(i=(n-r)/(1-r)),[t[0],r*100,i*100]};p.hcg.rgb=function(t){const e=t[0]/360,n=t[1]/100,r=t[2]/100;if(n===0)return[r*255,r*255,r*255];const i=[0,0,0],s=e%1*6,o=s%1,a=1-o;let l=0;switch(Math.floor(s)){case 0:{i[0]=1,i[1]=o,i[2]=0;break}case 1:{i[0]=a,i[1]=1,i[2]=0;break}case 2:{i[0]=0,i[1]=1,i[2]=o;break}case 3:{i[0]=0,i[1]=a,i[2]=1;break}case 4:{i[0]=o,i[1]=0,i[2]=1;break}default:i[0]=1,i[1]=0,i[2]=a}return l=(1-n)*r,[(n*i[0]+l)*255,(n*i[1]+l)*255,(n*i[2]+l)*255]};p.hcg.hsv=function(t){const e=t[1]/100,n=t[2]/100,r=e+n*(1-e);let i=0;return r>0&&(i=e/r),[t[0],i*100,r*100]};p.hcg.hsl=function(t){const e=t[1]/100,r=t[2]/100*(1-e)+.5*e;let i=0;return r>0&&r<.5?i=e/(2*r):r>=.5&&r<1&&(i=e/(2*(1-r))),[t[0],i*100,r*100]};p.hcg.hwb=function(t){const e=t[1]/100,n=t[2]/100,r=e+n*(1-e);return[t[0],(r-e)*100,(1-r)*100]};p.hwb.hcg=function(t){const e=t[1]/100,r=1-t[2]/100,i=r-e;let s=0;return i<1&&(s=(r-i)/(1-i)),[t[0],i*100,s*100]};p.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]};p.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]};p.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]};p.gray.hsl=function(t){return[0,0,t[0]]};p.gray.hsv=p.gray.hsl;p.gray.hwb=function(t){return[0,100,t[0]]};p.gray.cmyk=function(t){return[0,0,0,t[0]]};p.gray.lab=function(t){return[t[0],0,0]};p.gray.hex=function(t){const e=Math.round(t[0]/100*255)&255,r=((e<<16)+(e<<8)+e).toString(16).toUpperCase();return"000000".slice(r.length)+r};p.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]};function Un(){const t={},e=Object.keys(p);for(let{length:n}=e,r=0;r<n;r++)t[e[r]]={distance:-1,parent:null};return t}function Yn(t){const e=Un(),n=[t];for(e[t].distance=0;n.length>0;){const r=n.pop(),i=Object.keys(p[r]);for(let{length:s}=i,o=0;o<s;o++){const a=i[o],l=e[a];l.distance===-1&&(l.distance=e[r].distance+1,l.parent=r,n.unshift(a))}}return e}function jn(t,e){return function(n){return e(t(n))}}function Xn(t,e){const n=[e[t].parent,t];let r=p[e[t].parent][t],i=e[t].parent;for(;e[i].parent;)n.unshift(e[i].parent),r=jn(p[e[i].parent][i],r),i=e[i].parent;return r.conversion=n,r}function Kn(t){const e=Yn(t),n={},r=Object.keys(e);for(let{length:i}=r,s=0;s<i;s++){const o=r[s];e[o].parent!==null&&(n[o]=Xn(o,e))}return n}const A={},Jn=Object.keys(p);function Vn(t){const e=function(...n){const r=n[0];return r==null?r:(r.length>1&&(n=r),t(n))};return"conversion"in t&&(e.conversion=t.conversion),e}function Zn(t){const e=function(...n){const r=n[0];if(r==null)return r;r.length>1&&(n=r);const i=t(n);if(typeof i=="object")for(let{length:s}=i,o=0;o<s;o++)i[o]=Math.round(i[o]);return i};return"conversion"in t&&(e.conversion=t.conversion),e}for(const t of Jn){A[t]={},Object.defineProperty(A[t],"channels",{value:p[t].channels}),Object.defineProperty(A[t],"labels",{value:p[t].labels});const e=Kn(t),n=Object.keys(e);for(const r of n){const i=e[r];A[t][r]=Zn(i),A[t][r].raw=Vn(i)}}const $e=["keyword","gray","hex"],Qt={};for(const t of Object.keys(A))Qt[[...A[t].labels].sort().join("")]=t;const te={};function D(t,e){if(!(this instanceof D))return new D(t,e);if(e&&e in $e&&(e=null),e&&!(e in A))throw new Error("Unknown model: "+e);let n,r;if(t==null)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof D)this.model=t.model,this.color=[...t.color],this.valpha=t.valpha;else if(typeof t=="string"){const i=S.get(t);if(i===null)throw new Error("Unable to parse color from string: "+t);this.model=i.model,r=A[this.model].channels,this.color=i.value.slice(0,r),this.valpha=typeof i.value[r]=="number"?i.value[r]:1}else if(t.length>0){this.model=e||"rgb",r=A[this.model].channels;const i=Array.prototype.slice.call(t,0,r);this.color=ee(i,r),this.valpha=typeof t[r]=="number"?t[r]:1}else if(typeof t=="number")this.model="rgb",this.color=[t>>16&255,t>>8&255,t&255],this.valpha=1;else{this.valpha=1;const i=Object.keys(t);"alpha"in t&&(i.splice(i.indexOf("alpha"),1),this.valpha=typeof t.alpha=="number"?t.alpha:0);const s=i.sort().join("");if(!(s in Qt))throw new Error("Unable to parse color from object: "+JSON.stringify(t));this.model=Qt[s];const{labels:o}=A[this.model],a=[];for(n=0;n<o.length;n++)a.push(t[o[n]]);this.color=ee(a)}if(te[this.model])for(r=A[this.model].channels,n=0;n<r;n++){const i=te[this.model][n];i&&(this.color[n]=i(this.color[n]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}D.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(t){let e=this.model in S.to?this:this.rgb();e=e.round(typeof t=="number"?t:1);const n=e.valpha===1?e.color:[...e.color,this.valpha];return S.to[e.model](...n)},percentString(t){const e=this.rgb().round(typeof t=="number"?t:1),n=e.valpha===1?e.color:[...e.color,this.valpha];return S.to.rgb.percent(...n)},array(){return this.valpha===1?[...this.color]:[...this.color,this.valpha]},object(){const t={},{channels:e}=A[this.model],{labels:n}=A[this.model];for(let r=0;r<e;r++)t[n[r]]=this.color[r];return this.valpha!==1&&(t.alpha=this.valpha),t},unitArray(){const t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,this.valpha!==1&&t.push(this.valpha),t},unitObject(){const t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,this.valpha!==1&&(t.alpha=this.valpha),t},round(t){return t=Math.max(t||0,0),new D([...this.color.map(tr(t)),this.valpha],this.model)},alpha(t){return t!==void 0?new D([...this.color,Math.max(0,Math.min(1,t))],this.model):this.valpha},red:k("rgb",0,T(255)),green:k("rgb",1,T(255)),blue:k("rgb",2,T(255)),hue:k(["hsl","hsv","hsl","hwb","hcg"],0,t=>(t%360+360)%360),saturationl:k("hsl",1,T(100)),lightness:k("hsl",2,T(100)),saturationv:k("hsv",1,T(100)),value:k("hsv",2,T(100)),chroma:k("hcg",1,T(100)),gray:k("hcg",2,T(100)),white:k("hwb",1,T(100)),wblack:k("hwb",2,T(100)),cyan:k("cmyk",0,T(100)),magenta:k("cmyk",1,T(100)),yellow:k("cmyk",2,T(100)),black:k("cmyk",3,T(100)),x:k("xyz",0,T(95.047)),y:k("xyz",1,T(100)),z:k("xyz",2,T(108.833)),l:k("lab",0,T(100)),a:k("lab",1),b:k("lab",2),keyword(t){return t!==void 0?new D(t):A[this.model].keyword(this.color)},hex(t){return t!==void 0?new D(t):S.to.hex(...this.rgb().round().color)},hexa(t){if(t!==void 0)return new D(t);const e=this.rgb().round().color;let n=Math.round(this.valpha*255).toString(16).toUpperCase();return n.length===1&&(n="0"+n),S.to.hex(...e)+n},rgbNumber(){const t=this.rgb().color;return(t[0]&255)<<16|(t[1]&255)<<8|t[2]&255},luminosity(){const t=this.rgb().color,e=[];for(const[n,r]of t.entries()){const i=r/255;e[n]=i<=.04045?i/12.92:((i+.055)/1.055)**2.4}return .2126*e[0]+.7152*e[1]+.0722*e[2]},contrast(t){const e=this.luminosity(),n=t.luminosity();return e>n?(e+.05)/(n+.05):(n+.05)/(e+.05)},level(t){const e=this.contrast(t);return e>=7?"AAA":e>=4.5?"AA":""},isDark(){const t=this.rgb().color;return(t[0]*2126+t[1]*7152+t[2]*722)/1e4<128},isLight(){return!this.isDark()},negate(){const t=this.rgb();for(let e=0;e<3;e++)t.color[e]=255-t.color[e];return t},lighten(t){const e=this.hsl();return e.color[2]+=e.color[2]*t,e},darken(t){const e=this.hsl();return e.color[2]-=e.color[2]*t,e},saturate(t){const e=this.hsl();return e.color[1]+=e.color[1]*t,e},desaturate(t){const e=this.hsl();return e.color[1]-=e.color[1]*t,e},whiten(t){const e=this.hwb();return e.color[1]+=e.color[1]*t,e},blacken(t){const e=this.hwb();return e.color[2]+=e.color[2]*t,e},grayscale(){const t=this.rgb().color,e=t[0]*.3+t[1]*.59+t[2]*.11;return D.rgb(e,e,e)},fade(t){return this.alpha(this.valpha-this.valpha*t)},opaquer(t){return this.alpha(this.valpha+this.valpha*t)},rotate(t){const e=this.hsl();let n=e.color[0];return n=(n+t)%360,n=n<0?360+n:n,e.color[0]=n,e},mix(t,e){if(!t||!t.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof t);const n=t.rgb(),r=this.rgb(),i=e===void 0?.5:e,s=2*i-1,o=n.alpha()-r.alpha(),a=((s*o===-1?s:(s+o)/(1+s*o))+1)/2,l=1-a;return D.rgb(a*n.red()+l*r.red(),a*n.green()+l*r.green(),a*n.blue()+l*r.blue(),n.alpha()*i+r.alpha()*(1-i))}};for(const t of Object.keys(A)){if($e.includes(t))continue;const{channels:e}=A[t];D.prototype[t]=function(...n){return this.model===t?new D(this):n.length>0?new D(n,t):new D([...er(A[this.model][t].raw(this.color)),this.valpha],t)},D[t]=function(...n){let r=n[0];return typeof r=="number"&&(r=ee(n,e)),new D(r,t)}}function Qn(t,e){return Number(t.toFixed(e))}function tr(t){return function(e){return Qn(e,t)}}function k(t,e,n){t=Array.isArray(t)?t:[t];for(const r of t)(te[r]||=[])[e]=n;return t=t[0],function(r){let i;return r!==void 0?(n&&(r=n(r)),i=this[t](),i.color[e]=r,i):(i=this[t]().color[e],n&&(i=n(i)),i)}}function T(t){return function(e){return Math.max(0,Math.min(t,e))}}function er(t){return Array.isArray(t)?t:[t]}function ee(t,e){for(let n=0;n<e;n++)typeof t[n]!="number"&&(t[n]=0);return t}/**
 * @author Markus Ekholm
 * @copyright 2012-2023 (c) Markus Ekholm <markus at botten dot org >
 * @license Copyright (c) 2012-2023, Markus Ekholm
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *    * Redistributions of source code must retain the above copyright
 *      notice, this list of conditions and the following disclaimer.
 *    * Redistributions in binary form must reproduce the above copyright
 *      notice, this list of conditions and the following disclaimer in the
 *      documentation and/or other materials provided with the distribution.
 *    * Neither the name of the author nor the
 *      names of its contributors may be used to endorse or promote products
 *      derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL MARKUS EKHOLM BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */function xe(t,e){e=ne(e||{R:255,G:255,B:255}),t=ne(t);let n=t;return t.A!==void 0&&(n={R:e.R+(t.R-e.R)*t.A,G:e.G+(t.G-e.G)*t.A,B:e.B+(t.B-e.B)*t.A}),rr(nr(n))}function nr(t){let e=t.R/255,n=t.G/255,r=t.B/255;e>.04045?e=Math.pow((e+.055)/1.055,2.4):e=e/12.92,n>.04045?n=Math.pow((n+.055)/1.055,2.4):n=n/12.92,r>.04045?r=Math.pow((r+.055)/1.055,2.4):r=r/12.92,e*=100,n*=100,r*=100;const i=e*.4124+n*.3576+r*.1805,s=e*.2126+n*.7152+r*.0722,o=e*.0193+n*.1192+r*.9505;return{X:i,Y:s,Z:o}}function rr(t){let i=t.Y/100,s=t.Z/108.883,o=t.X/95.047;o>.008856?o=Math.pow(o,1/3):o=7.787*o+16/116,i>.008856?i=Math.pow(i,1/3):i=7.787*i+16/116,s>.008856?s=Math.pow(s,1/3):s=7.787*s+16/116;const a=116*i-16,l=500*(o-i),h=200*(i-s);return{L:a,a:l,b:h}}function ne(t){let e,n,r,i;"R"in t?(e=t.R,n=t.G,r=t.B,i=t.A):(e=t.r,n=t.g,r=t.b,i=t.a);const s={R:e,G:n,B:r};return i!==void 0&&(s.A=i),s}/**
 * @author Markus Ekholm
 * @copyright 2012-2023 (c) Markus Ekholm <markus at botten dot org >
 * @license Copyright (c) 2012-2023, Markus Ekholm
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *    * Redistributions of source code must retain the above copyright
 *      notice, this list of conditions and the following disclaimer.
 *    * Redistributions in binary form must reproduce the above copyright
 *      notice, this list of conditions and the following disclaimer in the
 *      documentation and/or other materials provided with the distribution.
 *    * Neither the name of the author nor the
 *      names of its contributors may be used to endorse or promote products
 *      derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL MARKUS EKHOLM BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */function ir(t,e,n){("R"in t||"r"in t)&&(t=xe(t,n)),("R"in e||"r"in e)&&(e=xe(e,n));const r=t.L,i=t.a,s=t.b,o=e.L,a=e.a,l=e.b,h=1,c=1,u=1,d=Math.sqrt(Math.pow(i,2)+Math.pow(s,2)),w=Math.sqrt(Math.pow(a,2)+Math.pow(l,2)),f=(d+w)/2,_=.5*(1-Math.sqrt(Math.pow(f,7)/(Math.pow(f,7)+Math.pow(25,7)))),g=(1+_)*i,y=(1+_)*a,b=Math.sqrt(Math.pow(g,2)+Math.pow(s,2)),O=Math.sqrt(Math.pow(y,2)+Math.pow(l,2)),K=ve(s,g),J=ve(l,y),at=o-r,H=O-b,U=or(d,w,K,J),q=2*Math.sqrt(b*O)*Math.sin(ht(U)/2),B=(r+o)/2,R=(b+O)/2,E=ar(d,w,K,J),P=1-.17*Math.cos(ht(E-30))+.24*Math.cos(ht(2*E))+.32*Math.cos(ht(3*E+6))-.2*Math.cos(ht(4*E-63)),Y=30*Math.exp(-Math.pow((E-275)/25,2)),V=Math.sqrt(Math.pow(R,7)/(Math.pow(R,7)+Math.pow(25,7))),lt=1+.015*Math.pow(B-50,2)/Math.sqrt(20+Math.pow(B-50,2)),Yt=1+.045*R,m=1+.015*R*P,x=-2*V*Math.sin(ht(2*Y));return Math.sqrt(Math.pow(at/(lt*h),2)+Math.pow(H/(Yt*c),2)+Math.pow(q/(m*u),2)+x*(H/(Yt*c))*(q/(m*u)))}function sr(t){return t*(180/Math.PI)}function ht(t){return t*(Math.PI/180)}function ve(t,e){if(t===0&&e===0)return 0;{const n=sr(Math.atan2(t,e));return n>=0?n:n+360}}function or(t,e,n,r){if(t*e===0)return 0;if(Math.abs(r-n)<=180)return r-n;if(r-n>180)return r-n-360;if(r-n<-180)return r-n+360;throw new Error}function ar(t,e,n,r){if(t*e===0)return n+r;if(Math.abs(n-r)<=180)return(n+r)/2;if(Math.abs(n-r)>180&&n+r<360)return(n+r+360)/2;if(Math.abs(n-r)>180&&n+r>=360)return(n+r-360)/2;throw new Error}/**
 * @author Markus Ekholm
 * @copyright 2012-2023 (c) Markus Ekholm <markus at botten dot org >
 * @license Copyright (c) 2012-2023, Markus Ekholm
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *    * Redistributions of source code must retain the above copyright
 *      notice, this list of conditions and the following disclaimer.
 *    * Redistributions in binary form must reproduce the above copyright
 *      notice, this list of conditions and the following disclaimer in the
 *      documentation and/or other materials provided with the distribution.
 *    * Neither the name of the author nor the
 *      names of its contributors may be used to endorse or promote products
 *      derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL MARKUS EKHOLM BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */function He(t){return t=ne(t),t.A!==1?`rgba(${t.R}, ${t.G}, ${t.B}, ${t.A})`:`rgb(${t.R}, ${t.G}, ${t.B})`}function lr(t,e,n,r){const i={};r=r||{R:255,G:255,B:255},n=n||"closest";for(let s=0;s<t.length;s+=1){const o=t[s];let a,l;for(let h=0;h<e.length;h+=1){const c=e[h],u=ir(o,c,r);if(!a){a=c,l=u;continue}if(l!==void 0&&n==="closest"&&u<l){a=c,l=u;continue}if(l!==void 0&&n==="furthest"&&u>l){a=c,l=u;continue}}a&&(i[He(o)]=a)}return i}function hr(t,e,n){const r=He(t);return n=n||{R:255,G:255,B:255},lr([t],e,"closest",n)[r]}const cr=Object.freeze(["#ecebe7","#cbc6c1","#b28b78","#847066","#695b59","#4f4240","#352f2e","#723012","#845425","#a76343","#dc6a36","#f682bf","#d74060","#c5452b","#b02222","#8d1931","#6a1325","#3e1909","#406a3b","#76771d","#939446","#d3bd46","#99e0a8","#399a4d","#204f1a","#0f2c0c","#1a0a01","#14266a","#194f80","#2067a7","#49a3b4","#1de9de"]);function L(t){if(!Object.keys(W).includes(t))throw new Error("Invalid CSS color name");const[e,n,r]=W[t],i=hr({R:e,G:n,B:r},cr.map(s=>{const o=D(s).object();return{R:o.r,G:o.g,B:o.b}}));return`rgb(${i.R}, ${i.G}, ${i.B})`}qt(Nn);const ur=Dt.shuffle({deck:ft,random:Wt});var It={exports:{}},fr=It.exports,ke;function dr(){return ke||(ke=1,function(t,e){(function(r,i){t.exports=i()})(fr,function(){return function(n){var r={};function i(s){if(r[s])return r[s].exports;var o=r[s]={i:s,l:!1,exports:{}};return n[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=n,i.c=r,i.i=function(s){return s},i.d=function(s,o,a){i.o(s,o)||Object.defineProperty(s,o,{configurable:!1,enumerable:!0,get:a})},i.n=function(s){var o=s&&s.__esModule?function(){return s.default}:function(){return s};return i.d(o,"a",o),o},i.o=function(s,o){return Object.prototype.hasOwnProperty.call(s,o)},i.p="",i(i.s=5)}([function(n,r,i){n.exports=function(s,o){var a,l,h;for(a=1;a<arguments.length;a++){l=arguments[a];for(h in l)l.hasOwnProperty(h)&&(s[h]=l[h])}return s}},function(n,r,i){var s=i(0);n.exports={build:function(o,a){var l,h,c,u=a.plugins;for(l=0,h=u.length;l<h;l++)c=u[l],c.methods&&s(o,c.methods),c.properties&&Object.defineProperties(o,c.properties)},hook:function(o,a,l){var h,c,u,d,w=o.config.plugins,f=[o.context];for(l&&(f=f.concat(l)),h=0,c=w.length;h<c;h++)d=w[h],u=w[h][a],u&&u.apply(d,f)}}},function(n,r,i){function s(o){if(o.length===0)return o;var a,l,h=o.split(/[_-]/);if(h.length===1&&h[0][0].toLowerCase()===h[0][0])return o;for(l=h[0].toLowerCase(),a=1;a<h.length;a++)l=l+h[a].charAt(0).toUpperCase()+h[a].substring(1).toLowerCase();return l}s.prepended=function(o,a){return a=s(a),o+a[0].toUpperCase()+a.substring(1)},n.exports=s},function(n,r,i){var s=i(0),o=i(2);function a(l,h){l=l||{},this.options=l,this.defaults=h.defaults,this.states=[],this.transitions=[],this.map={},this.lifecycle=this.configureLifecycle(),this.init=this.configureInitTransition(l.init),this.data=this.configureData(l.data),this.methods=this.configureMethods(l.methods),this.map[this.defaults.wildcard]={},this.configureTransitions(l.transitions||[]),this.plugins=this.configurePlugins(l.plugins,h.plugin)}s(a.prototype,{addState:function(l){this.map[l]||(this.states.push(l),this.addStateLifecycleNames(l),this.map[l]={})},addStateLifecycleNames:function(l){this.lifecycle.onEnter[l]=o.prepended("onEnter",l),this.lifecycle.onLeave[l]=o.prepended("onLeave",l),this.lifecycle.on[l]=o.prepended("on",l)},addTransition:function(l){this.transitions.indexOf(l)<0&&(this.transitions.push(l),this.addTransitionLifecycleNames(l))},addTransitionLifecycleNames:function(l){this.lifecycle.onBefore[l]=o.prepended("onBefore",l),this.lifecycle.onAfter[l]=o.prepended("onAfter",l),this.lifecycle.on[l]=o.prepended("on",l)},mapTransition:function(l){var h=l.name,c=l.from,u=l.to;return this.addState(c),typeof u!="function"&&this.addState(u),this.addTransition(h),this.map[c][h]=l,l},configureLifecycle:function(){return{onBefore:{transition:"onBeforeTransition"},onAfter:{transition:"onAfterTransition"},onEnter:{state:"onEnterState"},onLeave:{state:"onLeaveState"},on:{transition:"onTransition"}}},configureInitTransition:function(l){return typeof l=="string"?this.mapTransition(s({},this.defaults.init,{to:l,active:!0})):typeof l=="object"?this.mapTransition(s({},this.defaults.init,l,{active:!0})):(this.addState(this.defaults.init.from),this.defaults.init)},configureData:function(l){return typeof l=="function"?l:typeof l=="object"?function(){return l}:function(){return{}}},configureMethods:function(l){return l||{}},configurePlugins:function(l,h){l=l||[];var c,u,d;for(c=0,u=l.length;c<u;c++)d=l[c],typeof d=="function"&&(l[c]=d=d()),d.configure&&d.configure(this);return l},configureTransitions:function(l){var h,c,u,d,w,f=this.defaults.wildcard;for(c=0;c<l.length;c++)for(u=l[c],d=Array.isArray(u.from)?u.from:[u.from||f],w=u.to||f,h=0;h<d.length;h++)this.mapTransition({name:u.name,from:d[h],to:w})},transitionFor:function(l,h){var c=this.defaults.wildcard;return this.map[l][h]||this.map[c][h]},transitionsFor:function(l){var h=this.defaults.wildcard;return Object.keys(this.map[l]).concat(Object.keys(this.map[h]))},allStates:function(){return this.states},allTransitions:function(){return this.transitions}}),n.exports=a},function(n,r,i){var s=i(0),o=i(6),a=i(1),l=[null,[]];function h(c,u){this.context=c,this.config=u,this.state=u.init.from,this.observers=[c]}s(h.prototype,{init:function(c){if(s(this.context,this.config.data.apply(this.context,c)),a.hook(this,"init"),this.config.init.active)return this.fire(this.config.init.name,[])},is:function(c){return Array.isArray(c)?c.indexOf(this.state)>=0:this.state===c},isPending:function(){return this.pending},can:function(c){return!this.isPending()&&!!this.seek(c)},cannot:function(c){return!this.can(c)},allStates:function(){return this.config.allStates()},allTransitions:function(){return this.config.allTransitions()},transitions:function(){return this.config.transitionsFor(this.state)},seek:function(c,u){var d=this.config.defaults.wildcard,w=this.config.transitionFor(this.state,c),f=w&&w.to;return typeof f=="function"?f.apply(this.context,u):f===d?this.state:f},fire:function(c,u){return this.transit(c,this.state,this.seek(c,u),u)},transit:function(c,u,d,w){var f=this.config.lifecycle,_=this.config.options.observeUnchangedState||u!==d;return d?this.isPending()?this.context.onPendingTransition(c,u,d):(this.config.addState(d),this.beginTransit(),w.unshift({transition:c,from:u,to:d,fsm:this.context}),this.observeEvents([this.observersForEvent(f.onBefore.transition),this.observersForEvent(f.onBefore[c]),_?this.observersForEvent(f.onLeave.state):l,_?this.observersForEvent(f.onLeave[u]):l,this.observersForEvent(f.on.transition),_?["doTransit",[this]]:l,_?this.observersForEvent(f.onEnter.state):l,_?this.observersForEvent(f.onEnter[d]):l,_?this.observersForEvent(f.on[d]):l,this.observersForEvent(f.onAfter.transition),this.observersForEvent(f.onAfter[c]),this.observersForEvent(f.on[c])],w)):this.context.onInvalidTransition(c,u,d)},beginTransit:function(){this.pending=!0},endTransit:function(c){return this.pending=!1,c},failTransit:function(c){throw this.pending=!1,c},doTransit:function(c){this.state=c.to},observe:function(c){if(c.length===2){var u={};u[c[0]]=c[1],this.observers.push(u)}else this.observers.push(c[0])},observersForEvent:function(c){for(var u=0,d=this.observers.length,w,f=[];u<d;u++)w=this.observers[u],w[c]&&f.push(w);return[c,f,!0]},observeEvents:function(c,u,d,w){if(c.length===0)return this.endTransit(w===void 0?!0:w);var f=c[0][0],_=c[0][1],g=c[0][2];if(u[0].event=f,f&&g&&f!==d&&a.hook(this,"lifecycle",u),_.length===0)return c.shift(),this.observeEvents(c,u,f,w);var y=_.shift(),b=y[f].apply(y,u);return b&&typeof b.then=="function"?b.then(this.observeEvents.bind(this,c,u,f)).catch(this.failTransit.bind(this)):b===!1?this.endTransit(!1):this.observeEvents(c,u,f,b)},onInvalidTransition:function(c,u,d){throw new o("transition is invalid in current state",c,u,d,this.state)},onPendingTransition:function(c,u,d){throw new o("transition is invalid while previous transition is still in progress",c,u,d,this.state)}}),n.exports=h},function(n,r,i){var s=i(0),o=i(2),a=i(1),l=i(3),h=i(4),c={is:function(g){return this._fsm.is(g)},can:function(g){return this._fsm.can(g)},cannot:function(g){return this._fsm.cannot(g)},observe:function(){return this._fsm.observe(arguments)},transitions:function(){return this._fsm.transitions()},allTransitions:function(){return this._fsm.allTransitions()},allStates:function(){return this._fsm.allStates()},onInvalidTransition:function(g,y,b){return this._fsm.onInvalidTransition(g,y,b)},onPendingTransition:function(g,y,b){return this._fsm.onPendingTransition(g,y,b)}},u={state:{configurable:!1,enumerable:!0,get:function(){return this._fsm.state},set:function(g){throw Error("use transitions to change state")}}};function d(g){return f(this||{},g)}function w(){var g,y;typeof arguments[0]=="function"?(g=arguments[0],y=arguments[1]||{}):(g=function(){this._fsm.apply(this,arguments)},y=arguments[0]||{});var b=new l(y,d);return _(g.prototype,b),g.prototype._fsm.config=b,g}function f(g,y){var b=new l(y,d);return _(g,b),g._fsm(),g}function _(g,y){if(typeof g!="object"||Array.isArray(g))throw Error("StateMachine can only be applied to objects");a.build(g,y),Object.defineProperties(g,u),s(g,c),s(g,y.methods),y.allTransitions().forEach(function(b){g[o(b)]=function(){return this._fsm.fire(b,[].slice.call(arguments))}}),g._fsm=function(){this._fsm=new h(this,y),this._fsm.init(arguments)}}d.version="3.0.1",d.factory=w,d.apply=f,d.defaults={wildcard:"*",init:{name:"init",from:"none"}},n.exports=d},function(n,r,i){n.exports=function(s,o,a,l,h){this.message=s,this.transition=o,this.from=a,this.to=l,this.current=h}}])})}(It)),It.exports}var pr=dr();const gr=Ae(pr),bt=gr({init:"player-1s-turn",transitions:[{name:"next-players-turn",from:"player-1s-turn",to:"player-2s-turn"},{name:"next-players-turn",from:"player-1s-turn",to:"player-1s-turn"},{name:"next-players-turn",from:"player-2s-turn",to:"player-3s-turn"},{name:"next-players-turn",from:"player-2s-turn",to:"player-1s-turn"},{name:"next-players-turn",from:"player-3s-turn",to:"player-4s-turn"},{name:"next-players-turn",from:"player-3s-turn",to:"player-1s-turn"},{name:"next-players-turn",from:"player-4s-turn",to:"player-5s-turn"},{name:"next-players-turn",from:"player-4s-turn",to:"player-1s-turn"},{name:"next-players-turn",from:"player-5s-turn",to:"player-6s-turn"},{name:"next-players-turn",from:"player-5s-turn",to:"player-1s-turn"},{name:"next-players-turn",from:"player-6s-turn",to:"player-1s-turn"},{name:"reset",from:"*",to:"player-1s-turn"}],data:{player:0,text:""},methods:{onNextPlayersTurn(){this.player<Pe-1?++this.player:this.player=0,this.text=`It is player ${1+this.player}'s turn`},onReset(){this.player=0,this.text="It is player 1's turn"}}});function mr(){function t(){this.context.fillStyle=this.color,this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,2*Math.PI),this.context.fill(),this.context.lineWidth=2,this.context.strokeStyle=L("white"),this.context.stroke()}const e=$({color:L("black"),id:vt,radius:C,render(){t.call(this)}}),n=$({color:L("firebrick"),id:kt,radius:C,render(){t.call(this)}}),r=$({color:L("green"),id:Mt,radius:C,render(){t.call(this)}}),i=$({color:L("silver"),id:Et,radius:C,render(){t.call(this)}}),s=$({color:L("yellow"),id:Tt,radius:C,render(){t.call(this)}}),o=$({color:L("blue"),id:St,radius:C,render(){t.call(this)}});return{diverPawn:e,engineerPawn:n,explorerPawn:r,messengerPawn:i,navigatorPawn:s,pilotPawn:o}}function wr(){return $({color:L(Pn),render(){if(this.context.beginPath(),this.radius!==void 0)this.context.arc(this.radius,this.radius,this.radius,0,2*Math.PI);else if(this.width!==void 0&&this.height!==void 0)this.context.rect(0,0,this.width,this.height);else return;this.context.lineWidth=Fn,this.context.strokeStyle=this.color,this.context.stroke()}})}function yr(){const t=wn({image:Q[Fe],frameWidth:z,frameHeight:M,animations:ft.map((n,r)=>({[r]:{frames:r*2,frameRate:1},[`${r}-flooded`]:{frames:[r*2+1],frameRate:1}})).reduce((n,r)=>({...n,...r}))}),e=[];for(let n=0;n<ft.length;++n){const r=$({animations:t.animations,id:1+n,flooded:ft[n].flooded});r.playAnimation(n),e.push(r)}return e}async function _r(){try{const t=Q[Re];return xn({tilewidth:z,tileheight:M,width:8,height:8,tilesets:[{firstgid:0,image:t}],layers:[{name:"ground",data:[0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,0,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0]}]})}catch(t){return console.error(t),null}}function br(){const t=$({color:L("saddlebrown"),width:At,height:Lt,id:$t}),e=$({color:L("yellow"),width:At,height:Lt,id:Ht}),n=$({color:L("firebrick"),width:At,height:Lt,id:Bt}),r=$({color:L("blue"),width:At,height:Lt,id:Gt});return{theCrystalOfFire:n,theEarthStone:t,theOceansChalice:r,theStatueOfTheWind:e}}function xr(){return $({x:0,y:0,color:L(Rn),width:it,height:dt})}const xt=Object.freeze([{cardsToDraw:2,difficultyLevel:Oe},{cardsToDraw:2,difficultyLevel:An},{cardsToDraw:3,difficultyLevel:Ln},{cardsToDraw:3,difficultyLevel:On},{cardsToDraw:3},{cardsToDraw:4},{cardsToDraw:4},{cardsToDraw:5},{cardsToDraw:5}]);function vr(t=Bn){const e=xt.findIndex(r=>r.difficultyLevel===t);if(e===-1)throw new Error("Invalid starting water level");return $({color:L("white"),x:-it,backgroundColor:L("teal"),font:`${M/2}px Arial`,startingWaterLevel:e,text:`${xt[e].cardsToDraw}`,waterLevel:e,render(){const r=this.text.split(`
`);if(r.length===0)return;this.context.font=this.font,this.context.textBaseline="top";let i=-1;for(let s=0;s<r.length;++s){const o=this.context.measureText(r[s]),a=o.actualBoundingBoxRight+o.actualBoundingBoxLeft;a>i&&(i=a)}this.width=Math.ceil(i),this.height=r.length*M/2,this.x=it-this.width,this.y=dt-this.height,this.context.fillStyle=this.backgroundColor,this.context.fillRect(0,0,this.width,this.height),this.context.fillStyle=this.color;for(let s=0;s<r.length;++s)this.context.fillText(r[s],0,s*M/2)},increment(){this.waterLevel<xt.length-1&&(++this.waterLevel,this.text=`${xt[this.waterLevel].cardsToDraw}`)},reset(){this.waterLevel=this.startingWaterLevel,this.text=`${xt[this.waterLevel].cardsToDraw}`}})}qt($n);const kr=Dt.shuffle({deck:ft,random:Wt});function Mr(t){return function(){const{innerWidth:e,innerHeight:n}=window,r=e/n,i=it/dt;r<i?(t.style.width=`${e}px`,t.style.height=`${e/i}px`):(t.style.width=`${n*i}px`,t.style.height=`${n}px`)}}function Er(t,e=`
`){const n={};for(const i of t)n[i.name]===void 0?n[i.name]=1:++n[i.name];const r=[];for(const[i,s]of Object.entries(n))r.push(`${s} x ${i}`);return r.join(e)}qt(Hn);const Pt=Dt.shuffle({deck:Le.filter(({type:t})=>t==="treasure"),random:Wt}),Tr=31.5,Sr="0.0.42",Me={hours:Tr,version:Sr};async function Cr(){const{canvas:t,context:e}=ze();t.width=it,t.height=dt;const n=Mr(t);n(),window.addEventListener("resize",n),fn();const r=`v${Me.version}`,i=`${Me.hours}h`,s=ue({text:`${r}
${i}`,font:`${M/4}px Courier`,color:L("white"),x:it-z/4*Math.max(r.length,i.length),y:M/4}),o=ue({font:`${M/4}px Arial`,color:L("white"),x:z/4,y:M/4});await Wn();const a=await _r();if(a===null)return 1;a.sx=(z*8-it)/2,a.sy=(M*8-dt)/2;const l=()=>{const{y:m}=ln();if(m<M){let x=a.sy-M;x=st(0,a.mapheight-M-1,x),a.sy=x}else if(m>dt-M-1){let x=a.sy+M;x=st(0,a.mapheight-M-1,x),a.sy=x}},h=()=>{w(),o.text=bt.text};a.onDown=h,N(a);const c=xr();c.onDown=h,N(c);const u=wr(),d=m=>{u.x=m.x,u.y=m.y,m.radius?(u.radius=m.radius,u.width=u.height=void 0):(u.width=m.width,u.height=m.height,u.radius=void 0)},w=()=>{u.width=u.height=u.radius=void 0},f=yr(),_=a.layers.find(({name:m})=>m==="ground");if(_!==void 0){for(let m=0;m<a.height;++m)for(let x=0;x<a.width;++x)if(_.data[m*a.width+x]!==0){const v=kr.draw(),F=f[v.id-1];F.x=x*F.width,F.y=m*F.height,F.onDown=()=>{l();let I=v.name;if(F.flooded&&(I+=`
FLOODED!`),v.adventurer!==void 0)switch(v.adventurer){case vt:I+=`
(Diver)`;break;case kt:I+=`
(Engineer)`;break;case Mt:I+=`
(Explorer)`;break;case Et:I+=`
(Messenger)`;break;case Tt:I+=`
(Navigator)`;break;case St:I+=`
(Pilot)`}if(v.treasure!==void 0)switch(v.treasure){case Bt:I+=`
(The Crystal of Fire)`;break;case $t:I+=`
(The Earth Stone)`;break;case Gt:I+=`
(The Ocean's Chalice)`;break;case Ht:I+=`
(The Statue of the Wind)`}d(F),o.text=I},N(F),a.add(F)}}const{theCrystalOfFire:g,theEarthStone:y,theOceansChalice:b,theStatueOfTheWind:O}=br();y.x=f[0].width+(f[0].width-y.width)/2,y.y=f[0].height+(f[0].height-y.height)/2,y.onDown=()=>{d(y),o.text="The Earth Stone"},N(y),a.add(y),O.x=f[0].width+(f[0].width-O.width)/2,O.y=f[0].height*6+(f[0].height-O.height)/2,O.onDown=()=>{d(O),o.text="The Statue of the Wind"},N(O),a.add(O),g.x=f[0].width*6+(f[0].width-g.width)/2,g.y=f[0].height+(f[0].height-g.height)/2,g.onDown=()=>{d(g),o.text="The Crystal of Fire"},N(g),a.add(g),b.x=f[0].width*6+(f[0].width-b.width)/2,b.y=f[0].height*6+(f[0].height-b.height)/2,b.onDown=()=>{d(b),o.text="The Ocean's Chalice"},N(b),a.add(b);const K={...ur},J=[];for(let m=0;m<6;++m){const x=K.draw(),v=f.find(({id:F})=>F===x.id);v.flooded=!0,v.playAnimation(`${v.id-1}-flooded`),J.push(x)}Dt.shuffle({deck:[]}).putOnTopOfDeck(J);const H=[];for(let m=0;m<Pe;++m)H.push({name:`Player ${m+1}`,adventurerCard:Gn.draw(),cards:[]});const U=m=>()=>{d(m);const x=H.find(({adventurerCard:F})=>F.id===m.id);if(x===void 0)return;const v=`${x.name}: ${x.adventurerCard.name}
Cards:
${Er(x.cards)}`;o.text=v},{diverPawn:q,engineerPawn:B,explorerPawn:R,messengerPawn:E,navigatorPawn:P,pilotPawn:Y}=mr();for(const m of f){const x=ft.find(({id:v})=>v===m.id);if(x!==void 0&&!(x.adventurer!==void 0&&!H.map(({adventurerCard:v})=>v.id).includes(x.adventurer)))switch(x.adventurer){case vt:q.x=m.x+(z-C*2)/2,q.y=m.y+(M-C*2)/2,q.onDown=U(q),N(q),a.add(q);break;case kt:B.x=m.x+(z-C*2)/2,B.y=m.y+(M-C*2)/2,B.onDown=U(B),N(B),a.add(B);break;case Mt:R.x=m.x+(z-C*2)/2,R.y=m.y+(M-C*2)/2,R.onDown=U(R),N(R),a.add(R);break;case Et:E.x=m.x+(z-C*2)/2,E.y=m.y+(M-C*2)/2,E.onDown=U(E),N(E),a.add(E);break;case Tt:P.x=m.x+(z-C*2)/2,P.y=m.y+(M-C*2)/2,P.onDown=U(P),N(P),a.add(P);break;case St:Y.x=m.x+(z-C*2)/2,Y.y=m.y+(M-C*2)/2,Y.onDown=U(Y),N(Y),a.add(Y);break}}a.add(u),Pt.deal(2,H.map(({cards:m})=>m));for(const m of H){let x=m.cards.filter(({name:v})=>v==="Waters Rise!").length;for(;x>0;){console.log("Waters Rise! Replacement card required");for(let v=0;v<m.cards.length;++v)if(m.cards[v].name==="Waters Rise!"){const F=m.cards[v],I=Pt.draw();m.cards[v]=I,Pt.putOnTopOfDeck(F),Pt.shuffle()}x=m.cards.filter(({name:v})=>v==="Waters Rise!").length}}const V=vr();return V.onDown=()=>{w(),o.text=`Water level: ${V.waterLevel}`,bt.nextPlayersTurn(),o.text+=`

`+bt.text},N(V),bt.reset(),(()=>{o.text=H.map(({name:m,adventurerCard:x})=>`${m}: ${x.name}`).join(`
`),o.text+=`

`+bt.text})(),pn({render(){c.render(),a.render(),V.render(),e.fillStyle="rgba(0, 0, 0, 0.67)",e.fillRect(s.x,s.y,s.width,s.height),s.render(),e.fillStyle="rgba(0, 0, 0, 0.67)",e.fillRect(o.x,o.y,o.width,o.height),o.render()},update(){}}).start(),0}Cr();
