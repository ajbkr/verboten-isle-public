(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function i(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=i(s);fetch(s.href,r)}})();/**
 * @preserve
 * Kontra.js v10.0.2
 */function se(e,t){let i=Math.sin(t),n=Math.cos(t);return{x:e.x*n-e.y*i,y:e.x*i+e.y*n}}function X(e,t,i){return Math.min(Math.max(e,i),t)}function Vt(e){let{x:t=0,y:i=0,width:n,height:s,radius:r}=e.world||e;return e.mapwidth&&(n=e.mapwidth,s=e.mapheight),r&&(n=r.x*2,s=r.y*2),e.anchor&&(t-=n*e.anchor.x,i-=s*e.anchor.y),n<0&&(t+=n,n*=-1),s<0&&(i+=s,s*=-1),{x:t,y:i,width:n,height:s}}let wt=()=>{};function Zt(e,t){let i=e.indexOf(t);if(i!=-1)return e.splice(i,1),!0}function re(e,t){let{x:i,y:n,width:s,height:r}=Vt(t);do i-=t.sx||0,n-=t.sy||0;while(t=t.parent);let a=e.x-Math.max(i,Math.min(e.x,i+s)),o=e.y-Math.max(n,Math.min(e.y,n+r));return a*a+o*o<e.radius*e.radius}let ft={};function ht(e,t){ft[e]=ft[e]||[],ft[e].push(t)}function q(e,...t){(ft[e]||[]).map(i=>i(...t))}let U,ut,$t={get(e,t){return t=="_proxy"?!0:wt}};function N(){return U}function I(){return ut}function ae(e,{contextless:t=!1}={}){if(U=document.getElementById(e)||e||document.querySelector("canvas"),t&&(U=U||new Proxy({},$t)),!U)throw Error("You must provide a canvas element for the game");return ut=U.getContext("2d")||new Proxy({},$t),ut.imageSmoothingEnabled=!1,q("init"),{canvas:U,context:ut}}class Pt{constructor({spriteSheet:t,frames:i,frameRate:n,loop:s=!0,name:r}){let{width:a,height:o,spacing:l=0,margin:c=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:i,frameRate:n,loop:s,name:r,width:a,height:o,spacing:l,margin:c,isStopped:!1,_f:0,_a:0})}clone(){return new Pt(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped){if(!this.loop&&this._f==this.frames.length-1){this.stop();return}for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}}render({x:t,y:i,width:n=this.width,height:s=this.height,context:r=I()}){let a=this.frames[this._f]/this.spriteSheet._f|0,o=this.frames[this._f]%this.spriteSheet._f|0;r.drawImage(this.spriteSheet.image,this.margin+o*this.width+(o*2+1)*this.spacing,this.margin+a*this.height+(a*2+1)*this.spacing,this.width,this.height,t,i,n,s)}}function oe(){return new Pt(...arguments)}let he=/(jpeg|jpg|gif|png|webp)$/,le=/(wav|mp3|ogg|aac)$/,de=/^\//,ce=/\/$/,jt=new WeakMap,fe="",ue="",we="";function _t(e,t){return new URL(e,t).href}function At(e,t){return[e.replace(ce,""),t].filter(i=>i).join("/")}function Lt(e){return e.split(".").pop()}function Rt(e){let t=e.replace("."+Lt(e),"");return t.split("/").length==2?t.replace(de,""):t}function pe(e){return{wav:e.canPlayType('audio/wav; codecs="1"'),mp3:e.canPlayType("audio/mpeg;"),ogg:e.canPlayType('audio/ogg; codecs="vorbis"'),aac:e.canPlayType("audio/aac;")}}let W={},V={},z={};function Ot(){window.__k||(window.__k={dm:jt,u:_t,d:z,i:W})}function ge(e){return Ot(),new Promise((t,i)=>{let n,s,r;if(n=At(fe,e),W[n])return t(W[n]);s=new Image,s.onload=function(){r=_t(n,window.location.href),W[Rt(e)]=W[n]=W[r]=this,q("assetLoaded",this,e),t(this)},s.onerror=function(){i("Unable to load image "+n)},s.src=n})}function me(e){return new Promise((t,i)=>{let n=e,s,r,a,o;if(s=new Audio,r=pe(s),e=[].concat(e).reduce((l,c)=>l||(r[Lt(c)]?c:null),0),!e)return i("cannot play any of the audio formats provided "+n);if(a=At(ue,e),V[a])return t(V[a]);s.addEventListener("canplay",function(){o=_t(a,window.location.href),V[Rt(e)]=V[a]=V[o]=this,q("assetLoaded",this,e),t(this)}),s.onerror=function(){i("Unable to load audio "+a)},s.src=a,s.load()})}function ye(e){Ot();let t,i;return t=At(we,e),z[t]?Promise.resolve(z[t]):fetch(t).then(n=>{if(!n.ok)throw n;return n.clone().json().catch(()=>n.text())}).then(n=>(i=_t(t,window.location.href),typeof n=="object"&&jt.set(n,i),z[Rt(e)]=z[t]=z[i]=n,q("assetLoaded",n,e),n))}function _e(...e){return Ot(),Promise.all(e.map(t=>{let i=Lt([].concat(t)[0]);return i.match(he)?ge(t):i.match(le)?me(t):ye(t)}))}class K{constructor(t=0,i=0,n={}){t.x!=null?(this.x=t.x,this.y=t.y):(this.x=t,this.y=i),n._c&&(this.clamp(n._a,n._b,n._d,n._e),this.x=t,this.y=i)}set(t){this.x=t.x,this.y=t.y}add(t){return new K(this.x+t.x,this.y+t.y,this)}subtract(t){return new K(this.x-t.x,this.y-t.y,this)}scale(t){return new K(this.x*t,this.y*t)}normalize(t=this.length()||1){return new K(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,i,n,s){this._c=!0,this._a=t,this._b=i,this._d=n,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?X(this._a,this._d,t):t}set y(t){this._y=this._c?X(this._b,this._e,t):t}}function St(){return new K(...arguments)}class xe{constructor(t){return this.init(t)}init(t={}){this.position=St(),this.velocity=St(),this.acceleration=St(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let i=this.acceleration;t&&(i=i.scale(t)),this.velocity=this.velocity.add(i);let n=this.velocity;t&&(n=n.scale(t)),this.position=this.position.add(n),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}class te extends xe{init({width:t=0,height:i=0,context:n=I(),render:s=this.draw,update:r=this.advance,children:a=[],anchor:o={x:0,y:0},opacity:l=1,rotation:c=0,drotation:d=0,ddrotation:h=0,scaleX:w=1,scaleY:u=1,...m}={}){this._c=[],super.init({width:t,height:i,context:n,anchor:o,opacity:l,rotation:c,drotation:d,ddrotation:h,scaleX:w,scaleY:u,...m}),this._di=!0,this._uw(),this.addChild(a),this._rf=s,this._uf=r,ht("init",()=>{this.context??(this.context=I())})}update(t){this._uf(t),this.children.map(i=>i.update&&i.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let i=this.width,n=this.height;this.radius&&(i=n=this.radius*2);let s=-i*this.anchor.x,r=-n*this.anchor.y;(s||r)&&t.translate(s,r),this.context.globalAlpha=this.opacity,this._rf(),(s||r)&&t.translate(-s,-r),this.children.map(o=>o.render&&o.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:i=0,_wo:n=1,_wrot:s=0,_wsx:r=1,_wsy:a=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this.radius&&(this._wrx=this.radius,this._wry=this.radius),this._wo=n*this.opacity,this._wsx=r*this.scaleX,this._wsy=a*this.scaleY,this._wx=this._wx*r,this._wy=this._wy*a,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this.radius&&(this._wrx=this.radius*this._wsx,this._wry=this.radius*this._wsy),this._wrot=s+this.rotation;let{x:o,y:l}=se({x:this._wx,y:this._wy},s);this._wx=o,this._wy=l,this._wx+=t,this._wy+=i}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,radius:this.radius?{x:this._wrx,y:this._wry}:void 0,opacity:this._wo,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(i=>{this.children.push(i),i.parent=this,i._pc=i._pc||wt,i._pc()})}removeChild(...t){t.flat().map(i=>{Zt(this.children,i)&&(i.parent=null,i._pc())})}get radius(){return this._r}set radius(t){this._r=t,this._pc()}get opacity(){return this._opa}set opacity(t){this._opa=X(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}advance(t){super.advance(t),this.drotation+=this.ddrotation,this.rotation+=this.drotation}setScale(t,i=t){this.scaleX=t,this.scaleY=i}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class Ee extends te{init({image:t,width:i=t?t.width:void 0,height:n=t?t.height:void 0,...s}={}){super.init({image:t,width:i,height:n,...s})}get animations(){return this._a}set animations(t){let i,n;this._a={};for(i in t)this._a[i]=t[i].clone(),n=n||this._a[i];this.currentAnimation=n,this.width=this.width||n.width,this.height=this.height||n.height}playAnimation(t){var i;(i=this.currentAnimation)==null||i.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){var i;super.advance(t),(i=this.currentAnimation)==null||i.update(t)}draw(){if(this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color){if(this.context.fillStyle=this.color,this.radius){this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.context.fill();return}this.context.fillRect(0,0,this.width,this.height)}}}function T(){return new Ee(...arguments)}let ve=/(\d+)(\w+)/;function Se(e){if(!e)return{computed:0};let t=e.match(ve),i=+t[1],n=t[2];return{size:i,unit:n,computed:i}}class Ce extends te{init({text:t="",textAlign:i="",lineHeight:n=1,font:s=(a=>(a=I())==null?void 0:a.font)(),...r}={}){t=""+t,super.init({text:t,textAlign:i,lineHeight:n,font:s,...r}),this.context&&this._p(),ht("init",()=>{this.font??(this.font=I().font),this._p()})}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=Se(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context,i=[this.text];if(t.font=this.font,i=this.text.split(`
`),this._fw&&i.map(n=>{let s=n.split(" "),r=s.shift(),a=r;s.map(o=>{a+=" "+o,t.measureText(a).width>this._fw&&(this._s.push(r),a=o),r=a}),this._s.push(a)}),!this._s.length&&this.text.includes(`
`)){let n=0;i.map(s=>{this._s.push(s),n=Math.max(n,t.measureText(s).width)}),this._w=this._fw||n}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,i=this.textAlign,n=this.context;i=this.textAlign||(n.canvas.dir=="rtl"?"right":"left"),t=i=="right"?this.width:i=="center"?this.width/2|0:0,this._s.map((s,r)=>{n.textBaseline="top",n.textAlign=i,n.fillStyle=this.color,n.font=this.font,this.strokeColor&&(n.strokeStyle=this.strokeColor,n.lineWidth=this.lineWidth??1,n.strokeText(s,t,this._fs*this.lineHeight*r)),n.fillText(s,t,this._fs*this.lineHeight*r)})}}function Yt(){return new Ce(...arguments)}let Q=new WeakMap,Gt={},It={},ee={0:"left",1:"middle",2:"right"};function be(e=N()){return Q.get(e)}function Te(e){let t=e._lf.length?e._lf:e._cf;for(let i=t.length-1;i>=0;i--){let n=t[i];if(n.collidesWithPointer?n.collidesWithPointer(e):re(e,n))return n}}function k(e,t){return parseFloat(e.getPropertyValue(t))||0}function De(e){let{canvas:t,_s:i}=e,n=t.getBoundingClientRect(),s=i.transform!="none"?i.transform.replace("matrix(","").split(","):[1,1,1,1],r=parseFloat(s[0]),a=parseFloat(s[3]),o=(k(i,"border-left-width")+k(i,"border-right-width"))*r,l=(k(i,"border-top-width")+k(i,"border-bottom-width"))*a,c=(k(i,"padding-left")+k(i,"padding-right"))*r,d=(k(i,"padding-top")+k(i,"padding-bottom"))*a;return{scaleX:(n.width-o-c)/t.width,scaleY:(n.height-l-d)/t.height,offsetX:n.left+(k(i,"border-left-width")+k(i,"padding-left"))*r,offsetY:n.top+(k(i,"border-top-width")+k(i,"padding-top"))*a}}function Ut(e){let t=e.button!=null?ee[e.button]:"left";It[t]=!0,Mt(e,"onDown")}function Ct(e){let t=e.button!=null?ee[e.button]:"left";It[t]=!1,Mt(e,"onUp")}function Nt(e){Mt(e,"onOver")}function ke(e){let t=Q.get(e.target);t._oo=null,It={}}function Xt(e,t,i){let n=Te(e);n&&n[t]&&n[t](i),Gt[t]&&Gt[t](i,n),t=="onOver"&&(n!=e._oo&&e._oo&&e._oo.onOut&&e._oo.onOut(i),e._oo=n)}function Mt(e,t){e.preventDefault();let i=e.target,n=Q.get(i),{scaleX:s,scaleY:r,offsetX:a,offsetY:o}=De(n);e.type.includes("touch")?(Array.from(e.touches).map(({clientX:c,clientY:d,identifier:h})=>{let w=n.touches[h];w||(w=n.touches[h]={start:{x:(c-a)/s,y:(d-o)/r}},n.touches.length++),w.changed=!1}),Array.from(e.changedTouches).map(({clientX:c,clientY:d,identifier:h})=>{let w=n.touches[h];w.changed=!0,w.x=n.x=(c-a)/s,w.y=n.y=(d-o)/r,Xt(n,t,e),q("touchChanged",e,n.touches),t=="onUp"&&(delete n.touches[h],n.touches.length--,n.touches.length||q("touchEnd"))})):(n.x=(e.clientX-a)/s,n.y=(e.clientY-o)/r,Xt(n,t,e))}function Pe({radius:e=5,canvas:t=N()}={}){let i=Q.get(t);if(!i){let n=window.getComputedStyle(t);i={x:0,y:0,radius:e,touches:{length:0},canvas:t,_cf:[],_lf:[],_o:[],_oo:null,_s:n},Q.set(t,i)}return t.addEventListener("mousedown",Ut),t.addEventListener("touchstart",Ut),t.addEventListener("mouseup",Ct),t.addEventListener("touchend",Ct),t.addEventListener("touchcancel",Ct),t.addEventListener("blur",ke),t.addEventListener("mousemove",Nt),t.addEventListener("touchmove",Nt),i._t||(i._t=!0,ht("tick",()=>{i._lf.length=0,i._cf.map(n=>{i._lf.push(n)}),i._cf.length=0})),i}function b(...e){e.flat().map(t=>{let i=t.context?t.context.canvas:N(),n=Q.get(i);if(!n)throw new ReferenceError("Pointer events not initialized for the objects canvas");t.__r||(t.__r=t.render,t.render=function(){n._cf.push(this),this.__r()},n._o.push(t))})}function Ae(e){let t=e.canvas;e.clearRect(0,0,t.width,t.height)}function Le({fps:e=60,clearCanvas:t=!0,update:i=wt,render:n,context:s=I(),blur:r=!1}={}){if(!n)throw Error("You must provide a render() function");let a=0,o=1e3/e,l=1/e,c=t?Ae:wt,d,h,w,u,m,y=!0;r||(window.addEventListener("focus",()=>{y=!0}),window.addEventListener("blur",()=>{y=!1})),ht("init",()=>{m.context??(m.context=I())});function p(){if(h=requestAnimationFrame(p),!!y&&(w=performance.now(),u=w-d,d=w,!(u>1e3))){for(a+=u;a>=o;)q("tick"),m.update(l),a-=o;c(m.context),m.render()}}return m={update:i,render:n,isStopped:!0,context:s,start(){this.isStopped&&(d=performance.now(),this.isStopped=!1,requestAnimationFrame(p))},stop(){this.isStopped=!0,cancelAnimationFrame(h)},_frame:p,set _last(x){d=x}},m}let F;function Ht(){F??(F=Date.now()),F|=0,F=F+2654435769|0;let e=F^F>>>16;return e=Math.imul(e,569420461),e=e^e>>>15,e=Math.imul(e,1935289751),((e=e^e>>>15)>>>0)/4294967296}function Ft(e=Date.now()){if(F=e,typeof e=="string"){for(var t=0,i=1779033703^e.length;t<e.length;t++)i=Math.imul(i^e.charCodeAt(t),3432918353),i=i<<13|i>>>19;i=Math.imul(i^i>>>16,2246822507),i=Math.imul(i^i>>>13,3266489909),F=(i^=i>>>16)>>>0}}function Re(e){if(+e==e)return e;let t=[],i=e.split(".."),n=+i[0],s=+i[1],r=n;if(n<s)for(;r<=s;r++)t.push(r);else for(;r>=s;r--)t.push(r);return t}class Oe{constructor({image:t,frameWidth:i,frameHeight:n,spacing:s=0,margin:r=0,animations:a}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:i,height:n,spacing:s,margin:r},this._f=(t.width-r)/i|0,this.createAnimations(a)}createAnimations(t){let i,n;for(n in t){let{frames:s,frameRate:r,loop:a}=t[n];if(i=[],s==null)throw Error("Animation "+n+" must provide a frames property");[].concat(s).map(o=>{i=i.concat(Re(o))}),this.animations[n]=oe({spriteSheet:this,frames:i,frameRate:r,loop:a,name:n})}}}function Ie(){return new Oe(...arguments)}let Me=2147483648,He=1073741824,qt=536870912;function Z(e,t){return e/t|0}function j(e,t){return e/t|0}class Fe{constructor(t={}){let{width:i,height:n,tilewidth:s,tileheight:r,tilesets:a}=t,o=i*s,l=n*r,c=document.createElement("canvas");c.width=o,c.height=l,this._c=c,this._ctx=c.getContext("2d"),a.map(d=>{let{__k:h,location:w}=window,u=(h?h.dm.get(t):"")||w.href,{source:m}=d;if(m){if(!h)throw Error('You must use "load" or "loadData" to resolve tileset.source');let p=h.d[h.u(m,u)];if(!p)throw Error(`You must load the tileset source "${m}" before loading the tileset`);Object.keys(p).map(x=>{d[x]=p[x]})}let{image:y}=d;if(""+y===y){if(!h)throw Error('You must use "load" or "loadImage" to resolve tileset.image');let p=h.i[h.u(y,u)];if(!p)throw Error(`You must load the image "${y}" before loading the tileset`);d.image=p}}),Object.assign(this,{context:I(),layerMap:{},layerCanvases:{},mapwidth:o,mapheight:l,_sx:0,_sy:0,_o:[],...t}),this.context&&this._p(),ht("init",()=>{this.context??(this.context=I()),this._p()})}get sx(){return this._sx}get sy(){return this._sy}set sx(t){let i=Math.max(0,this.mapwidth-N().width);this._sx=X(0,i,t)}set sy(t){let i=Math.max(0,this.mapheight-N().height);this._sy=X(0,i,t)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map(i=>{this._o.push(i),i.parent=this})}remove(...t){t.flat().map(i=>{Zt(this._o,i),i.parent=null})}getPosition(t){let i=N().getBoundingClientRect(),n=t.x-i.x,s=t.y-i.y;return n+=this.sx,s+=this.sy,{x:n,y:s,row:Z(s,this.tileheight),col:j(n,this.tilewidth)}}setTileAtLayer(t,i,n){let{layerMap:s,tileheight:r,tilewidth:a,width:o}=this,{row:l,col:c,x:d,y:h}=i,w=l??Z(h,r),u=c??j(d,a);s[t]&&(this._d=!0,s[t]._d=!0,s[t].data[w*o+u]=n)}setLayer(t,i){let{layerMap:n}=this;n[t]&&(this._d=!0,n[t]._d=!0,n[t].data=i)}layerCollidesWith(t,i){let{tilewidth:n,tileheight:s,layerMap:r}=this,{x:a,y:o,width:l,height:c}=Vt(i),d=Z(o,s),h=j(a,n),w=Z(o+c,s),u=j(a+l,n),m=r[t];for(let y=d;y<=w;y++)for(let p=h;p<=u;p++)if(m.data[p+y*this.width])return!0;return!1}tileAtLayer(t,i){let{layerMap:n,tileheight:s,tilewidth:r,width:a}=this,{row:o,col:l,x:c,y:d}=i,h=o??Z(d,s),w=l??j(c,r);return n[t]?n[t].data[h*a+w]:-1}render(t=this._c,i=!0){let{_d:n,context:s,sx:r=0,sy:a=0}=this;n&&this._p();let{width:o,height:l}=N(),c=Math.min(t.width,o),d=Math.min(t.height,l);s.drawImage(t,r,a,c,d,0,0,c,d),i&&(s.save(),(r||a)&&s.translate(-r,-a),this.objects.map(h=>h.render&&h.render()),s.restore())}renderLayer(t){let{layerCanvases:i,layerMap:n}=this,s=n[t],r=i[t],a=r==null?void 0:r.getContext("2d");if(!r){let{mapwidth:o,mapheight:l}=this;r=document.createElement("canvas"),a=r.getContext("2d"),r.width=o,r.height=l,i[t]=r,this._rl(s,a)}s._d&&(s._d=!1,a.clearRect(0,0,r.width,r.height),this._rl(s,a)),this.render(r,!1)}_p(){let{_ctx:t,layers:i=[],layerMap:n}=this;this._d=!1,i.map(s=>{let{name:r,data:a,visible:o}=s;s._d=!1,n[r]=s,a&&o!=!1&&this._rl(s,t)})}_rl(t,i){let{opacity:n,data:s=[]}=t,{tilesets:r,width:a,tilewidth:o,tileheight:l}=this;i.save(),i.globalAlpha=n,s.map((c,d)=>{if(!c)return;let h=0,w=0,u=c&Me,m=c&He,y=0,p=0,x=0,S=0,lt=0;h=u||m,c&=1073741823,lt=c&qt,lt&&(u&&m?x=1:u?y=1:m?p=1:S=1,w=y||p||x||S,c&=~qt);let B;for(let g=r.length-1;g>=0&&(B=r[g],!(c/B.firstgid>=1));g--);let{image:vt,spacing:$=0,margin:L=0,firstgid:M,columns:H}=B,R=c-M,O=H??vt.width/(o+$)|0,C=d%a*o,Y=(d/a|0)*l,Wt=L+R%O*(o+$),f=L+(R/O|0)*(l+$);w?(i.save(),i.translate(C+o/2,Y+l/2),p||S?i.rotate(-Math.PI/2):(y||x)&&i.rotate(Math.PI/2),(x||S)&&i.scale(-1,1),C=-o/2,Y=-l/2):h&&(i.save(),i.translate(C+(u?o:0),Y+(m?l:0)),i.scale(u?-1:1,m?-1:1),C=h?0:C,Y=h?0:Y),i.drawImage(vt,Wt,f,o,l,C,Y,o,l),(h||w)&&i.restore()}),i.restore()}}function We(){return new Fe(...arguments)}function $e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var bt={exports:{}},Tt,Bt;function Ye(){return Bt||(Bt=1,Tt=function(e,t){this.reset=function(){this.cards=e.slice(0),this.length=this.cards.length},this.shuffle=function(){i(this.cards)},this.reset(),this.shuffle(),this.deal=function(n,s){for(var r=0;r<n;r++)for(var a=0;a<s.length;a++){if(!s[a]||!s[a].push)throw new Error("Deck#deal | Undefined Hand");s[a].push(this.cards.pop())}this.length=this.cards.length},this.draw=function(n){if(!n||n<=1)return this.length=this.cards.length-1,this.cards.pop();for(var s=[],r=0;r<n;r++)s.push(this.cards.pop());return this.length=this.cards.length,s},this.drawFromBottomOfDeck=function(n){(!n||n<1)&&(n=1);for(var s=[],r=0;r<n;r++)s.push(this.cards.shift());return this.length=this.cards.length,s.length===1?s[0]:s},this.drawRandom=function(n){var s=function(){var o=Math.floor(t()*this.cards.length),l=this.cards[o];return this.cards.splice(o,1),this.length=this.cards.length,l};if(!n||n<=1)return s.apply(this);for(var r=[],a=0;a<n;a++)r.push(s.apply(this));return r},this.putOnTopOfDeck=function(n){if(!n instanceof Array)this.cards.push(n);else for(var s=0;s<n.length;s++)this.cards.push(n[s]);this.length=this.cards.length},this.putOnBottomOfDeck=function(n){if(!n instanceof Array)this.cards.unshift(n);else for(var s=0;s<n.length;s++)this.cards.unshift(n[s]);this.length=this.cards.length};function i(n){var s=n.length;if(s===0)return!1;for(;--s;){var r=Math.floor(t()*(s+1)),a=n[s],o=n[r];n[s]=o,n[r]=a}}}),Tt}var Dt,zt;function Ge(){return zt||(zt=1,Dt=function(e,t,i){this.suit=e,this.description=t,this.sort=i,this.toString=function(){return this.description+" of "+this.suit+"s"},this.toShortDisplayString=function(){var n=this.suit.substring(0,1),s;switch(this.sort){case 11:s="J";break;case 12:s="Q";break;case 13:s="K";break;case 14:s="A";break;default:s=this.sort}return s+n}}),Dt}var kt,Kt;function Ue(){if(Kt)return kt;Kt=1;var e=Ge();return kt=function(){this.cards=[new e("Club","Two",2),new e("Club","Three",3),new e("Club","Four",4),new e("Club","Five",5),new e("Club","Six",6),new e("Club","Seven",7),new e("Club","Eight",8),new e("Club","Nine",9),new e("Club","Ten",10),new e("Club","Jack",11),new e("Club","Queen",12),new e("Club","King",13),new e("Club","Ace",14),new e("Diamond","Two",2),new e("Diamond","Three",3),new e("Diamond","Four",4),new e("Diamond","Five",5),new e("Diamond","Six",6),new e("Diamond","Seven",7),new e("Diamond","Eight",8),new e("Diamond","Nine",9),new e("Diamond","Ten",10),new e("Diamond","Jack",11),new e("Diamond","Queen",12),new e("Diamond","King",13),new e("Diamond","Ace",14),new e("Heart","Two",2),new e("Heart","Three",3),new e("Heart","Four",4),new e("Heart","Five",5),new e("Heart","Six",6),new e("Heart","Seven",7),new e("Heart","Eight",8),new e("Heart","Nine",9),new e("Heart","Ten",10),new e("Heart","Jack",11),new e("Heart","Queen",12),new e("Heart","King",13),new e("Heart","Ace",14),new e("Spade","Two",2),new e("Spade","Three",3),new e("Spade","Four",4),new e("Spade","Five",5),new e("Spade","Six",6),new e("Spade","Seven",7),new e("Spade","Eight",8),new e("Spade","Nine",9),new e("Spade","Ten",10),new e("Spade","Jack",11),new e("Spade","Queen",12),new e("Spade","King",13),new e("Spade","Ace",14)]},kt}var Jt;function Ne(){if(Jt)return bt.exports;Jt=1;var e=Ye(),t=Ue(),i=bt.exports={},n={deck:new t().cards,numberOfDecks:1,random:function(){return Math.random()}};return i.playingCards=function(){return new t().cards},i.shuffle=function(s){if(s||(s=n),s.deck||(s.deck=n.deck),s.numberOfDecks)for(var r=s.deck,a=0;a<s.numberOfDecks-1;a++)s.deck=s.deck.concat(r);return s.random||(s.random=n.random),new e(s.deck,s.random)},bt.exports}var Xe=Ne();const xt=$e(Xe),it=1,nt=2,st=3,rt=4,at=5,ot=6,pt=1,gt=2,mt=3,yt=4,J=[{id:1,name:"Fools' Landing",flooded:!1,adventurer:ot},{id:2,name:"Cave of Shadows",flooded:!1,treasure:mt},{id:3,name:"Temple of the Moon",flooded:!1,treasure:pt},{id:4,name:"Copper Gate",flooded:!1,adventurer:st},{id:5,name:"Whispering Garden",flooded:!1,treasure:gt},{id:6,name:"Dunes of Deception",flooded:!1},{id:7,name:"Silver Gate",flooded:!1,adventurer:rt},{id:8,name:"Observatory",flooded:!1},{id:9,name:"Breakers Bridge",flooded:!1},{id:10,name:"Twilight Hollow",flooded:!1},{id:11,name:"Lost Lagoon",flooded:!1},{id:12,name:"Bronze Gate",flooded:!1,adventurer:nt},{id:13,name:"Phantom Rock",flooded:!1},{id:14,name:"Watchtower",flooded:!1},{id:15,name:"Cliffs of Abandon",flooded:!1},{id:16,name:"Misty Marsh",flooded:!1},{id:17,name:"Coral Palace",flooded:!1,treasure:yt},{id:18,name:"Howling Garden",flooded:!1,treasure:gt},{id:19,name:"Iron Gate",flooded:!1,adventurer:it},{id:20,name:"Gold Gate",flooded:!1,adventurer:at},{id:21,name:"Crimson Forest",flooded:!1},{id:22,name:"Temple of the Sun",flooded:!1,treasure:pt},{id:23,name:"Cave of Embers",flooded:!1,treasure:mt},{id:24,name:"Tidal Palace",flooded:!1,treasure:yt}],qe=[{id:rt,name:"Messenger",color:"silver",type:"adventurer"},{id:ot,name:"Pilot",color:"blue",type:"adventurer"},{id:nt,name:"Engineer",color:"red",type:"adventurer"},{id:st,name:"Explorer",color:"green",type:"adventurer"},{id:it,name:"Diver",color:"black",type:"adventurer"},{id:at,name:"Navigator",color:"yellow",type:"adventurer"}],Be=[{name:"Fools' Landing",type:"flood"},{name:"Cave of Shadows",type:"flood"},{name:"Temple of the Moon",type:"flood"},{name:"Copper Gate",type:"flood"},{name:"Whispering Garden",type:"flood"},{name:"Dunes of Deception",type:"flood"},{name:"Silver Gate",type:"flood"},{name:"Observatory",type:"flood"},{name:"Breakers Bridge",type:"flood"},{name:"Twilight Hollow",type:"flood"},{name:"Lost Lagoon",type:"flood"},{name:"Bronze Gate",type:"flood"},{name:"Phantom Rock",type:"flood"},{name:"Watchtower",type:"flood"},{name:"Cliffs of Abandon",type:"flood"},{name:"Misty Marsh",type:"flood"},{name:"Coral Palace",type:"flood"},{name:"Howling Garden",type:"flood"},{name:"Iron Gate",type:"flood"},{name:"Gold Gate",type:"flood"},{name:"Crimson Forest",type:"flood"},{name:"Temple of the Sun",type:"flood"},{name:"Cave of Embers",type:"flood"},{name:"Tidal Palace",type:"flood"}];function G(e,t){const i=[];for(let n=0;n<e;++n)i.push(t);return i}const ze=[...G(5,{name:"The Earth Stone",type:"treasure"}),...G(5,{name:"The Statue of the Wind",type:"treasure"}),...G(5,{name:"The Crystal of Fire",type:"treasure"}),...G(5,{name:"The Ocean's Chalice",type:"treasure"}),...G(3,{name:"Waters Rise!",type:"treasure"}),...G(3,{name:"Helicopter Lift",type:"treasure"}),...G(3,{name:"Sandbags",type:"treasure"})],Ke=[...qe,...Be,...ze],Et=2,tt=512,et=256,P=32*Et,_=32*Et,dt=24*Et,ct=24*Et,E=P/4/2,Je="lime",Qe=2,Ve="aqua",Ze="adventurer-deck",je="flood-deck",ti="island-tiles-deck",ei=6;Ft(Ze);const ii=xt.shuffle({deck:Ke.filter(({type:e})=>e==="adventurer"),random:Ht}),ie=""+new URL("spritesheet-Dm4BmPvg.png",import.meta.url).href,ne=""+new URL("tilesheet-C_zpU0l5.png",import.meta.url).href,ni=[ie,ne],si=e=>_e(...ni);Ft(je);const ri=xt.shuffle({deck:J,random:Ht});function ai(){function e(){this.context.fillStyle=this.color,this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,2*Math.PI),this.context.fill(),this.context.lineWidth=2,this.context.strokeStyle="white",this.context.stroke()}const t=T({color:"black",id:it,radius:E,render(){e.call(this)}}),i=T({color:"red",id:nt,radius:E,render(){e.call(this)}}),n=T({color:"green",id:st,radius:E,render(){e.call(this)}}),s=T({color:"silver",id:rt,radius:E,render(){e.call(this)}}),r=T({color:"yellow",id:at,radius:E,render(){e.call(this)}}),a=T({color:"blue",id:ot,radius:E,render(){e.call(this)}});return{diverPawn:t,engineerPawn:i,explorerPawn:n,messengerPawn:s,navigatorPawn:r,pilotPawn:a}}function oi(){return T({color:Je,render(){if(this.context.beginPath(),this.radius!==void 0)this.context.arc(this.radius,this.radius,this.radius,0,2*Math.PI);else if(this.width!==void 0&&this.height!==void 0)this.context.rect(0,0,this.width,this.height);else return;this.context.lineWidth=Qe,this.context.strokeStyle=this.color,this.context.stroke()}})}function hi(){const e=Ie({image:W[ie],frameWidth:P,frameHeight:_,animations:J.map((i,n)=>({[n]:{frames:n*2,frameRate:1},[`${n}-flooded`]:{frames:[n*2+1],frameRate:1}})).reduce((i,n)=>({...i,...n}))}),t=[];for(let i=0;i<J.length;++i){const n=T({animations:e.animations,id:1+i,flooded:J[i].flooded});n.playAnimation(i),t.push(n)}return t}async function li(){try{const e=W[ne];return We({tilewidth:P,tileheight:_,width:8,height:8,tilesets:[{firstgid:0,image:e}],layers:[{name:"ground",data:[0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,0,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0]}]})}catch(e){return console.error(e),null}}function di(){const e=T({color:"brown",width:dt,height:ct,id:pt}),t=T({color:"yellow",width:dt,height:ct,id:gt}),i=T({color:"red",width:dt,height:ct,id:mt}),n=T({color:"blue",width:dt,height:ct,id:yt});return{theCrystalOfFire:i,theEarthStone:e,theOceansChalice:n,theStatueOfTheWind:t}}function ci(){return T({x:0,y:0,color:Ve,width:tt,height:et})}Ft(ti);const fi=xt.shuffle({deck:J,random:Ht});function ui(e){return function(){const{innerWidth:t,innerHeight:i}=window,n=t/i,s=tt/et;n<s?(e.style.width=`${t}px`,e.style.height=`${t/s}px`):(e.style.width=`${i*s}px`,e.style.height=`${i}px`)}}const wi=24.25,pi="0.0.32",Qt={hours:wi,version:pi};async function gi(){const{canvas:e,context:t}=ae();e.width=tt,e.height=et;const i=ui(e);i(),window.addEventListener("resize",i),Pe();const n=`v${Qt.version}`,s=`${Qt.hours}h`,r=Yt({text:`${n}
${s}`,font:`${_/4}px Courier`,color:"white",x:tt-P/4*Math.max(n.length,s.length),y:_/4}),a=Yt({font:`${_/4}px Arial`,color:"white",x:P/4,y:_/4});await si();const o=await li();if(o===null)return 1;o.sx=(P*8-tt)/2,o.sy=(_*8-et)/2;const l=()=>{const{y:f}=be();if(f<_){let g=o.sy-_;g=X(0,o.mapheight-_-1,g),o.sy=g}else if(f>et-_-1){let g=o.sy+_;g=X(0,o.mapheight-_-1,g),o.sy=g}};o.onDown=()=>{l(),w(),a.text=""},b(o);const c=ci();c.onDown=()=>{l(),w(),a.text=""},b(c);const d=oi(),h=f=>{d.x=f.x,d.y=f.y,f.radius?(d.radius=f.radius,d.width=d.height=void 0):(d.width=f.width,d.height=f.height,d.radius=void 0)},w=()=>{d.width=d.height=d.radius=void 0},u=hi(),m=o.layers.find(({name:f})=>f==="ground");if(m!==void 0){for(let f=0;f<o.height;++f)for(let g=0;g<o.width;++g)if(m.data[f*o.width+g]!==0){const v=fi.draw(),A=u[v.id-1];A.x=g*A.width,A.y=f*A.height,A.onDown=()=>{l();let D=v.name;if(A.flooded&&(D+=`
FLOODED!`),v.adventurer!==void 0)switch(v.adventurer){case it:D+=`
(Diver)`;break;case nt:D+=`
(Engineer)`;break;case st:D+=`
(Explorer)`;break;case rt:D+=`
(Messenger)`;break;case at:D+=`
(Navigator)`;break;case ot:D+=`
(Pilot)`}if(v.treasure!==void 0)switch(v.treasure){case mt:D+=`
(The Crystal of Fire)`;break;case pt:D+=`
(The Earth Stone)`;break;case yt:D+=`
(The Ocean's Chalice)`;break;case gt:D+=`
(The Statue of the Wind)`}h(A),a.text=D},b(A),o.add(A)}}const{theCrystalOfFire:y,theEarthStone:p,theOceansChalice:x,theStatueOfTheWind:S}=di();p.x=u[0].width+(u[0].width-p.width)/2,p.y=u[0].height+(u[0].height-p.height)/2,p.onDown=()=>{h(p),a.text="The Earth Stone"},b(p),o.add(p),S.x=u[0].width+(u[0].width-S.width)/2,S.y=u[0].height*6+(u[0].height-S.height)/2,S.onDown=()=>{h(S),a.text="The Statue of the Wind"},b(S),o.add(S),y.x=u[0].width*6+(u[0].width-y.width)/2,y.y=u[0].height+(u[0].height-y.height)/2,y.onDown=()=>{h(y),a.text="The Crystal of Fire"},b(y),o.add(y),x.x=u[0].width*6+(u[0].width-x.width)/2,x.y=u[0].height*6+(u[0].height-x.height)/2,x.onDown=()=>{h(x),a.text="The Ocean's Chalice"},b(x),o.add(x);const lt={...ri},B=[];for(let f=0;f<6;++f){const g=lt.draw(),v=u.find(({id:A})=>A===g.id);v.flooded=!0,v.playAnimation(`${v.id-1}-flooded`),B.push(g)}xt.shuffle({deck:[]}).putOnTopOfDeck(B);const $=[];for(let f=0;f<ei;++f)$.push({name:`Player ${f+1}`,adventurerCard:ii.draw(),cards:[]});const{diverPawn:L,engineerPawn:M,explorerPawn:H,messengerPawn:R,navigatorPawn:O,pilotPawn:C}=ai();for(const f of u){const g=J.find(({id:v})=>v===f.id);if(g!==void 0&&!(g.adventurer!==void 0&&!$.map(({adventurerCard:v})=>v.id).includes(g.adventurer)))switch(g.adventurer){case it:L.x=f.x+(P-E*2)/2,L.y=f.y+(_-E*2)/2,L.onDown=()=>{h(L),a.text="Diver"},b(L),o.add(L);break;case nt:M.x=f.x+(P-E*2)/2,M.y=f.y+(_-E*2)/2,M.onDown=()=>{h(M),a.text="Engineer"},b(M),o.add(M);break;case st:H.x=f.x+(P-E*2)/2,H.y=f.y+(_-E*2)/2,H.onDown=()=>{h(H),a.text="Explorer"},b(H),o.add(H);break;case rt:R.x=f.x+(P-E*2)/2,R.y=f.y+(_-E*2)/2,R.onDown=()=>{h(R),a.text="Messenger"},b(R),o.add(R);break;case at:O.x=f.x+(P-E*2)/2,O.y=f.y+(_-E*2)/2,O.onDown=()=>{h(O),a.text="Navigator"},b(O),o.add(O);break;case ot:C.x=f.x+(P-E*2)/2,C.y=f.y+(_-E*2)/2,C.onDown=()=>{h(C),a.text="Pilot"},b(C),o.add(C);break}}return o.add(d),(()=>{a.text=$.map(({name:f,adventurerCard:g})=>`${f}: ${g.name}`).join(`
`)})(),Le({render(){c.render(),o.render(),t.fillStyle="rgba(0, 0, 0, 0.67)",t.fillRect(r.x,r.y,r.width,r.height),r.render(),t.fillStyle="rgba(0, 0, 0, 0.67)",t.fillRect(a.x,a.y,a.width,a.height),a.render()},update(){}}).start(),0}gi();
