(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();/**
 * @preserve
 * Kontra.js v10.0.2
 */function oe(e,t){let n=Math.sin(t),i=Math.cos(t);return{x:e.x*i-e.y*n,y:e.x*n+e.y*i}}function q(e,t,n){return Math.min(Math.max(e,n),t)}function Zt(e){let{x:t=0,y:n=0,width:i,height:s,radius:r}=e.world||e;return e.mapwidth&&(i=e.mapwidth,s=e.mapheight),r&&(i=r.x*2,s=r.y*2),e.anchor&&(t-=i*e.anchor.x,n-=s*e.anchor.y),i<0&&(t+=i,i*=-1),s<0&&(n+=s,s*=-1),{x:t,y:n,width:i,height:s}}let gt=()=>{};function te(e,t){let n=e.indexOf(t);if(n!=-1)return e.splice(n,1),!0}function he(e,t){let{x:n,y:i,width:s,height:r}=Zt(t);do n-=t.sx||0,i-=t.sy||0;while(t=t.parent);let a=e.x-Math.max(n,Math.min(e.x,n+s)),o=e.y-Math.max(i,Math.min(e.y,i+r));return a*a+o*o<e.radius*e.radius}let wt={};function ht(e,t){wt[e]=wt[e]||[],wt[e].push(t)}function X(e,...t){(wt[e]||[]).map(n=>n(...t))}let U,pt,Gt={get(e,t){return t=="_proxy"?!0:gt}};function N(){return U}function H(){return pt}function le(e,{contextless:t=!1}={}){if(U=document.getElementById(e)||e||document.querySelector("canvas"),t&&(U=U||new Proxy({},Gt)),!U)throw Error("You must provide a canvas element for the game");return pt=U.getContext("2d")||new Proxy({},Gt),pt.imageSmoothingEnabled=!1,X("init"),{canvas:U,context:pt}}class Ot{constructor({spriteSheet:t,frames:n,frameRate:i,loop:s=!0,name:r}){let{width:a,height:o,spacing:l=0,margin:c=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:n,frameRate:i,loop:s,name:r,width:a,height:o,spacing:l,margin:c,isStopped:!1,_f:0,_a:0})}clone(){return new Ot(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped){if(!this.loop&&this._f==this.frames.length-1){this.stop();return}for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}}render({x:t,y:n,width:i=this.width,height:s=this.height,context:r=H()}){let a=this.frames[this._f]/this.spriteSheet._f|0,o=this.frames[this._f]%this.spriteSheet._f|0;r.drawImage(this.spriteSheet.image,this.margin+o*this.width+(o*2+1)*this.spacing,this.margin+a*this.height+(a*2+1)*this.spacing,this.width,this.height,t,n,i,s)}}function de(){return new Ot(...arguments)}let ce=/(jpeg|jpg|gif|png|webp)$/,fe=/(wav|mp3|ogg|aac)$/,ue=/^\//,we=/\/$/,ee=new WeakMap,pe="",ge="",me="";function Et(e,t){return new URL(e,t).href}function Lt(e,t){return[e.replace(we,""),t].filter(n=>n).join("/")}function It(e){return e.split(".").pop()}function Mt(e){let t=e.replace("."+It(e),"");return t.split("/").length==2?t.replace(ue,""):t}function ye(e){return{wav:e.canPlayType('audio/wav; codecs="1"'),mp3:e.canPlayType("audio/mpeg;"),ogg:e.canPlayType('audio/ogg; codecs="vorbis"'),aac:e.canPlayType("audio/aac;")}}let Y={},V={},z={};function Ht(){window.__k||(window.__k={dm:ee,u:Et,d:z,i:Y})}function _e(e){return Ht(),new Promise((t,n)=>{let i,s,r;if(i=Lt(pe,e),Y[i])return t(Y[i]);s=new Image,s.onload=function(){r=Et(i,window.location.href),Y[Mt(e)]=Y[i]=Y[r]=this,X("assetLoaded",this,e),t(this)},s.onerror=function(){n("Unable to load image "+i)},s.src=i})}function xe(e){return new Promise((t,n)=>{let i=e,s,r,a,o;if(s=new Audio,r=ye(s),e=[].concat(e).reduce((l,c)=>l||(r[It(c)]?c:null),0),!e)return n("cannot play any of the audio formats provided "+i);if(a=Lt(ge,e),V[a])return t(V[a]);s.addEventListener("canplay",function(){o=Et(a,window.location.href),V[Mt(e)]=V[a]=V[o]=this,X("assetLoaded",this,e),t(this)}),s.onerror=function(){n("Unable to load audio "+a)},s.src=a,s.load()})}function Ee(e){Ht();let t,n;return t=Lt(me,e),z[t]?Promise.resolve(z[t]):fetch(t).then(i=>{if(!i.ok)throw i;return i.clone().json().catch(()=>i.text())}).then(i=>(n=Et(t,window.location.href),typeof i=="object"&&ee.set(i,n),z[Mt(e)]=z[t]=z[n]=i,X("assetLoaded",i,e),i))}function ve(...e){return Ht(),Promise.all(e.map(t=>{let n=It([].concat(t)[0]);return n.match(ce)?_e(t):n.match(fe)?xe(t):Ee(t)}))}class K{constructor(t=0,n=0,i={}){t.x!=null?(this.x=t.x,this.y=t.y):(this.x=t,this.y=n),i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=n)}set(t){this.x=t.x,this.y=t.y}add(t){return new K(this.x+t.x,this.y+t.y,this)}subtract(t){return new K(this.x-t.x,this.y-t.y,this)}scale(t){return new K(this.x*t,this.y*t)}normalize(t=this.length()||1){return new K(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,n,i,s){this._c=!0,this._a=t,this._b=n,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?q(this._a,this._d,t):t}set y(t){this._y=this._c?q(this._b,this._e,t):t}}function Tt(){return new K(...arguments)}class Se{constructor(t){return this.init(t)}init(t={}){this.position=Tt(),this.velocity=Tt(),this.acceleration=Tt(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let n=this.acceleration;t&&(n=n.scale(t)),this.velocity=this.velocity.add(n);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}class ie extends Se{init({width:t=0,height:n=0,context:i=H(),render:s=this.draw,update:r=this.advance,children:a=[],anchor:o={x:0,y:0},opacity:l=1,rotation:c=0,drotation:d=0,ddrotation:f=0,scaleX:p=1,scaleY:u=1,..._}={}){this._c=[],super.init({width:t,height:n,context:i,anchor:o,opacity:l,rotation:c,drotation:d,ddrotation:f,scaleX:p,scaleY:u,..._}),this._di=!0,this._uw(),this.addChild(a),this._rf=s,this._uf=r,ht("init",()=>{this.context??=H()})}update(t){this._uf(t),this.children.map(n=>n.update&&n.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let n=this.width,i=this.height;this.radius&&(n=i=this.radius*2);let s=-n*this.anchor.x,r=-i*this.anchor.y;(s||r)&&t.translate(s,r),this.context.globalAlpha=this.opacity,this._rf(),(s||r)&&t.translate(-s,-r),this.children.map(o=>o.render&&o.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:n=0,_wo:i=1,_wrot:s=0,_wsx:r=1,_wsy:a=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this.radius&&(this._wrx=this.radius,this._wry=this.radius),this._wo=i*this.opacity,this._wsx=r*this.scaleX,this._wsy=a*this.scaleY,this._wx=this._wx*r,this._wy=this._wy*a,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this.radius&&(this._wrx=this.radius*this._wsx,this._wry=this.radius*this._wsy),this._wrot=s+this.rotation;let{x:o,y:l}=oe({x:this._wx,y:this._wy},s);this._wx=o,this._wy=l,this._wx+=t,this._wy+=n}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,radius:this.radius?{x:this._wrx,y:this._wry}:void 0,opacity:this._wo,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(n=>{this.children.push(n),n.parent=this,n._pc=n._pc||gt,n._pc()})}removeChild(...t){t.flat().map(n=>{te(this.children,n)&&(n.parent=null,n._pc())})}get radius(){return this._r}set radius(t){this._r=t,this._pc()}get opacity(){return this._opa}set opacity(t){this._opa=q(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}advance(t){super.advance(t),this.drotation+=this.ddrotation,this.rotation+=this.drotation}setScale(t,n=t){this.scaleX=t,this.scaleY=n}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class Ce extends ie{init({image:t,width:n=t?t.width:void 0,height:i=t?t.height:void 0,...s}={}){super.init({image:t,width:n,height:i,...s})}get animations(){return this._a}set animations(t){let n,i;this._a={};for(n in t)this._a[n]=t[n].clone(),i=i||this._a[n];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){this.currentAnimation?.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){super.advance(t),this.currentAnimation?.update(t)}draw(){if(this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color){if(this.context.fillStyle=this.color,this.radius){this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.context.fill();return}this.context.fillRect(0,0,this.width,this.height)}}}function P(){return new Ce(...arguments)}let be=/(\d+)(\w+)/;function Te(e){if(!e)return{computed:0};let t=e.match(be),n=+t[1],i=t[2];return{size:n,unit:i,computed:n}}class De extends ie{init({text:t="",textAlign:n="",lineHeight:i=1,font:s=H()?.font,...r}={}){t=""+t,super.init({text:t,textAlign:n,lineHeight:i,font:s,...r}),this.context&&this._p(),ht("init",()=>{this.font??=H().font,this._p()})}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=Te(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context,n=[this.text];if(t.font=this.font,n=this.text.split(`
`),this._fw&&n.map(i=>{let s=i.split(" "),r=s.shift(),a=r;s.map(o=>{a+=" "+o,t.measureText(a).width>this._fw&&(this._s.push(r),a=o),r=a}),this._s.push(a)}),!this._s.length&&this.text.includes(`
`)){let i=0;n.map(s=>{this._s.push(s),i=Math.max(i,t.measureText(s).width)}),this._w=this._fw||i}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,n=this.textAlign,i=this.context;n=this.textAlign||(i.canvas.dir=="rtl"?"right":"left"),t=n=="right"?this.width:n=="center"?this.width/2|0:0,this._s.map((s,r)=>{i.textBaseline="top",i.textAlign=n,i.fillStyle=this.color,i.font=this.font,this.strokeColor&&(i.strokeStyle=this.strokeColor,i.lineWidth=this.lineWidth??1,i.strokeText(s,t,this._fs*this.lineHeight*r)),i.fillText(s,t,this._fs*this.lineHeight*r)})}}function Ut(){return new De(...arguments)}let Q=new WeakMap,Nt={},Ft={},ne={0:"left",1:"middle",2:"right"};function ke(e=N()){return Q.get(e)}function Pe(e){let t=e._lf.length?e._lf:e._cf;for(let n=t.length-1;n>=0;n--){let i=t[n];if(i.collidesWithPointer?i.collidesWithPointer(e):he(e,i))return i}}function A(e,t){return parseFloat(e.getPropertyValue(t))||0}function Ae(e){let{canvas:t,_s:n}=e,i=t.getBoundingClientRect(),s=n.transform!="none"?n.transform.replace("matrix(","").split(","):[1,1,1,1],r=parseFloat(s[0]),a=parseFloat(s[3]),o=(A(n,"border-left-width")+A(n,"border-right-width"))*r,l=(A(n,"border-top-width")+A(n,"border-bottom-width"))*a,c=(A(n,"padding-left")+A(n,"padding-right"))*r,d=(A(n,"padding-top")+A(n,"padding-bottom"))*a;return{scaleX:(i.width-o-c)/t.width,scaleY:(i.height-l-d)/t.height,offsetX:i.left+(A(n,"border-left-width")+A(n,"padding-left"))*r,offsetY:i.top+(A(n,"border-top-width")+A(n,"padding-top"))*a}}function qt(e){let t=e.button!=null?ne[e.button]:"left";Ft[t]=!0,Wt(e,"onDown")}function Dt(e){let t=e.button!=null?ne[e.button]:"left";Ft[t]=!1,Wt(e,"onUp")}function Xt(e){Wt(e,"onOver")}function Re(e){let t=Q.get(e.target);t._oo=null,Ft={}}function Bt(e,t,n){let i=Pe(e);i&&i[t]&&i[t](n),Nt[t]&&Nt[t](n,i),t=="onOver"&&(i!=e._oo&&e._oo&&e._oo.onOut&&e._oo.onOut(n),e._oo=i)}function Wt(e,t){e.preventDefault();let n=e.target,i=Q.get(n),{scaleX:s,scaleY:r,offsetX:a,offsetY:o}=Ae(i);e.type.includes("touch")?(Array.from(e.touches).map(({clientX:c,clientY:d,identifier:f})=>{let p=i.touches[f];p||(p=i.touches[f]={start:{x:(c-a)/s,y:(d-o)/r}},i.touches.length++),p.changed=!1}),Array.from(e.changedTouches).map(({clientX:c,clientY:d,identifier:f})=>{let p=i.touches[f];p.changed=!0,p.x=i.x=(c-a)/s,p.y=i.y=(d-o)/r,Bt(i,t,e),X("touchChanged",e,i.touches),t=="onUp"&&(delete i.touches[f],i.touches.length--,i.touches.length||X("touchEnd"))})):(i.x=(e.clientX-a)/s,i.y=(e.clientY-o)/r,Bt(i,t,e))}function Oe({radius:e=5,canvas:t=N()}={}){let n=Q.get(t);if(!n){let i=window.getComputedStyle(t);n={x:0,y:0,radius:e,touches:{length:0},canvas:t,_cf:[],_lf:[],_o:[],_oo:null,_s:i},Q.set(t,n)}return t.addEventListener("mousedown",qt),t.addEventListener("touchstart",qt),t.addEventListener("mouseup",Dt),t.addEventListener("touchend",Dt),t.addEventListener("touchcancel",Dt),t.addEventListener("blur",Re),t.addEventListener("mousemove",Xt),t.addEventListener("touchmove",Xt),n._t||(n._t=!0,ht("tick",()=>{n._lf.length=0,n._cf.map(i=>{n._lf.push(i)}),n._cf.length=0})),n}function k(...e){e.flat().map(t=>{let n=t.context?t.context.canvas:N(),i=Q.get(n);if(!i)throw new ReferenceError("Pointer events not initialized for the objects canvas");t.__r||(t.__r=t.render,t.render=function(){i._cf.push(this),this.__r()},i._o.push(t))})}function Le(e){let t=e.canvas;e.clearRect(0,0,t.width,t.height)}function Ie({fps:e=60,clearCanvas:t=!0,update:n=gt,render:i,context:s=H(),blur:r=!1}={}){if(!i)throw Error("You must provide a render() function");let a=0,o=1e3/e,l=1/e,c=t?Le:gt,d,f,p,u,_,y=!0;r||(window.addEventListener("focus",()=>{y=!0}),window.addEventListener("blur",()=>{y=!1})),ht("init",()=>{_.context??=H()});function g(){if(f=requestAnimationFrame(g),!!y&&(p=performance.now(),u=p-d,d=p,!(u>1e3))){for(a+=u;a>=o;)X("tick"),_.update(l),a-=o;c(_.context),_.render()}}return _={update:n,render:i,isStopped:!0,context:s,start(){this.isStopped&&(d=performance.now(),this.isStopped=!1,requestAnimationFrame(g))},stop(){this.isStopped=!0,cancelAnimationFrame(f)},_frame:g,set _last(E){d=E}},_}let $;function vt(){$??=Date.now(),$|=0,$=$+2654435769|0;let e=$^$>>>16;return e=Math.imul(e,569420461),e=e^e>>>15,e=Math.imul(e,1935289751),((e=e^e>>>15)>>>0)/4294967296}function St(e=Date.now()){if($=e,typeof e=="string"){for(var t=0,n=1779033703^e.length;t<e.length;t++)n=Math.imul(n^e.charCodeAt(t),3432918353),n=n<<13|n>>>19;n=Math.imul(n^n>>>16,2246822507),n=Math.imul(n^n>>>13,3266489909),$=(n^=n>>>16)>>>0}}function Me(e){if(+e==e)return e;let t=[],n=e.split(".."),i=+n[0],s=+n[1],r=i;if(i<s)for(;r<=s;r++)t.push(r);else for(;r>=s;r--)t.push(r);return t}class He{constructor({image:t,frameWidth:n,frameHeight:i,spacing:s=0,margin:r=0,animations:a}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:n,height:i,spacing:s,margin:r},this._f=(t.width-r)/n|0,this.createAnimations(a)}createAnimations(t){let n,i;for(i in t){let{frames:s,frameRate:r,loop:a}=t[i];if(n=[],s==null)throw Error("Animation "+i+" must provide a frames property");[].concat(s).map(o=>{n=n.concat(Me(o))}),this.animations[i]=de({spriteSheet:this,frames:n,frameRate:r,loop:a,name:i})}}}function Fe(){return new He(...arguments)}let We=2147483648,$e=1073741824,zt=536870912;function j(e,t){return e/t|0}function Z(e,t){return e/t|0}class Ye{constructor(t={}){let{width:n,height:i,tilewidth:s,tileheight:r,tilesets:a}=t,o=n*s,l=i*r,c=document.createElement("canvas");c.width=o,c.height=l,this._c=c,this._ctx=c.getContext("2d"),a.map(d=>{let{__k:f,location:p}=window,u=(f?f.dm.get(t):"")||p.href,{source:_}=d;if(_){if(!f)throw Error('You must use "load" or "loadData" to resolve tileset.source');let g=f.d[f.u(_,u)];if(!g)throw Error(`You must load the tileset source "${_}" before loading the tileset`);Object.keys(g).map(E=>{d[E]=g[E]})}let{image:y}=d;if(""+y===y){if(!f)throw Error('You must use "load" or "loadImage" to resolve tileset.image');let g=f.i[f.u(y,u)];if(!g)throw Error(`You must load the image "${y}" before loading the tileset`);d.image=g}}),Object.assign(this,{context:H(),layerMap:{},layerCanvases:{},mapwidth:o,mapheight:l,_sx:0,_sy:0,_o:[],...t}),this.context&&this._p(),ht("init",()=>{this.context??=H(),this._p()})}get sx(){return this._sx}get sy(){return this._sy}set sx(t){let n=Math.max(0,this.mapwidth-N().width);this._sx=q(0,n,t)}set sy(t){let n=Math.max(0,this.mapheight-N().height);this._sy=q(0,n,t)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map(n=>{this._o.push(n),n.parent=this})}remove(...t){t.flat().map(n=>{te(this._o,n),n.parent=null})}getPosition(t){let n=N().getBoundingClientRect(),i=t.x-n.x,s=t.y-n.y;return i+=this.sx,s+=this.sy,{x:i,y:s,row:j(s,this.tileheight),col:Z(i,this.tilewidth)}}setTileAtLayer(t,n,i){let{layerMap:s,tileheight:r,tilewidth:a,width:o}=this,{row:l,col:c,x:d,y:f}=n,p=l??j(f,r),u=c??Z(d,a);s[t]&&(this._d=!0,s[t]._d=!0,s[t].data[p*o+u]=i)}setLayer(t,n){let{layerMap:i}=this;i[t]&&(this._d=!0,i[t]._d=!0,i[t].data=n)}layerCollidesWith(t,n){let{tilewidth:i,tileheight:s,layerMap:r}=this,{x:a,y:o,width:l,height:c}=Zt(n),d=j(o,s),f=Z(a,i),p=j(o+c,s),u=Z(a+l,i),_=r[t];for(let y=d;y<=p;y++)for(let g=f;g<=u;g++)if(_.data[g+y*this.width])return!0;return!1}tileAtLayer(t,n){let{layerMap:i,tileheight:s,tilewidth:r,width:a}=this,{row:o,col:l,x:c,y:d}=n,f=o??j(d,s),p=l??Z(c,r);return i[t]?i[t].data[f*a+p]:-1}render(t=this._c,n=!0){let{_d:i,context:s,sx:r=0,sy:a=0}=this;i&&this._p();let{width:o,height:l}=N(),c=Math.min(t.width,o),d=Math.min(t.height,l);s.drawImage(t,r,a,c,d,0,0,c,d),n&&(s.save(),(r||a)&&s.translate(-r,-a),this.objects.map(f=>f.render&&f.render()),s.restore())}renderLayer(t){let{layerCanvases:n,layerMap:i}=this,s=i[t],r=n[t],a=r?.getContext("2d");if(!r){let{mapwidth:o,mapheight:l}=this;r=document.createElement("canvas"),a=r.getContext("2d"),r.width=o,r.height=l,n[t]=r,this._rl(s,a)}s._d&&(s._d=!1,a.clearRect(0,0,r.width,r.height),this._rl(s,a)),this.render(r,!1)}_p(){let{_ctx:t,layers:n=[],layerMap:i}=this;this._d=!1,n.map(s=>{let{name:r,data:a,visible:o}=s;s._d=!1,i[r]=s,a&&o!=!1&&this._rl(s,t)})}_rl(t,n){let{opacity:i,data:s=[]}=t,{tilesets:r,width:a,tilewidth:o,tileheight:l}=this;n.save(),n.globalAlpha=i,s.map((c,d)=>{if(!c)return;let f=0,p=0,u=c&We,_=c&$e,y=0,g=0,E=0,b=0,dt=0;f=u||_,c&=1073741823,dt=c&zt,dt&&(u&&_?E=1:u?y=1:_?g=1:b=1,p=y||g||E||b,c&=~zt);let B;for(let h=r.length-1;h>=0&&(B=r[h],!(c/B.firstgid>=1));h--);let{image:bt,spacing:O=0,margin:L=0,firstgid:F,columns:W}=B,I=c-F,M=W??bt.width/(o+O)|0,T=d%a*o,D=(d/a|0)*l,$t=L+I%M*(o+O),Yt=L+(I/M|0)*(l+O);p?(n.save(),n.translate(T+o/2,D+l/2),g||b?n.rotate(-Math.PI/2):(y||E)&&n.rotate(Math.PI/2),(E||b)&&n.scale(-1,1),T=-o/2,D=-l/2):f&&(n.save(),n.translate(T+(u?o:0),D+(_?l:0)),n.scale(u?-1:1,_?-1:1),T=f?0:T,D=f?0:D),n.drawImage(bt,$t,Yt,o,l,T,D,o,l),(f||p)&&n.restore()}),n.restore()}}function Ge(){return new Ye(...arguments)}function Ue(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var kt={exports:{}},Pt,Kt;function Ne(){return Kt||(Kt=1,Pt=function(e,t){this.reset=function(){this.cards=e.slice(0),this.length=this.cards.length},this.shuffle=function(){n(this.cards)},this.reset(),this.shuffle(),this.deal=function(i,s){for(var r=0;r<i;r++)for(var a=0;a<s.length;a++){if(!s[a]||!s[a].push)throw new Error("Deck#deal | Undefined Hand");s[a].push(this.cards.pop())}this.length=this.cards.length},this.draw=function(i){if(!i||i<=1)return this.length=this.cards.length-1,this.cards.pop();for(var s=[],r=0;r<i;r++)s.push(this.cards.pop());return this.length=this.cards.length,s},this.drawFromBottomOfDeck=function(i){(!i||i<1)&&(i=1);for(var s=[],r=0;r<i;r++)s.push(this.cards.shift());return this.length=this.cards.length,s.length===1?s[0]:s},this.drawRandom=function(i){var s=function(){var o=Math.floor(t()*this.cards.length),l=this.cards[o];return this.cards.splice(o,1),this.length=this.cards.length,l};if(!i||i<=1)return s.apply(this);for(var r=[],a=0;a<i;a++)r.push(s.apply(this));return r},this.putOnTopOfDeck=function(i){if(!i instanceof Array)this.cards.push(i);else for(var s=0;s<i.length;s++)this.cards.push(i[s]);this.length=this.cards.length},this.putOnBottomOfDeck=function(i){if(!i instanceof Array)this.cards.unshift(i);else for(var s=0;s<i.length;s++)this.cards.unshift(i[s]);this.length=this.cards.length};function n(i){var s=i.length;if(s===0)return!1;for(;--s;){var r=Math.floor(t()*(s+1)),a=i[s],o=i[r];i[s]=o,i[r]=a}}}),Pt}var At,Jt;function qe(){return Jt||(Jt=1,At=function(e,t,n){this.suit=e,this.description=t,this.sort=n,this.toString=function(){return this.description+" of "+this.suit+"s"},this.toShortDisplayString=function(){var i=this.suit.substring(0,1),s;switch(this.sort){case 11:s="J";break;case 12:s="Q";break;case 13:s="K";break;case 14:s="A";break;default:s=this.sort}return s+i}}),At}var Rt,Qt;function Xe(){if(Qt)return Rt;Qt=1;var e=qe();return Rt=function(){this.cards=[new e("Club","Two",2),new e("Club","Three",3),new e("Club","Four",4),new e("Club","Five",5),new e("Club","Six",6),new e("Club","Seven",7),new e("Club","Eight",8),new e("Club","Nine",9),new e("Club","Ten",10),new e("Club","Jack",11),new e("Club","Queen",12),new e("Club","King",13),new e("Club","Ace",14),new e("Diamond","Two",2),new e("Diamond","Three",3),new e("Diamond","Four",4),new e("Diamond","Five",5),new e("Diamond","Six",6),new e("Diamond","Seven",7),new e("Diamond","Eight",8),new e("Diamond","Nine",9),new e("Diamond","Ten",10),new e("Diamond","Jack",11),new e("Diamond","Queen",12),new e("Diamond","King",13),new e("Diamond","Ace",14),new e("Heart","Two",2),new e("Heart","Three",3),new e("Heart","Four",4),new e("Heart","Five",5),new e("Heart","Six",6),new e("Heart","Seven",7),new e("Heart","Eight",8),new e("Heart","Nine",9),new e("Heart","Ten",10),new e("Heart","Jack",11),new e("Heart","Queen",12),new e("Heart","King",13),new e("Heart","Ace",14),new e("Spade","Two",2),new e("Spade","Three",3),new e("Spade","Four",4),new e("Spade","Five",5),new e("Spade","Six",6),new e("Spade","Seven",7),new e("Spade","Eight",8),new e("Spade","Nine",9),new e("Spade","Ten",10),new e("Spade","Jack",11),new e("Spade","Queen",12),new e("Spade","King",13),new e("Spade","Ace",14)]},Rt}var Vt;function Be(){if(Vt)return kt.exports;Vt=1;var e=Ne(),t=Xe(),n=kt.exports={},i={deck:new t().cards,numberOfDecks:1,random:function(){return Math.random()}};return n.playingCards=function(){return new t().cards},n.shuffle=function(s){if(s||(s=i),s.deck||(s.deck=i.deck),s.numberOfDecks)for(var r=s.deck,a=0;a<s.numberOfDecks-1;a++)s.deck=s.deck.concat(r);return s.random||(s.random=i.random),new e(s.deck,s.random)},kt.exports}var ze=Be();const lt=Ue(ze),it=1,nt=2,st=3,rt=4,at=5,ot=6,mt=1,yt=2,_t=3,xt=4,J=[{id:1,name:"Fools' Landing",flooded:!1,adventurer:ot},{id:2,name:"Cave of Shadows",flooded:!1,treasure:_t},{id:3,name:"Temple of the Moon",flooded:!1,treasure:mt},{id:4,name:"Copper Gate",flooded:!1,adventurer:st},{id:5,name:"Whispering Garden",flooded:!1,treasure:yt},{id:6,name:"Dunes of Deception",flooded:!1},{id:7,name:"Silver Gate",flooded:!1,adventurer:rt},{id:8,name:"Observatory",flooded:!1},{id:9,name:"Breakers Bridge",flooded:!1},{id:10,name:"Twilight Hollow",flooded:!1},{id:11,name:"Lost Lagoon",flooded:!1},{id:12,name:"Bronze Gate",flooded:!1,adventurer:nt},{id:13,name:"Phantom Rock",flooded:!1},{id:14,name:"Watchtower",flooded:!1},{id:15,name:"Cliffs of Abandon",flooded:!1},{id:16,name:"Misty Marsh",flooded:!1},{id:17,name:"Coral Palace",flooded:!1,treasure:xt},{id:18,name:"Howling Garden",flooded:!1,treasure:yt},{id:19,name:"Iron Gate",flooded:!1,adventurer:it},{id:20,name:"Gold Gate",flooded:!1,adventurer:at},{id:21,name:"Crimson Forest",flooded:!1},{id:22,name:"Temple of the Sun",flooded:!1,treasure:mt},{id:23,name:"Cave of Embers",flooded:!1,treasure:_t},{id:24,name:"Tidal Palace",flooded:!1,treasure:xt}],Ke=[{id:rt,name:"Messenger",color:"silver",type:"adventurer"},{id:ot,name:"Pilot",color:"blue",type:"adventurer"},{id:nt,name:"Engineer",color:"red",type:"adventurer"},{id:st,name:"Explorer",color:"green",type:"adventurer"},{id:it,name:"Diver",color:"black",type:"adventurer"},{id:at,name:"Navigator",color:"yellow",type:"adventurer"}],Je=[{name:"Fools' Landing",type:"flood"},{name:"Cave of Shadows",type:"flood"},{name:"Temple of the Moon",type:"flood"},{name:"Copper Gate",type:"flood"},{name:"Whispering Garden",type:"flood"},{name:"Dunes of Deception",type:"flood"},{name:"Silver Gate",type:"flood"},{name:"Observatory",type:"flood"},{name:"Breakers Bridge",type:"flood"},{name:"Twilight Hollow",type:"flood"},{name:"Lost Lagoon",type:"flood"},{name:"Bronze Gate",type:"flood"},{name:"Phantom Rock",type:"flood"},{name:"Watchtower",type:"flood"},{name:"Cliffs of Abandon",type:"flood"},{name:"Misty Marsh",type:"flood"},{name:"Coral Palace",type:"flood"},{name:"Howling Garden",type:"flood"},{name:"Iron Gate",type:"flood"},{name:"Gold Gate",type:"flood"},{name:"Crimson Forest",type:"flood"},{name:"Temple of the Sun",type:"flood"},{name:"Cave of Embers",type:"flood"},{name:"Tidal Palace",type:"flood"}];function G(e,t){const n=[];for(let i=0;i<e;++i)n.push(t);return n}const Qe=[...G(5,{name:"The Earth Stone",type:"treasure"}),...G(5,{name:"The Statue of the Wind",type:"treasure"}),...G(5,{name:"The Crystal of Fire",type:"treasure"}),...G(5,{name:"The Ocean's Chalice",type:"treasure"}),...G(3,{name:"Waters Rise!",type:"treasure"}),...G(3,{name:"Helicopter Lift",type:"treasure"}),...G(3,{name:"Sandbags",type:"treasure"})],se=[...Ke,...Je,...Qe],Ct=2,tt=512,et=256,R=32*Ct,x=32*Ct,ct=24*Ct,ft=24*Ct,v=R/4/2,Ve="lime",je=2,Ze="aqua",ti="adventurer-deck",ei="flood-deck",ii="island-tiles-deck",ni="treasure-deck",si=6;St(ti);const ri=lt.shuffle({deck:se.filter(({type:e})=>e==="adventurer"),random:vt}),re=""+new URL("spritesheet-Dm4BmPvg.png",import.meta.url).href,ae=""+new URL("tilesheet-C_zpU0l5.png",import.meta.url).href,ai=[re,ae],oi=e=>ve(...ai);St(ei);const hi=lt.shuffle({deck:J,random:vt});function li(){function e(){this.context.fillStyle=this.color,this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,2*Math.PI),this.context.fill(),this.context.lineWidth=2,this.context.strokeStyle="white",this.context.stroke()}const t=P({color:"black",id:it,radius:v,render(){e.call(this)}}),n=P({color:"red",id:nt,radius:v,render(){e.call(this)}}),i=P({color:"green",id:st,radius:v,render(){e.call(this)}}),s=P({color:"silver",id:rt,radius:v,render(){e.call(this)}}),r=P({color:"yellow",id:at,radius:v,render(){e.call(this)}}),a=P({color:"blue",id:ot,radius:v,render(){e.call(this)}});return{diverPawn:t,engineerPawn:n,explorerPawn:i,messengerPawn:s,navigatorPawn:r,pilotPawn:a}}function di(){return P({color:Ve,render(){if(this.context.beginPath(),this.radius!==void 0)this.context.arc(this.radius,this.radius,this.radius,0,2*Math.PI);else if(this.width!==void 0&&this.height!==void 0)this.context.rect(0,0,this.width,this.height);else return;this.context.lineWidth=je,this.context.strokeStyle=this.color,this.context.stroke()}})}function ci(){const e=Fe({image:Y[re],frameWidth:R,frameHeight:x,animations:J.map((n,i)=>({[i]:{frames:i*2,frameRate:1},[`${i}-flooded`]:{frames:[i*2+1],frameRate:1}})).reduce((n,i)=>({...n,...i}))}),t=[];for(let n=0;n<J.length;++n){const i=P({animations:e.animations,id:1+n,flooded:J[n].flooded});i.playAnimation(n),t.push(i)}return t}async function fi(){try{const e=Y[ae];return Ge({tilewidth:R,tileheight:x,width:8,height:8,tilesets:[{firstgid:0,image:e}],layers:[{name:"ground",data:[0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,0,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0]}]})}catch(e){return console.error(e),null}}function ui(){const e=P({color:"brown",width:ct,height:ft,id:mt}),t=P({color:"yellow",width:ct,height:ft,id:yt}),n=P({color:"red",width:ct,height:ft,id:_t}),i=P({color:"blue",width:ct,height:ft,id:xt});return{theCrystalOfFire:n,theEarthStone:e,theOceansChalice:i,theStatueOfTheWind:t}}function wi(){return P({x:0,y:0,color:Ze,width:tt,height:et})}St(ii);const pi=lt.shuffle({deck:J,random:vt});function gi(e){return function(){const{innerWidth:t,innerHeight:n}=window,i=t/n,s=tt/et;i<s?(e.style.width=`${t}px`,e.style.height=`${t/s}px`):(e.style.width=`${n*s}px`,e.style.height=`${n}px`)}}St(ni);const ut=lt.shuffle({deck:se.filter(({type:e})=>e==="treasure"),random:vt}),mi=25.5,yi="0.0.34",jt={hours:mi,version:yi};async function _i(){const{canvas:e,context:t}=le();e.width=tt,e.height=et;const n=gi(e);n(),window.addEventListener("resize",n),Oe();const i=`v${jt.version}`,s=`${jt.hours}h`,r=Ut({text:`${i}
${s}`,font:`${x/4}px Courier`,color:"white",x:tt-R/4*Math.max(i.length,s.length),y:x/4}),a=Ut({font:`${x/4}px Arial`,color:"white",x:R/4,y:x/4});await oi();const o=await fi();if(o===null)return 1;o.sx=(R*8-tt)/2,o.sy=(x*8-et)/2;const l=()=>{const{y:h}=ke();if(h<x){let w=o.sy-x;w=q(0,o.mapheight-x-1,w),o.sy=w}else if(h>et-x-1){let w=o.sy+x;w=q(0,o.mapheight-x-1,w),o.sy=w}};o.onDown=()=>{l(),p(),a.text=""},k(o);const c=wi();c.onDown=()=>{l(),p(),a.text=""},k(c);const d=di(),f=h=>{d.x=h.x,d.y=h.y,h.radius?(d.radius=h.radius,d.width=d.height=void 0):(d.width=h.width,d.height=h.height,d.radius=void 0)},p=()=>{d.width=d.height=d.radius=void 0},u=ci(),_=o.layers.find(({name:h})=>h==="ground");if(_!==void 0){for(let h=0;h<o.height;++h)for(let w=0;w<o.width;++w)if(_.data[h*o.width+w]!==0){const m=pi.draw(),S=u[m.id-1];S.x=w*S.width,S.y=h*S.height,S.onDown=()=>{l();let C=m.name;if(S.flooded&&(C+=`
FLOODED!`),m.adventurer!==void 0)switch(m.adventurer){case it:C+=`
(Diver)`;break;case nt:C+=`
(Engineer)`;break;case st:C+=`
(Explorer)`;break;case rt:C+=`
(Messenger)`;break;case at:C+=`
(Navigator)`;break;case ot:C+=`
(Pilot)`}if(m.treasure!==void 0)switch(m.treasure){case _t:C+=`
(The Crystal of Fire)`;break;case mt:C+=`
(The Earth Stone)`;break;case xt:C+=`
(The Ocean's Chalice)`;break;case yt:C+=`
(The Statue of the Wind)`}f(S),a.text=C},k(S),o.add(S)}}const{theCrystalOfFire:y,theEarthStone:g,theOceansChalice:E,theStatueOfTheWind:b}=ui();g.x=u[0].width+(u[0].width-g.width)/2,g.y=u[0].height+(u[0].height-g.height)/2,g.onDown=()=>{f(g),a.text="The Earth Stone"},k(g),o.add(g),b.x=u[0].width+(u[0].width-b.width)/2,b.y=u[0].height*6+(u[0].height-b.height)/2,b.onDown=()=>{f(b),a.text="The Statue of the Wind"},k(b),o.add(b),y.x=u[0].width*6+(u[0].width-y.width)/2,y.y=u[0].height+(u[0].height-y.height)/2,y.onDown=()=>{f(y),a.text="The Crystal of Fire"},k(y),o.add(y),E.x=u[0].width*6+(u[0].width-E.width)/2,E.y=u[0].height*6+(u[0].height-E.height)/2,E.onDown=()=>{f(E),a.text="The Ocean's Chalice"},k(E),o.add(E);const dt={...hi},B=[];for(let h=0;h<6;++h){const w=dt.draw(),m=u.find(({id:S})=>S===w.id);m.flooded=!0,m.playAnimation(`${m.id-1}-flooded`),B.push(w)}lt.shuffle({deck:[]}).putOnTopOfDeck(B);const O=[];for(let h=0;h<si;++h)O.push({name:`Player ${h+1}`,adventurerCard:ri.draw(),cards:[]});const L=h=>()=>{f(h);const w=O.find(({adventurerCard:S})=>S.id===h.id);if(w===void 0)return;const m=`${w.name}: ${w.adventurerCard.name}
Cards: `+w.cards.map(({name:S})=>S).join(", ");a.text=m},{diverPawn:F,engineerPawn:W,explorerPawn:I,messengerPawn:M,navigatorPawn:T,pilotPawn:D}=li();for(const h of u){const w=J.find(({id:m})=>m===h.id);if(w!==void 0&&!(w.adventurer!==void 0&&!O.map(({adventurerCard:m})=>m.id).includes(w.adventurer)))switch(w.adventurer){case it:F.x=h.x+(R-v*2)/2,F.y=h.y+(x-v*2)/2,F.onDown=L(F),k(F),o.add(F);break;case nt:W.x=h.x+(R-v*2)/2,W.y=h.y+(x-v*2)/2,W.onDown=L(W),k(W),o.add(W);break;case st:I.x=h.x+(R-v*2)/2,I.y=h.y+(x-v*2)/2,I.onDown=L(I),k(I),o.add(I);break;case rt:M.x=h.x+(R-v*2)/2,M.y=h.y+(x-v*2)/2,M.onDown=L(M),k(M),o.add(M);break;case at:T.x=h.x+(R-v*2)/2,T.y=h.y+(x-v*2)/2,T.onDown=L(T),k(T),o.add(T);break;case ot:D.x=h.x+(R-v*2)/2,D.y=h.y+(x-v*2)/2,D.onDown=L(D),k(D),o.add(D);break}}o.add(d),ut.deal(2,O.map(({cards:h})=>h));for(const h of O){let w=h.cards.filter(({name:m})=>m==="Waters Rise!").length;for(;w>0;){console.log("Waters Rise! Replacement card required");for(let m=0;m<h.cards.length;++m)if(h.cards[m].name==="Waters Rise!"){const S=h.cards[m],C=ut.draw();h.cards[m]=C,ut.putOnTopOfDeck(S),ut.shuffle()}w=h.cards.filter(({name:m})=>m==="Waters Rise!").length}}return(()=>{a.text=O.map(({name:h,adventurerCard:w})=>`${h}: ${w.name}`).join(`
`)})(),Ie({render(){c.render(),o.render(),t.fillStyle="rgba(0, 0, 0, 0.67)",t.fillRect(r.x,r.y,r.width,r.height),r.render(),t.fillStyle="rgba(0, 0, 0, 0.67)",t.fillRect(a.x,a.y,a.width,a.height),a.render()},update(){}}).start(),0}_i();
