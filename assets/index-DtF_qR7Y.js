(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function i(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=i(s);fetch(s.href,r)}})();/**
 * @preserve
 * Kontra.js v10.0.2
 */function ne(e,t){let i=Math.sin(t),n=Math.cos(t);return{x:e.x*n-e.y*i,y:e.x*i+e.y*n}}function N(e,t,i){return Math.min(Math.max(e,i),t)}function Qt(e){let{x:t=0,y:i=0,width:n,height:s,radius:r}=e.world||e;return e.mapwidth&&(n=e.mapwidth,s=e.mapheight),r&&(n=r.x*2,s=r.y*2),e.anchor&&(t-=n*e.anchor.x,i-=s*e.anchor.y),n<0&&(t+=n,n*=-1),s<0&&(i+=s,s*=-1),{x:t,y:i,width:n,height:s}}let pt=()=>{};function Vt(e,t){let i=e.indexOf(t);if(i!=-1)return e.splice(i,1),!0}function se(e,t){let{x:i,y:n,width:s,height:r}=Qt(t);do i-=t.sx||0,n-=t.sy||0;while(t=t.parent);let a=e.x-Math.max(i,Math.min(e.x,i+s)),o=e.y-Math.max(n,Math.min(e.y,n+r));return a*a+o*o<e.radius*e.radius}let ut={};function lt(e,t){ut[e]=ut[e]||[],ut[e].push(t)}function X(e,...t){(ut[e]||[]).map(i=>i(...t))}let G,wt,Wt={get(e,t){return t=="_proxy"?!0:pt}};function U(){return G}function O(){return wt}function re(e,{contextless:t=!1}={}){if(G=document.getElementById(e)||e||document.querySelector("canvas"),t&&(G=G||new Proxy({},Wt)),!G)throw Error("You must provide a canvas element for the game");return wt=G.getContext("2d")||new Proxy({},Wt),wt.imageSmoothingEnabled=!1,X("init"),{canvas:G,context:wt}}class Pt{constructor({spriteSheet:t,frames:i,frameRate:n,loop:s=!0,name:r}){let{width:a,height:o,spacing:d=0,margin:c=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:i,frameRate:n,loop:s,name:r,width:a,height:o,spacing:d,margin:c,isStopped:!1,_f:0,_a:0})}clone(){return new Pt(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped){if(!this.loop&&this._f==this.frames.length-1){this.stop();return}for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}}render({x:t,y:i,width:n=this.width,height:s=this.height,context:r=O()}){let a=this.frames[this._f]/this.spriteSheet._f|0,o=this.frames[this._f]%this.spriteSheet._f|0;r.drawImage(this.spriteSheet.image,this.margin+o*this.width+(o*2+1)*this.spacing,this.margin+a*this.height+(a*2+1)*this.spacing,this.width,this.height,t,i,n,s)}}function ae(){return new Pt(...arguments)}let oe=/(jpeg|jpg|gif|png|webp)$/,he=/(wav|mp3|ogg|aac)$/,le=/^\//,de=/\/$/,Zt=new WeakMap,ce="",fe="",ue="";function xt(e,t){return new URL(e,t).href}function At(e,t){return[e.replace(de,""),t].filter(i=>i).join("/")}function Lt(e){return e.split(".").pop()}function Rt(e){let t=e.replace("."+Lt(e),"");return t.split("/").length==2?t.replace(le,""):t}function we(e){return{wav:e.canPlayType('audio/wav; codecs="1"'),mp3:e.canPlayType("audio/mpeg;"),ogg:e.canPlayType('audio/ogg; codecs="vorbis"'),aac:e.canPlayType("audio/aac;")}}let F={},Z={},z={};function Ot(){window.__k||(window.__k={dm:Zt,u:xt,d:z,i:F})}function pe(e){return Ot(),new Promise((t,i)=>{let n,s,r;if(n=At(ce,e),F[n])return t(F[n]);s=new Image,s.onload=function(){r=xt(n,window.location.href),F[Rt(e)]=F[n]=F[r]=this,X("assetLoaded",this,e),t(this)},s.onerror=function(){i("Unable to load image "+n)},s.src=n})}function ge(e){return new Promise((t,i)=>{let n=e,s,r,a,o;if(s=new Audio,r=we(s),e=[].concat(e).reduce((d,c)=>d||(r[Lt(c)]?c:null),0),!e)return i("cannot play any of the audio formats provided "+n);if(a=At(fe,e),Z[a])return t(Z[a]);s.addEventListener("canplay",function(){o=xt(a,window.location.href),Z[Rt(e)]=Z[a]=Z[o]=this,X("assetLoaded",this,e),t(this)}),s.onerror=function(){i("Unable to load audio "+a)},s.src=a,s.load()})}function me(e){Ot();let t,i;return t=At(ue,e),z[t]?Promise.resolve(z[t]):fetch(t).then(n=>{if(!n.ok)throw n;return n.clone().json().catch(()=>n.text())}).then(n=>(i=xt(t,window.location.href),typeof n=="object"&&Zt.set(n,i),z[Rt(e)]=z[t]=z[i]=n,X("assetLoaded",n,e),n))}function ye(...e){return Ot(),Promise.all(e.map(t=>{let i=Lt([].concat(t)[0]);return i.match(oe)?pe(t):i.match(he)?ge(t):me(t)}))}class K{constructor(t=0,i=0,n={}){t.x!=null?(this.x=t.x,this.y=t.y):(this.x=t,this.y=i),n._c&&(this.clamp(n._a,n._b,n._d,n._e),this.x=t,this.y=i)}set(t){this.x=t.x,this.y=t.y}add(t){return new K(this.x+t.x,this.y+t.y,this)}subtract(t){return new K(this.x-t.x,this.y-t.y,this)}scale(t){return new K(this.x*t,this.y*t)}normalize(t=this.length()||1){return new K(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,i,n,s){this._c=!0,this._a=t,this._b=i,this._d=n,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?N(this._a,this._d,t):t}set y(t){this._y=this._c?N(this._b,this._e,t):t}}function St(){return new K(...arguments)}class _e{constructor(t){return this.init(t)}init(t={}){this.position=St(),this.velocity=St(),this.acceleration=St(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let i=this.acceleration;t&&(i=i.scale(t)),this.velocity=this.velocity.add(i);let n=this.velocity;t&&(n=n.scale(t)),this.position=this.position.add(n),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}class jt extends _e{init({width:t=0,height:i=0,context:n=O(),render:s=this.draw,update:r=this.advance,children:a=[],anchor:o={x:0,y:0},opacity:d=1,rotation:c=0,drotation:u=0,ddrotation:h=0,scaleX:l=1,scaleY:y=1,...w}={}){this._c=[],super.init({width:t,height:i,context:n,anchor:o,opacity:d,rotation:c,drotation:u,ddrotation:h,scaleX:l,scaleY:y,...w}),this._di=!0,this._uw(),this.addChild(a),this._rf=s,this._uf=r,lt("init",()=>{this.context??(this.context=O())})}update(t){this._uf(t),this.children.map(i=>i.update&&i.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let i=this.width,n=this.height;this.radius&&(i=n=this.radius*2);let s=-i*this.anchor.x,r=-n*this.anchor.y;(s||r)&&t.translate(s,r),this.context.globalAlpha=this.opacity,this._rf(),(s||r)&&t.translate(-s,-r),this.children.map(o=>o.render&&o.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:i=0,_wo:n=1,_wrot:s=0,_wsx:r=1,_wsy:a=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this.radius&&(this._wrx=this.radius,this._wry=this.radius),this._wo=n*this.opacity,this._wsx=r*this.scaleX,this._wsy=a*this.scaleY,this._wx=this._wx*r,this._wy=this._wy*a,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this.radius&&(this._wrx=this.radius*this._wsx,this._wry=this.radius*this._wsy),this._wrot=s+this.rotation;let{x:o,y:d}=ne({x:this._wx,y:this._wy},s);this._wx=o,this._wy=d,this._wx+=t,this._wy+=i}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,radius:this.radius?{x:this._wrx,y:this._wry}:void 0,opacity:this._wo,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(i=>{this.children.push(i),i.parent=this,i._pc=i._pc||pt,i._pc()})}removeChild(...t){t.flat().map(i=>{Vt(this.children,i)&&(i.parent=null,i._pc())})}get radius(){return this._r}set radius(t){this._r=t,this._pc()}get opacity(){return this._opa}set opacity(t){this._opa=N(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}advance(t){super.advance(t),this.drotation+=this.ddrotation,this.rotation+=this.drotation}setScale(t,i=t){this.scaleX=t,this.scaleY=i}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class xe extends jt{init({image:t,width:i=t?t.width:void 0,height:n=t?t.height:void 0,...s}={}){super.init({image:t,width:i,height:n,...s})}get animations(){return this._a}set animations(t){let i,n;this._a={};for(i in t)this._a[i]=t[i].clone(),n=n||this._a[i];this.currentAnimation=n,this.width=this.width||n.width,this.height=this.height||n.height}playAnimation(t){var i;(i=this.currentAnimation)==null||i.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){var i;super.advance(t),(i=this.currentAnimation)==null||i.update(t)}draw(){if(this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color){if(this.context.fillStyle=this.color,this.radius){this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.context.fill();return}this.context.fillRect(0,0,this.width,this.height)}}}function C(){return new xe(...arguments)}let Ee=/(\d+)(\w+)/;function ve(e){if(!e)return{computed:0};let t=e.match(Ee),i=+t[1],n=t[2];return{size:i,unit:n,computed:i}}class Se extends jt{init({text:t="",textAlign:i="",lineHeight:n=1,font:s=(a=>(a=O())==null?void 0:a.font)(),...r}={}){t=""+t,super.init({text:t,textAlign:i,lineHeight:n,font:s,...r}),this.context&&this._p(),lt("init",()=>{this.font??(this.font=O().font),this._p()})}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=ve(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context,i=[this.text];if(t.font=this.font,i=this.text.split(`
`),this._fw&&i.map(n=>{let s=n.split(" "),r=s.shift(),a=r;s.map(o=>{a+=" "+o,t.measureText(a).width>this._fw&&(this._s.push(r),a=o),r=a}),this._s.push(a)}),!this._s.length&&this.text.includes(`
`)){let n=0;i.map(s=>{this._s.push(s),n=Math.max(n,t.measureText(s).width)}),this._w=this._fw||n}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,i=this.textAlign,n=this.context;i=this.textAlign||(n.canvas.dir=="rtl"?"right":"left"),t=i=="right"?this.width:i=="center"?this.width/2|0:0,this._s.map((s,r)=>{n.textBaseline="top",n.textAlign=i,n.fillStyle=this.color,n.font=this.font,this.strokeColor&&(n.strokeStyle=this.strokeColor,n.lineWidth=this.lineWidth??1,n.strokeText(s,t,this._fs*this.lineHeight*r)),n.fillText(s,t,this._fs*this.lineHeight*r)})}}function $t(){return new Se(...arguments)}let Q=new WeakMap,Yt={},It={},te={0:"left",1:"middle",2:"right"};function Ce(e=U()){return Q.get(e)}function be(e){let t=e._lf.length?e._lf:e._cf;for(let i=t.length-1;i>=0;i--){let n=t[i];if(n.collidesWithPointer?n.collidesWithPointer(e):se(e,n))return n}}function T(e,t){return parseFloat(e.getPropertyValue(t))||0}function Te(e){let{canvas:t,_s:i}=e,n=t.getBoundingClientRect(),s=i.transform!="none"?i.transform.replace("matrix(","").split(","):[1,1,1,1],r=parseFloat(s[0]),a=parseFloat(s[3]),o=(T(i,"border-left-width")+T(i,"border-right-width"))*r,d=(T(i,"border-top-width")+T(i,"border-bottom-width"))*a,c=(T(i,"padding-left")+T(i,"padding-right"))*r,u=(T(i,"padding-top")+T(i,"padding-bottom"))*a;return{scaleX:(n.width-o-c)/t.width,scaleY:(n.height-d-u)/t.height,offsetX:n.left+(T(i,"border-left-width")+T(i,"padding-left"))*r,offsetY:n.top+(T(i,"border-top-width")+T(i,"padding-top"))*a}}function Gt(e){let t=e.button!=null?te[e.button]:"left";It[t]=!0,Mt(e,"onDown")}function Ct(e){let t=e.button!=null?te[e.button]:"left";It[t]=!1,Mt(e,"onUp")}function Ut(e){Mt(e,"onOver")}function De(e){let t=Q.get(e.target);t._oo=null,It={}}function Nt(e,t,i){let n=be(e);n&&n[t]&&n[t](i),Yt[t]&&Yt[t](i,n),t=="onOver"&&(n!=e._oo&&e._oo&&e._oo.onOut&&e._oo.onOut(i),e._oo=n)}function Mt(e,t){e.preventDefault();let i=e.target,n=Q.get(i),{scaleX:s,scaleY:r,offsetX:a,offsetY:o}=Te(n);e.type.includes("touch")?(Array.from(e.touches).map(({clientX:c,clientY:u,identifier:h})=>{let l=n.touches[h];l||(l=n.touches[h]={start:{x:(c-a)/s,y:(u-o)/r}},n.touches.length++),l.changed=!1}),Array.from(e.changedTouches).map(({clientX:c,clientY:u,identifier:h})=>{let l=n.touches[h];l.changed=!0,l.x=n.x=(c-a)/s,l.y=n.y=(u-o)/r,Nt(n,t,e),X("touchChanged",e,n.touches),t=="onUp"&&(delete n.touches[h],n.touches.length--,n.touches.length||X("touchEnd"))})):(n.x=(e.clientX-a)/s,n.y=(e.clientY-o)/r,Nt(n,t,e))}function ke({radius:e=5,canvas:t=U()}={}){let i=Q.get(t);if(!i){let n=window.getComputedStyle(t);i={x:0,y:0,radius:e,touches:{length:0},canvas:t,_cf:[],_lf:[],_o:[],_oo:null,_s:n},Q.set(t,i)}return t.addEventListener("mousedown",Gt),t.addEventListener("touchstart",Gt),t.addEventListener("mouseup",Ct),t.addEventListener("touchend",Ct),t.addEventListener("touchcancel",Ct),t.addEventListener("blur",De),t.addEventListener("mousemove",Ut),t.addEventListener("touchmove",Ut),i._t||(i._t=!0,lt("tick",()=>{i._lf.length=0,i._cf.map(n=>{i._lf.push(n)}),i._cf.length=0})),i}function S(...e){e.flat().map(t=>{let i=t.context?t.context.canvas:U(),n=Q.get(i);if(!n)throw new ReferenceError("Pointer events not initialized for the objects canvas");t.__r||(t.__r=t.render,t.render=function(){n._cf.push(this),this.__r()},n._o.push(t))})}function Pe(e){let t=e.canvas;e.clearRect(0,0,t.width,t.height)}function Ae({fps:e=60,clearCanvas:t=!0,update:i=pt,render:n,context:s=O(),blur:r=!1}={}){if(!n)throw Error("You must provide a render() function");let a=0,o=1e3/e,d=1/e,c=t?Pe:pt,u,h,l,y,w,g=!0;r||(window.addEventListener("focus",()=>{g=!0}),window.addEventListener("blur",()=>{g=!1})),lt("init",()=>{w.context??(w.context=O())});function p(){if(h=requestAnimationFrame(p),!!g&&(l=performance.now(),y=l-u,u=l,!(y>1e3))){for(a+=y;a>=o;)X("tick"),w.update(d),a-=o;c(w.context),w.render()}}return w={update:i,render:n,isStopped:!0,context:s,start(){this.isStopped&&(u=performance.now(),this.isStopped=!1,requestAnimationFrame(p))},stop(){this.isStopped=!0,cancelAnimationFrame(h)},_frame:p,set _last(x){u=x}},w}let H;function Ht(){H??(H=Date.now()),H|=0,H=H+2654435769|0;let e=H^H>>>16;return e=Math.imul(e,569420461),e=e^e>>>15,e=Math.imul(e,1935289751),((e=e^e>>>15)>>>0)/4294967296}function Ft(e=Date.now()){if(H=e,typeof e=="string"){for(var t=0,i=1779033703^e.length;t<e.length;t++)i=Math.imul(i^e.charCodeAt(t),3432918353),i=i<<13|i>>>19;i=Math.imul(i^i>>>16,2246822507),i=Math.imul(i^i>>>13,3266489909),H=(i^=i>>>16)>>>0}}function Le(e){if(+e==e)return e;let t=[],i=e.split(".."),n=+i[0],s=+i[1],r=n;if(n<s)for(;r<=s;r++)t.push(r);else for(;r>=s;r--)t.push(r);return t}class Re{constructor({image:t,frameWidth:i,frameHeight:n,spacing:s=0,margin:r=0,animations:a}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:i,height:n,spacing:s,margin:r},this._f=(t.width-r)/i|0,this.createAnimations(a)}createAnimations(t){let i,n;for(n in t){let{frames:s,frameRate:r,loop:a}=t[n];if(i=[],s==null)throw Error("Animation "+n+" must provide a frames property");[].concat(s).map(o=>{i=i.concat(Le(o))}),this.animations[n]=ae({spriteSheet:this,frames:i,frameRate:r,loop:a,name:n})}}}function Oe(){return new Re(...arguments)}let Ie=2147483648,Me=1073741824,Xt=536870912;function j(e,t){return e/t|0}function tt(e,t){return e/t|0}class He{constructor(t={}){let{width:i,height:n,tilewidth:s,tileheight:r,tilesets:a}=t,o=i*s,d=n*r,c=document.createElement("canvas");c.width=o,c.height=d,this._c=c,this._ctx=c.getContext("2d"),a.map(u=>{let{__k:h,location:l}=window,y=(h?h.dm.get(t):"")||l.href,{source:w}=u;if(w){if(!h)throw Error('You must use "load" or "loadData" to resolve tileset.source');let p=h.d[h.u(w,y)];if(!p)throw Error(`You must load the tileset source "${w}" before loading the tileset`);Object.keys(p).map(x=>{u[x]=p[x]})}let{image:g}=u;if(""+g===g){if(!h)throw Error('You must use "load" or "loadImage" to resolve tileset.image');let p=h.i[h.u(g,y)];if(!p)throw Error(`You must load the image "${g}" before loading the tileset`);u.image=p}}),Object.assign(this,{context:O(),layerMap:{},layerCanvases:{},mapwidth:o,mapheight:d,_sx:0,_sy:0,_o:[],...t}),this.context&&this._p(),lt("init",()=>{this.context??(this.context=O()),this._p()})}get sx(){return this._sx}get sy(){return this._sy}set sx(t){let i=Math.max(0,this.mapwidth-U().width);this._sx=N(0,i,t)}set sy(t){let i=Math.max(0,this.mapheight-U().height);this._sy=N(0,i,t)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map(i=>{this._o.push(i),i.parent=this})}remove(...t){t.flat().map(i=>{Vt(this._o,i),i.parent=null})}getPosition(t){let i=U().getBoundingClientRect(),n=t.x-i.x,s=t.y-i.y;return n+=this.sx,s+=this.sy,{x:n,y:s,row:j(s,this.tileheight),col:tt(n,this.tilewidth)}}setTileAtLayer(t,i,n){let{layerMap:s,tileheight:r,tilewidth:a,width:o}=this,{row:d,col:c,x:u,y:h}=i,l=d??j(h,r),y=c??tt(u,a);s[t]&&(this._d=!0,s[t]._d=!0,s[t].data[l*o+y]=n)}setLayer(t,i){let{layerMap:n}=this;n[t]&&(this._d=!0,n[t]._d=!0,n[t].data=i)}layerCollidesWith(t,i){let{tilewidth:n,tileheight:s,layerMap:r}=this,{x:a,y:o,width:d,height:c}=Qt(i),u=j(o,s),h=tt(a,n),l=j(o+c,s),y=tt(a+d,n),w=r[t];for(let g=u;g<=l;g++)for(let p=h;p<=y;p++)if(w.data[p+g*this.width])return!0;return!1}tileAtLayer(t,i){let{layerMap:n,tileheight:s,tilewidth:r,width:a}=this,{row:o,col:d,x:c,y:u}=i,h=o??j(u,s),l=d??tt(c,r);return n[t]?n[t].data[h*a+l]:-1}render(t=this._c,i=!0){let{_d:n,context:s,sx:r=0,sy:a=0}=this;n&&this._p();let{width:o,height:d}=U(),c=Math.min(t.width,o),u=Math.min(t.height,d);s.drawImage(t,r,a,c,u,0,0,c,u),i&&(s.save(),(r||a)&&s.translate(-r,-a),this.objects.map(h=>h.render&&h.render()),s.restore())}renderLayer(t){let{layerCanvases:i,layerMap:n}=this,s=n[t],r=i[t],a=r==null?void 0:r.getContext("2d");if(!r){let{mapwidth:o,mapheight:d}=this;r=document.createElement("canvas"),a=r.getContext("2d"),r.width=o,r.height=d,i[t]=r,this._rl(s,a)}s._d&&(s._d=!1,a.clearRect(0,0,r.width,r.height),this._rl(s,a)),this.render(r,!1)}_p(){let{_ctx:t,layers:i=[],layerMap:n}=this;this._d=!1,i.map(s=>{let{name:r,data:a,visible:o}=s;s._d=!1,n[r]=s,a&&o!=!1&&this._rl(s,t)})}_rl(t,i){let{opacity:n,data:s=[]}=t,{tilesets:r,width:a,tilewidth:o,tileheight:d}=this;i.save(),i.globalAlpha=n,s.map((c,u)=>{if(!c)return;let h=0,l=0,y=c&Ie,w=c&Me,g=0,p=0,x=0,q=0,V=0;h=y||w,c&=1073741823,V=c&Xt,V&&(y&&w?x=1:y?g=1:w?p=1:q=1,l=g||p||x||q,c&=~Xt);let dt;for(let E=r.length-1;E>=0&&(dt=r[E],!(c/dt.firstgid>=1));E--);let{image:B,spacing:P=0,margin:A=0,firstgid:I,columns:M}=dt,L=c-I,R=M??B.width/(o+P)|0,W=u%a*o,$=(u/a|0)*d,f=A+L%R*(o+P),m=A+(L/R|0)*(d+P);l?(i.save(),i.translate(W+o/2,$+d/2),p||q?i.rotate(-Math.PI/2):(g||x)&&i.rotate(Math.PI/2),(x||q)&&i.scale(-1,1),W=-o/2,$=-d/2):h&&(i.save(),i.translate(W+(y?o:0),$+(w?d:0)),i.scale(y?-1:1,w?-1:1),W=h?0:W,$=h?0:$),i.drawImage(B,f,m,o,d,W,$,o,d),(h||l)&&i.restore()}),i.restore()}}function Fe(){return new He(...arguments)}function We(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var bt={exports:{}},Tt,qt;function $e(){return qt||(qt=1,Tt=function(e,t){this.reset=function(){this.cards=e.slice(0),this.length=this.cards.length},this.shuffle=function(){i(this.cards)},this.reset(),this.shuffle(),this.deal=function(n,s){for(var r=0;r<n;r++)for(var a=0;a<s.length;a++){if(!s[a]||!s[a].push)throw new Error("Deck#deal | Undefined Hand");s[a].push(this.cards.pop())}this.length=this.cards.length},this.draw=function(n){if(!n||n<=1)return this.length=this.cards.length-1,this.cards.pop();for(var s=[],r=0;r<n;r++)s.push(this.cards.pop());return this.length=this.cards.length,s},this.drawFromBottomOfDeck=function(n){(!n||n<1)&&(n=1);for(var s=[],r=0;r<n;r++)s.push(this.cards.shift());return this.length=this.cards.length,s.length===1?s[0]:s},this.drawRandom=function(n){var s=function(){var o=Math.floor(t()*this.cards.length),d=this.cards[o];return this.cards.splice(o,1),this.length=this.cards.length,d};if(!n||n<=1)return s.apply(this);for(var r=[],a=0;a<n;a++)r.push(s.apply(this));return r},this.putOnTopOfDeck=function(n){if(!n instanceof Array)this.cards.push(n);else for(var s=0;s<n.length;s++)this.cards.push(n[s]);this.length=this.cards.length},this.putOnBottomOfDeck=function(n){if(!n instanceof Array)this.cards.unshift(n);else for(var s=0;s<n.length;s++)this.cards.unshift(n[s]);this.length=this.cards.length};function i(n){var s=n.length;if(s===0)return!1;for(;--s;){var r=Math.floor(t()*(s+1)),a=n[s],o=n[r];n[s]=o,n[r]=a}}}),Tt}var Dt,Bt;function Ye(){return Bt||(Bt=1,Dt=function(e,t,i){this.suit=e,this.description=t,this.sort=i,this.toString=function(){return this.description+" of "+this.suit+"s"},this.toShortDisplayString=function(){var n=this.suit.substring(0,1),s;switch(this.sort){case 11:s="J";break;case 12:s="Q";break;case 13:s="K";break;case 14:s="A";break;default:s=this.sort}return s+n}}),Dt}var kt,zt;function Ge(){if(zt)return kt;zt=1;var e=Ye();return kt=function(){this.cards=[new e("Club","Two",2),new e("Club","Three",3),new e("Club","Four",4),new e("Club","Five",5),new e("Club","Six",6),new e("Club","Seven",7),new e("Club","Eight",8),new e("Club","Nine",9),new e("Club","Ten",10),new e("Club","Jack",11),new e("Club","Queen",12),new e("Club","King",13),new e("Club","Ace",14),new e("Diamond","Two",2),new e("Diamond","Three",3),new e("Diamond","Four",4),new e("Diamond","Five",5),new e("Diamond","Six",6),new e("Diamond","Seven",7),new e("Diamond","Eight",8),new e("Diamond","Nine",9),new e("Diamond","Ten",10),new e("Diamond","Jack",11),new e("Diamond","Queen",12),new e("Diamond","King",13),new e("Diamond","Ace",14),new e("Heart","Two",2),new e("Heart","Three",3),new e("Heart","Four",4),new e("Heart","Five",5),new e("Heart","Six",6),new e("Heart","Seven",7),new e("Heart","Eight",8),new e("Heart","Nine",9),new e("Heart","Ten",10),new e("Heart","Jack",11),new e("Heart","Queen",12),new e("Heart","King",13),new e("Heart","Ace",14),new e("Spade","Two",2),new e("Spade","Three",3),new e("Spade","Four",4),new e("Spade","Five",5),new e("Spade","Six",6),new e("Spade","Seven",7),new e("Spade","Eight",8),new e("Spade","Nine",9),new e("Spade","Ten",10),new e("Spade","Jack",11),new e("Spade","Queen",12),new e("Spade","King",13),new e("Spade","Ace",14)]},kt}var Kt;function Ue(){if(Kt)return bt.exports;Kt=1;var e=$e(),t=Ge(),i=bt.exports={},n={deck:new t().cards,numberOfDecks:1,random:function(){return Math.random()}};return i.playingCards=function(){return new t().cards},i.shuffle=function(s){if(s||(s=n),s.deck||(s.deck=n.deck),s.numberOfDecks)for(var r=s.deck,a=0;a<s.numberOfDecks-1;a++)s.deck=s.deck.concat(r);return s.random||(s.random=n.random),new e(s.deck,s.random)},bt.exports}var Ne=Ue();const Et=We(Ne),nt=1,st=2,rt=3,at=4,ot=5,ht=6,gt=1,mt=2,yt=3,_t=4,J=[{id:1,name:"Fools' Landing",flooded:!1,adventurer:ht},{id:2,name:"Cave of Shadows",flooded:!1,treasure:yt},{id:3,name:"Temple of the Moon",flooded:!1,treasure:gt},{id:4,name:"Copper Gate",flooded:!1,adventurer:rt},{id:5,name:"Whispering Garden",flooded:!1,treasure:mt},{id:6,name:"Dunes of Deception",flooded:!1},{id:7,name:"Silver Gate",flooded:!1,adventurer:at},{id:8,name:"Observatory",flooded:!1},{id:9,name:"Breakers Bridge",flooded:!1},{id:10,name:"Twilight Hollow",flooded:!1},{id:11,name:"Lost Lagoon",flooded:!1},{id:12,name:"Bronze Gate",flooded:!1,adventurer:st},{id:13,name:"Phantom Rock",flooded:!1},{id:14,name:"Watchtower",flooded:!1},{id:15,name:"Cliffs of Abandon",flooded:!1},{id:16,name:"Misty Marsh",flooded:!1},{id:17,name:"Coral Palace",flooded:!1,treasure:_t},{id:18,name:"Howling Garden",flooded:!1,treasure:mt},{id:19,name:"Iron Gate",flooded:!1,adventurer:nt},{id:20,name:"Gold Gate",flooded:!1,adventurer:ot},{id:21,name:"Crimson Forest",flooded:!1},{id:22,name:"Temple of the Sun",flooded:!1,treasure:gt},{id:23,name:"Cave of Embers",flooded:!1,treasure:yt},{id:24,name:"Tidal Palace",flooded:!1,treasure:_t}],Xe=[{id:at,name:"Messenger",color:"silver",type:"adventurer"},{id:ht,name:"Pilot",color:"blue",type:"adventurer"},{id:st,name:"Engineer",color:"red",type:"adventurer"},{id:rt,name:"Explorer",color:"green",type:"adventurer"},{id:nt,name:"Diver",color:"black",type:"adventurer"},{id:ot,name:"Navigator",color:"yellow",type:"adventurer"}],qe=[{name:"Fools' Landing",type:"flood"},{name:"Cave of Shadows",type:"flood"},{name:"Temple of the Moon",type:"flood"},{name:"Copper Gate",type:"flood"},{name:"Whispering Garden",type:"flood"},{name:"Dunes of Deception",type:"flood"},{name:"Silver Gate",type:"flood"},{name:"Observatory",type:"flood"},{name:"Breakers Bridge",type:"flood"},{name:"Twilight Hollow",type:"flood"},{name:"Lost Lagoon",type:"flood"},{name:"Bronze Gate",type:"flood"},{name:"Phantom Rock",type:"flood"},{name:"Watchtower",type:"flood"},{name:"Cliffs of Abandon",type:"flood"},{name:"Misty Marsh",type:"flood"},{name:"Coral Palace",type:"flood"},{name:"Howling Garden",type:"flood"},{name:"Iron Gate",type:"flood"},{name:"Gold Gate",type:"flood"},{name:"Crimson Forest",type:"flood"},{name:"Temple of the Sun",type:"flood"},{name:"Cave of Embers",type:"flood"},{name:"Tidal Palace",type:"flood"}];function Y(e,t){const i=[];for(let n=0;n<e;++n)i.push(t);return i}const Be=[...Y(5,{name:"The Earth Stone",type:"treasure"}),...Y(5,{name:"The Statue of the Wind",type:"treasure"}),...Y(5,{name:"The Crystal of Fire",type:"treasure"}),...Y(5,{name:"The Ocean's Chalice",type:"treasure"}),...Y(3,{name:"Waters Rise!",type:"treasure"}),...Y(3,{name:"Helicopter Lift",type:"treasure"}),...Y(3,{name:"Sandbags",type:"treasure"})],ze=[...Xe,...qe,...Be],vt=2,et=512,it=256,D=32*vt,_=32*vt,ct=24*vt,ft=24*vt,v=D/4/2,Ke="lime",Je=2,Qe="aqua",Ve="adventurer-deck",Ze="flood-deck",je="island-tiles-deck",ti=6;Ft(Ve);const ei=Et.shuffle({deck:ze.filter(({type:e})=>e==="adventurer"),random:Ht}),ee=""+new URL("spritesheet-Dm4BmPvg.png",import.meta.url).href,ie=""+new URL("tilesheet-C_zpU0l5.png",import.meta.url).href,ii=[ee,ie],ni=e=>ye(...ii);Ft(Ze);const si=Et.shuffle({deck:J,random:Ht});function ri(){function e(){this.context.fillStyle=this.color,this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,2*Math.PI),this.context.fill(),this.context.lineWidth=2,this.context.strokeStyle="white",this.context.stroke()}const t=C({color:"black",id:nt,radius:v,render(){e.call(this)}}),i=C({color:"red",id:st,radius:v,render(){e.call(this)}}),n=C({color:"green",id:rt,radius:v,render(){e.call(this)}}),s=C({color:"silver",id:at,radius:v,render(){e.call(this)}}),r=C({color:"yellow",id:ot,radius:v,render(){e.call(this)}}),a=C({color:"blue",id:ht,radius:v,render(){e.call(this)}});return{diverPawn:t,engineerPawn:i,explorerPawn:n,messengerPawn:s,navigatorPawn:r,pilotPawn:a}}function ai(){return C({color:Ke,render(){this.context.beginPath(),this.radius!==void 0?this.context.arc(this.radius,this.radius,this.radius,0,2*Math.PI):this.context.rect(0,0,this.width,this.height),this.context.lineWidth=Je,this.context.strokeStyle=this.color,this.context.stroke()}})}function oi(){const e=Oe({image:F[ee],frameWidth:D,frameHeight:_,animations:J.map((i,n)=>({[n]:{frames:n*2,frameRate:1},[`${n}-flooded`]:{frames:[n*2+1],frameRate:1}})).reduce((i,n)=>({...i,...n}))}),t=[];for(let i=0;i<J.length;++i){const n=C({animations:e.animations,id:1+i,flooded:J[i].flooded});n.playAnimation(i),t.push(n)}return t}async function hi(){try{const e=F[ie];return Fe({tilewidth:D,tileheight:_,width:8,height:8,tilesets:[{firstgid:0,image:e}],layers:[{name:"ground",data:[0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,0,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0]}]})}catch(e){return console.error(e),null}}function li(){const e=C({color:"brown",width:ct,height:ft,id:gt}),t=C({color:"yellow",width:ct,height:ft,id:mt}),i=C({color:"red",width:ct,height:ft,id:yt}),n=C({color:"blue",width:ct,height:ft,id:_t});return{theCrystalOfFire:i,theEarthStone:e,theOceansChalice:n,theStatueOfTheWind:t}}function di(){return C({x:0,y:0,color:Qe,width:et,height:it})}Ft(je);const ci=Et.shuffle({deck:J,random:Ht});function fi(e){return function(){const{innerWidth:t,innerHeight:i}=window,n=t/i,s=et/it;n<s?(e.style.width=`${t}px`,e.style.height=`${t/s}px`):(e.style.width=`${i*s}px`,e.style.height=`${i}px`)}}const ui=24,wi="0.0.31",Jt={hours:ui,version:wi};async function pi(){const{canvas:e,context:t}=re();e.width=et,e.height=it;const i=fi(e);i(),window.addEventListener("resize",i),ke();const n=`v${Jt.version}`,s=`${Jt.hours}h`,r=$t({text:`${n}
${s}`,font:`${_/4}px Courier`,color:"white",x:et-D/4*Math.max(n.length,s.length),y:_/4}),a=$t({font:`${_/4}px Arial`,color:"white",x:D/4,y:_/4});await ni();const o=await hi();if(o===null)return 1;o.sx=(D*8-et)/2,o.sy=(_*8-it)/2;const d=()=>{const{y:f}=Ce();if(f<_){let m=o.sy-_;m=N(0,o.mapheight-_-1,m),o.sy=m}else if(f>it-_-1){let m=o.sy+_;m=N(0,o.mapheight-_-1,m),o.sy=m}};o.onDown=()=>{d(),a.text=""},S(o);const c=di();c.onDown=()=>{a.text=""},S(c);const u=ai(),h=f=>{u.x=f.x,u.y=f.y,f.radius?(u.radius=f.radius,u.width=void 0,u.height=void 0):(u.width=f.width,u.height=f.height,u.radius=void 0)},l=oi(),y=o.layers.find(({name:f})=>f==="ground");if(y!==void 0){for(let f=0;f<o.height;++f)for(let m=0;m<o.width;++m)if(y.data[f*o.width+m]!==0){const E=ci.draw(),k=l[E.id-1];k.x=m*k.width,k.y=f*k.height,k.onDown=()=>{d();let b=E.name;if(k.flooded&&(b+=`
FLOODED!`),E.adventurer!==void 0)switch(E.adventurer){case nt:b+=`
(Diver)`;break;case st:b+=`
(Engineer)`;break;case rt:b+=`
(Explorer)`;break;case at:b+=`
(Messenger)`;break;case ot:b+=`
(Navigator)`;break;case ht:b+=`
(Pilot)`}if(E.treasure!==void 0)switch(E.treasure){case yt:b+=`
(The Crystal of Fire)`;break;case gt:b+=`
(The Earth Stone)`;break;case _t:b+=`
(The Ocean's Chalice)`;break;case mt:b+=`
(The Statue of the Wind)`}h(k),a.text=b},S(k),o.add(k)}}const{theCrystalOfFire:w,theEarthStone:g,theOceansChalice:p,theStatueOfTheWind:x}=li();g.x=l[0].width+(l[0].width-g.width)/2,g.y=l[0].height+(l[0].height-g.height)/2,g.onDown=()=>{h(g),a.text="The Earth Stone"},S(g),o.add(g),x.x=l[0].width+(l[0].width-x.width)/2,x.y=l[0].height*6+(l[0].height-x.height)/2,x.onDown=()=>{h(x),a.text="The Statue of the Wind"},S(x),o.add(x),w.x=l[0].width*6+(l[0].width-w.width)/2,w.y=l[0].height+(l[0].height-w.height)/2,w.onDown=()=>{h(w),a.text="The Crystal of Fire"},S(w),o.add(w),p.x=l[0].width*6+(l[0].width-p.width)/2,p.y=l[0].height*6+(l[0].height-p.height)/2,p.onDown=()=>{h(p),a.text="The Ocean's Chalice"},S(p),o.add(p);const q={...si},V=[];for(let f=0;f<6;++f){const m=q.draw(),E=l.find(({id:k})=>k===m.id);E.flooded=!0,E.playAnimation(`${E.id-1}-flooded`),V.push(m)}Et.shuffle({deck:[]}).putOnTopOfDeck(V);const B=[];for(let f=0;f<ti;++f)B.push({name:`Player ${f+1}`,adventurerCard:ei.draw(),cards:[]});const{diverPawn:P,engineerPawn:A,explorerPawn:I,messengerPawn:M,navigatorPawn:L,pilotPawn:R}=ri();for(const f of l){const m=J.find(({id:E})=>E===f.id);if(m!==void 0&&!(m.adventurer!==void 0&&!B.map(({adventurerCard:E})=>E.id).includes(m.adventurer)))switch(m.adventurer){case nt:P.x=f.x+(D-v*2)/2,P.y=f.y+(_-v*2)/2,P.onDown=()=>{h(P),a.text="Diver"},S(P),o.add(P);break;case st:A.x=f.x+(D-v*2)/2,A.y=f.y+(_-v*2)/2,A.onDown=()=>{h(A),a.text="Engineer"},S(A),o.add(A);break;case rt:I.x=f.x+(D-v*2)/2,I.y=f.y+(_-v*2)/2,I.onDown=()=>{h(I),a.text="Explorer"},S(I),o.add(I);break;case at:M.x=f.x+(D-v*2)/2,M.y=f.y+(_-v*2)/2,M.onDown=()=>{h(M),a.text="Messenger"},S(M),o.add(M);break;case ot:L.x=f.x+(D-v*2)/2,L.y=f.y+(_-v*2)/2,L.onDown=()=>{h(L),a.text="Navigator"},S(L),o.add(L);break;case ht:R.x=f.x+(D-v*2)/2,R.y=f.y+(_-v*2)/2,R.onDown=()=>{h(R),a.text="Pilot"},S(R),o.add(R);break}}return o.add(u),(()=>{a.text=B.map(({name:f,adventurerCard:m})=>`${f}: ${m.name}`).join(`
`)})(),Ae({render(){c.render(),o.render(),t.fillStyle="rgba(0, 0, 0, 0.67)",t.fillRect(r.x,r.y,r.width,r.height),r.render(),t.fillStyle="rgba(0, 0, 0, 0.67)",t.fillRect(a.x,a.y,a.width,a.height),a.render()},update(){}}).start(),0}pi();
