(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();/**
 * @preserve
 * Kontra.js v10.0.2
 */function ot(a,t){let e=Math.sin(t),i=Math.cos(t);return{x:a.x*i-a.y*e,y:a.x*e+a.y*i}}function M(a,t,e){return Math.min(Math.max(a,e),t)}function lt(a){let{x:t=0,y:e=0,width:i,height:s,radius:r}=a.world||a;return a.mapwidth&&(i=a.mapwidth,s=a.mapheight),r&&(i=r.x*2,s=r.y*2),a.anchor&&(t-=i*a.anchor.x,e-=s*a.anchor.y),i<0&&(t+=i,i*=-1),s<0&&(e+=s,s*=-1),{x:t,y:e,width:i,height:s}}let Y=()=>{};function V(a,t){let e=a.indexOf(t);if(e!=-1)return a.splice(e,1),!0}let R={};function D(a,t){R[a]=R[a]||[],R[a].push(t)}function b(a,...t){(R[a]||[]).map(e=>e(...t))}let y,T,J={get(a,t){return t=="_proxy"?!0:Y}};function O(){return y}function x(){return T}function dt(a,{contextless:t=!1}={}){if(y=document.getElementById(a)||a||document.querySelector("canvas"),t&&(y=y||new Proxy({},J)),!y)throw Error("You must provide a canvas element for the game");return T=y.getContext("2d")||new Proxy({},J),T.imageSmoothingEnabled=!1,b("init"),{canvas:y,context:T}}class H{constructor({spriteSheet:t,frames:e,frameRate:i,loop:s=!0,name:r}){let{width:n,height:h,spacing:o=0,margin:l=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:e,frameRate:i,loop:s,name:r,width:n,height:h,spacing:o,margin:l,isStopped:!1,_f:0,_a:0})}clone(){return new H(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped){if(!this.loop&&this._f==this.frames.length-1){this.stop();return}for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}}render({x:t,y:e,width:i=this.width,height:s=this.height,context:r=x()}){let n=this.frames[this._f]/this.spriteSheet._f|0,h=this.frames[this._f]%this.spriteSheet._f|0;r.drawImage(this.spriteSheet.image,this.margin+h*this.width+(h*2+1)*this.spacing,this.margin+n*this.height+(n*2+1)*this.spacing,this.width,this.height,t,e,i,s)}}function ct(){return new H(...arguments)}let ft=/(jpeg|jpg|gif|png|webp)$/,ut=/(wav|mp3|ogg|aac)$/,pt=/^\//,mt=/\/$/,tt=new WeakMap,wt="",gt="",_t="";function $(a,t){return new URL(a,t).href}function X(a,t){return[a.replace(mt,""),t].filter(e=>e).join("/")}function q(a){return a.split(".").pop()}function W(a){let t=a.replace("."+q(a),"");return t.split("/").length==2?t.replace(pt,""):t}function yt(a){return{wav:a.canPlayType('audio/wav; codecs="1"'),mp3:a.canPlayType("audio/mpeg;"),ogg:a.canPlayType('audio/ogg; codecs="vorbis"'),aac:a.canPlayType("audio/aac;")}}let _={},P={},E={};function N(){window.__k||(window.__k={dm:tt,u:$,d:E,i:_})}function xt(a){return N(),new Promise((t,e)=>{let i,s,r;if(i=X(wt,a),_[i])return t(_[i]);s=new Image,s.onload=function(){r=$(i,window.location.href),_[W(a)]=_[i]=_[r]=this,b("assetLoaded",this,a),t(this)},s.onerror=function(){e("Unable to load image "+i)},s.src=i})}function At(a){return new Promise((t,e)=>{let i=a,s,r,n,h;if(s=new Audio,r=yt(s),a=[].concat(a).reduce((o,l)=>o||(r[q(l)]?l:null),0),!a)return e("cannot play any of the audio formats provided "+i);if(n=X(gt,a),P[n])return t(P[n]);s.addEventListener("canplay",function(){h=$(n,window.location.href),P[W(a)]=P[n]=P[h]=this,b("assetLoaded",this,a),t(this)}),s.onerror=function(){e("Unable to load audio "+n)},s.src=n,s.load()})}function vt(a){N();let t,e;return t=X(_t,a),E[t]?Promise.resolve(E[t]):fetch(t).then(i=>{if(!i.ok)throw i;return i.clone().json().catch(()=>i.text())}).then(i=>(e=$(t,window.location.href),typeof i=="object"&&tt.set(i,e),E[W(a)]=E[t]=E[e]=i,b("assetLoaded",i,a),i))}function Et(...a){return N(),Promise.all(a.map(t=>{let e=q([].concat(t)[0]);return e.match(ft)?xt(t):e.match(ut)?At(t):vt(t)}))}class S{constructor(t=0,e=0,i={}){t.x!=null?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}set(t){this.x=t.x,this.y=t.y}add(t){return new S(this.x+t.x,this.y+t.y,this)}subtract(t){return new S(this.x-t.x,this.y-t.y,this)}scale(t){return new S(this.x*t,this.y*t)}normalize(t=this.length()||1){return new S(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,e,i,s){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?M(this._a,this._d,t):t}set y(t){this._y=this._c?M(this._b,this._e,t):t}}function F(){return new S(...arguments)}class St{constructor(t){return this.init(t)}init(t={}){this.position=F(),this.velocity=F(),this.acceleration=F(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}class Pt extends St{init({width:t=0,height:e=0,context:i=x(),render:s=this.draw,update:r=this.advance,children:n=[],anchor:h={x:0,y:0},opacity:o=1,rotation:l=0,drotation:c=0,ddrotation:d=0,scaleX:m=1,scaleY:u=1,...f}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:h,opacity:o,rotation:l,drotation:c,ddrotation:d,scaleX:m,scaleY:u,...f}),this._di=!0,this._uw(),this.addChild(n),this._rf=s,this._uf=r,D("init",()=>{this.context??(this.context=x())})}update(t){this._uf(t),this.children.map(e=>e.update&&e.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let e=this.width,i=this.height;this.radius&&(e=i=this.radius*2);let s=-e*this.anchor.x,r=-i*this.anchor.y;(s||r)&&t.translate(s,r),this.context.globalAlpha=this.opacity,this._rf(),(s||r)&&t.translate(-s,-r),this.children.map(h=>h.render&&h.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:i=1,_wrot:s=0,_wsx:r=1,_wsy:n=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this.radius&&(this._wrx=this.radius,this._wry=this.radius),this._wo=i*this.opacity,this._wsx=r*this.scaleX,this._wsy=n*this.scaleY,this._wx=this._wx*r,this._wy=this._wy*n,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this.radius&&(this._wrx=this.radius*this._wsx,this._wry=this.radius*this._wsy),this._wrot=s+this.rotation;let{x:h,y:o}=ot({x:this._wx,y:this._wy},s);this._wx=h,this._wy=o,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,radius:this.radius?{x:this._wrx,y:this._wry}:void 0,opacity:this._wo,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(e=>{this.children.push(e),e.parent=this,e._pc=e._pc||Y,e._pc()})}removeChild(...t){t.flat().map(e=>{V(this.children,e)&&(e.parent=null,e._pc())})}get radius(){return this._r}set radius(t){this._r=t,this._pc()}get opacity(){return this._opa}set opacity(t){this._opa=M(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}advance(t){super.advance(t),this.drotation+=this.ddrotation,this.rotation+=this.drotation}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class Lt extends Pt{init({image:t,width:e=t?t.width:void 0,height:i=t?t.height:void 0,...s}={}){super.init({image:t,width:e,height:i,...s})}get animations(){return this._a}set animations(t){let e,i;this._a={};for(e in t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){var e;(e=this.currentAnimation)==null||e.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){var e;super.advance(t),(e=this.currentAnimation)==null||e.update(t)}draw(){if(this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color){if(this.context.fillStyle=this.color,this.radius){this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.context.fill();return}this.context.fillRect(0,0,this.width,this.height)}}}function Ct(){return new Lt(...arguments)}function Mt(a){let t=a.canvas;a.clearRect(0,0,t.width,t.height)}function bt({fps:a=60,clearCanvas:t=!0,update:e=Y,render:i,context:s=x(),blur:r=!1}={}){if(!i)throw Error("You must provide a render() function");let n=0,h=1e3/a,o=1/a,l=t?Mt:Y,c,d,m,u,f,w=!0;r||(window.addEventListener("focus",()=>{w=!0}),window.addEventListener("blur",()=>{w=!1})),D("init",()=>{f.context??(f.context=x())});function p(){if(d=requestAnimationFrame(p),!!w&&(m=performance.now(),u=m-c,c=m,!(u>1e3))){for(n+=u;n>=h;)b("tick"),f.update(o),n-=h;l(f.context),f.render()}}return f={update:e,render:i,isStopped:!0,context:s,start(){this.isStopped&&(c=performance.now(),this.isStopped=!1,requestAnimationFrame(p))},stop(){this.isStopped=!0,cancelAnimationFrame(d)},_frame:p,set _last(g){c=g}},f}function It(a){if(+a==a)return a;let t=[],e=a.split(".."),i=+e[0],s=+e[1],r=i;if(i<s)for(;r<=s;r++)t.push(r);else for(;r>=s;r--)t.push(r);return t}class Ot{constructor({image:t,frameWidth:e,frameHeight:i,spacing:s=0,margin:r=0,animations:n}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:e,height:i,spacing:s,margin:r},this._f=(t.width-r)/e|0,this.createAnimations(n)}createAnimations(t){let e,i;for(i in t){let{frames:s,frameRate:r,loop:n}=t[i];if(e=[],s==null)throw Error("Animation "+i+" must provide a frames property");[].concat(s).map(h=>{e=e.concat(It(h))}),this.animations[i]=ct({spriteSheet:this,frames:e,frameRate:r,loop:n,name:i})}}}function Rt(){return new Ot(...arguments)}let Tt=2147483648,Yt=1073741824,Q=536870912;function L(a,t){return a/t|0}function C(a,t){return a/t|0}class $t{constructor(t={}){let{width:e,height:i,tilewidth:s,tileheight:r,tilesets:n}=t,h=e*s,o=i*r,l=document.createElement("canvas");l.width=h,l.height=o,this._c=l,this._ctx=l.getContext("2d"),n.map(c=>{let{__k:d,location:m}=window,u=(d?d.dm.get(t):"")||m.href,{source:f}=c;if(f){if(!d)throw Error('You must use "load" or "loadData" to resolve tileset.source');let p=d.d[d.u(f,u)];if(!p)throw Error(`You must load the tileset source "${f}" before loading the tileset`);Object.keys(p).map(g=>{c[g]=p[g]})}let{image:w}=c;if(""+w===w){if(!d)throw Error('You must use "load" or "loadImage" to resolve tileset.image');let p=d.i[d.u(w,u)];if(!p)throw Error(`You must load the image "${w}" before loading the tileset`);c.image=p}}),Object.assign(this,{context:x(),layerMap:{},layerCanvases:{},mapwidth:h,mapheight:o,_sx:0,_sy:0,_o:[],...t}),this.context&&this._p(),D("init",()=>{this.context??(this.context=x()),this._p()})}get sx(){return this._sx}get sy(){return this._sy}set sx(t){let e=Math.max(0,this.mapwidth-O().width);this._sx=M(0,e,t)}set sy(t){let e=Math.max(0,this.mapheight-O().height);this._sy=M(0,e,t)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map(e=>{this._o.push(e),e.parent=this})}remove(...t){t.flat().map(e=>{V(this._o,e),e.parent=null})}getPosition(t){let e=O().getBoundingClientRect(),i=t.x-e.x,s=t.y-e.y;return i+=this.sx,s+=this.sy,{x:i,y:s,row:L(s,this.tileheight),col:C(i,this.tilewidth)}}setTileAtLayer(t,e,i){let{layerMap:s,tileheight:r,tilewidth:n,width:h}=this,{row:o,col:l,x:c,y:d}=e,m=o??L(d,r),u=l??C(c,n);s[t]&&(this._d=!0,s[t]._d=!0,s[t].data[m*h+u]=i)}setLayer(t,e){let{layerMap:i}=this;i[t]&&(this._d=!0,i[t]._d=!0,i[t].data=e)}layerCollidesWith(t,e){let{tilewidth:i,tileheight:s,layerMap:r}=this,{x:n,y:h,width:o,height:l}=lt(e),c=L(h,s),d=C(n,i),m=L(h+l,s),u=C(n+o,i),f=r[t];for(let w=c;w<=m;w++)for(let p=d;p<=u;p++)if(f.data[p+w*this.width])return!0;return!1}tileAtLayer(t,e){let{layerMap:i,tileheight:s,tilewidth:r,width:n}=this,{row:h,col:o,x:l,y:c}=e,d=h??L(c,s),m=o??C(l,r);return i[t]?i[t].data[d*n+m]:-1}render(t=this._c,e=!0){let{_d:i,context:s,sx:r=0,sy:n=0}=this;i&&this._p();let{width:h,height:o}=O(),l=Math.min(t.width,h),c=Math.min(t.height,o);s.drawImage(t,r,n,l,c,0,0,l,c),e&&(s.save(),(r||n)&&s.translate(-r,-n),this.objects.map(d=>d.render&&d.render()),s.restore())}renderLayer(t){let{layerCanvases:e,layerMap:i}=this,s=i[t],r=e[t],n=r==null?void 0:r.getContext("2d");if(!r){let{mapwidth:h,mapheight:o}=this;r=document.createElement("canvas"),n=r.getContext("2d"),r.width=h,r.height=o,e[t]=r,this._rl(s,n)}s._d&&(s._d=!1,n.clearRect(0,0,r.width,r.height),this._rl(s,n)),this.render(r,!1)}_p(){let{_ctx:t,layers:e=[],layerMap:i}=this;this._d=!1,e.map(s=>{let{name:r,data:n,visible:h}=s;s._d=!1,i[r]=s,n&&h!=!1&&this._rl(s,t)})}_rl(t,e){let{opacity:i,data:s=[]}=t,{tilesets:r,width:n,tilewidth:h,tileheight:o}=this;e.save(),e.globalAlpha=i,s.map((l,c)=>{if(!l)return;let d=0,m=0,u=l&Tt,f=l&Yt,w=0,p=0,g=0,I=0,B=0;d=u||f,l&=1073741823,B=l&Q,B&&(u&&f?g=1:u?w=1:f?p=1:I=1,m=w||p||g||I,l&=~Q);let G;for(let k=r.length-1;k>=0&&(G=r[k],!(l/G.firstgid>=1));k--);let{image:j,spacing:U=0,margin:z=0,firstgid:at,columns:rt}=G,K=l-at,Z=rt??j.width/(h+U)|0,A=c%n*h,v=(c/n|0)*o,nt=z+K%Z*(h+U),ht=z+(K/Z|0)*(o+U);m?(e.save(),e.translate(A+h/2,v+o/2),p||I?e.rotate(-Math.PI/2):(w||g)&&e.rotate(Math.PI/2),(g||I)&&e.scale(-1,1),A=-h/2,v=-o/2):d&&(e.save(),e.translate(A+(u?h:0),v+(f?o:0)),e.scale(u?-1:1,f?-1:1),A=d?0:A,v=d?0:v),e.drawImage(j,nt,ht,h,o,A,v,h,o),(d||m)&&e.restore()}),e.restore()}}function Gt(){return new $t(...arguments)}const et="assets/",it=`${et}assets/spritesheet.png`,st=`${et}assets/tilesheet.png`,Ut=[it,st],kt=a=>Et(...Ut),Ft=[{name:"Fools' Landing",flooded:!1},{name:"Cave of Shadows",flooded:!1},{name:"Temple of the Moon",flooded:!1},{name:"Copper Gate",flooded:!1},{name:"Whispering Garden",flooded:!1},{name:"Dunes of Deception",flooded:!1},{name:"Silver Gate",flooded:!1},{name:"Observatory",flooded:!1},{name:"Breakers Bridge",flooded:!1},{name:"Twilight Hollow",flooded:!1},{name:"Lost Lagoon",flooded:!1},{name:"Bronze Gate",flooded:!1},{name:"Phantom Rock",flooded:!1},{name:"Watchtower",flooded:!1},{name:"Cliffs of Abandon",flooded:!1},{name:"Misty Marsh",flooded:!1},{name:"Coral Palace",flooded:!1},{name:"Howling Garden",flooded:!1},{name:"Iron Gate",flooded:!1},{name:"Gold Gate",flooded:!1},{name:"Crimson Forest",flooded:!1},{name:"Temple of the Sun",flooded:!1},{name:"Cave of Embers",flooded:!1},{name:"Tidal Palace",flooded:!1}];function Dt(){const a=Rt({image:_[it],frameWidth:32,frameHeight:32,animations:Ft.map((e,i)=>({[i]:{frames:i,frameRate:1}})).reduce((e,i)=>({...e,...i}))}),t=[];for(let e=0;e<Object.keys(a.animations).length;++e){const i=Ct({x:e*32,y:0,animations:a.animations});i.playAnimation(e),t.push(i)}return t}async function Ht(){try{const a=_[st];return Gt({tilewidth:32,tileheight:32,width:8,height:8,tilesets:[{firstgid:0,image:a}],layers:[{name:"ground",data:[0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,0,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0]}]})}catch(a){return console.error(a),null}}const Xt="aqua";async function qt(){const{canvas:a,context:t}=dt();await kt();const e=await Ht();if(e===null)return 1;const i=Dt();for(const r of i)e.add(r);return bt({render(){t.fillStyle=Xt,t.fillRect(0,0,a.width,a.height),e.render()},update(){}}).start(),0}qt();
