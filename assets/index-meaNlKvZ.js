(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();/**
 * @preserve
 * Kontra.js v10.0.2
 */function tn(t,e){let n=Math.sin(e),i=Math.cos(e);return{x:t.x*i-t.y*n,y:t.x*n+t.y*i}}function pt(t,e,n){return Math.min(Math.max(t,n),e)}function $e(t){let{x:e=0,y:n=0,width:i,height:r,radius:s}=t.world||t;return t.mapwidth&&(i=t.mapwidth,r=t.mapheight),s&&(i=s.x*2,r=s.y*2),t.anchor&&(e-=i*t.anchor.x,n-=r*t.anchor.y),i<0&&(e+=i,i*=-1),r<0&&(n+=r,r*=-1),{x:e,y:n,width:i,height:r}}let Mt=()=>{},en="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);",nn={preventScroll:!0};function rn(t,e){let n=e.parentNode;t.setAttribute("data-kontra",""),n?([...n.querySelectorAll(":scope > [data-kontra]")].pop()||e).after(t):e.nodeName=="CANVAS"?document.body.append(t):e.append(t)}function He(t,e){let n=t.indexOf(e);if(n!=-1)return t.splice(n,1),!0}function sn(t,e){let{x:n,y:i,width:r,height:s}=$e(e);do n-=e.sx||0,i-=e.sy||0;while(e=e.parent);let o=t.x-Math.max(n,Math.min(t.x,n+r)),a=t.y-Math.max(i,Math.min(t.y,i+s));return o*o+a*a<t.radius*t.radius}let zt={};function Nt(t,e){zt[t]=zt[t]||[],zt[t].push(e)}function gt(t,...e){(zt[t]||[]).map(n=>n(...e))}let dt,Ut,ke={get(t,e){return e=="_proxy"?!0:Mt}};function ut(){return dt}function nt(){return Ut}function on(t,{contextless:e=!1}={}){if(dt=document.getElementById(t)||t||document.querySelector("canvas"),e&&(dt=dt||new Proxy({},ke)),!dt)throw Error("You must provide a canvas element for the game");return Ut=dt.getContext("2d")||new Proxy({},ke),Ut.imageSmoothingEnabled=!1,gt("init"),{canvas:dt,context:Ut}}class ge{constructor({spriteSheet:e,frames:n,frameRate:i,loop:r=!0,name:s}){let{width:o,height:a,spacing:l=0,margin:h=0}=e.frame;Object.assign(this,{spriteSheet:e,frames:n,frameRate:i,loop:r,name:s,width:o,height:a,spacing:l,margin:h,isStopped:!1,_f:0,_a:0})}clone(){return new ge(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(e=1/60){if(!this.isStopped){if(!this.loop&&this._f==this.frames.length-1){this.stop();return}for(this._a+=e;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}}render({x:e,y:n,width:i=this.width,height:r=this.height,context:s=nt()}){let o=this.frames[this._f]/this.spriteSheet._f|0,a=this.frames[this._f]%this.spriteSheet._f|0;s.drawImage(this.spriteSheet.image,this.margin+a*this.width+(a*2+1)*this.spacing,this.margin+o*this.height+(o*2+1)*this.spacing,this.width,this.height,e,n,i,r)}}function an(){return new ge(...arguments)}let ln=/(jpeg|jpg|gif|png|webp)$/,hn=/(wav|mp3|ogg|aac)$/,cn=/^\//,dn=/\/$/,Ge=new WeakMap,un="",fn="",pn="";function Qt(t,e){return new URL(t,e).href}function we(t,e){return[t.replace(dn,""),e].filter(n=>n).join("/")}function me(t){return t.split(".").pop()}function ye(t){let e=t.replace("."+me(t),"");return e.split("/").length==2?e.replace(cn,""):e}function gn(t){return{wav:t.canPlayType('audio/wav; codecs="1"'),mp3:t.canPlayType("audio/mpeg;"),ogg:t.canPlayType('audio/ogg; codecs="vorbis"'),aac:t.canPlayType("audio/aac;")}}let st={},Ct={},yt={};function _e(){window.__k||(window.__k={dm:Ge,u:Qt,d:yt,i:st})}function wn(t){return _e(),new Promise((e,n)=>{let i,r,s;if(i=we(un,t),st[i])return e(st[i]);r=new Image,r.onload=function(){s=Qt(i,window.location.href),st[ye(t)]=st[i]=st[s]=this,gt("assetLoaded",this,t),e(this)},r.onerror=function(){n("Unable to load image "+i)},r.src=i})}function mn(t){return new Promise((e,n)=>{let i=t,r,s,o,a;if(r=new Audio,s=gn(r),t=[].concat(t).reduce((l,h)=>l||(s[me(h)]?h:null),0),!t)return n("cannot play any of the audio formats provided "+i);if(o=we(fn,t),Ct[o])return e(Ct[o]);r.addEventListener("canplay",function(){a=Qt(o,window.location.href),Ct[ye(t)]=Ct[o]=Ct[a]=this,gt("assetLoaded",this,t),e(this)}),r.onerror=function(){n("Unable to load audio "+o)},r.src=o,r.load()})}function yn(t){_e();let e,n;return e=we(pn,t),yt[e]?Promise.resolve(yt[e]):fetch(e).then(i=>{if(!i.ok)throw i;return i.clone().json().catch(()=>i.text())}).then(i=>(n=Qt(e,window.location.href),typeof i=="object"&&Ge.set(i,n),yt[ye(t)]=yt[e]=yt[n]=i,gt("assetLoaded",i,t),i))}function _n(...t){return _e(),Promise.all(t.map(e=>{let n=me([].concat(e)[0]);return n.match(ln)?wn(e):n.match(hn)?mn(e):yn(e)}))}class bt{constructor(e=0,n=0,i={}){e.x!=null?(this.x=e.x,this.y=e.y):(this.x=e,this.y=n),i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=e,this.y=n)}set(e){this.x=e.x,this.y=e.y}add(e){return new bt(this.x+e.x,this.y+e.y,this)}subtract(e){return new bt(this.x-e.x,this.y-e.y,this)}scale(e){return new bt(this.x*e,this.y*e)}normalize(e=this.length()||1){return new bt(this.x/e,this.y/e)}dot(e){return this.x*e.x+this.y*e.y}length(){return Math.hypot(this.x,this.y)}distance(e){return Math.hypot(this.x-e.x,this.y-e.y)}angle(e){return Math.acos(this.dot(e)/(this.length()*e.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(e,n,i,r){this._c=!0,this._a=e,this._b=n,this._d=i,this._e=r}get x(){return this._x}get y(){return this._y}set x(e){this._x=this._c?pt(this._a,this._d,e):e}set y(e){this._y=this._c?pt(this._b,this._e,e):e}}function re(){return new bt(...arguments)}class bn{constructor(e){return this.init(e)}init(e={}){this.position=re(),this.velocity=re(),this.acceleration=re(),this.ttl=1/0,Object.assign(this,e)}update(e){this.advance(e)}advance(e){let n=this.acceleration;e&&(n=n.scale(e)),this.velocity=this.velocity.add(n);let i=this.velocity;e&&(i=i.scale(e)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(e){this.velocity.x=e}set dy(e){this.velocity.y=e}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(e){this.acceleration.x=e}set ddy(e){this.acceleration.y=e}isAlive(){return this.ttl>0}_pc(){}}class be extends bn{init({width:e=0,height:n=0,context:i=nt(),render:r=this.draw,update:s=this.advance,children:o=[],anchor:a={x:0,y:0},opacity:l=1,rotation:h=0,drotation:c=0,ddrotation:d=0,scaleX:f=1,scaleY:_=1,...u}={}){this._c=[],super.init({width:e,height:n,context:i,anchor:a,opacity:l,rotation:h,drotation:c,ddrotation:d,scaleX:f,scaleY:_,...u}),this._di=!0,this._uw(),this.addChild(o),this._rf=r,this._uf=s,Nt("init",()=>{this.context??=nt()})}update(e){this._uf(e),this.children.map(n=>n.update&&n.update(e))}render(){let e=this.context;e.save(),(this.x||this.y)&&e.translate(this.x,this.y),this.rotation&&e.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&e.scale(this.scaleX,this.scaleY);let n=this.width,i=this.height;this.radius&&(n=i=this.radius*2);let r=-n*this.anchor.x,s=-i*this.anchor.y;(r||s)&&e.translate(r,s),this.context.globalAlpha=this.opacity,this._rf(),(r||s)&&e.translate(-r,-s),this.children.map(a=>a.render&&a.render()),e.restore()}draw(){}_pc(){this._uw(),this.children.map(e=>e._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(e){this.position.x=e,this._pc()}set y(e){this.position.y=e,this._pc()}get width(){return this._w}set width(e){this._w=e,this._pc()}get height(){return this._h}set height(e){this._h=e,this._pc()}_uw(){if(!this._di)return;let{_wx:e=0,_wy:n=0,_wo:i=1,_wrot:r=0,_wsx:s=1,_wsy:o=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this.radius&&(this._wrx=this.radius,this._wry=this.radius),this._wo=i*this.opacity,this._wsx=s*this.scaleX,this._wsy=o*this.scaleY,this._wx=this._wx*s,this._wy=this._wy*o,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this.radius&&(this._wrx=this.radius*this._wsx,this._wry=this.radius*this._wsy),this._wrot=r+this.rotation;let{x:a,y:l}=tn({x:this._wx,y:this._wy},r);this._wx=a,this._wy=l,this._wx+=e,this._wy+=n}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,radius:this.radius?{x:this._wrx,y:this._wry}:void 0,opacity:this._wo,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}set children(e){this.removeChild(this._c),this.addChild(e)}get children(){return this._c}addChild(...e){e.flat().map(n=>{this.children.push(n),n.parent=this,n._pc=n._pc||Mt,n._pc()})}removeChild(...e){e.flat().map(n=>{He(this.children,n)&&(n.parent=null,n._pc())})}get radius(){return this._r}set radius(e){this._r=e,this._pc()}get opacity(){return this._opa}set opacity(e){this._opa=pt(0,1,e),this._pc()}get rotation(){return this._rot}set rotation(e){this._rot=e,this._pc()}advance(e){super.advance(e),this.drotation+=this.ddrotation,this.rotation+=this.drotation}setScale(e,n=e){this.scaleX=e,this.scaleY=n}get scaleX(){return this._scx}set scaleX(e){this._scx=e,this._pc()}get scaleY(){return this._scy}set scaleY(e){this._scy=e,this._pc()}}class Be extends be{init({image:e,width:n=e?e.width:void 0,height:i=e?e.height:void 0,...r}={}){super.init({image:e,width:n,height:i,...r})}get animations(){return this._a}set animations(e){let n,i;this._a={};for(n in e)this._a[n]=e[n].clone(),i=i||this._a[n];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(e){this.currentAnimation?.stop(),this.currentAnimation=this.animations[e],this.currentAnimation.start()}advance(e){super.advance(e),this.currentAnimation?.update(e)}draw(){if(this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color){if(this.context.fillStyle=this.color,this.radius){this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.context.fill();return}this.context.fillRect(0,0,this.width,this.height)}}}function j(){return new Be(...arguments)}let xn=/(\d+)(\w+)/;function vn(t){if(!t)return{computed:0};let e=t.match(xn),n=+e[1],i=e[2];return{size:n,unit:i,computed:n}}class kn extends be{init({text:e="",textAlign:n="",lineHeight:i=1,font:r=nt()?.font,...s}={}){e=""+e,super.init({text:e,textAlign:n,lineHeight:i,font:r,...s}),this.context&&this._p(),Nt("init",()=>{this.font??=nt().font,this._p()})}get width(){return this._w}set width(e){this._d=!0,this._w=e,this._fw=e}get text(){return this._t}set text(e){this._d=!0,this._t=""+e}get font(){return this._f}set font(e){this._d=!0,this._f=e,this._fs=vn(e).computed}get lineHeight(){return this._lh}set lineHeight(e){this._d=!0,this._lh=e}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let e=this.context,n=[this.text];if(e.font=this.font,n=this.text.split(`
`),this._fw&&n.map(i=>{let r=i.split(" "),s=r.shift(),o=s;r.map(a=>{o+=" "+a,e.measureText(o).width>this._fw&&(this._s.push(s),o=a),s=o}),this._s.push(o)}),!this._s.length&&this.text.includes(`
`)){let i=0;n.map(r=>{this._s.push(r),i=Math.max(i,e.measureText(r).width)}),this._w=this._fw||i}this._s.length||(this._s.push(this.text),this._w=this._fw||e.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let e=0,n=this.textAlign,i=this.context;n=this.textAlign||(i.canvas.dir=="rtl"?"right":"left"),e=n=="right"?this.width:n=="center"?this.width/2|0:0,this._s.map((r,s)=>{i.textBaseline="top",i.textAlign=n,i.fillStyle=this.color,i.font=this.font,this.strokeColor&&(i.strokeStyle=this.strokeColor,i.lineWidth=this.lineWidth??1,i.strokeText(r,e,this._fs*this.lineHeight*s)),i.fillText(r,e,this._fs*this.lineHeight*s)})}}function ce(){return new kn(...arguments)}let Et=new WeakMap,Me={},xe={},We={0:"left",1:"middle",2:"right"};function Mn(t=ut()){return Et.get(t)}function En(t){let e=t._lf.length?t._lf:t._cf;for(let n=e.length-1;n>=0;n--){let i=e[n];if(i.collidesWithPointer?i.collidesWithPointer(t):sn(t,i))return i}}function K(t,e){return parseFloat(t.getPropertyValue(e))||0}function Tn(t){let{canvas:e,_s:n}=t,i=e.getBoundingClientRect(),r=n.transform!="none"?n.transform.replace("matrix(","").split(","):[1,1,1,1],s=parseFloat(r[0]),o=parseFloat(r[3]),a=(K(n,"border-left-width")+K(n,"border-right-width"))*s,l=(K(n,"border-top-width")+K(n,"border-bottom-width"))*o,h=(K(n,"padding-left")+K(n,"padding-right"))*s,c=(K(n,"padding-top")+K(n,"padding-bottom"))*o;return{scaleX:(i.width-a-h)/e.width,scaleY:(i.height-l-c)/e.height,offsetX:i.left+(K(n,"border-left-width")+K(n,"padding-left"))*s,offsetY:i.top+(K(n,"border-top-width")+K(n,"padding-top"))*o}}function Ee(t){let e=t.button!=null?We[t.button]:"left";xe[e]=!0,ve(t,"onDown")}function se(t){let e=t.button!=null?We[t.button]:"left";xe[e]=!1,ve(t,"onUp")}function Te(t){ve(t,"onOver")}function Sn(t){let e=Et.get(t.target);e._oo=null,xe={}}function Se(t,e,n){let i=En(t);i&&i[e]&&i[e](n),Me[e]&&Me[e](n,i),e=="onOver"&&(i!=t._oo&&t._oo&&t._oo.onOut&&t._oo.onOut(n),t._oo=i)}function ve(t,e){t.preventDefault();let n=t.target,i=Et.get(n),{scaleX:r,scaleY:s,offsetX:o,offsetY:a}=Tn(i);t.type.includes("touch")?(Array.from(t.touches).map(({clientX:h,clientY:c,identifier:d})=>{let f=i.touches[d];f||(f=i.touches[d]={start:{x:(h-o)/r,y:(c-a)/s}},i.touches.length++),f.changed=!1}),Array.from(t.changedTouches).map(({clientX:h,clientY:c,identifier:d})=>{let f=i.touches[d];f.changed=!0,f.x=i.x=(h-o)/r,f.y=i.y=(c-a)/s,Se(i,e,t),gt("touchChanged",t,i.touches),e=="onUp"&&(delete i.touches[d],i.touches.length--,i.touches.length||gt("touchEnd"))})):(i.x=(t.clientX-o)/r,i.y=(t.clientY-a)/s,Se(i,e,t))}function Cn({radius:t=5,canvas:e=ut()}={}){let n=Et.get(e);if(!n){let i=window.getComputedStyle(e);n={x:0,y:0,radius:t,touches:{length:0},canvas:e,_cf:[],_lf:[],_o:[],_oo:null,_s:i},Et.set(e,n)}return e.addEventListener("mousedown",Ee),e.addEventListener("touchstart",Ee),e.addEventListener("mouseup",se),e.addEventListener("touchend",se),e.addEventListener("touchcancel",se),e.addEventListener("blur",Sn),e.addEventListener("mousemove",Te),e.addEventListener("touchmove",Te),n._t||(n._t=!0,Nt("tick",()=>{n._lf.length=0,n._cf.map(i=>{n._lf.push(i)}),n._cf.length=0})),n}function B(...t){t.flat().map(e=>{let n=e.context?e.context.canvas:ut(),i=Et.get(n);if(!i)throw new ReferenceError("Pointer events not initialized for the objects canvas");e.__r||(e.__r=e.render,e.render=function(){i._cf.push(this),this.__r()},i._o.push(e))})}class Dn extends Be{init({padX:e=0,padY:n=0,text:i,disabled:r=!1,container:s,onDown:o,onUp:a,...l}={}){super.init({padX:e,padY:n,...l}),this.textNode=ce({...i,context:this.context}),this.width||(this.width=this.textNode.width,this.height=this.textNode.height),B(this),this.addChild(this.textNode),this._od=o||Mt,this._ou=a||Mt;let h=this._dn=document.createElement("button");h.style=en,h.textContent=this.text,r&&this.disable(),h.addEventListener("focus",()=>this.focus()),h.addEventListener("blur",()=>this.blur()),h.addEventListener("keydown",c=>this._kd(c)),h.addEventListener("keyup",c=>this._ku(c)),rn(h,s??this.context.canvas),this._uw(),this._p()}get text(){return this.textNode.text}set text(e){this._d=!0,this.textNode.text=e}get node(){return this._dn}destroy(){this._dn.remove()}_p(){this.text!=this._dn.textContent&&(this._dn.textContent=this.text),this.textNode._p();let e=this.textNode.width+this.padX*2,n=this.textNode.height+this.padY*2;this.width=Math.max(e,this.width),this.height=Math.max(n,this.height),this._uw()}render(){this._d&&this._p(),super.render()}enable(){this.disabled=this._dn.disabled=!1,this.onEnable()}disable(){this.disabled=this._dn.disabled=!0,this.onDisable()}focus(){this.disabled||(this.focused=!0,document.activeElement!=this._dn&&this._dn.focus(nn),this.onFocus())}blur(){this.focused=!1,document.activeElement==this._dn&&this._dn.blur(),this.onBlur()}onOver(){this.disabled||(this.hovered=!0)}onOut(){this.hovered=!1}onEnable(){}onDisable(){}onFocus(){}onBlur(){}onDown(){this.disabled||(this.pressed=!0,this._od())}onUp(){this.disabled||(this.pressed=!1,this._ou())}_kd(e){(e.code=="Enter"||e.code=="Space")&&this.onDown()}_ku(e){(e.code=="Enter"||e.code=="Space")&&this.onUp()}}function Ht(){return new Dn(...arguments)}function An(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}function Fn({fps:t=60,clearCanvas:e=!0,update:n=Mt,render:i,context:r=nt(),blur:s=!1}={}){if(!i)throw Error("You must provide a render() function");let o=0,a=1e3/t,l=1/t,h=e?An:Mt,c,d,f,_,u,b=!0;s||(window.addEventListener("focus",()=>{b=!0}),window.addEventListener("blur",()=>{b=!1})),Nt("init",()=>{u.context??=nt()});function g(){if(d=requestAnimationFrame(g),!!b&&(f=performance.now(),_=f-c,c=f,!(_>1e3))){for(o+=_;o>=a;)gt("tick"),u.update(l),o-=a;h(u.context),u.render()}}return u={update:n,render:i,isStopped:!0,context:r,start(){this.isStopped&&(c=performance.now(),this.isStopped=!1,requestAnimationFrame(g))},stop(){this.isStopped=!0,cancelAnimationFrame(d)},_frame:g,set _last(w){c=w}},u}let Ln={set(t,e,n){return e.startsWith("_")||(t._d=!0),Reflect.set(t,e,n)}},Ce={start(t){return t?1:0},center(){return .5},end(t){return t?0:1}};class On extends be{init({flow:e="column",align:n="start",justify:i="start",colGap:r=0,rowGap:s=0,numCols:o=1,dir:a="",breakpoints:l=[],...h}={}){return super.init({flow:e,align:n,justify:i,colGap:r,rowGap:s,numCols:o,dir:a,breakpoints:l,...h}),this._p(),new Proxy(this,Ln)}addChild(e){this._d=!0,super.addChild(e)}removeChild(e){this._d=!0,super.removeChild(e)}render(){this._d&&this._p(),super.render()}destroy(){this.children.map(e=>e.destroy&&e.destroy())}_p(){this._d=!1,this.breakpoints.map(w=>{w.metric.call(this)&&this._b!==w&&(this._b=w,w.callback.call(this))});let e=this._g=[],n=this._cw=[],i=this._rh=[],r=this.children,s=this._nc=this.flow=="column"?1:this.flow=="row"?r.length:this.numCols,o=0,a=0;for(let w=0,y;y=r[w];w++){e[o]=e[o]||[],y._p&&y._p();let{width:F,height:k}=y.world||y;i[o]=Math.max(i[o]||0,k);let L=y.colSpan||1,R=L;do n[a]=Math.max(n[a]||0,F/R),e[o][a]=y;while(a++<=s&&--L);a>=s&&(a=0,o++)}for(;a>0&&a<s;)e[o][a++]=!1;let l=e.length,h=[].concat(this.colGap),c=[].concat(this.rowGap);this._w=n.reduce((w,y)=>w+=y,0);for(let w=0;w<s-1;w++)this._w+=h[w%h.length];this._h=i.reduce((w,y)=>w+=y,0);for(let w=0;w<l-1;w++)this._h+=c[w%c.length];this._uw();let f=this.context.canvas.dir=="rtl"&&!this.dir||this.dir=="rtl";this._rtl=f,f&&(this._g=e.map(w=>w.reverse()),this._cw=n.reverse(),h=h.reverse());let _=-this.anchor.y*this.height,u=[],b=[].concat(this.justify),g=[].concat(this.align);this._g.map((w,y)=>{let F=-this.anchor.x*this.width;w.map((k,L)=>{if(k&&!u.includes(k)){u.push(k);let R=Ce[k.justifySelf||b[L%b.length]](this._rtl),I=Ce[k.alignSelf||g[y%g.length]](),z=k.colSpan||1,W=n[L];if(z>1&&L+z<=this._nc)for(let C=1;C<z;C++)W+=n[L+C]+h[(L+C)%h.length];let A=W*R,T=i[y]*I,M=0,S=0,{width:q,height:Y}=k.world||k;if(k.anchor&&(M=k.anchor.x,S=k.anchor.y),R==0)A=A+q*M;else if(R==.5){let C=M<.5?-1:M==.5?0:1;A=A+C*q*R}else A=A-q*(1-M);if(I==0)T=T+Y*S;else if(I==.5){let C=S<.5?-1:S==.5?0:1;T=T+C*Y*I}else T=T-Y*(1-S);k.x=F+A,k.y=_+T}F+=n[L]+h[L%h.length]}),_+=i[y]+c[y%c.length]})}}function Pn(){return new On(...arguments)}let rt;function te(){rt??=Date.now(),rt|=0,rt=rt+2654435769|0;let t=rt^rt>>>16;return t=Math.imul(t,569420461),t=t^t>>>15,t=Math.imul(t,1935289751),((t=t^t>>>15)>>>0)/4294967296}function ee(t=Date.now()){if(rt=t,typeof t=="string"){for(var e=0,n=1779033703^t.length;e<t.length;e++)n=Math.imul(n^t.charCodeAt(e),3432918353),n=n<<13|n>>>19;n=Math.imul(n^n>>>16,2246822507),n=Math.imul(n^n>>>13,3266489909),rt=(n^=n>>>16)>>>0}}function Rn(t){if(+t==t)return t;let e=[],n=t.split(".."),i=+n[0],r=+n[1],s=i;if(i<r)for(;s<=r;s++)e.push(s);else for(;s>=r;s--)e.push(s);return e}class In{constructor({image:e,frameWidth:n,frameHeight:i,spacing:r=0,margin:s=0,animations:o}={}){if(!e)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=e,this.frame={width:n,height:i,spacing:r,margin:s},this._f=(e.width-s)/n|0,this.createAnimations(o)}createAnimations(e){let n,i;for(i in e){let{frames:r,frameRate:s,loop:o}=e[i];if(n=[],r==null)throw Error("Animation "+i+" must provide a frames property");[].concat(r).map(a=>{n=n.concat(Rn(a))}),this.animations[i]=an({spriteSheet:this,frames:n,frameRate:s,loop:o,name:i})}}}function Nn(){return new In(...arguments)}let $n=2147483648,Hn=1073741824,De=536870912;function Dt(t,e){return t/e|0}function At(t,e){return t/e|0}class Gn{constructor(e={}){let{width:n,height:i,tilewidth:r,tileheight:s,tilesets:o}=e,a=n*r,l=i*s,h=document.createElement("canvas");h.width=a,h.height=l,this._c=h,this._ctx=h.getContext("2d"),o.map(c=>{let{__k:d,location:f}=window,_=(d?d.dm.get(e):"")||f.href,{source:u}=c;if(u){if(!d)throw Error('You must use "load" or "loadData" to resolve tileset.source');let g=d.d[d.u(u,_)];if(!g)throw Error(`You must load the tileset source "${u}" before loading the tileset`);Object.keys(g).map(w=>{c[w]=g[w]})}let{image:b}=c;if(""+b===b){if(!d)throw Error('You must use "load" or "loadImage" to resolve tileset.image');let g=d.i[d.u(b,_)];if(!g)throw Error(`You must load the image "${b}" before loading the tileset`);c.image=g}}),Object.assign(this,{context:nt(),layerMap:{},layerCanvases:{},mapwidth:a,mapheight:l,_sx:0,_sy:0,_o:[],...e}),this.context&&this._p(),Nt("init",()=>{this.context??=nt(),this._p()})}get sx(){return this._sx}get sy(){return this._sy}set sx(e){let n=Math.max(0,this.mapwidth-ut().width);this._sx=pt(0,n,e)}set sy(e){let n=Math.max(0,this.mapheight-ut().height);this._sy=pt(0,n,e)}set objects(e){this.remove(this._o),this.add(e)}get objects(){return this._o}add(...e){e.flat().map(n=>{this._o.push(n),n.parent=this})}remove(...e){e.flat().map(n=>{He(this._o,n),n.parent=null})}getPosition(e){let n=ut().getBoundingClientRect(),i=e.x-n.x,r=e.y-n.y;return i+=this.sx,r+=this.sy,{x:i,y:r,row:Dt(r,this.tileheight),col:At(i,this.tilewidth)}}setTileAtLayer(e,n,i){let{layerMap:r,tileheight:s,tilewidth:o,width:a}=this,{row:l,col:h,x:c,y:d}=n,f=l??Dt(d,s),_=h??At(c,o);r[e]&&(this._d=!0,r[e]._d=!0,r[e].data[f*a+_]=i)}setLayer(e,n){let{layerMap:i}=this;i[e]&&(this._d=!0,i[e]._d=!0,i[e].data=n)}layerCollidesWith(e,n){let{tilewidth:i,tileheight:r,layerMap:s}=this,{x:o,y:a,width:l,height:h}=$e(n),c=Dt(a,r),d=At(o,i),f=Dt(a+h,r),_=At(o+l,i),u=s[e];for(let b=c;b<=f;b++)for(let g=d;g<=_;g++)if(u.data[g+b*this.width])return!0;return!1}tileAtLayer(e,n){let{layerMap:i,tileheight:r,tilewidth:s,width:o}=this,{row:a,col:l,x:h,y:c}=n,d=a??Dt(c,r),f=l??At(h,s);return i[e]?i[e].data[d*o+f]:-1}render(e=this._c,n=!0){let{_d:i,context:r,sx:s=0,sy:o=0}=this;i&&this._p();let{width:a,height:l}=ut(),h=Math.min(e.width,a),c=Math.min(e.height,l);r.drawImage(e,s,o,h,c,0,0,h,c),n&&(r.save(),(s||o)&&r.translate(-s,-o),this.objects.map(d=>d.render&&d.render()),r.restore())}renderLayer(e){let{layerCanvases:n,layerMap:i}=this,r=i[e],s=n[e],o=s?.getContext("2d");if(!s){let{mapwidth:a,mapheight:l}=this;s=document.createElement("canvas"),o=s.getContext("2d"),s.width=a,s.height=l,n[e]=s,this._rl(r,o)}r._d&&(r._d=!1,o.clearRect(0,0,s.width,s.height),this._rl(r,o)),this.render(s,!1)}_p(){let{_ctx:e,layers:n=[],layerMap:i}=this;this._d=!1,n.map(r=>{let{name:s,data:o,visible:a}=r;r._d=!1,i[s]=r,o&&a!=!1&&this._rl(r,e)})}_rl(e,n){let{opacity:i,data:r=[]}=e,{tilesets:s,width:o,tilewidth:a,tileheight:l}=this;n.save(),n.globalAlpha=i,r.map((h,c)=>{if(!h)return;let d=0,f=0,_=h&$n,u=h&Hn,b=0,g=0,w=0,y=0,F=0;d=_||u,h&=1073741823,F=h&De,F&&(_&&u?w=1:_?b=1:u?g=1:y=1,f=b||g||w||y,h&=~De);let k;for(let C=s.length-1;C>=0&&(k=s[C],!(h/k.firstgid>=1));C--);let{image:L,spacing:R=0,margin:I=0,firstgid:z,columns:W}=k,A=h-z,T=W??L.width/(a+R)|0,M=c%o*a,S=(c/o|0)*l,q=I+A%T*(a+R),Y=I+(A/T|0)*(l+R);f?(n.save(),n.translate(M+a/2,S+l/2),g||y?n.rotate(-Math.PI/2):(b||w)&&n.rotate(Math.PI/2),(w||y)&&n.scale(-1,1),M=-a/2,S=-l/2):d&&(n.save(),n.translate(M+(_?a:0),S+(u?l:0)),n.scale(_?-1:1,u?-1:1),M=d?0:M,S=d?0:S),n.drawImage(L,q,Y,a,l,M,S,a,l),(d||f)&&n.restore()}),n.restore()}}function Bn(){return new Gn(...arguments)}function qe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var oe={exports:{}},ae,Ae;function Wn(){return Ae||(Ae=1,ae=function(t,e){this.reset=function(){this.cards=t.slice(0),this.length=this.cards.length},this.shuffle=function(){n(this.cards)},this.reset(),this.shuffle(),this.deal=function(i,r){for(var s=0;s<i;s++)for(var o=0;o<r.length;o++){if(!r[o]||!r[o].push)throw new Error("Deck#deal | Undefined Hand");r[o].push(this.cards.pop())}this.length=this.cards.length},this.draw=function(i){if(!i||i<=1)return this.length=this.cards.length-1,this.cards.pop();for(var r=[],s=0;s<i;s++)r.push(this.cards.pop());return this.length=this.cards.length,r},this.drawFromBottomOfDeck=function(i){(!i||i<1)&&(i=1);for(var r=[],s=0;s<i;s++)r.push(this.cards.shift());return this.length=this.cards.length,r.length===1?r[0]:r},this.drawRandom=function(i){var r=function(){var a=Math.floor(e()*this.cards.length),l=this.cards[a];return this.cards.splice(a,1),this.length=this.cards.length,l};if(!i||i<=1)return r.apply(this);for(var s=[],o=0;o<i;o++)s.push(r.apply(this));return s},this.putOnTopOfDeck=function(i){if(!i instanceof Array)this.cards.push(i);else for(var r=0;r<i.length;r++)this.cards.push(i[r]);this.length=this.cards.length},this.putOnBottomOfDeck=function(i){if(!i instanceof Array)this.cards.unshift(i);else for(var r=0;r<i.length;r++)this.cards.unshift(i[r]);this.length=this.cards.length};function n(i){var r=i.length;if(r===0)return!1;for(;--r;){var s=Math.floor(e()*(r+1)),o=i[r],a=i[s];i[r]=a,i[s]=o}}}),ae}var le,Fe;function qn(){return Fe||(Fe=1,le=function(t,e,n){this.suit=t,this.description=e,this.sort=n,this.toString=function(){return this.description+" of "+this.suit+"s"},this.toShortDisplayString=function(){var i=this.suit.substring(0,1),r;switch(this.sort){case 11:r="J";break;case 12:r="Q";break;case 13:r="K";break;case 14:r="A";break;default:r=this.sort}return r+i}}),le}var he,Le;function zn(){if(Le)return he;Le=1;var t=qn();return he=function(){this.cards=[new t("Club","Two",2),new t("Club","Three",3),new t("Club","Four",4),new t("Club","Five",5),new t("Club","Six",6),new t("Club","Seven",7),new t("Club","Eight",8),new t("Club","Nine",9),new t("Club","Ten",10),new t("Club","Jack",11),new t("Club","Queen",12),new t("Club","King",13),new t("Club","Ace",14),new t("Diamond","Two",2),new t("Diamond","Three",3),new t("Diamond","Four",4),new t("Diamond","Five",5),new t("Diamond","Six",6),new t("Diamond","Seven",7),new t("Diamond","Eight",8),new t("Diamond","Nine",9),new t("Diamond","Ten",10),new t("Diamond","Jack",11),new t("Diamond","Queen",12),new t("Diamond","King",13),new t("Diamond","Ace",14),new t("Heart","Two",2),new t("Heart","Three",3),new t("Heart","Four",4),new t("Heart","Five",5),new t("Heart","Six",6),new t("Heart","Seven",7),new t("Heart","Eight",8),new t("Heart","Nine",9),new t("Heart","Ten",10),new t("Heart","Jack",11),new t("Heart","Queen",12),new t("Heart","King",13),new t("Heart","Ace",14),new t("Spade","Two",2),new t("Spade","Three",3),new t("Spade","Four",4),new t("Spade","Five",5),new t("Spade","Six",6),new t("Spade","Seven",7),new t("Spade","Eight",8),new t("Spade","Nine",9),new t("Spade","Ten",10),new t("Spade","Jack",11),new t("Spade","Queen",12),new t("Spade","King",13),new t("Spade","Ace",14)]},he}var Oe;function Un(){if(Oe)return oe.exports;Oe=1;var t=Wn(),e=zn(),n=oe.exports={},i={deck:new e().cards,numberOfDecks:1,random:function(){return Math.random()}};return n.playingCards=function(){return new e().cards},n.shuffle=function(r){if(r||(r=i),r.deck||(r.deck=i.deck),r.numberOfDecks)for(var s=r.deck,o=0;o<r.numberOfDecks-1;o++)r.deck=r.deck.concat(s);return r.random||(r.random=i.random),new t(r.deck,r.random)},oe.exports}var jn=Un();const $t=qe(jn),Ft=1,Lt=2,Ot=3,Pt=4,Rt=5,It=6,Yt=1,Xt=2,Kt=3,Vt=4,xt=[{id:1,name:"Fools' Landing",flooded:!1,adventurer:It},{id:2,name:"Cave of Shadows",flooded:!1,treasure:Kt},{id:3,name:"Temple of the Moon",flooded:!1,treasure:Yt},{id:4,name:"Copper Gate",flooded:!1,adventurer:Ot},{id:5,name:"Whispering Garden",flooded:!1,treasure:Xt},{id:6,name:"Dunes of Deception",flooded:!1},{id:7,name:"Silver Gate",flooded:!1,adventurer:Pt},{id:8,name:"Observatory",flooded:!1},{id:9,name:"Breakers Bridge",flooded:!1},{id:10,name:"Twilight Hollow",flooded:!1},{id:11,name:"Lost Lagoon",flooded:!1},{id:12,name:"Bronze Gate",flooded:!1,adventurer:Lt},{id:13,name:"Phantom Rock",flooded:!1},{id:14,name:"Watchtower",flooded:!1},{id:15,name:"Cliffs of Abandon",flooded:!1},{id:16,name:"Misty Marsh",flooded:!1},{id:17,name:"Coral Palace",flooded:!1,treasure:Vt},{id:18,name:"Howling Garden",flooded:!1,treasure:Xt},{id:19,name:"Iron Gate",flooded:!1,adventurer:Ft},{id:20,name:"Gold Gate",flooded:!1,adventurer:Rt},{id:21,name:"Crimson Forest",flooded:!1},{id:22,name:"Temple of the Sun",flooded:!1,treasure:Yt},{id:23,name:"Cave of Embers",flooded:!1,treasure:Kt},{id:24,name:"Tidal Palace",flooded:!1,treasure:Vt}],Yn=[{id:Pt,name:"Messenger",color:"silver",type:"adventurer"},{id:It,name:"Pilot",color:"blue",type:"adventurer"},{id:Lt,name:"Engineer",color:"firebrick",type:"adventurer"},{id:Ot,name:"Explorer",color:"green",type:"adventurer"},{id:Ft,name:"Diver",color:"black",type:"adventurer"},{id:Rt,name:"Navigator",color:"yellow",type:"adventurer"}],Xn=[{name:"Fools' Landing",type:"flood"},{name:"Cave of Shadows",type:"flood"},{name:"Temple of the Moon",type:"flood"},{name:"Copper Gate",type:"flood"},{name:"Whispering Garden",type:"flood"},{name:"Dunes of Deception",type:"flood"},{name:"Silver Gate",type:"flood"},{name:"Observatory",type:"flood"},{name:"Breakers Bridge",type:"flood"},{name:"Twilight Hollow",type:"flood"},{name:"Lost Lagoon",type:"flood"},{name:"Bronze Gate",type:"flood"},{name:"Phantom Rock",type:"flood"},{name:"Watchtower",type:"flood"},{name:"Cliffs of Abandon",type:"flood"},{name:"Misty Marsh",type:"flood"},{name:"Coral Palace",type:"flood"},{name:"Howling Garden",type:"flood"},{name:"Iron Gate",type:"flood"},{name:"Gold Gate",type:"flood"},{name:"Crimson Forest",type:"flood"},{name:"Temple of the Sun",type:"flood"},{name:"Cave of Embers",type:"flood"},{name:"Tidal Palace",type:"flood"}];function ct(t,e){const n=[];for(let i=0;i<t;++i)n.push(e);return n}const Kn=Object.freeze([...ct(5,{name:"The Earth Stone",type:"treasure"}),...ct(5,{name:"The Statue of the Wind",type:"treasure"}),...ct(5,{name:"The Crystal of Fire",type:"treasure"}),...ct(5,{name:"The Ocean's Chalice",type:"treasure"}),...ct(3,{name:"Waters Rise!",type:"treasure"}),...ct(3,{name:"Helicopter Lift",type:"treasure"}),...ct(3,{name:"Sandbags",type:"treasure"})]),ze=Object.freeze([...Yn,...Xn,...Kn]),Z={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Ue=Object.create(null);for(const t in Z)Object.hasOwn(Z,t)&&(Ue[Z[t]]=t);const P={to:{},get:{}};P.get=function(t){const e=t.slice(0,3).toLowerCase();let n,i;switch(e){case"hsl":{n=P.get.hsl(t),i="hsl";break}case"hwb":{n=P.get.hwb(t),i="hwb";break}default:{n=P.get.rgb(t),i="rgb";break}}return n?{model:i,value:n}:null};P.get.rgb=function(t){if(!t)return null;const e=/^#([a-f\d]{3,4})$/i,n=/^#([a-f\d]{6})([a-f\d]{2})?$/i,i=/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[\s,|/]\s*([+-]?[\d.]+)(%?)\s*)?\)$/,r=/^rgba?\(\s*([+-]?[\d.]+)%\s*,?\s*([+-]?[\d.]+)%\s*,?\s*([+-]?[\d.]+)%\s*(?:[\s,|/]\s*([+-]?[\d.]+)(%?)\s*)?\)$/,s=/^(\w+)$/;let o=[0,0,0,1],a,l,h;if(a=t.match(n)){for(h=a[2],a=a[1],l=0;l<3;l++){const c=l*2;o[l]=Number.parseInt(a.slice(c,c+2),16)}h&&(o[3]=Number.parseInt(h,16)/255)}else if(a=t.match(e)){for(a=a[1],h=a[3],l=0;l<3;l++)o[l]=Number.parseInt(a[l]+a[l],16);h&&(o[3]=Number.parseInt(h+h,16)/255)}else if(a=t.match(i)){for(l=0;l<3;l++)o[l]=Number.parseInt(a[l+1],10);a[4]&&(o[3]=a[5]?Number.parseFloat(a[4])*.01:Number.parseFloat(a[4]))}else if(a=t.match(r)){for(l=0;l<3;l++)o[l]=Math.round(Number.parseFloat(a[l+1])*2.55);a[4]&&(o[3]=a[5]?Number.parseFloat(a[4])*.01:Number.parseFloat(a[4]))}else return(a=t.match(s))?a[1]==="transparent"?[0,0,0,0]:Object.hasOwn(Z,a[1])?(o=Z[a[1]],o[3]=1,o):null:null;for(l=0;l<3;l++)o[l]=ot(o[l],0,255);return o[3]=ot(o[3],0,1),o};P.get.hsl=function(t){if(!t)return null;const e=/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d.]+)%\s*,?\s*([+-]?[\d.]+)%\s*(?:[,|/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/,n=t.match(e);if(n){const i=Number.parseFloat(n[4]),r=(Number.parseFloat(n[1])%360+360)%360,s=ot(Number.parseFloat(n[2]),0,100),o=ot(Number.parseFloat(n[3]),0,100),a=ot(Number.isNaN(i)?1:i,0,1);return[r,s,o,a]}return null};P.get.hwb=function(t){if(!t)return null;const e=/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*[\s,]\s*([+-]?[\d.]+)%\s*[\s,]\s*([+-]?[\d.]+)%\s*(?:[\s,]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/,n=t.match(e);if(n){const i=Number.parseFloat(n[4]),r=(Number.parseFloat(n[1])%360+360)%360,s=ot(Number.parseFloat(n[2]),0,100),o=ot(Number.parseFloat(n[3]),0,100),a=ot(Number.isNaN(i)?1:i,0,1);return[r,s,o,a]}return null};P.to.hex=function(...t){return"#"+Gt(t[0])+Gt(t[1])+Gt(t[2])+(t[3]<1?Gt(Math.round(t[3]*255)):"")};P.to.rgb=function(...t){return t.length<4||t[3]===1?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"};P.to.rgb.percent=function(...t){const e=Math.round(t[0]/255*100),n=Math.round(t[1]/255*100),i=Math.round(t[2]/255*100);return t.length<4||t[3]===1?"rgb("+e+"%, "+n+"%, "+i+"%)":"rgba("+e+"%, "+n+"%, "+i+"%, "+t[3]+")"};P.to.hsl=function(...t){return t.length<4||t[3]===1?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"};P.to.hwb=function(...t){let e="";return t.length>=4&&t[3]!==1&&(e=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+e+")"};P.to.keyword=function(...t){return Ue[t.slice(0,3)]};function ot(t,e,n){return Math.min(Math.max(e,t),n)}function Gt(t){const e=Math.round(t).toString(16).toUpperCase();return e.length<2?"0"+e:e}const je={};for(const t of Object.keys(Z))je[Z[t]]=t;const p={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},oklab:{channels:3,labels:["okl","oka","okb"]},lch:{channels:3,labels:"lch"},oklch:{channels:3,labels:["okl","okc","okh"]},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}},et=(6/29)**3;function vt(t){const e=t>.0031308?1.055*t**.4166666666666667-.055:t*12.92;return Math.min(Math.max(0,e),1)}function kt(t){return t>.04045?((t+.055)/1.055)**2.4:t/12.92}for(const t of Object.keys(p)){if(!("channels"in p[t]))throw new Error("missing channels property: "+t);if(!("labels"in p[t]))throw new Error("missing channel labels property: "+t);if(p[t].labels.length!==p[t].channels)throw new Error("channel and label counts mismatch: "+t);const{channels:e,labels:n}=p[t];delete p[t].channels,delete p[t].labels,Object.defineProperty(p[t],"channels",{value:e}),Object.defineProperty(p[t],"labels",{value:n})}p.rgb.hsl=function(t){const e=t[0]/255,n=t[1]/255,i=t[2]/255,r=Math.min(e,n,i),s=Math.max(e,n,i),o=s-r;let a,l;switch(s){case r:{a=0;break}case e:{a=(n-i)/o;break}case n:{a=2+(i-e)/o;break}case i:{a=4+(e-n)/o;break}}a=Math.min(a*60,360),a<0&&(a+=360);const h=(r+s)/2;return s===r?l=0:h<=.5?l=o/(s+r):l=o/(2-s-r),[a,l*100,h*100]};p.rgb.hsv=function(t){let e,n,i,r,s;const o=t[0]/255,a=t[1]/255,l=t[2]/255,h=Math.max(o,a,l),c=h-Math.min(o,a,l),d=function(f){return(h-f)/6/c+1/2};if(c===0)r=0,s=0;else{switch(s=c/h,e=d(o),n=d(a),i=d(l),h){case o:{r=i-n;break}case a:{r=1/3+e-i;break}case l:{r=2/3+n-e;break}}r<0?r+=1:r>1&&(r-=1)}return[r*360,s*100,h*100]};p.rgb.hwb=function(t){const e=t[0],n=t[1];let i=t[2];const r=p.rgb.hsl(t)[0],s=1/255*Math.min(e,Math.min(n,i));return i=1-1/255*Math.max(e,Math.max(n,i)),[r,s*100,i*100]};p.rgb.oklab=function(t){const e=kt(t[0]/255),n=kt(t[1]/255),i=kt(t[2]/255),r=Math.cbrt(.4122214708*e+.5363325363*n+.0514459929*i),s=Math.cbrt(.2119034982*e+.6806995451*n+.1073969566*i),o=Math.cbrt(.0883024619*e+.2817188376*n+.6299787005*i),a=.2104542553*r+.793617785*s-.0040720468*o,l=1.9779984951*r-2.428592205*s+.4505937099*o,h=.0259040371*r+.7827717662*s-.808675766*o;return[a*100,l*100,h*100]};p.rgb.cmyk=function(t){const e=t[0]/255,n=t[1]/255,i=t[2]/255,r=Math.min(1-e,1-n,1-i),s=(1-e-r)/(1-r)||0,o=(1-n-r)/(1-r)||0,a=(1-i-r)/(1-r)||0;return[s*100,o*100,a*100,r*100]};function Vn(t,e){return(t[0]-e[0])**2+(t[1]-e[1])**2+(t[2]-e[2])**2}p.rgb.keyword=function(t){const e=je[t];if(e)return e;let n=Number.POSITIVE_INFINITY,i;for(const r of Object.keys(Z)){const s=Z[r],o=Vn(t,s);o<n&&(n=o,i=r)}return i};p.keyword.rgb=function(t){return Z[t]};p.rgb.xyz=function(t){const e=kt(t[0]/255),n=kt(t[1]/255),i=kt(t[2]/255),r=e*.4124564+n*.3575761+i*.1804375,s=e*.2126729+n*.7151522+i*.072175,o=e*.0193339+n*.119192+i*.9503041;return[r*100,s*100,o*100]};p.rgb.lab=function(t){const e=p.rgb.xyz(t);let n=e[0],i=e[1],r=e[2];n/=95.047,i/=100,r/=108.883,n=n>et?n**(1/3):7.787*n+16/116,i=i>et?i**(1/3):7.787*i+16/116,r=r>et?r**(1/3):7.787*r+16/116;const s=116*i-16,o=500*(n-i),a=200*(i-r);return[s,o,a]};p.hsl.rgb=function(t){const e=t[0]/360,n=t[1]/100,i=t[2]/100;let r,s;if(n===0)return s=i*255,[s,s,s];const o=i<.5?i*(1+n):i+n-i*n,a=2*i-o,l=[0,0,0];for(let h=0;h<3;h++)r=e+1/3*-(h-1),r<0&&r++,r>1&&r--,6*r<1?s=a+(o-a)*6*r:2*r<1?s=o:3*r<2?s=a+(o-a)*(2/3-r)*6:s=a,l[h]=s*255;return l};p.hsl.hsv=function(t){const e=t[0];let n=t[1]/100,i=t[2]/100,r=n;const s=Math.max(i,.01);i*=2,n*=i<=1?i:2-i,r*=s<=1?s:2-s;const o=(i+n)/2,a=i===0?2*r/(s+r):2*n/(i+n);return[e,a*100,o*100]};p.hsv.rgb=function(t){const e=t[0]/60,n=t[1]/100;let i=t[2]/100;const r=Math.floor(e)%6,s=e-Math.floor(e),o=255*i*(1-n),a=255*i*(1-n*s),l=255*i*(1-n*(1-s));switch(i*=255,r){case 0:return[i,l,o];case 1:return[a,i,o];case 2:return[o,i,l];case 3:return[o,a,i];case 4:return[l,o,i];case 5:return[i,o,a]}};p.hsv.hsl=function(t){const e=t[0],n=t[1]/100,i=t[2]/100,r=Math.max(i,.01);let s,o;o=(2-n)*i;const a=(2-n)*r;return s=n*r,s/=a<=1?a:2-a,s=s||0,o/=2,[e,s*100,o*100]};p.hwb.rgb=function(t){const e=t[0]/360;let n=t[1]/100,i=t[2]/100;const r=n+i;let s;r>1&&(n/=r,i/=r);const o=Math.floor(6*e),a=1-i;s=6*e-o,(o&1)!==0&&(s=1-s);const l=n+s*(a-n);let h,c,d;switch(o){default:case 6:case 0:{h=a,c=l,d=n;break}case 1:{h=l,c=a,d=n;break}case 2:{h=n,c=a,d=l;break}case 3:{h=n,c=l,d=a;break}case 4:{h=l,c=n,d=a;break}case 5:{h=a,c=n,d=l;break}}return[h*255,c*255,d*255]};p.cmyk.rgb=function(t){const e=t[0]/100,n=t[1]/100,i=t[2]/100,r=t[3]/100,s=1-Math.min(1,e*(1-r)+r),o=1-Math.min(1,n*(1-r)+r),a=1-Math.min(1,i*(1-r)+r);return[s*255,o*255,a*255]};p.xyz.rgb=function(t){const e=t[0]/100,n=t[1]/100,i=t[2]/100;let r,s,o;return r=e*3.2404542+n*-1.5371385+i*-.4985314,s=e*-.969266+n*1.8760108+i*.041556,o=e*.0556434+n*-.2040259+i*1.0572252,r=vt(r),s=vt(s),o=vt(o),[r*255,s*255,o*255]};p.xyz.lab=function(t){let e=t[0],n=t[1],i=t[2];e/=95.047,n/=100,i/=108.883,e=e>et?e**(1/3):7.787*e+16/116,n=n>et?n**(1/3):7.787*n+16/116,i=i>et?i**(1/3):7.787*i+16/116;const r=116*n-16,s=500*(e-n),o=200*(n-i);return[r,s,o]};p.xyz.oklab=function(t){const e=t[0]/100,n=t[1]/100,i=t[2]/100,r=Math.cbrt(.8189330101*e+.3618667424*n-.1288597137*i),s=Math.cbrt(.0329845436*e+.9293118715*n+.0361456387*i),o=Math.cbrt(.0482003018*e+.2643662691*n+.633851707*i),a=.2104542553*r+.793617785*s-.0040720468*o,l=1.9779984951*r-2.428592205*s+.4505937099*o,h=.0259040371*r+.7827717662*s-.808675766*o;return[a*100,l*100,h*100]};p.oklab.oklch=function(t){return p.lab.lch(t)};p.oklab.xyz=function(t){const e=t[0]/100,n=t[1]/100,i=t[2]/100,r=(.999999998*e+.396337792*n+.215803758*i)**3,s=(1.000000008*e-.105561342*n-.063854175*i)**3,o=(1.000000055*e-.089484182*n-1.291485538*i)**3,a=1.227013851*r-.55779998*s+.281256149*o,l=-.040580178*r+1.11225687*s-.071676679*o,h=-.076381285*r-.421481978*s+1.58616322*o;return[a*100,l*100,h*100]};p.oklab.rgb=function(t){const e=t[0]/100,n=t[1]/100,i=t[2]/100,r=(e+.3963377774*n+.2158037573*i)**3,s=(e-.1055613458*n-.0638541728*i)**3,o=(e-.0894841775*n-1.291485548*i)**3,a=vt(4.0767416621*r-3.3077115913*s+.2309699292*o),l=vt(-1.2684380046*r+2.6097574011*s-.3413193965*o),h=vt(-.0041960863*r-.7034186147*s+1.707614701*o);return[a*255,l*255,h*255]};p.oklch.oklab=function(t){return p.lch.lab(t)};p.lab.xyz=function(t){const e=t[0],n=t[1],i=t[2];let r,s,o;s=(e+16)/116,r=n/500+s,o=s-i/200;const a=s**3,l=r**3,h=o**3;return s=a>et?a:(s-16/116)/7.787,r=l>et?l:(r-16/116)/7.787,o=h>et?h:(o-16/116)/7.787,r*=95.047,s*=100,o*=108.883,[r,s,o]};p.lab.lch=function(t){const e=t[0],n=t[1],i=t[2];let r;r=Math.atan2(i,n)*360/2/Math.PI,r<0&&(r+=360);const o=Math.sqrt(n*n+i*i);return[e,o,r]};p.lch.lab=function(t){const e=t[0],n=t[1],r=t[2]/360*2*Math.PI,s=n*Math.cos(r),o=n*Math.sin(r);return[e,s,o]};p.rgb.ansi16=function(t,e=null){const[n,i,r]=t;let s=e===null?p.rgb.hsv(t)[2]:e;if(s=Math.round(s/50),s===0)return 30;let o=30+(Math.round(r/255)<<2|Math.round(i/255)<<1|Math.round(n/255));return s===2&&(o+=60),o};p.hsv.ansi16=function(t){return p.rgb.ansi16(p.hsv.rgb(t),t[2])};p.rgb.ansi256=function(t){const e=t[0],n=t[1],i=t[2];return e>>4===n>>4&&n>>4===i>>4?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(n/255*5)+Math.round(i/255*5)};p.ansi16.rgb=function(t){t=t[0];let e=t%10;if(e===0||e===7)return t>50&&(e+=3.5),e=e/10.5*255,[e,e,e];const n=(Math.trunc(t>50)+1)*.5,i=(e&1)*n*255,r=(e>>1&1)*n*255,s=(e>>2&1)*n*255;return[i,r,s]};p.ansi256.rgb=function(t){if(t=t[0],t>=232){const s=(t-232)*10+8;return[s,s,s]}t-=16;let e;const n=Math.floor(t/36)/5*255,i=Math.floor((e=t%36)/6)/5*255,r=e%6/5*255;return[n,i,r]};p.rgb.hex=function(t){const n=(((Math.round(t[0])&255)<<16)+((Math.round(t[1])&255)<<8)+(Math.round(t[2])&255)).toString(16).toUpperCase();return"000000".slice(n.length)+n};p.hex.rgb=function(t){const e=t.toString(16).match(/[a-f\d]{6}|[a-f\d]{3}/i);if(!e)return[0,0,0];let n=e[0];e[0].length===3&&(n=[...n].map(a=>a+a).join(""));const i=Number.parseInt(n,16),r=i>>16&255,s=i>>8&255,o=i&255;return[r,s,o]};p.rgb.hcg=function(t){const e=t[0]/255,n=t[1]/255,i=t[2]/255,r=Math.max(Math.max(e,n),i),s=Math.min(Math.min(e,n),i),o=r-s;let a;const l=o<1?s/(1-o):0;return o<=0?a=0:r===e?a=(n-i)/o%6:r===n?a=2+(i-e)/o:a=4+(e-n)/o,a/=6,a%=1,[a*360,o*100,l*100]};p.hsl.hcg=function(t){const e=t[1]/100,n=t[2]/100,i=n<.5?2*e*n:2*e*(1-n);let r=0;return i<1&&(r=(n-.5*i)/(1-i)),[t[0],i*100,r*100]};p.hsv.hcg=function(t){const e=t[1]/100,n=t[2]/100,i=e*n;let r=0;return i<1&&(r=(n-i)/(1-i)),[t[0],i*100,r*100]};p.hcg.rgb=function(t){const e=t[0]/360,n=t[1]/100,i=t[2]/100;if(n===0)return[i*255,i*255,i*255];const r=[0,0,0],s=e%1*6,o=s%1,a=1-o;let l=0;switch(Math.floor(s)){case 0:{r[0]=1,r[1]=o,r[2]=0;break}case 1:{r[0]=a,r[1]=1,r[2]=0;break}case 2:{r[0]=0,r[1]=1,r[2]=o;break}case 3:{r[0]=0,r[1]=a,r[2]=1;break}case 4:{r[0]=o,r[1]=0,r[2]=1;break}default:r[0]=1,r[1]=0,r[2]=a}return l=(1-n)*i,[(n*r[0]+l)*255,(n*r[1]+l)*255,(n*r[2]+l)*255]};p.hcg.hsv=function(t){const e=t[1]/100,n=t[2]/100,i=e+n*(1-e);let r=0;return i>0&&(r=e/i),[t[0],r*100,i*100]};p.hcg.hsl=function(t){const e=t[1]/100,i=t[2]/100*(1-e)+.5*e;let r=0;return i>0&&i<.5?r=e/(2*i):i>=.5&&i<1&&(r=e/(2*(1-i))),[t[0],r*100,i*100]};p.hcg.hwb=function(t){const e=t[1]/100,n=t[2]/100,i=e+n*(1-e);return[t[0],(i-e)*100,(1-i)*100]};p.hwb.hcg=function(t){const e=t[1]/100,i=1-t[2]/100,r=i-e;let s=0;return r<1&&(s=(i-r)/(1-r)),[t[0],r*100,s*100]};p.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]};p.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]};p.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]};p.gray.hsl=function(t){return[0,0,t[0]]};p.gray.hsv=p.gray.hsl;p.gray.hwb=function(t){return[0,100,t[0]]};p.gray.cmyk=function(t){return[0,0,0,t[0]]};p.gray.lab=function(t){return[t[0],0,0]};p.gray.hex=function(t){const e=Math.round(t[0]/100*255)&255,i=((e<<16)+(e<<8)+e).toString(16).toUpperCase();return"000000".slice(i.length)+i};p.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]};function Jn(){const t={},e=Object.keys(p);for(let{length:n}=e,i=0;i<n;i++)t[e[i]]={distance:-1,parent:null};return t}function Zn(t){const e=Jn(),n=[t];for(e[t].distance=0;n.length>0;){const i=n.pop(),r=Object.keys(p[i]);for(let{length:s}=r,o=0;o<s;o++){const a=r[o],l=e[a];l.distance===-1&&(l.distance=e[i].distance+1,l.parent=i,n.unshift(a))}}return e}function Qn(t,e){return function(n){return e(t(n))}}function ti(t,e){const n=[e[t].parent,t];let i=p[e[t].parent][t],r=e[t].parent;for(;e[r].parent;)n.unshift(e[r].parent),i=Qn(p[e[r].parent][r],i),r=e[r].parent;return i.conversion=n,i}function ei(t){const e=Zn(t),n={},i=Object.keys(e);for(let{length:r}=i,s=0;s<r;s++){const o=i[s];e[o].parent!==null&&(n[o]=ti(o,e))}return n}const H={},ni=Object.keys(p);function ii(t){const e=function(...n){const i=n[0];return i==null?i:(i.length>1&&(n=i),t(n))};return"conversion"in t&&(e.conversion=t.conversion),e}function ri(t){const e=function(...n){const i=n[0];if(i==null)return i;i.length>1&&(n=i);const r=t(n);if(typeof r=="object")for(let{length:s}=r,o=0;o<s;o++)r[o]=Math.round(r[o]);return r};return"conversion"in t&&(e.conversion=t.conversion),e}for(const t of ni){H[t]={},Object.defineProperty(H[t],"channels",{value:p[t].channels}),Object.defineProperty(H[t],"labels",{value:p[t].labels});const e=ei(t),n=Object.keys(e);for(const i of n){const r=e[i];H[t][i]=ri(r),H[t][i].raw=ii(r)}}const Ye=["keyword","gray","hex"],de={};for(const t of Object.keys(H))de[[...H[t].labels].sort().join("")]=t;const ue={};function $(t,e){if(!(this instanceof $))return new $(t,e);if(e&&e in Ye&&(e=null),e&&!(e in H))throw new Error("Unknown model: "+e);let n,i;if(t==null)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof $)this.model=t.model,this.color=[...t.color],this.valpha=t.valpha;else if(typeof t=="string"){const r=P.get(t);if(r===null)throw new Error("Unable to parse color from string: "+t);this.model=r.model,i=H[this.model].channels,this.color=r.value.slice(0,i),this.valpha=typeof r.value[i]=="number"?r.value[i]:1}else if(t.length>0){this.model=e||"rgb",i=H[this.model].channels;const r=Array.prototype.slice.call(t,0,i);this.color=fe(r,i),this.valpha=typeof t[i]=="number"?t[i]:1}else if(typeof t=="number")this.model="rgb",this.color=[t>>16&255,t>>8&255,t&255],this.valpha=1;else{this.valpha=1;const r=Object.keys(t);"alpha"in t&&(r.splice(r.indexOf("alpha"),1),this.valpha=typeof t.alpha=="number"?t.alpha:0);const s=r.sort().join("");if(!(s in de))throw new Error("Unable to parse color from object: "+JSON.stringify(t));this.model=de[s];const{labels:o}=H[this.model],a=[];for(n=0;n<o.length;n++)a.push(t[o[n]]);this.color=fe(a)}if(ue[this.model])for(i=H[this.model].channels,n=0;n<i;n++){const r=ue[this.model][n];r&&(this.color[n]=r(this.color[n]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}$.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(t){let e=this.model in P.to?this:this.rgb();e=e.round(typeof t=="number"?t:1);const n=e.valpha===1?e.color:[...e.color,this.valpha];return P.to[e.model](...n)},percentString(t){const e=this.rgb().round(typeof t=="number"?t:1),n=e.valpha===1?e.color:[...e.color,this.valpha];return P.to.rgb.percent(...n)},array(){return this.valpha===1?[...this.color]:[...this.color,this.valpha]},object(){const t={},{channels:e}=H[this.model],{labels:n}=H[this.model];for(let i=0;i<e;i++)t[n[i]]=this.color[i];return this.valpha!==1&&(t.alpha=this.valpha),t},unitArray(){const t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,this.valpha!==1&&t.push(this.valpha),t},unitObject(){const t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,this.valpha!==1&&(t.alpha=this.valpha),t},round(t){return t=Math.max(t||0,0),new $([...this.color.map(oi(t)),this.valpha],this.model)},alpha(t){return t!==void 0?new $([...this.color,Math.max(0,Math.min(1,t))],this.model):this.valpha},red:D("rgb",0,O(255)),green:D("rgb",1,O(255)),blue:D("rgb",2,O(255)),hue:D(["hsl","hsv","hsl","hwb","hcg"],0,t=>(t%360+360)%360),saturationl:D("hsl",1,O(100)),lightness:D("hsl",2,O(100)),saturationv:D("hsv",1,O(100)),value:D("hsv",2,O(100)),chroma:D("hcg",1,O(100)),gray:D("hcg",2,O(100)),white:D("hwb",1,O(100)),wblack:D("hwb",2,O(100)),cyan:D("cmyk",0,O(100)),magenta:D("cmyk",1,O(100)),yellow:D("cmyk",2,O(100)),black:D("cmyk",3,O(100)),x:D("xyz",0,O(95.047)),y:D("xyz",1,O(100)),z:D("xyz",2,O(108.833)),l:D("lab",0,O(100)),a:D("lab",1),b:D("lab",2),keyword(t){return t!==void 0?new $(t):H[this.model].keyword(this.color)},hex(t){return t!==void 0?new $(t):P.to.hex(...this.rgb().round().color)},hexa(t){if(t!==void 0)return new $(t);const e=this.rgb().round().color;let n=Math.round(this.valpha*255).toString(16).toUpperCase();return n.length===1&&(n="0"+n),P.to.hex(...e)+n},rgbNumber(){const t=this.rgb().color;return(t[0]&255)<<16|(t[1]&255)<<8|t[2]&255},luminosity(){const t=this.rgb().color,e=[];for(const[n,i]of t.entries()){const r=i/255;e[n]=r<=.04045?r/12.92:((r+.055)/1.055)**2.4}return .2126*e[0]+.7152*e[1]+.0722*e[2]},contrast(t){const e=this.luminosity(),n=t.luminosity();return e>n?(e+.05)/(n+.05):(n+.05)/(e+.05)},level(t){const e=this.contrast(t);return e>=7?"AAA":e>=4.5?"AA":""},isDark(){const t=this.rgb().color;return(t[0]*2126+t[1]*7152+t[2]*722)/1e4<128},isLight(){return!this.isDark()},negate(){const t=this.rgb();for(let e=0;e<3;e++)t.color[e]=255-t.color[e];return t},lighten(t){const e=this.hsl();return e.color[2]+=e.color[2]*t,e},darken(t){const e=this.hsl();return e.color[2]-=e.color[2]*t,e},saturate(t){const e=this.hsl();return e.color[1]+=e.color[1]*t,e},desaturate(t){const e=this.hsl();return e.color[1]-=e.color[1]*t,e},whiten(t){const e=this.hwb();return e.color[1]+=e.color[1]*t,e},blacken(t){const e=this.hwb();return e.color[2]+=e.color[2]*t,e},grayscale(){const t=this.rgb().color,e=t[0]*.3+t[1]*.59+t[2]*.11;return $.rgb(e,e,e)},fade(t){return this.alpha(this.valpha-this.valpha*t)},opaquer(t){return this.alpha(this.valpha+this.valpha*t)},rotate(t){const e=this.hsl();let n=e.color[0];return n=(n+t)%360,n=n<0?360+n:n,e.color[0]=n,e},mix(t,e){if(!t||!t.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof t);const n=t.rgb(),i=this.rgb(),r=e===void 0?.5:e,s=2*r-1,o=n.alpha()-i.alpha(),a=((s*o===-1?s:(s+o)/(1+s*o))+1)/2,l=1-a;return $.rgb(a*n.red()+l*i.red(),a*n.green()+l*i.green(),a*n.blue()+l*i.blue(),n.alpha()*r+i.alpha()*(1-r))}};for(const t of Object.keys(H)){if(Ye.includes(t))continue;const{channels:e}=H[t];$.prototype[t]=function(...n){return this.model===t?new $(this):n.length>0?new $(n,t):new $([...ai(H[this.model][t].raw(this.color)),this.valpha],t)},$[t]=function(...n){let i=n[0];return typeof i=="number"&&(i=fe(n,e)),new $(i,t)}}function si(t,e){return Number(t.toFixed(e))}function oi(t){return function(e){return si(e,t)}}function D(t,e,n){t=Array.isArray(t)?t:[t];for(const i of t)(ue[i]||=[])[e]=n;return t=t[0],function(i){let r;return i!==void 0?(n&&(i=n(i)),r=this[t](),r.color[e]=i,r):(r=this[t]().color[e],n&&(r=n(r)),r)}}function O(t){return function(e){return Math.max(0,Math.min(t,e))}}function ai(t){return Array.isArray(t)?t:[t]}function fe(t,e){for(let n=0;n<e;n++)typeof t[n]!="number"&&(t[n]=0);return t}/**
 * @author Markus Ekholm
 * @copyright 2012-2023 (c) Markus Ekholm <markus at botten dot org >
 * @license Copyright (c) 2012-2023, Markus Ekholm
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *    * Redistributions of source code must retain the above copyright
 *      notice, this list of conditions and the following disclaimer.
 *    * Redistributions in binary form must reproduce the above copyright
 *      notice, this list of conditions and the following disclaimer in the
 *      documentation and/or other materials provided with the distribution.
 *    * Neither the name of the author nor the
 *      names of its contributors may be used to endorse or promote products
 *      derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL MARKUS EKHOLM BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */function Pe(t,e){e=pe(e||{R:255,G:255,B:255}),t=pe(t);let n=t;return t.A!==void 0&&(n={R:e.R+(t.R-e.R)*t.A,G:e.G+(t.G-e.G)*t.A,B:e.B+(t.B-e.B)*t.A}),hi(li(n))}function li(t){let e=t.R/255,n=t.G/255,i=t.B/255;e>.04045?e=Math.pow((e+.055)/1.055,2.4):e=e/12.92,n>.04045?n=Math.pow((n+.055)/1.055,2.4):n=n/12.92,i>.04045?i=Math.pow((i+.055)/1.055,2.4):i=i/12.92,e*=100,n*=100,i*=100;const r=e*.4124+n*.3576+i*.1805,s=e*.2126+n*.7152+i*.0722,o=e*.0193+n*.1192+i*.9505;return{X:r,Y:s,Z:o}}function hi(t){let r=t.Y/100,s=t.Z/108.883,o=t.X/95.047;o>.008856?o=Math.pow(o,1/3):o=7.787*o+16/116,r>.008856?r=Math.pow(r,1/3):r=7.787*r+16/116,s>.008856?s=Math.pow(s,1/3):s=7.787*s+16/116;const a=116*r-16,l=500*(o-r),h=200*(r-s);return{L:a,a:l,b:h}}function pe(t){let e,n,i,r;"R"in t?(e=t.R,n=t.G,i=t.B,r=t.A):(e=t.r,n=t.g,i=t.b,r=t.a);const s={R:e,G:n,B:i};return r!==void 0&&(s.A=r),s}/**
 * @author Markus Ekholm
 * @copyright 2012-2023 (c) Markus Ekholm <markus at botten dot org >
 * @license Copyright (c) 2012-2023, Markus Ekholm
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *    * Redistributions of source code must retain the above copyright
 *      notice, this list of conditions and the following disclaimer.
 *    * Redistributions in binary form must reproduce the above copyright
 *      notice, this list of conditions and the following disclaimer in the
 *      documentation and/or other materials provided with the distribution.
 *    * Neither the name of the author nor the
 *      names of its contributors may be used to endorse or promote products
 *      derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL MARKUS EKHOLM BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */function ci(t,e,n){("R"in t||"r"in t)&&(t=Pe(t,n)),("R"in e||"r"in e)&&(e=Pe(e,n));const i=t.L,r=t.a,s=t.b,o=e.L,a=e.a,l=e.b,h=1,c=1,d=1,f=Math.sqrt(Math.pow(r,2)+Math.pow(s,2)),_=Math.sqrt(Math.pow(a,2)+Math.pow(l,2)),u=(f+_)/2,b=.5*(1-Math.sqrt(Math.pow(u,7)/(Math.pow(u,7)+Math.pow(25,7)))),g=(1+b)*r,w=(1+b)*a,y=Math.sqrt(Math.pow(g,2)+Math.pow(s,2)),F=Math.sqrt(Math.pow(w,2)+Math.pow(l,2)),k=Re(s,g),L=Re(l,w),R=o-i,I=F-y,z=ui(f,_,k,L),W=2*Math.sqrt(y*F)*Math.sin(wt(z)/2),A=(i+o)/2,T=(y+F)/2,M=fi(f,_,k,L),S=1-.17*Math.cos(wt(M-30))+.24*Math.cos(wt(2*M))+.32*Math.cos(wt(3*M+6))-.2*Math.cos(wt(4*M-63)),q=30*Math.exp(-Math.pow((M-275)/25,2)),Y=Math.sqrt(Math.pow(T,7)/(Math.pow(T,7)+Math.pow(25,7))),C=1+.015*Math.pow(A-50,2)/Math.sqrt(20+Math.pow(A-50,2)),it=1+.045*T,lt=1+.015*T*S,Tt=-2*Y*Math.sin(wt(2*q));return Math.sqrt(Math.pow(R/(C*h),2)+Math.pow(I/(it*c),2)+Math.pow(W/(lt*d),2)+Tt*(I/(it*c))*(W/(lt*d)))}function di(t){return t*(180/Math.PI)}function wt(t){return t*(Math.PI/180)}function Re(t,e){if(t===0&&e===0)return 0;{const n=di(Math.atan2(t,e));return n>=0?n:n+360}}function ui(t,e,n,i){if(t*e===0)return 0;if(Math.abs(i-n)<=180)return i-n;if(i-n>180)return i-n-360;if(i-n<-180)return i-n+360;throw new Error}function fi(t,e,n,i){if(t*e===0)return n+i;if(Math.abs(n-i)<=180)return(n+i)/2;if(Math.abs(n-i)>180&&n+i<360)return(n+i+360)/2;if(Math.abs(n-i)>180&&n+i>=360)return(n+i-360)/2;throw new Error}/**
 * @author Markus Ekholm
 * @copyright 2012-2023 (c) Markus Ekholm <markus at botten dot org >
 * @license Copyright (c) 2012-2023, Markus Ekholm
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *    * Redistributions of source code must retain the above copyright
 *      notice, this list of conditions and the following disclaimer.
 *    * Redistributions in binary form must reproduce the above copyright
 *      notice, this list of conditions and the following disclaimer in the
 *      documentation and/or other materials provided with the distribution.
 *    * Neither the name of the author nor the
 *      names of its contributors may be used to endorse or promote products
 *      derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL MARKUS EKHOLM BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */function Xe(t){return t=pe(t),t.A!==1?`rgba(${t.R}, ${t.G}, ${t.B}, ${t.A})`:`rgb(${t.R}, ${t.G}, ${t.B})`}function pi(t,e,n,i){const r={};i=i||{R:255,G:255,B:255},n=n||"closest";for(let s=0;s<t.length;s+=1){const o=t[s];let a,l;for(let h=0;h<e.length;h+=1){const c=e[h],d=ci(o,c,i);if(!a){a=c,l=d;continue}if(l!==void 0&&n==="closest"&&d<l){a=c,l=d;continue}if(l!==void 0&&n==="furthest"&&d>l){a=c,l=d;continue}}a&&(r[Xe(o)]=a)}return r}function gi(t,e,n){const i=Xe(t);return n=n||{R:255,G:255,B:255},pi([t],e,"closest",n)[i]}const wi=Object.freeze(["#ecebe7","#cbc6c1","#b28b78","#847066","#695b59","#4f4240","#352f2e","#723012","#845425","#a76343","#dc6a36","#f682bf","#d74060","#c5452b","#b02222","#8d1931","#6a1325","#3e1909","#406a3b","#76771d","#939446","#d3bd46","#99e0a8","#399a4d","#204f1a","#0f2c0c","#1a0a01","#14266a","#194f80","#2067a7","#49a3b4","#1de9de"]),mi=wi;function Q(t){if(!Object.keys(Z).includes(t))throw new Error("Invalid CSS color name");const[e,n,i]=Z[t],r=gi({R:e,G:n,B:i},mi.map(s=>{const o=$(s).object();return{R:o.r,G:o.g,B:o.b}}));return`rgb(${r.R}, ${r.G}, ${r.B})`}const yi=Q("aqua"),_i=Q("black"),Ke=Q("blue"),Ve=Q("firebrick"),bi=Q("gray"),xi=Q("green"),vi=Q("hotpink"),ki=Q("saddlebrown"),Mi=Q("silver"),Ei=Q("teal"),Jt=Q("white"),Zt=Q("yellow"),Je=0,Ti=1,Si=2,Ci=3,ne=2,at=512,ft=256,J=32*ne,E=32*ne,Bt=24*ne,Wt=24*ne,N=J/4/2,Di=vi,Ai=2,Fi=yi,Li="adventurer-deck",Oi="flood-deck",Pi="island-tiles-deck",Ri="treasure-deck",Ii=6,Ni=Je;ee(Li);const $i=$t.shuffle({deck:ze.filter(({type:t})=>t==="adventurer"),random:te}),Ze=""+new URL("spritesheet-Dm4BmPvg.png",import.meta.url).href,Qe=""+new URL("tilesheet-C_zpU0l5.png",import.meta.url).href,Hi=[Ze,Qe],Gi=t=>_n(...Hi);ee(Oi);const Bi=$t.shuffle({deck:xt,random:te});function Wi(){const t={color:Zt,font:`${E/2}px Arial`};function e(){this.textNode.color=this.disabled?bi:Zt}const n=Ht({text:{text:"Take action",...t},render(){e.call(this)}}),i=Ht({text:{text:"Finish taking actions",...t},render(){e.call(this)}}),r=Ht({text:{text:"Draw flood card",...t},render(){e.call(this)}}),s=Ht({text:{text:"End turn",...t},render(){e.call(this)}});return{menu:Pn({x:at/2,y:ft/2,anchor:{x:.5,y:.5},rowGap:E/4,justify:"center",children:[n,i,r,s]}),drawFloodCard:r,endTurn:s,finishTakingActions:i,takeAction:n}}function qi(){function t(){this.context.fillStyle=this.color,this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,2*Math.PI),this.context.fill(),this.context.lineWidth=2,this.context.strokeStyle=Jt,this.context.stroke()}const e=j({color:_i,id:Ft,radius:N,render(){t.call(this)}}),n=j({color:Ve,id:Lt,radius:N,render(){t.call(this)}}),i=j({color:xi,id:Ot,radius:N,render(){t.call(this)}}),r=j({color:Mi,id:Pt,radius:N,render(){t.call(this)}}),s=j({color:Zt,id:Rt,radius:N,render(){t.call(this)}}),o=j({color:Ke,id:It,radius:N,render(){t.call(this)}});return{diverPawn:e,engineerPawn:n,explorerPawn:i,messengerPawn:r,navigatorPawn:s,pilotPawn:o}}function zi(){return j({color:Di,render(){if(this.context.beginPath(),this.radius!==void 0)this.context.arc(this.radius,this.radius,this.radius,0,2*Math.PI);else if(this.width!==void 0&&this.height!==void 0)this.context.rect(0,0,this.width,this.height);else return;this.context.lineWidth=Ai,this.context.strokeStyle=this.color,this.context.stroke()}})}function Ui(){const t=Nn({image:st[Ze],frameWidth:J,frameHeight:E,animations:xt.map((n,i)=>({[i]:{frames:i*2,frameRate:1},[`${i}-flooded`]:{frames:[i*2+1],frameRate:1}})).reduce((n,i)=>({...n,...i}))}),e=[];for(let n=0;n<xt.length;++n){const i=j({animations:t.animations,id:1+n,flooded:xt[n].flooded});i.playAnimation(n),e.push(i)}return e}async function ji(){try{const t=st[Qe];return Bn({tilewidth:J,tileheight:E,width:8,height:8,tilesets:[{firstgid:0,image:t}],layers:[{name:"ground",data:[0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,0,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0]}]})}catch(t){return console.error(t),null}}function Yi(){const t=j({color:ki,width:Bt,height:Wt,id:Yt}),e=j({color:Zt,width:Bt,height:Wt,id:Xt}),n=j({color:Ve,width:Bt,height:Wt,id:Kt}),i=j({color:Ke,width:Bt,height:Wt,id:Vt});return{theCrystalOfFire:n,theEarthStone:t,theOceansChalice:i,theStatueOfTheWind:e}}function Xi(){return j({x:0,y:0,color:Fi,width:at,height:ft})}const _t=Object.freeze([{cardsToDraw:2,difficultyLevel:Je},{cardsToDraw:2,difficultyLevel:Ti},{cardsToDraw:3,difficultyLevel:Si},{cardsToDraw:3,difficultyLevel:Ci},{cardsToDraw:3},{cardsToDraw:4},{cardsToDraw:4},{cardsToDraw:5},{cardsToDraw:5}]);function Ki(t=Ni){const e=_t.findIndex(i=>i.difficultyLevel===t);if(e===-1)throw new Error("Invalid starting water level");return j({color:Jt,x:-at,backgroundColor:Ei,font:`${E/2}px Arial`,startingWaterLevel:e,text:`${_t[e].cardsToDraw}`,waterLevel:e,render(){const i=this.text.split(`
`);if(i.length===0)return;this.context.font=this.font,this.context.textBaseline="top";let r=-1;for(let s=0;s<i.length;++s){const o=this.context.measureText(i[s]),a=o.actualBoundingBoxRight+o.actualBoundingBoxLeft;a>r&&(r=a)}this.width=Math.ceil(r),this.height=i.length*E/2,this.x=at-this.width,this.y=ft-this.height,this.context.fillStyle=this.backgroundColor,this.context.fillRect(0,0,this.width,this.height),this.context.fillStyle=this.color;for(let s=0;s<i.length;++s)this.context.fillText(i[s],0,s*E/2)},increment(){this.waterLevel<_t.length-1&&(++this.waterLevel,this.text=`${_t[this.waterLevel].cardsToDraw}`)},reset(){this.waterLevel=this.startingWaterLevel,this.text=`${_t[this.waterLevel].cardsToDraw}`}})}ee(Pi);const Vi=$t.shuffle({deck:xt,random:te});function Ji(t){return function(){const{innerWidth:e,innerHeight:n}=window,i=e/n,r=at/ft;i<r?(t.style.width=`${e}px`,t.style.height=`${e/r}px`):(t.style.width=`${n*r}px`,t.style.height=`${n}px`)}}var jt={exports:{}},Zi=jt.exports,Ie;function Qi(){return Ie||(Ie=1,function(t,e){(function(i,r){t.exports=r()})(Zi,function(){return function(n){var i={};function r(s){if(i[s])return i[s].exports;var o=i[s]={i:s,l:!1,exports:{}};return n[s].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=n,r.c=i,r.i=function(s){return s},r.d=function(s,o,a){r.o(s,o)||Object.defineProperty(s,o,{configurable:!1,enumerable:!0,get:a})},r.n=function(s){var o=s&&s.__esModule?function(){return s.default}:function(){return s};return r.d(o,"a",o),o},r.o=function(s,o){return Object.prototype.hasOwnProperty.call(s,o)},r.p="",r(r.s=5)}([function(n,i,r){n.exports=function(s,o){var a,l,h;for(a=1;a<arguments.length;a++){l=arguments[a];for(h in l)l.hasOwnProperty(h)&&(s[h]=l[h])}return s}},function(n,i,r){var s=r(0);n.exports={build:function(o,a){var l,h,c,d=a.plugins;for(l=0,h=d.length;l<h;l++)c=d[l],c.methods&&s(o,c.methods),c.properties&&Object.defineProperties(o,c.properties)},hook:function(o,a,l){var h,c,d,f,_=o.config.plugins,u=[o.context];for(l&&(u=u.concat(l)),h=0,c=_.length;h<c;h++)f=_[h],d=_[h][a],d&&d.apply(f,u)}}},function(n,i,r){function s(o){if(o.length===0)return o;var a,l,h=o.split(/[_-]/);if(h.length===1&&h[0][0].toLowerCase()===h[0][0])return o;for(l=h[0].toLowerCase(),a=1;a<h.length;a++)l=l+h[a].charAt(0).toUpperCase()+h[a].substring(1).toLowerCase();return l}s.prepended=function(o,a){return a=s(a),o+a[0].toUpperCase()+a.substring(1)},n.exports=s},function(n,i,r){var s=r(0),o=r(2);function a(l,h){l=l||{},this.options=l,this.defaults=h.defaults,this.states=[],this.transitions=[],this.map={},this.lifecycle=this.configureLifecycle(),this.init=this.configureInitTransition(l.init),this.data=this.configureData(l.data),this.methods=this.configureMethods(l.methods),this.map[this.defaults.wildcard]={},this.configureTransitions(l.transitions||[]),this.plugins=this.configurePlugins(l.plugins,h.plugin)}s(a.prototype,{addState:function(l){this.map[l]||(this.states.push(l),this.addStateLifecycleNames(l),this.map[l]={})},addStateLifecycleNames:function(l){this.lifecycle.onEnter[l]=o.prepended("onEnter",l),this.lifecycle.onLeave[l]=o.prepended("onLeave",l),this.lifecycle.on[l]=o.prepended("on",l)},addTransition:function(l){this.transitions.indexOf(l)<0&&(this.transitions.push(l),this.addTransitionLifecycleNames(l))},addTransitionLifecycleNames:function(l){this.lifecycle.onBefore[l]=o.prepended("onBefore",l),this.lifecycle.onAfter[l]=o.prepended("onAfter",l),this.lifecycle.on[l]=o.prepended("on",l)},mapTransition:function(l){var h=l.name,c=l.from,d=l.to;return this.addState(c),typeof d!="function"&&this.addState(d),this.addTransition(h),this.map[c][h]=l,l},configureLifecycle:function(){return{onBefore:{transition:"onBeforeTransition"},onAfter:{transition:"onAfterTransition"},onEnter:{state:"onEnterState"},onLeave:{state:"onLeaveState"},on:{transition:"onTransition"}}},configureInitTransition:function(l){return typeof l=="string"?this.mapTransition(s({},this.defaults.init,{to:l,active:!0})):typeof l=="object"?this.mapTransition(s({},this.defaults.init,l,{active:!0})):(this.addState(this.defaults.init.from),this.defaults.init)},configureData:function(l){return typeof l=="function"?l:typeof l=="object"?function(){return l}:function(){return{}}},configureMethods:function(l){return l||{}},configurePlugins:function(l,h){l=l||[];var c,d,f;for(c=0,d=l.length;c<d;c++)f=l[c],typeof f=="function"&&(l[c]=f=f()),f.configure&&f.configure(this);return l},configureTransitions:function(l){var h,c,d,f,_,u=this.defaults.wildcard;for(c=0;c<l.length;c++)for(d=l[c],f=Array.isArray(d.from)?d.from:[d.from||u],_=d.to||u,h=0;h<f.length;h++)this.mapTransition({name:d.name,from:f[h],to:_})},transitionFor:function(l,h){var c=this.defaults.wildcard;return this.map[l][h]||this.map[c][h]},transitionsFor:function(l){var h=this.defaults.wildcard;return Object.keys(this.map[l]).concat(Object.keys(this.map[h]))},allStates:function(){return this.states},allTransitions:function(){return this.transitions}}),n.exports=a},function(n,i,r){var s=r(0),o=r(6),a=r(1),l=[null,[]];function h(c,d){this.context=c,this.config=d,this.state=d.init.from,this.observers=[c]}s(h.prototype,{init:function(c){if(s(this.context,this.config.data.apply(this.context,c)),a.hook(this,"init"),this.config.init.active)return this.fire(this.config.init.name,[])},is:function(c){return Array.isArray(c)?c.indexOf(this.state)>=0:this.state===c},isPending:function(){return this.pending},can:function(c){return!this.isPending()&&!!this.seek(c)},cannot:function(c){return!this.can(c)},allStates:function(){return this.config.allStates()},allTransitions:function(){return this.config.allTransitions()},transitions:function(){return this.config.transitionsFor(this.state)},seek:function(c,d){var f=this.config.defaults.wildcard,_=this.config.transitionFor(this.state,c),u=_&&_.to;return typeof u=="function"?u.apply(this.context,d):u===f?this.state:u},fire:function(c,d){return this.transit(c,this.state,this.seek(c,d),d)},transit:function(c,d,f,_){var u=this.config.lifecycle,b=this.config.options.observeUnchangedState||d!==f;return f?this.isPending()?this.context.onPendingTransition(c,d,f):(this.config.addState(f),this.beginTransit(),_.unshift({transition:c,from:d,to:f,fsm:this.context}),this.observeEvents([this.observersForEvent(u.onBefore.transition),this.observersForEvent(u.onBefore[c]),b?this.observersForEvent(u.onLeave.state):l,b?this.observersForEvent(u.onLeave[d]):l,this.observersForEvent(u.on.transition),b?["doTransit",[this]]:l,b?this.observersForEvent(u.onEnter.state):l,b?this.observersForEvent(u.onEnter[f]):l,b?this.observersForEvent(u.on[f]):l,this.observersForEvent(u.onAfter.transition),this.observersForEvent(u.onAfter[c]),this.observersForEvent(u.on[c])],_)):this.context.onInvalidTransition(c,d,f)},beginTransit:function(){this.pending=!0},endTransit:function(c){return this.pending=!1,c},failTransit:function(c){throw this.pending=!1,c},doTransit:function(c){this.state=c.to},observe:function(c){if(c.length===2){var d={};d[c[0]]=c[1],this.observers.push(d)}else this.observers.push(c[0])},observersForEvent:function(c){for(var d=0,f=this.observers.length,_,u=[];d<f;d++)_=this.observers[d],_[c]&&u.push(_);return[c,u,!0]},observeEvents:function(c,d,f,_){if(c.length===0)return this.endTransit(_===void 0?!0:_);var u=c[0][0],b=c[0][1],g=c[0][2];if(d[0].event=u,u&&g&&u!==f&&a.hook(this,"lifecycle",d),b.length===0)return c.shift(),this.observeEvents(c,d,u,_);var w=b.shift(),y=w[u].apply(w,d);return y&&typeof y.then=="function"?y.then(this.observeEvents.bind(this,c,d,u)).catch(this.failTransit.bind(this)):y===!1?this.endTransit(!1):this.observeEvents(c,d,u,y)},onInvalidTransition:function(c,d,f){throw new o("transition is invalid in current state",c,d,f,this.state)},onPendingTransition:function(c,d,f){throw new o("transition is invalid while previous transition is still in progress",c,d,f,this.state)}}),n.exports=h},function(n,i,r){var s=r(0),o=r(2),a=r(1),l=r(3),h=r(4),c={is:function(g){return this._fsm.is(g)},can:function(g){return this._fsm.can(g)},cannot:function(g){return this._fsm.cannot(g)},observe:function(){return this._fsm.observe(arguments)},transitions:function(){return this._fsm.transitions()},allTransitions:function(){return this._fsm.allTransitions()},allStates:function(){return this._fsm.allStates()},onInvalidTransition:function(g,w,y){return this._fsm.onInvalidTransition(g,w,y)},onPendingTransition:function(g,w,y){return this._fsm.onPendingTransition(g,w,y)}},d={state:{configurable:!1,enumerable:!0,get:function(){return this._fsm.state},set:function(g){throw Error("use transitions to change state")}}};function f(g){return u(this||{},g)}function _(){var g,w;typeof arguments[0]=="function"?(g=arguments[0],w=arguments[1]||{}):(g=function(){this._fsm.apply(this,arguments)},w=arguments[0]||{});var y=new l(w,f);return b(g.prototype,y),g.prototype._fsm.config=y,g}function u(g,w){var y=new l(w,f);return b(g,y),g._fsm(),g}function b(g,w){if(typeof g!="object"||Array.isArray(g))throw Error("StateMachine can only be applied to objects");a.build(g,w),Object.defineProperties(g,d),s(g,c),s(g,w.methods),w.allTransitions().forEach(function(y){g[o(y)]=function(){return this._fsm.fire(y,[].slice.call(arguments))}}),g._fsm=function(){this._fsm=new h(this,w),this._fsm.init(arguments)}}f.version="3.0.1",f.factory=_,f.apply=u,f.defaults={wildcard:"*",init:{name:"init",from:"none"}},n.exports=f},function(n,i,r){n.exports=function(s,o,a,l,h){this.message=s,this.transition=o,this.from=a,this.to=l,this.current=h}}])})}(jt)),jt.exports}var tr=Qi();const ie=qe(tr),X=ie({init:"no-actions-taken",transitions:[{name:"take-action",from:"no-actions-taken",to:"one-action-taken"},{name:"take-action",from:"one-action-taken",to:"two-actions-taken"},{name:"take-action",from:"two-actions-taken",to:"three-actions-taken"},{name:"finish-taking-actions",from:"no-actions-taken",to:"final-state"},{name:"finish-taking-actions",from:"one-action-taken",to:"final-state"},{name:"finish-taking-actions",from:"two-actions-taken",to:"final-state"},{name:"finish-taking-actions",from:"three-actions-taken",to:"final-state"},{name:"reset",from:"*",to:"no-actions-taken"}],data:{text:"No actions taken, yet"},methods:{onTakeAction(){switch(this.state){case"one-action-taken":this.text="One action taken";break;case"two-actions-taken":this.text="Two actions taken";break;case"three-actions-taken":this.text="Three actions taken";break;case"final-state":break;default:throw new Error("Invalid action state")}},onFinishTakingActions(){this.text="Finished taking actions"}}}),tt=ie({init:"no-cards-drawn",transitions:[{name:"draw-a-card",from:"no-cards-drawn",to:"one-card-drawn"},{name:"draw-a-card",from:"one-card-drawn",to:"two-cards-drawn"},{name:"draw-a-card",from:"two-cards-drawn",to:"three-cards-drawn"},{name:"draw-a-card",from:"three-cards-drawn",to:"four-cards-drawn"},{name:"draw-a-card",from:"four-cards-drawn",to:"five-cards-drawn"},{name:"reset",from:"*",to:"no-cards-drawn"}],data:{text:"No Flood cards drawn"},methods:{onDrawACard(){const t={"one-card-drawn":"One Flood card drawn","two-cards-drawn":"Two Flood cards drawn","three-cards-drawn":"Three Flood cards drawn","four-cards-drawn":"Four Flood cards drawn","five-cards-drawn":"Five Flood cards drawn"};if(!Object.keys(t).includes(this.state))throw new Error("Invalid flood state");this.text=t[this.state]},onReset(){this.text="No Flood cards drawn"}}}),V=ie({init:"player-1s-turn",transitions:[{name:"next-players-turn",from:"player-1s-turn",to:()=>"player-2s-turn"},{name:"next-players-turn",from:"player-2s-turn",to:()=>"player-3s-turn"},{name:"next-players-turn",from:"player-3s-turn",to:()=>"player-4s-turn"},{name:"next-players-turn",from:"player-4s-turn",to:()=>"player-5s-turn"},{name:"next-players-turn",from:"player-5s-turn",to:()=>"player-6s-turn"},{name:"next-players-turn",from:"player-6s-turn",to:"player-1s-turn"},{name:"reset",from:"*",to:"player-1s-turn"}],data:{text:""},methods:{onNextPlayersTurn(){const e={"player-1s-turn":1,"player-2s-turn":2,"player-3s-turn":3,"player-4s-turn":4,"player-5s-turn":5,"player-6s-turn":6}[this.state];if(e===void 0)throw new Error("Invalid game state");this.text=`It is player ${e}'s turn`},onReset(){this.text="It is player 1's turn"}}}),mt=ie({init:"take-up-to-3-actions",transitions:[{name:"do-next-thing",from:"take-up-to-3-actions",to:"draw-2-treasure-deck-cards"},{name:"do-next-thing",from:"draw-2-treasure-deck-cards",to:"draw-flood-cards"},{name:"do-next-thing",from:"draw-flood-cards",to:"final-state"},{name:"reset",from:"*",to:"take-up-to-3-actions"}],data:{text:""},methods:{onDoNextThing(){switch(this.state){case"take-up-to-3-actions":this.text="Take up to 3 actions";break;case"draw-2-treasure-deck-cards":this.text="Draw 2 Treasure deck cards";break;case"draw-flood-cards":this.text="Draw Flood cards equal to the water level";break;case"final-state":break;default:throw new Error("Invalid turn state")}},onReset(){this.text="Take up to 3 actions"}}});function er(t,e=`
`){const n={};for(const r of t)n[r.name]===void 0?n[r.name]=1:++n[r.name];const i=[];for(const[r,s]of Object.entries(n))i.push(`${s} x ${r}`);return i.join(e)}ee(Ri);const qt=$t.shuffle({deck:ze.filter(({type:t})=>t==="treasure"),random:te}),nr=36.75,ir="0.0.49",Ne={hours:nr,version:ir};async function rr(){const{canvas:t,context:e}=on();t.width=at,t.height=ft;const n=Ji(t);n(),window.addEventListener("resize",n),Cn();const i=`v${Ne.version}`,r=`${Ne.hours}h`,s=ce({text:`${i}
${r}`,font:`${E/4}px Courier`,color:Jt,x:at-J/4*Math.max(i.length,r.length),y:E/4}),o=ce({font:`${E/4}px Arial`,color:Jt,x:J/4,y:E/4});await Gi();const a=await ji();if(a===null)return 1;a.sx=(J*8-at)/2,a.sy=(E*8-ft)/2;const l=()=>{const{y:m}=Mn();if(m<E){let x=a.sy-E;x=pt(0,a.mapheight-E-1,x),a.sy=x}else if(m>ft-E-1){let x=a.sy+E;x=pt(0,a.mapheight-E-1,x),a.sy=x}},h=()=>{_(),o.text=[V.text,`(${V.state})`,"",X.text,`(${X.state})`].join(`
`)};a.onDown=h,B(a);const c=Xi();c.onDown=h,B(c);const d=zi(),f=m=>{d.x=m.x,d.y=m.y,m.radius?(d.radius=m.radius,d.width=d.height=void 0):(d.width=m.width,d.height=m.height,d.radius=void 0)},_=()=>{d.width=d.height=d.radius=void 0},u=Ui(),b=a.layers.find(({name:m})=>m==="ground");if(b!==void 0){for(let m=0;m<a.height;++m)for(let x=0;x<a.width;++x)if(b.data[m*a.width+x]!==0){const v=Vi.draw(),G=u[v.id-1];G.x=x*G.width,G.y=m*G.height,G.onDown=()=>{l();let U=v.name;if(G.flooded&&(U+=`
FLOODED!`),v.adventurer!==void 0)switch(v.adventurer){case Ft:U+=`
(Diver)`;break;case Lt:U+=`
(Engineer)`;break;case Ot:U+=`
(Explorer)`;break;case Pt:U+=`
(Messenger)`;break;case Rt:U+=`
(Navigator)`;break;case It:U+=`
(Pilot)`}if(v.treasure!==void 0)switch(v.treasure){case Kt:U+=`
(The Crystal of Fire)`;break;case Yt:U+=`
(The Earth Stone)`;break;case Vt:U+=`
(The Ocean's Chalice)`;break;case Xt:U+=`
(The Statue of the Wind)`}f(G),o.text=U},B(G),a.add(G)}}const{theCrystalOfFire:g,theEarthStone:w,theOceansChalice:y,theStatueOfTheWind:F}=Yi();w.x=u[0].width+(u[0].width-w.width)/2,w.y=u[0].height+(u[0].height-w.height)/2,w.onDown=()=>{f(w),o.text="The Earth Stone"},B(w),a.add(w),F.x=u[0].width+(u[0].width-F.width)/2,F.y=u[0].height*6+(u[0].height-F.height)/2,F.onDown=()=>{f(F),o.text="The Statue of the Wind"},B(F),a.add(F),g.x=u[0].width*6+(u[0].width-g.width)/2,g.y=u[0].height+(u[0].height-g.height)/2,g.onDown=()=>{f(g),o.text="The Crystal of Fire"},B(g),a.add(g),y.x=u[0].width*6+(u[0].width-y.width)/2,y.y=u[0].height*6+(u[0].height-y.height)/2,y.onDown=()=>{f(y),o.text="The Ocean's Chalice"},B(y),a.add(y);const k={...Bi},L=[];for(let m=0;m<6;++m){const x=k.draw(),v=u.find(({id:G})=>G===x.id);v.flooded=!0,v.playAnimation(`${v.id-1}-flooded`),L.push(x)}const R=$t.shuffle({deck:[]});R.putOnTopOfDeck(L);const I=[];for(let m=0;m<Ii;++m)I.push({name:`Player ${m+1}`,adventurerCard:$i.draw(),cards:[]});const z=m=>()=>{f(m);const x=I.find(({adventurerCard:G})=>G.id===m.id);if(x===void 0)return;const v=`${x.name}: ${x.adventurerCard.name}
Cards:
${er(x.cards)}`;o.text=v},{diverPawn:W,engineerPawn:A,explorerPawn:T,messengerPawn:M,navigatorPawn:S,pilotPawn:q}=qi();for(const m of u){const x=xt.find(({id:v})=>v===m.id);if(x!==void 0&&!(x.adventurer!==void 0&&!I.map(({adventurerCard:v})=>v.id).includes(x.adventurer)))switch(x.adventurer){case Ft:W.x=m.x+(J-N*2)/2,W.y=m.y+(E-N*2)/2,W.onDown=z(W),B(W),a.add(W);break;case Lt:A.x=m.x+(J-N*2)/2,A.y=m.y+(E-N*2)/2,A.onDown=z(A),B(A),a.add(A);break;case Ot:T.x=m.x+(J-N*2)/2,T.y=m.y+(E-N*2)/2,T.onDown=z(T),B(T),a.add(T);break;case Pt:M.x=m.x+(J-N*2)/2,M.y=m.y+(E-N*2)/2,M.onDown=z(M),B(M),a.add(M);break;case Rt:S.x=m.x+(J-N*2)/2,S.y=m.y+(E-N*2)/2,S.onDown=z(S),B(S),a.add(S);break;case It:q.x=m.x+(J-N*2)/2,q.y=m.y+(E-N*2)/2,q.onDown=z(q),B(q),a.add(q);break}}a.add(d),qt.deal(2,I.map(({cards:m})=>m));for(const m of I){let x=m.cards.filter(({name:v})=>v==="Waters Rise!").length;for(;x>0;){console.log("Waters Rise! Replacement card required");for(let v=0;v<m.cards.length;++v)if(m.cards[v].name==="Waters Rise!"){const G=m.cards[v],U=qt.draw();m.cards[v]=U,qt.putOnTopOfDeck(G),qt.shuffle()}x=m.cards.filter(({name:v})=>v==="Waters Rise!").length}}const Y=Ki();Y.onDown=()=>{_(),V.nextPlayersTurn(),o.text=[`Water level: ${Y.waterLevel}`,"",V.text,`(${V.state})`,"",mt.text,`(${mt.state})`].join(`
`)},B(Y);const{drawFloodCard:C,endTurn:it,finishTakingActions:lt,menu:Tt,takeAction:St}=Wi();St.onDown=()=>{["no-actions-taken","one-action-taken","two-actions-taken"].includes(X.state)&&X.takeAction(),X.state==="three-actions-taken"&&(St.disabled=!0,lt.disabled=!0,C.disabled=!1),o.text=["Taking action...","",X.text,`(${X.state})`].join(`
`)},lt.onDown=()=>{["no-actions-taken","one-action-taken","two-actions-taken","three-actions-taken"].includes(X.state)&&(X.finishTakingActions(),C.disabled=!1),St.disabled=!0,lt.disabled=!0,o.text=["Finished taking actions","",X.text,`(${X.state})`].join(`
`)},C.onDown=()=>{if(C.disabled===!0)return;tt.drawACard(),console.log("floodDrawPile.cards",k.cards),console.log("floodDiscardPile.cards",R.cards),k.cards.length===0&&(console.log("Flood draw pile has run out"),console.log("Resetting..."),k.reset(),R.reset(),console.log("floodDrawPile.cards",k.cards),console.log("floodDiscardPile.cards",R.cards));const m=k.draw(),x=u.find(({id:G})=>G===m.id);x.flooded=!0,x.playAnimation(`${x.id-1}-flooded`),R.putOnTopOfDeck([m]);const{cardsToDraw:v}=_t[Y.waterLevel];(v===2&&tt.state==="two-cards-drawn"||v===3&&tt.state==="three-cards-drawn"||v===4&&tt.state==="four-cards-drawn"||v===5&&tt.state==="five-cards-drawn")&&(C.disabled=!0,it.disabled=!1),o.text=[`Flood card drawn: ${m.name}`,"",tt.text,`(${tt.state})`].join(`
`)};const ht=m=>{const x=[W,A,T,M,S,q].find(({id:v})=>v===I[m].adventurerCard.id);x!==void 0&&f(x)};it.onDown=()=>{if(it.disabled!==!0){switch(V.nextPlayersTurn(),V.state){case"player-1s-turn":ht(0);break;case"player-2s-turn":ht(1);break;case"player-3s-turn":ht(2);break;case"player-4s-turn":ht(3);break;case"player-5s-turn":ht(4);break;case"player-6s-turn":ht(5)}mt.reset(),X.reset(),tt.reset(),St.disabled=!1,lt.disabled=!1,C.disabled=!0,it.disabled=!0,o.text=["Turn ended","",V.text,`(${V.state})`].join(`
`)}};for(let m=0;m<Tt.children.length;++m)B(Tt.children[m]);return V.reset(),mt.reset(),X.reset(),tt.reset(),C.disabled=!0,it.disabled=!0,ht(0),(()=>{o.text=[I.map(({name:m,adventurerCard:x})=>`${m}: ${x.name}`).join(`
`),"",V.text,`(${V.state})`,"",mt.text,`(${mt.state})`].join(`
`)})(),Fn({render(){c.render(),a.render(),Y.render(),Tt.render(),e.fillStyle="rgba(0, 0, 0, 0.67)",e.fillRect(s.x,s.y,s.width,s.height),s.render(),e.fillStyle="rgba(0, 0, 0, 0.67)",e.fillRect(o.x,o.y,o.width,o.height),o.render()},update(){}}).start(),0}rr();
