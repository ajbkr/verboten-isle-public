(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const h of r.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function i(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=i(n);fetch(n.href,r)}})();/**
 * @preserve
 * Kontra.js v10.0.2
 */function Qt(e,t){let i=Math.sin(t),s=Math.cos(t);return{x:e.x*s-e.y*i,y:e.x*i+e.y*s}}function W(e,t,i){return Math.min(Math.max(e,i),t)}function Lt(e){let{x:t=0,y:i=0,width:s,height:n,radius:r}=e.world||e;return e.mapwidth&&(s=e.mapwidth,n=e.mapheight),r&&(s=r.x*2,n=r.y*2),e.anchor&&(t-=s*e.anchor.x,i-=n*e.anchor.y),s<0&&(t+=s,s*=-1),n<0&&(i+=n,n*=-1),{x:t,y:i,width:s,height:n}}let K=()=>{};function Pt(e,t){let i=e.indexOf(t);if(i!=-1)return e.splice(i,1),!0}function Vt(e,t){let{x:i,y:s,width:n,height:r}=Lt(t);do i-=t.sx||0,s-=t.sy||0;while(t=t.parent);let h=e.x-Math.max(i,Math.min(e.x,i+n)),a=e.y-Math.max(s,Math.min(e.y,s+r));return h*h+a*a<e.radius*e.radius}let B={};function X(e,t){B[e]=B[e]||[],B[e].push(t)}function T(e,...t){(B[e]||[]).map(i=>i(...t))}let C,z,xt={get(e,t){return t=="_proxy"?!0:K}};function R(){return C}function v(){return z}function Zt(e,{contextless:t=!1}={}){if(C=document.getElementById(e)||e||document.querySelector("canvas"),t&&(C=C||new Proxy({},xt)),!C)throw Error("You must provide a canvas element for the game");return z=C.getContext("2d")||new Proxy({},xt),z.imageSmoothingEnabled=!1,T("init"),{canvas:C,context:z}}class ot{constructor({spriteSheet:t,frames:i,frameRate:s,loop:n=!0,name:r}){let{width:h,height:a,spacing:l=0,margin:o=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:i,frameRate:s,loop:n,name:r,width:h,height:a,spacing:l,margin:o,isStopped:!1,_f:0,_a:0})}clone(){return new ot(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped){if(!this.loop&&this._f==this.frames.length-1){this.stop();return}for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}}render({x:t,y:i,width:s=this.width,height:n=this.height,context:r=v()}){let h=this.frames[this._f]/this.spriteSheet._f|0,a=this.frames[this._f]%this.spriteSheet._f|0;r.drawImage(this.spriteSheet.image,this.margin+a*this.width+(a*2+1)*this.spacing,this.margin+h*this.height+(h*2+1)*this.spacing,this.width,this.height,t,i,s,n)}}function jt(){return new ot(...arguments)}let te=/(jpeg|jpg|gif|png|webp)$/,ee=/(wav|mp3|ogg|aac)$/,ie=/^\//,se=/\/$/,Mt=new WeakMap,ne="",re="",he="";function j(e,t){return new URL(e,t).href}function lt(e,t){return[e.replace(se,""),t].filter(i=>i).join("/")}function dt(e){return e.split(".").pop()}function ct(e){let t=e.replace("."+dt(e),"");return t.split("/").length==2?t.replace(ie,""):t}function ae(e){return{wav:e.canPlayType('audio/wav; codecs="1"'),mp3:e.canPlayType("audio/mpeg;"),ogg:e.canPlayType('audio/ogg; codecs="vorbis"'),aac:e.canPlayType("audio/aac;")}}let b={},I={},D={};function ut(){window.__k||(window.__k={dm:Mt,u:j,d:D,i:b})}function oe(e){return ut(),new Promise((t,i)=>{let s,n,r;if(s=lt(ne,e),b[s])return t(b[s]);n=new Image,n.onload=function(){r=j(s,window.location.href),b[ct(e)]=b[s]=b[r]=this,T("assetLoaded",this,e),t(this)},n.onerror=function(){i("Unable to load image "+s)},n.src=s})}function le(e){return new Promise((t,i)=>{let s=e,n,r,h,a;if(n=new Audio,r=ae(n),e=[].concat(e).reduce((l,o)=>l||(r[dt(o)]?o:null),0),!e)return i("cannot play any of the audio formats provided "+s);if(h=lt(re,e),I[h])return t(I[h]);n.addEventListener("canplay",function(){a=j(h,window.location.href),I[ct(e)]=I[h]=I[a]=this,T("assetLoaded",this,e),t(this)}),n.onerror=function(){i("Unable to load audio "+h)},n.src=h,n.load()})}function de(e){ut();let t,i;return t=lt(he,e),D[t]?Promise.resolve(D[t]):fetch(t).then(s=>{if(!s.ok)throw s;return s.clone().json().catch(()=>s.text())}).then(s=>(i=j(t,window.location.href),typeof s=="object"&&Mt.set(s,i),D[ct(e)]=D[t]=D[i]=s,T("assetLoaded",s,e),s))}function ce(...e){return ut(),Promise.all(e.map(t=>{let i=dt([].concat(t)[0]);return i.match(te)?oe(t):i.match(ee)?le(t):de(t)}))}class L{constructor(t=0,i=0,s={}){t.x!=null?(this.x=t.x,this.y=t.y):(this.x=t,this.y=i),s._c&&(this.clamp(s._a,s._b,s._d,s._e),this.x=t,this.y=i)}set(t){this.x=t.x,this.y=t.y}add(t){return new L(this.x+t.x,this.y+t.y,this)}subtract(t){return new L(this.x-t.x,this.y-t.y,this)}scale(t){return new L(this.x*t,this.y*t)}normalize(t=this.length()||1){return new L(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,i,s,n){this._c=!0,this._a=t,this._b=i,this._d=s,this._e=n}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?W(this._a,this._d,t):t}set y(t){this._y=this._c?W(this._b,this._e,t):t}}function it(){return new L(...arguments)}class ue{constructor(t){return this.init(t)}init(t={}){this.position=it(),this.velocity=it(),this.acceleration=it(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let i=this.acceleration;t&&(i=i.scale(t)),this.velocity=this.velocity.add(i);let s=this.velocity;t&&(s=s.scale(t)),this.position=this.position.add(s),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}class Ht extends ue{init({width:t=0,height:i=0,context:s=v(),render:n=this.draw,update:r=this.advance,children:h=[],anchor:a={x:0,y:0},opacity:l=1,rotation:o=0,drotation:u=0,ddrotation:d=0,scaleX:c=1,scaleY:w=1,...f}={}){this._c=[],super.init({width:t,height:i,context:s,anchor:a,opacity:l,rotation:o,drotation:u,ddrotation:d,scaleX:c,scaleY:w,...f}),this._di=!0,this._uw(),this.addChild(h),this._rf=n,this._uf=r,X("init",()=>{this.context??(this.context=v())})}update(t){this._uf(t),this.children.map(i=>i.update&&i.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let i=this.width,s=this.height;this.radius&&(i=s=this.radius*2);let n=-i*this.anchor.x,r=-s*this.anchor.y;(n||r)&&t.translate(n,r),this.context.globalAlpha=this.opacity,this._rf(),(n||r)&&t.translate(-n,-r),this.children.map(a=>a.render&&a.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:i=0,_wo:s=1,_wrot:n=0,_wsx:r=1,_wsy:h=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this.radius&&(this._wrx=this.radius,this._wry=this.radius),this._wo=s*this.opacity,this._wsx=r*this.scaleX,this._wsy=h*this.scaleY,this._wx=this._wx*r,this._wy=this._wy*h,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this.radius&&(this._wrx=this.radius*this._wsx,this._wry=this.radius*this._wsy),this._wrot=n+this.rotation;let{x:a,y:l}=Qt({x:this._wx,y:this._wy},n);this._wx=a,this._wy=l,this._wx+=t,this._wy+=i}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,radius:this.radius?{x:this._wrx,y:this._wry}:void 0,opacity:this._wo,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(i=>{this.children.push(i),i.parent=this,i._pc=i._pc||K,i._pc()})}removeChild(...t){t.flat().map(i=>{Pt(this.children,i)&&(i.parent=null,i._pc())})}get radius(){return this._r}set radius(t){this._r=t,this._pc()}get opacity(){return this._opa}set opacity(t){this._opa=W(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}advance(t){super.advance(t),this.drotation+=this.ddrotation,this.rotation+=this.drotation}setScale(t,i=t){this.scaleX=t,this.scaleY=i}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class fe extends Ht{init({image:t,width:i=t?t.width:void 0,height:s=t?t.height:void 0,...n}={}){super.init({image:t,width:i,height:s,...n})}get animations(){return this._a}set animations(t){let i,s;this._a={};for(i in t)this._a[i]=t[i].clone(),s=s||this._a[i];this.currentAnimation=s,this.width=this.width||s.width,this.height=this.height||s.height}playAnimation(t){var i;(i=this.currentAnimation)==null||i.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){var i;super.advance(t),(i=this.currentAnimation)==null||i.update(t)}draw(){if(this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color){if(this.context.fillStyle=this.color,this.radius){this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.context.fill();return}this.context.fillRect(0,0,this.width,this.height)}}}function P(){return new fe(...arguments)}let we=/(\d+)(\w+)/;function ge(e){if(!e)return{computed:0};let t=e.match(we),i=+t[1],s=t[2];return{size:i,unit:s,computed:i}}class pe extends Ht{init({text:t="",textAlign:i="",lineHeight:s=1,font:n=(h=>(h=v())==null?void 0:h.font)(),...r}={}){t=""+t,super.init({text:t,textAlign:i,lineHeight:s,font:n,...r}),this.context&&this._p(),X("init",()=>{this.font??(this.font=v().font),this._p()})}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=ge(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context,i=[this.text];if(t.font=this.font,i=this.text.split(`
`),this._fw&&i.map(s=>{let n=s.split(" "),r=n.shift(),h=r;n.map(a=>{h+=" "+a,t.measureText(h).width>this._fw&&(this._s.push(r),h=a),r=h}),this._s.push(h)}),!this._s.length&&this.text.includes(`
`)){let s=0;i.map(n=>{this._s.push(n),s=Math.max(s,t.measureText(n).width)}),this._w=this._fw||s}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,i=this.textAlign,s=this.context;i=this.textAlign||(s.canvas.dir=="rtl"?"right":"left"),t=i=="right"?this.width:i=="center"?this.width/2|0:0,this._s.map((n,r)=>{s.textBaseline="top",s.textAlign=i,s.fillStyle=this.color,s.font=this.font,this.strokeColor&&(s.strokeStyle=this.strokeColor,s.lineWidth=this.lineWidth??1,s.strokeText(n,t,this._fs*this.lineHeight*r)),s.fillText(n,t,this._fs*this.lineHeight*r)})}}function Et(){return new pe(...arguments)}let U=new WeakMap,vt={},ft={},It={0:"left",1:"middle",2:"right"};function me(e){let t=e._lf.length?e._lf:e._cf;for(let i=t.length-1;i>=0;i--){let s=t[i];if(s.collidesWithPointer?s.collidesWithPointer(e):Vt(e,s))return s}}function y(e,t){return parseFloat(e.getPropertyValue(t))||0}function _e(e){let{canvas:t,_s:i}=e,s=t.getBoundingClientRect(),n=i.transform!="none"?i.transform.replace("matrix(","").split(","):[1,1,1,1],r=parseFloat(n[0]),h=parseFloat(n[3]),a=(y(i,"border-left-width")+y(i,"border-right-width"))*r,l=(y(i,"border-top-width")+y(i,"border-bottom-width"))*h,o=(y(i,"padding-left")+y(i,"padding-right"))*r,u=(y(i,"padding-top")+y(i,"padding-bottom"))*h;return{scaleX:(s.width-a-o)/t.width,scaleY:(s.height-l-u)/t.height,offsetX:s.left+(y(i,"border-left-width")+y(i,"padding-left"))*r,offsetY:s.top+(y(i,"border-top-width")+y(i,"padding-top"))*h}}function St(e){let t=e.button!=null?It[e.button]:"left";ft[t]=!0,wt(e,"onDown")}function st(e){let t=e.button!=null?It[e.button]:"left";ft[t]=!1,wt(e,"onUp")}function bt(e){wt(e,"onOver")}function ye(e){let t=U.get(e.target);t._oo=null,ft={}}function Ct(e,t,i){let s=me(e);s&&s[t]&&s[t](i),vt[t]&&vt[t](i,s),t=="onOver"&&(s!=e._oo&&e._oo&&e._oo.onOut&&e._oo.onOut(i),e._oo=s)}function wt(e,t){e.preventDefault();let i=e.target,s=U.get(i),{scaleX:n,scaleY:r,offsetX:h,offsetY:a}=_e(s);e.type.includes("touch")?(Array.from(e.touches).map(({clientX:o,clientY:u,identifier:d})=>{let c=s.touches[d];c||(c=s.touches[d]={start:{x:(o-h)/n,y:(u-a)/r}},s.touches.length++),c.changed=!1}),Array.from(e.changedTouches).map(({clientX:o,clientY:u,identifier:d})=>{let c=s.touches[d];c.changed=!0,c.x=s.x=(o-h)/n,c.y=s.y=(u-a)/r,Ct(s,t,e),T("touchChanged",e,s.touches),t=="onUp"&&(delete s.touches[d],s.touches.length--,s.touches.length||T("touchEnd"))})):(s.x=(e.clientX-h)/n,s.y=(e.clientY-a)/r,Ct(s,t,e))}function xe({radius:e=5,canvas:t=R()}={}){let i=U.get(t);if(!i){let s=window.getComputedStyle(t);i={x:0,y:0,radius:e,touches:{length:0},canvas:t,_cf:[],_lf:[],_o:[],_oo:null,_s:s},U.set(t,i)}return t.addEventListener("mousedown",St),t.addEventListener("touchstart",St),t.addEventListener("mouseup",st),t.addEventListener("touchend",st),t.addEventListener("touchcancel",st),t.addEventListener("blur",ye),t.addEventListener("mousemove",bt),t.addEventListener("touchmove",bt),i._t||(i._t=!0,X("tick",()=>{i._lf.length=0,i._cf.map(s=>{i._lf.push(s)}),i._cf.length=0})),i}function O(...e){e.flat().map(t=>{let i=t.context?t.context.canvas:R(),s=U.get(i);if(!s)throw new ReferenceError("Pointer events not initialized for the objects canvas");t.__r||(t.__r=t.render,t.render=function(){s._cf.push(this),this.__r()},s._o.push(t))})}function Ee(e){let t=e.canvas;e.clearRect(0,0,t.width,t.height)}function ve({fps:e=60,clearCanvas:t=!0,update:i=K,render:s,context:n=v(),blur:r=!1}={}){if(!s)throw Error("You must provide a render() function");let h=0,a=1e3/e,l=1/e,o=t?Ee:K,u,d,c,w,f,p=!0;r||(window.addEventListener("focus",()=>{p=!0}),window.addEventListener("blur",()=>{p=!1})),X("init",()=>{f.context??(f.context=v())});function g(){if(d=requestAnimationFrame(g),!!p&&(c=performance.now(),w=c-u,u=c,!(w>1e3))){for(h+=w;h>=a;)T("tick"),f.update(l),h-=a;o(f.context),f.render()}}return f={update:i,render:s,isStopped:!0,context:n,start(){this.isStopped&&(u=performance.now(),this.isStopped=!1,requestAnimationFrame(g))},stop(){this.isStopped=!0,cancelAnimationFrame(d)},_frame:g,set _last(_){u=_}},f}let S;function Se(){S??(S=Date.now()),S|=0,S=S+2654435769|0;let e=S^S>>>16;return e=Math.imul(e,569420461),e=e^e>>>15,e=Math.imul(e,1935289751),((e=e^e>>>15)>>>0)/4294967296}function be(e=Date.now()){if(S=e,typeof e=="string"){for(var t=0,i=1779033703^e.length;t<e.length;t++)i=Math.imul(i^e.charCodeAt(t),3432918353),i=i<<13|i>>>19;i=Math.imul(i^i>>>16,2246822507),i=Math.imul(i^i>>>13,3266489909),S=(i^=i>>>16)>>>0}}function Ce(e){if(+e==e)return e;let t=[],i=e.split(".."),s=+i[0],n=+i[1],r=s;if(s<n)for(;r<=n;r++)t.push(r);else for(;r>=n;r--)t.push(r);return t}class Te{constructor({image:t,frameWidth:i,frameHeight:s,spacing:n=0,margin:r=0,animations:h}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:i,height:s,spacing:n,margin:r},this._f=(t.width-r)/i|0,this.createAnimations(h)}createAnimations(t){let i,s;for(s in t){let{frames:n,frameRate:r,loop:h}=t[s];if(i=[],n==null)throw Error("Animation "+s+" must provide a frames property");[].concat(n).map(a=>{i=i.concat(Ce(a))}),this.animations[s]=jt({spriteSheet:this,frames:i,frameRate:r,loop:h,name:s})}}}function Ae(){return new Te(...arguments)}let ke=2147483648,Oe=1073741824,Tt=536870912;function F(e,t){return e/t|0}function Y(e,t){return e/t|0}class De{constructor(t={}){let{width:i,height:s,tilewidth:n,tileheight:r,tilesets:h}=t,a=i*n,l=s*r,o=document.createElement("canvas");o.width=a,o.height=l,this._c=o,this._ctx=o.getContext("2d"),h.map(u=>{let{__k:d,location:c}=window,w=(d?d.dm.get(t):"")||c.href,{source:f}=u;if(f){if(!d)throw Error('You must use "load" or "loadData" to resolve tileset.source');let g=d.d[d.u(f,w)];if(!g)throw Error(`You must load the tileset source "${f}" before loading the tileset`);Object.keys(g).map(_=>{u[_]=g[_]})}let{image:p}=u;if(""+p===p){if(!d)throw Error('You must use "load" or "loadImage" to resolve tileset.image');let g=d.i[d.u(p,w)];if(!g)throw Error(`You must load the image "${p}" before loading the tileset`);u.image=g}}),Object.assign(this,{context:v(),layerMap:{},layerCanvases:{},mapwidth:a,mapheight:l,_sx:0,_sy:0,_o:[],...t}),this.context&&this._p(),X("init",()=>{this.context??(this.context=v()),this._p()})}get sx(){return this._sx}get sy(){return this._sy}set sx(t){let i=Math.max(0,this.mapwidth-R().width);this._sx=W(0,i,t)}set sy(t){let i=Math.max(0,this.mapheight-R().height);this._sy=W(0,i,t)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map(i=>{this._o.push(i),i.parent=this})}remove(...t){t.flat().map(i=>{Pt(this._o,i),i.parent=null})}getPosition(t){let i=R().getBoundingClientRect(),s=t.x-i.x,n=t.y-i.y;return s+=this.sx,n+=this.sy,{x:s,y:n,row:F(n,this.tileheight),col:Y(s,this.tilewidth)}}setTileAtLayer(t,i,s){let{layerMap:n,tileheight:r,tilewidth:h,width:a}=this,{row:l,col:o,x:u,y:d}=i,c=l??F(d,r),w=o??Y(u,h);n[t]&&(this._d=!0,n[t]._d=!0,n[t].data[c*a+w]=s)}setLayer(t,i){let{layerMap:s}=this;s[t]&&(this._d=!0,s[t]._d=!0,s[t].data=i)}layerCollidesWith(t,i){let{tilewidth:s,tileheight:n,layerMap:r}=this,{x:h,y:a,width:l,height:o}=Lt(i),u=F(a,n),d=Y(h,s),c=F(a+o,n),w=Y(h+l,s),f=r[t];for(let p=u;p<=c;p++)for(let g=d;g<=w;g++)if(f.data[g+p*this.width])return!0;return!1}tileAtLayer(t,i){let{layerMap:s,tileheight:n,tilewidth:r,width:h}=this,{row:a,col:l,x:o,y:u}=i,d=a??F(u,n),c=l??Y(o,r);return s[t]?s[t].data[d*h+c]:-1}render(t=this._c,i=!0){let{_d:s,context:n,sx:r=0,sy:h=0}=this;s&&this._p();let{width:a,height:l}=R(),o=Math.min(t.width,a),u=Math.min(t.height,l);n.drawImage(t,r,h,o,u,0,0,o,u),i&&(n.save(),(r||h)&&n.translate(-r,-h),this.objects.map(d=>d.render&&d.render()),n.restore())}renderLayer(t){let{layerCanvases:i,layerMap:s}=this,n=s[t],r=i[t],h=r==null?void 0:r.getContext("2d");if(!r){let{mapwidth:a,mapheight:l}=this;r=document.createElement("canvas"),h=r.getContext("2d"),r.width=a,r.height=l,i[t]=r,this._rl(n,h)}n._d&&(n._d=!1,h.clearRect(0,0,r.width,r.height),this._rl(n,h)),this.render(r,!1)}_p(){let{_ctx:t,layers:i=[],layerMap:s}=this;this._d=!1,i.map(n=>{let{name:r,data:h,visible:a}=n;n._d=!1,s[r]=n,h&&a!=!1&&this._rl(n,t)})}_rl(t,i){let{opacity:s,data:n=[]}=t,{tilesets:r,width:h,tilewidth:a,tileheight:l}=this;i.save(),i.globalAlpha=s,n.map((o,u)=>{if(!o)return;let d=0,c=0,w=o&ke,f=o&Oe,p=0,g=0,_=0,x=0,E=0;d=w||f,o&=1073741823,E=o&Tt,E&&(w&&f?_=1:w?p=1:f?g=1:x=1,c=p||g||_||x,o&=~Tt);let m;for(let et=r.length-1;et>=0&&(m=r[et],!(o/m.firstgid>=1));et--);let{image:pt,spacing:tt=0,margin:mt=0,firstgid:Bt,columns:zt}=m,_t=o-Bt,yt=zt??pt.width/(a+tt)|0,A=u%h*a,k=(u/h|0)*l,Kt=mt+_t%yt*(a+tt),Jt=mt+(_t/yt|0)*(l+tt);c?(i.save(),i.translate(A+a/2,k+l/2),g||x?i.rotate(-Math.PI/2):(p||_)&&i.rotate(Math.PI/2),(_||x)&&i.scale(-1,1),A=-a/2,k=-l/2):d&&(i.save(),i.translate(A+(w?a:0),k+(f?l:0)),i.scale(w?-1:1,f?-1:1),A=d?0:A,k=d?0:k),i.drawImage(pt,Kt,Jt,a,l,A,k,a,l),(d||c)&&i.restore()}),i.restore()}}function Re(){return new De(...arguments)}const Ft=1,Yt=2,$t=3,Wt=4,Ut=5,Gt=6,Xt=""+new URL("spritesheet-BP7Xv-Vg.png",import.meta.url).href,qt=""+new URL("tilesheet-C_zpU0l5.png",import.meta.url).href,Le=[Xt,qt],Pe=e=>ce(...Le),H=2,$=640*H,gt=320*H,Me="verboten-isle",G=32*H,M=32*H,q=24*H,N=24*H,He="aqua",J=1,Q=2,V=3,Z=4,Nt=[{id:1,name:"Fools' Landing",flooded:!1,adventurer:Gt},{id:2,name:"Cave of Shadows",flooded:!1,treasure:V},{id:3,name:"Temple of the Moon",flooded:!1,treasure:J},{id:4,name:"Copper Gate",flooded:!1,adventurer:$t},{id:5,name:"Whispering Garden",flooded:!1,treasure:Q},{id:6,name:"Dunes of Deception",flooded:!1},{id:7,name:"Silver Gate",flooded:!1,adventurer:Wt},{id:8,name:"Observatory",flooded:!1},{id:9,name:"Breakers Bridge",flooded:!1},{id:10,name:"Twilight Hollow",flooded:!1},{id:11,name:"Lost Lagoon",flooded:!1},{id:12,name:"Bronze Gate",flooded:!1,adventurer:Yt},{id:13,name:"Phantom Rock",flooded:!1},{id:14,name:"Watchtower",flooded:!1},{id:15,name:"Cliffs of Abandon",flooded:!1},{id:16,name:"Misty Marsh",flooded:!1},{id:17,name:"Coral Palace",flooded:!1,treasure:Z},{id:18,name:"Howling Garden",flooded:!1,treasure:Q},{id:19,name:"Iron Gate",flooded:!1,adventurer:Ft},{id:20,name:"Gold Gate",flooded:!1,adventurer:Ut},{id:21,name:"Crimson Forest",flooded:!1},{id:22,name:"Temple of the Sun",flooded:!1,treasure:J},{id:23,name:"Cave of Embers",flooded:!1,treasure:V},{id:24,name:"Tidal Palace",flooded:!1,treasure:Z}];function Ie(){const e=Ae({image:b[Xt],frameWidth:G,frameHeight:M,animations:Nt.map((i,s)=>({[s]:{frames:s,frameRate:1}})).reduce((i,s)=>({...i,...s}))}),t=[];for(let i=0;i<Object.keys(e.animations).length;++i){const s=P({x:i*G,y:0,animations:e.animations,id:1+i});s.playAnimation(i),t.push(s)}return t}async function Fe(){try{const e=b[qt];return Re({tilewidth:G,tileheight:M,width:8,height:8,tilesets:[{firstgid:0,image:e}],layers:[{name:"ground",data:[0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,0,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0]}]})}catch(e){return console.error(e),null}}function Ye(){const e=P({color:"brown",width:q,height:N,id:J}),t=P({color:"yellow",width:q,height:N,id:Q}),i=P({color:"red",width:q,height:N,id:V}),s=P({color:"blue",width:q,height:N,id:Z});return{theCrystalOfFire:i,theEarthStone:e,theOceansChalice:s,theStatueOfTheWind:t}}function $e(){return P({x:0,y:0,color:He,width:$,height:gt})}function We(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var nt={exports:{}},rt,At;function Ue(){return At||(At=1,rt=function(e,t){this.reset=function(){this.cards=e.slice(0),this.length=this.cards.length},this.shuffle=function(){i(this.cards)},this.reset(),this.shuffle(),this.deal=function(s,n){for(var r=0;r<s;r++)for(var h=0;h<n.length;h++){if(!n[h]||!n[h].push)throw new Error("Deck#deal | Undefined Hand");n[h].push(this.cards.pop())}this.length=this.cards.length},this.draw=function(s){if(!s||s<=1)return this.length=this.cards.length-1,this.cards.pop();for(var n=[],r=0;r<s;r++)n.push(this.cards.pop());return this.length=this.cards.length,n},this.drawFromBottomOfDeck=function(s){(!s||s<1)&&(s=1);for(var n=[],r=0;r<s;r++)n.push(this.cards.shift());return this.length=this.cards.length,n.length===1?n[0]:n},this.drawRandom=function(s){var n=function(){var a=Math.floor(t()*this.cards.length),l=this.cards[a];return this.cards.splice(a,1),this.length=this.cards.length,l};if(!s||s<=1)return n.apply(this);for(var r=[],h=0;h<s;h++)r.push(n.apply(this));return r},this.putOnTopOfDeck=function(s){if(!s instanceof Array)this.cards.push(s);else for(var n=0;n<s.length;n++)this.cards.push(s[n]);this.length=this.cards.length},this.putOnBottomOfDeck=function(s){if(!s instanceof Array)this.cards.unshift(s);else for(var n=0;n<s.length;n++)this.cards.unshift(s[n]);this.length=this.cards.length};function i(s){var n=s.length;if(n===0)return!1;for(;--n;){var r=Math.floor(t()*(n+1)),h=s[n],a=s[r];s[n]=a,s[r]=h}}}),rt}var ht,kt;function Ge(){return kt||(kt=1,ht=function(e,t,i){this.suit=e,this.description=t,this.sort=i,this.toString=function(){return this.description+" of "+this.suit+"s"},this.toShortDisplayString=function(){var s=this.suit.substring(0,1),n;switch(this.sort){case 11:n="J";break;case 12:n="Q";break;case 13:n="K";break;case 14:n="A";break;default:n=this.sort}return n+s}}),ht}var at,Ot;function Xe(){if(Ot)return at;Ot=1;var e=Ge();return at=function(){this.cards=[new e("Club","Two",2),new e("Club","Three",3),new e("Club","Four",4),new e("Club","Five",5),new e("Club","Six",6),new e("Club","Seven",7),new e("Club","Eight",8),new e("Club","Nine",9),new e("Club","Ten",10),new e("Club","Jack",11),new e("Club","Queen",12),new e("Club","King",13),new e("Club","Ace",14),new e("Diamond","Two",2),new e("Diamond","Three",3),new e("Diamond","Four",4),new e("Diamond","Five",5),new e("Diamond","Six",6),new e("Diamond","Seven",7),new e("Diamond","Eight",8),new e("Diamond","Nine",9),new e("Diamond","Ten",10),new e("Diamond","Jack",11),new e("Diamond","Queen",12),new e("Diamond","King",13),new e("Diamond","Ace",14),new e("Heart","Two",2),new e("Heart","Three",3),new e("Heart","Four",4),new e("Heart","Five",5),new e("Heart","Six",6),new e("Heart","Seven",7),new e("Heart","Eight",8),new e("Heart","Nine",9),new e("Heart","Ten",10),new e("Heart","Jack",11),new e("Heart","Queen",12),new e("Heart","King",13),new e("Heart","Ace",14),new e("Spade","Two",2),new e("Spade","Three",3),new e("Spade","Four",4),new e("Spade","Five",5),new e("Spade","Six",6),new e("Spade","Seven",7),new e("Spade","Eight",8),new e("Spade","Nine",9),new e("Spade","Ten",10),new e("Spade","Jack",11),new e("Spade","Queen",12),new e("Spade","King",13),new e("Spade","Ace",14)]},at}var Dt;function qe(){if(Dt)return nt.exports;Dt=1;var e=Ue(),t=Xe(),i=nt.exports={},s={deck:new t().cards,numberOfDecks:1,random:function(){return Math.random()}};return i.playingCards=function(){return new t().cards},i.shuffle=function(n){if(n||(n=s),n.deck||(n.deck=s.deck),n.numberOfDecks)for(var r=n.deck,h=0;h<n.numberOfDecks-1;h++)n.deck=n.deck.concat(r);return n.random||(n.random=s.random),new e(n.deck,n.random)},nt.exports}var Ne=qe();const Be=We(Ne);be(Me);const ze=Be.shuffle({deck:Nt,random:Se});function Ke(e){return function(){const{innerWidth:t,innerHeight:i}=window,s=t/i,n=$/gt;s<n?(e.style.width=`${t}px`,e.style.height=`${t/n}px`):(e.style.width=`${i*n}px`,e.style.height=`${i}px`)}}const Je=15.75,Qe="0.0.18",Rt={hours:Je,version:Qe};async function Ve(){const{canvas:e,context:t}=Zt();e.width=$,e.height=gt;const i=Ke(e);i(),window.addEventListener("resize",i),xe();const s=`v${Rt.version}`,n=`${Rt.hours}h`,r=Et({text:`${s}
${n}`,font:`${M/4}px Courier`,color:"white",x:$-G/4*Math.max(s.length,n.length),y:M/4}),h=Et({font:`${M}px Arial`,color:"blue",x:$/2-G,y:M});await Pe();const a=await Fe();if(a===null)return 1;const l=$e();l.onDown=l.onOver=()=>{h.text=""},O(l);const o=Ie(),u=a.layers.find(({name:g})=>g==="ground");if(u!==void 0){for(let g=0;g<a.height;++g)for(let _=0;_<a.width;++_)if(u.data[g*a.width+_]!==0){const x=ze.draw(),E=o[x.id-1];E.x=_*E.width,E.y=g*E.height,E.onDown=E.onOver=()=>{let m=x.name;if(x.adventurer!==void 0)switch(x.adventurer){case Ft:m+=`
(Diver)`;break;case Yt:m+=`
(Engineer)`;break;case $t:m+=`
(Explorer)`;break;case Wt:m+=`
(Messenger)`;break;case Ut:m+=`
(Navigator)`;break;case Gt:m+=`
(Pilot)`}if(x.treasure!==void 0)switch(x.treasure){case V:m+=`
(The Crystal of Fire)`;break;case J:m+=`
(The Earth Stone)`;break;case Z:m+=`
(The Ocean's Chalice)`;break;case Q:m+=`
(The Statue of the Wind)`}h.text=m},O(E),a.add(E)}}const{theCrystalOfFire:d,theEarthStone:c,theOceansChalice:w,theStatueOfTheWind:f}=Ye();return c.x=o[0].width+(o[0].width-c.width)/2,c.y=o[0].height+(o[0].height-c.height)/2,c.onDown=c.onOver=()=>{h.text="The Earth Stone"},O(c),a.add(c),f.x=o[0].width+(o[0].width-f.width)/2,f.y=o[0].height*6+(o[0].height-f.height)/2,f.onDown=f.onOver=()=>{h.text="The Statue of the Wind"},O(f),a.add(f),d.x=o[0].width*6+(o[0].width-d.width)/2,d.y=o[0].height+(o[0].height-d.height)/2,d.onDown=d.onOver=()=>{h.text="The Crystal of Fire"},O(d),a.add(d),w.x=o[0].width*6+(o[0].width-w.width)/2,w.y=o[0].height*6+(o[0].height-w.height)/2,w.onDown=w.onOver=()=>{h.text="The Ocean's Chalice"},O(w),a.add(w),ve({render(){l.render(),a.render(),t.fillStyle="black",t.fillRect(r.x,r.y,r.width,r.height),r.render(),h.render()},update(){}}).start(),0}Ve();
