(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=e(s);fetch(s.href,a)}})();/**
 * @preserve
 * Kontra.js v10.0.2
 */function dt(r,t){let e=Math.sin(t),i=Math.cos(t);return{x:r.x*i-r.y*e,y:r.x*e+r.y*i}}function I(r,t,e){return Math.min(Math.max(r,e),t)}function ct(r){let{x:t=0,y:e=0,width:i,height:s,radius:a}=r.world||r;return r.mapwidth&&(i=r.mapwidth,s=r.mapheight),a&&(i=a.x*2,s=a.y*2),r.anchor&&(t-=i*r.anchor.x,e-=s*r.anchor.y),i<0&&(t+=i,i*=-1),s<0&&(e+=s,s*=-1),{x:t,y:e,width:i,height:s}}let Y=()=>{};function V(r,t){let e=r.indexOf(t);if(e!=-1)return r.splice(e,1),!0}let T={};function D(r,t){T[r]=T[r]||[],T[r].push(t)}function M(r,...t){(T[r]||[]).map(e=>e(...t))}let y,O,J={get(r,t){return t=="_proxy"?!0:Y}};function b(){return y}function x(){return O}function ft(r,{contextless:t=!1}={}){if(y=document.getElementById(r)||r||document.querySelector("canvas"),t&&(y=y||new Proxy({},J)),!y)throw Error("You must provide a canvas element for the game");return O=y.getContext("2d")||new Proxy({},J),O.imageSmoothingEnabled=!1,M("init"),{canvas:y,context:O}}class F{constructor({spriteSheet:t,frames:e,frameRate:i,loop:s=!0,name:a}){let{width:n,height:h,spacing:o=0,margin:l=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:e,frameRate:i,loop:s,name:a,width:n,height:h,spacing:o,margin:l,isStopped:!1,_f:0,_a:0})}clone(){return new F(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped){if(!this.loop&&this._f==this.frames.length-1){this.stop();return}for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}}render({x:t,y:e,width:i=this.width,height:s=this.height,context:a=x()}){let n=this.frames[this._f]/this.spriteSheet._f|0,h=this.frames[this._f]%this.spriteSheet._f|0;a.drawImage(this.spriteSheet.image,this.margin+h*this.width+(h*2+1)*this.spacing,this.margin+n*this.height+(n*2+1)*this.spacing,this.width,this.height,t,e,i,s)}}function ut(){return new F(...arguments)}let pt=/(jpeg|jpg|gif|png|webp)$/,mt=/(wav|mp3|ogg|aac)$/,wt=/^\//,gt=/\/$/,tt=new WeakMap,_t="",yt="",xt="";function $(r,t){return new URL(r,t).href}function W(r,t){return[r.replace(gt,""),t].filter(e=>e).join("/")}function N(r){return r.split(".").pop()}function X(r){let t=r.replace("."+N(r),"");return t.split("/").length==2?t.replace(wt,""):t}function Et(r){return{wav:r.canPlayType('audio/wav; codecs="1"'),mp3:r.canPlayType("audio/mpeg;"),ogg:r.canPlayType('audio/ogg; codecs="vorbis"'),aac:r.canPlayType("audio/aac;")}}let _={},P={},v={};function q(){window.__k||(window.__k={dm:tt,u:$,d:v,i:_})}function At(r){return q(),new Promise((t,e)=>{let i,s,a;if(i=W(_t,r),_[i])return t(_[i]);s=new Image,s.onload=function(){a=$(i,window.location.href),_[X(r)]=_[i]=_[a]=this,M("assetLoaded",this,r),t(this)},s.onerror=function(){e("Unable to load image "+i)},s.src=i})}function vt(r){return new Promise((t,e)=>{let i=r,s,a,n,h;if(s=new Audio,a=Et(s),r=[].concat(r).reduce((o,l)=>o||(a[N(l)]?l:null),0),!r)return e("cannot play any of the audio formats provided "+i);if(n=W(yt,r),P[n])return t(P[n]);s.addEventListener("canplay",function(){h=$(n,window.location.href),P[X(r)]=P[n]=P[h]=this,M("assetLoaded",this,r),t(this)}),s.onerror=function(){e("Unable to load audio "+n)},s.src=n,s.load()})}function St(r){q();let t,e;return t=W(xt,r),v[t]?Promise.resolve(v[t]):fetch(t).then(i=>{if(!i.ok)throw i;return i.clone().json().catch(()=>i.text())}).then(i=>(e=$(t,window.location.href),typeof i=="object"&&tt.set(i,e),v[X(r)]=v[t]=v[e]=i,M("assetLoaded",i,r),i))}function Pt(...r){return q(),Promise.all(r.map(t=>{let e=N([].concat(t)[0]);return e.match(pt)?At(t):e.match(mt)?vt(t):St(t)}))}class S{constructor(t=0,e=0,i={}){t.x!=null?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}set(t){this.x=t.x,this.y=t.y}add(t){return new S(this.x+t.x,this.y+t.y,this)}subtract(t){return new S(this.x-t.x,this.y-t.y,this)}scale(t){return new S(this.x*t,this.y*t)}normalize(t=this.length()||1){return new S(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,e,i,s){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?I(this._a,this._d,t):t}set y(t){this._y=this._c?I(this._b,this._e,t):t}}function U(){return new S(...arguments)}class Ct{constructor(t){return this.init(t)}init(t={}){this.position=U(),this.velocity=U(),this.acceleration=U(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}class Lt extends Ct{init({width:t=0,height:e=0,context:i=x(),render:s=this.draw,update:a=this.advance,children:n=[],anchor:h={x:0,y:0},opacity:o=1,rotation:l=0,drotation:c=0,ddrotation:d=0,scaleX:m=1,scaleY:u=1,...f}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:h,opacity:o,rotation:l,drotation:c,ddrotation:d,scaleX:m,scaleY:u,...f}),this._di=!0,this._uw(),this.addChild(n),this._rf=s,this._uf=a,D("init",()=>{this.context??(this.context=x())})}update(t){this._uf(t),this.children.map(e=>e.update&&e.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let e=this.width,i=this.height;this.radius&&(e=i=this.radius*2);let s=-e*this.anchor.x,a=-i*this.anchor.y;(s||a)&&t.translate(s,a),this.context.globalAlpha=this.opacity,this._rf(),(s||a)&&t.translate(-s,-a),this.children.map(h=>h.render&&h.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:i=1,_wrot:s=0,_wsx:a=1,_wsy:n=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this.radius&&(this._wrx=this.radius,this._wry=this.radius),this._wo=i*this.opacity,this._wsx=a*this.scaleX,this._wsy=n*this.scaleY,this._wx=this._wx*a,this._wy=this._wy*n,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this.radius&&(this._wrx=this.radius*this._wsx,this._wry=this.radius*this._wsy),this._wrot=s+this.rotation;let{x:h,y:o}=dt({x:this._wx,y:this._wy},s);this._wx=h,this._wy=o,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,radius:this.radius?{x:this._wrx,y:this._wry}:void 0,opacity:this._wo,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(e=>{this.children.push(e),e.parent=this,e._pc=e._pc||Y,e._pc()})}removeChild(...t){t.flat().map(e=>{V(this.children,e)&&(e.parent=null,e._pc())})}get radius(){return this._r}set radius(t){this._r=t,this._pc()}get opacity(){return this._opa}set opacity(t){this._opa=I(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}advance(t){super.advance(t),this.drotation+=this.ddrotation,this.rotation+=this.drotation}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class It extends Lt{init({image:t,width:e=t?t.width:void 0,height:i=t?t.height:void 0,...s}={}){super.init({image:t,width:e,height:i,...s})}get animations(){return this._a}set animations(t){let e,i;this._a={};for(e in t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){var e;(e=this.currentAnimation)==null||e.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){var e;super.advance(t),(e=this.currentAnimation)==null||e.update(t)}draw(){if(this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color){if(this.context.fillStyle=this.color,this.radius){this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.context.fill();return}this.context.fillRect(0,0,this.width,this.height)}}}function Mt(){return new It(...arguments)}function Rt(r){let t=r.canvas;r.clearRect(0,0,t.width,t.height)}function bt({fps:r=60,clearCanvas:t=!0,update:e=Y,render:i,context:s=x(),blur:a=!1}={}){if(!i)throw Error("You must provide a render() function");let n=0,h=1e3/r,o=1/r,l=t?Rt:Y,c,d,m,u,f,w=!0;a||(window.addEventListener("focus",()=>{w=!0}),window.addEventListener("blur",()=>{w=!1})),D("init",()=>{f.context??(f.context=x())});function p(){if(d=requestAnimationFrame(p),!!w&&(m=performance.now(),u=m-c,c=m,!(u>1e3))){for(n+=u;n>=h;)M("tick"),f.update(o),n-=h;l(f.context),f.render()}}return f={update:e,render:i,isStopped:!0,context:s,start(){this.isStopped&&(c=performance.now(),this.isStopped=!1,requestAnimationFrame(p))},stop(){this.isStopped=!0,cancelAnimationFrame(d)},_frame:p,set _last(g){c=g}},f}function Tt(r){if(+r==r)return r;let t=[],e=r.split(".."),i=+e[0],s=+e[1],a=i;if(i<s)for(;a<=s;a++)t.push(a);else for(;a>=s;a--)t.push(a);return t}class Ot{constructor({image:t,frameWidth:e,frameHeight:i,spacing:s=0,margin:a=0,animations:n}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:e,height:i,spacing:s,margin:a},this._f=(t.width-a)/e|0,this.createAnimations(n)}createAnimations(t){let e,i;for(i in t){let{frames:s,frameRate:a,loop:n}=t[i];if(e=[],s==null)throw Error("Animation "+i+" must provide a frames property");[].concat(s).map(h=>{e=e.concat(Tt(h))}),this.animations[i]=ut({spriteSheet:this,frames:e,frameRate:a,loop:n,name:i})}}}function Yt(){return new Ot(...arguments)}let $t=2147483648,Gt=1073741824,Q=536870912;function C(r,t){return r/t|0}function L(r,t){return r/t|0}class Ht{constructor(t={}){let{width:e,height:i,tilewidth:s,tileheight:a,tilesets:n}=t,h=e*s,o=i*a,l=document.createElement("canvas");l.width=h,l.height=o,this._c=l,this._ctx=l.getContext("2d"),n.map(c=>{let{__k:d,location:m}=window,u=(d?d.dm.get(t):"")||m.href,{source:f}=c;if(f){if(!d)throw Error('You must use "load" or "loadData" to resolve tileset.source');let p=d.d[d.u(f,u)];if(!p)throw Error(`You must load the tileset source "${f}" before loading the tileset`);Object.keys(p).map(g=>{c[g]=p[g]})}let{image:w}=c;if(""+w===w){if(!d)throw Error('You must use "load" or "loadImage" to resolve tileset.image');let p=d.i[d.u(w,u)];if(!p)throw Error(`You must load the image "${w}" before loading the tileset`);c.image=p}}),Object.assign(this,{context:x(),layerMap:{},layerCanvases:{},mapwidth:h,mapheight:o,_sx:0,_sy:0,_o:[],...t}),this.context&&this._p(),D("init",()=>{this.context??(this.context=x()),this._p()})}get sx(){return this._sx}get sy(){return this._sy}set sx(t){let e=Math.max(0,this.mapwidth-b().width);this._sx=I(0,e,t)}set sy(t){let e=Math.max(0,this.mapheight-b().height);this._sy=I(0,e,t)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map(e=>{this._o.push(e),e.parent=this})}remove(...t){t.flat().map(e=>{V(this._o,e),e.parent=null})}getPosition(t){let e=b().getBoundingClientRect(),i=t.x-e.x,s=t.y-e.y;return i+=this.sx,s+=this.sy,{x:i,y:s,row:C(s,this.tileheight),col:L(i,this.tilewidth)}}setTileAtLayer(t,e,i){let{layerMap:s,tileheight:a,tilewidth:n,width:h}=this,{row:o,col:l,x:c,y:d}=e,m=o??C(d,a),u=l??L(c,n);s[t]&&(this._d=!0,s[t]._d=!0,s[t].data[m*h+u]=i)}setLayer(t,e){let{layerMap:i}=this;i[t]&&(this._d=!0,i[t]._d=!0,i[t].data=e)}layerCollidesWith(t,e){let{tilewidth:i,tileheight:s,layerMap:a}=this,{x:n,y:h,width:o,height:l}=ct(e),c=C(h,s),d=L(n,i),m=C(h+l,s),u=L(n+o,i),f=a[t];for(let w=c;w<=m;w++)for(let p=d;p<=u;p++)if(f.data[p+w*this.width])return!0;return!1}tileAtLayer(t,e){let{layerMap:i,tileheight:s,tilewidth:a,width:n}=this,{row:h,col:o,x:l,y:c}=e,d=h??C(c,s),m=o??L(l,a);return i[t]?i[t].data[d*n+m]:-1}render(t=this._c,e=!0){let{_d:i,context:s,sx:a=0,sy:n=0}=this;i&&this._p();let{width:h,height:o}=b(),l=Math.min(t.width,h),c=Math.min(t.height,o);s.drawImage(t,a,n,l,c,0,0,l,c),e&&(s.save(),(a||n)&&s.translate(-a,-n),this.objects.map(d=>d.render&&d.render()),s.restore())}renderLayer(t){let{layerCanvases:e,layerMap:i}=this,s=i[t],a=e[t],n=a==null?void 0:a.getContext("2d");if(!a){let{mapwidth:h,mapheight:o}=this;a=document.createElement("canvas"),n=a.getContext("2d"),a.width=h,a.height=o,e[t]=a,this._rl(s,n)}s._d&&(s._d=!1,n.clearRect(0,0,a.width,a.height),this._rl(s,n)),this.render(a,!1)}_p(){let{_ctx:t,layers:e=[],layerMap:i}=this;this._d=!1,e.map(s=>{let{name:a,data:n,visible:h}=s;s._d=!1,i[a]=s,n&&h!=!1&&this._rl(s,t)})}_rl(t,e){let{opacity:i,data:s=[]}=t,{tilesets:a,width:n,tilewidth:h,tileheight:o}=this;e.save(),e.globalAlpha=i,s.map((l,c)=>{if(!l)return;let d=0,m=0,u=l&$t,f=l&Gt,w=0,p=0,g=0,R=0,z=0;d=u||f,l&=1073741823,z=l&Q,z&&(u&&f?g=1:u?w=1:f?p=1:R=1,m=w||p||g||R,l&=~Q);let G;for(let k=a.length-1;k>=0&&(G=a[k],!(l/G.firstgid>=1));k--);let{image:B,spacing:H=0,margin:j=0,firstgid:nt,columns:ht}=G,K=l-nt,Z=ht??B.width/(h+H)|0,E=c%n*h,A=(c/n|0)*o,ot=j+K%Z*(h+H),lt=j+(K/Z|0)*(o+H);m?(e.save(),e.translate(E+h/2,A+o/2),p||R?e.rotate(-Math.PI/2):(w||g)&&e.rotate(Math.PI/2),(g||R)&&e.scale(-1,1),E=-h/2,A=-o/2):d&&(e.save(),e.translate(E+(u?h:0),A+(f?o:0)),e.scale(u?-1:1,f?-1:1),E=d?0:E,A=d?0:A),e.drawImage(B,ot,lt,h,o,E,A,h,o),(d||m)&&e.restore()}),e.restore()}}function kt(){return new Ht(...arguments)}const et="assets/",it=`${et}assets/spritesheet.png`,st=`${et}assets/tilesheet.png`,Ut=[it,st],Dt=r=>Pt(...Ut),rt=640,at=320,Ft="aqua",Wt=[{name:"Fools' Landing",flooded:!1},{name:"Cave of Shadows",flooded:!1},{name:"Temple of the Moon",flooded:!1},{name:"Copper Gate",flooded:!1},{name:"Whispering Garden",flooded:!1},{name:"Dunes of Deception",flooded:!1},{name:"Silver Gate",flooded:!1},{name:"Observatory",flooded:!1},{name:"Breakers Bridge",flooded:!1},{name:"Twilight Hollow",flooded:!1},{name:"Lost Lagoon",flooded:!1},{name:"Bronze Gate",flooded:!1},{name:"Phantom Rock",flooded:!1},{name:"Watchtower",flooded:!1},{name:"Cliffs of Abandon",flooded:!1},{name:"Misty Marsh",flooded:!1},{name:"Coral Palace",flooded:!1},{name:"Howling Garden",flooded:!1},{name:"Iron Gate",flooded:!1},{name:"Gold Gate",flooded:!1},{name:"Crimson Forest",flooded:!1},{name:"Temple of the Sun",flooded:!1},{name:"Cave of Embers",flooded:!1},{name:"Tidal Palace",flooded:!1}];function Nt(){const r=Yt({image:_[it],frameWidth:32,frameHeight:32,animations:Wt.map((e,i)=>({[i]:{frames:i,frameRate:1}})).reduce((e,i)=>({...e,...i}))}),t=[];for(let e=0;e<Object.keys(r.animations).length;++e){const i=Mt({x:e*32,y:0,animations:r.animations});i.playAnimation(e),t.push(i)}return t}async function Xt(){try{const r=_[st];return kt({tilewidth:32,tileheight:32,width:8,height:8,tilesets:[{firstgid:0,image:r}],layers:[{name:"ground",data:[0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,0,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0]}]})}catch(r){return console.error(r),null}}function qt(r){return function(){const{innerWidth:t,innerHeight:e}=window,i=t/e,s=rt/at;i<s?(r.style.width=`${t}px`,r.style.height=`${t/s}px`):(r.style.width=`${e*s}px`,r.style.height=`${e}px`)}}async function zt(){const{canvas:r,context:t}=ft();r.width=rt,r.height=at;const e=qt(r);e(),window.addEventListener("resize",e),await Dt();const i=await Xt();if(i===null)return 1;const s=Nt();for(const n of s)i.add(n);return bt({render(){t.fillStyle=Ft,t.fillRect(0,0,r.width,r.height),i.render()},update(){}}).start(),0}zt();
