(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const h of r.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function i(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=i(n);fetch(n.href,r)}})();/**
 * @preserve
 * Kontra.js v10.0.2
 */function jt(e,t){let i=Math.sin(t),s=Math.cos(t);return{x:e.x*s-e.y*i,y:e.x*i+e.y*s}}function q(e,t,i){return Math.min(Math.max(e,i),t)}function Mt(e){let{x:t=0,y:i=0,width:s,height:n,radius:r}=e.world||e;return e.mapwidth&&(s=e.mapwidth,n=e.mapheight),r&&(s=r.x*2,n=r.y*2),e.anchor&&(t-=s*e.anchor.x,i-=n*e.anchor.y),s<0&&(t+=s,s*=-1),n<0&&(i+=n,n*=-1),{x:t,y:i,width:s,height:n}}let V=()=>{};function Ht(e,t){let i=e.indexOf(t);if(i!=-1)return e.splice(i,1),!0}function te(e,t){let{x:i,y:s,width:n,height:r}=Mt(t);do i-=t.sx||0,s-=t.sy||0;while(t=t.parent);let h=e.x-Math.max(i,Math.min(e.x,i+n)),a=e.y-Math.max(s,Math.min(e.y,s+r));return h*h+a*a<e.radius*e.radius}let J={};function z(e,t){J[e]=J[e]||[],J[e].push(t)}function D(e,...t){(J[e]||[]).map(i=>i(...t))}let A,Q,vt={get(e,t){return t=="_proxy"?!0:V}};function P(){return A}function C(){return Q}function ee(e,{contextless:t=!1}={}){if(A=document.getElementById(e)||e||document.querySelector("canvas"),t&&(A=A||new Proxy({},vt)),!A)throw Error("You must provide a canvas element for the game");return Q=A.getContext("2d")||new Proxy({},vt),Q.imageSmoothingEnabled=!1,D("init"),{canvas:A,context:Q}}class ct{constructor({spriteSheet:t,frames:i,frameRate:s,loop:n=!0,name:r}){let{width:h,height:a,spacing:l=0,margin:o=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:i,frameRate:s,loop:n,name:r,width:h,height:a,spacing:l,margin:o,isStopped:!1,_f:0,_a:0})}clone(){return new ct(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped){if(!this.loop&&this._f==this.frames.length-1){this.stop();return}for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}}render({x:t,y:i,width:s=this.width,height:n=this.height,context:r=C()}){let h=this.frames[this._f]/this.spriteSheet._f|0,a=this.frames[this._f]%this.spriteSheet._f|0;r.drawImage(this.spriteSheet.image,this.margin+a*this.width+(a*2+1)*this.spacing,this.margin+h*this.height+(h*2+1)*this.spacing,this.width,this.height,t,i,s,n)}}function ie(){return new ct(...arguments)}let se=/(jpeg|jpg|gif|png|webp)$/,ne=/(wav|mp3|ogg|aac)$/,re=/^\//,he=/\/$/,It=new WeakMap,ae="",oe="",le="";function st(e,t){return new URL(e,t).href}function ft(e,t){return[e.replace(he,""),t].filter(i=>i).join("/")}function ut(e){return e.split(".").pop()}function wt(e){let t=e.replace("."+ut(e),"");return t.split("/").length==2?t.replace(re,""):t}function de(e){return{wav:e.canPlayType('audio/wav; codecs="1"'),mp3:e.canPlayType("audio/mpeg;"),ogg:e.canPlayType('audio/ogg; codecs="vorbis"'),aac:e.canPlayType("audio/aac;")}}let T={},$={},R={};function gt(){window.__k||(window.__k={dm:It,u:st,d:R,i:T})}function ce(e){return gt(),new Promise((t,i)=>{let s,n,r;if(s=ft(ae,e),T[s])return t(T[s]);n=new Image,n.onload=function(){r=st(s,window.location.href),T[wt(e)]=T[s]=T[r]=this,D("assetLoaded",this,e),t(this)},n.onerror=function(){i("Unable to load image "+s)},n.src=s})}function fe(e){return new Promise((t,i)=>{let s=e,n,r,h,a;if(n=new Audio,r=de(n),e=[].concat(e).reduce((l,o)=>l||(r[ut(o)]?o:null),0),!e)return i("cannot play any of the audio formats provided "+s);if(h=ft(oe,e),$[h])return t($[h]);n.addEventListener("canplay",function(){a=st(h,window.location.href),$[wt(e)]=$[h]=$[a]=this,D("assetLoaded",this,e),t(this)}),n.onerror=function(){i("Unable to load audio "+h)},n.src=h,n.load()})}function ue(e){gt();let t,i;return t=ft(le,e),R[t]?Promise.resolve(R[t]):fetch(t).then(s=>{if(!s.ok)throw s;return s.clone().json().catch(()=>s.text())}).then(s=>(i=st(t,window.location.href),typeof s=="object"&&It.set(s,i),R[wt(e)]=R[t]=R[i]=s,D("assetLoaded",s,e),s))}function we(...e){return gt(),Promise.all(e.map(t=>{let i=ut([].concat(t)[0]);return i.match(se)?ce(t):i.match(ne)?fe(t):ue(t)}))}class M{constructor(t=0,i=0,s={}){t.x!=null?(this.x=t.x,this.y=t.y):(this.x=t,this.y=i),s._c&&(this.clamp(s._a,s._b,s._d,s._e),this.x=t,this.y=i)}set(t){this.x=t.x,this.y=t.y}add(t){return new M(this.x+t.x,this.y+t.y,this)}subtract(t){return new M(this.x-t.x,this.y-t.y,this)}scale(t){return new M(this.x*t,this.y*t)}normalize(t=this.length()||1){return new M(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,i,s,n){this._c=!0,this._a=t,this._b=i,this._d=s,this._e=n}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?q(this._a,this._d,t):t}set y(t){this._y=this._c?q(this._b,this._e,t):t}}function rt(){return new M(...arguments)}class ge{constructor(t){return this.init(t)}init(t={}){this.position=rt(),this.velocity=rt(),this.acceleration=rt(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let i=this.acceleration;t&&(i=i.scale(t)),this.velocity=this.velocity.add(i);let s=this.velocity;t&&(s=s.scale(t)),this.position=this.position.add(s),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}class Ft extends ge{init({width:t=0,height:i=0,context:s=C(),render:n=this.draw,update:r=this.advance,children:h=[],anchor:a={x:0,y:0},opacity:l=1,rotation:o=0,drotation:f=0,ddrotation:d=0,scaleX:c=1,scaleY:w=1,...u}={}){this._c=[],super.init({width:t,height:i,context:s,anchor:a,opacity:l,rotation:o,drotation:f,ddrotation:d,scaleX:c,scaleY:w,...u}),this._di=!0,this._uw(),this.addChild(h),this._rf=n,this._uf=r,z("init",()=>{this.context??(this.context=C())})}update(t){this._uf(t),this.children.map(i=>i.update&&i.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let i=this.width,s=this.height;this.radius&&(i=s=this.radius*2);let n=-i*this.anchor.x,r=-s*this.anchor.y;(n||r)&&t.translate(n,r),this.context.globalAlpha=this.opacity,this._rf(),(n||r)&&t.translate(-n,-r),this.children.map(a=>a.render&&a.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:i=0,_wo:s=1,_wrot:n=0,_wsx:r=1,_wsy:h=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this.radius&&(this._wrx=this.radius,this._wry=this.radius),this._wo=s*this.opacity,this._wsx=r*this.scaleX,this._wsy=h*this.scaleY,this._wx=this._wx*r,this._wy=this._wy*h,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this.radius&&(this._wrx=this.radius*this._wsx,this._wry=this.radius*this._wsy),this._wrot=n+this.rotation;let{x:a,y:l}=jt({x:this._wx,y:this._wy},n);this._wx=a,this._wy=l,this._wx+=t,this._wy+=i}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,radius:this.radius?{x:this._wrx,y:this._wry}:void 0,opacity:this._wo,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(i=>{this.children.push(i),i.parent=this,i._pc=i._pc||V,i._pc()})}removeChild(...t){t.flat().map(i=>{Ht(this.children,i)&&(i.parent=null,i._pc())})}get radius(){return this._r}set radius(t){this._r=t,this._pc()}get opacity(){return this._opa}set opacity(t){this._opa=q(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}advance(t){super.advance(t),this.drotation+=this.ddrotation,this.rotation+=this.drotation}setScale(t,i=t){this.scaleX=t,this.scaleY=i}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class pe extends Ft{init({image:t,width:i=t?t.width:void 0,height:s=t?t.height:void 0,...n}={}){super.init({image:t,width:i,height:s,...n})}get animations(){return this._a}set animations(t){let i,s;this._a={};for(i in t)this._a[i]=t[i].clone(),s=s||this._a[i];this.currentAnimation=s,this.width=this.width||s.width,this.height=this.height||s.height}playAnimation(t){var i;(i=this.currentAnimation)==null||i.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){var i;super.advance(t),(i=this.currentAnimation)==null||i.update(t)}draw(){if(this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color){if(this.context.fillStyle=this.color,this.radius){this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.context.fill();return}this.context.fillRect(0,0,this.width,this.height)}}}function H(){return new pe(...arguments)}let me=/(\d+)(\w+)/;function _e(e){if(!e)return{computed:0};let t=e.match(me),i=+t[1],s=t[2];return{size:i,unit:s,computed:i}}class ye extends Ft{init({text:t="",textAlign:i="",lineHeight:s=1,font:n=(h=>(h=C())==null?void 0:h.font)(),...r}={}){t=""+t,super.init({text:t,textAlign:i,lineHeight:s,font:n,...r}),this.context&&this._p(),z("init",()=>{this.font??(this.font=C().font),this._p()})}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=_e(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context,i=[this.text];if(t.font=this.font,i=this.text.split(`
`),this._fw&&i.map(s=>{let n=s.split(" "),r=n.shift(),h=r;n.map(a=>{h+=" "+a,t.measureText(h).width>this._fw&&(this._s.push(r),h=a),r=h}),this._s.push(h)}),!this._s.length&&this.text.includes(`
`)){let s=0;i.map(n=>{this._s.push(n),s=Math.max(s,t.measureText(n).width)}),this._w=this._fw||s}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,i=this.textAlign,s=this.context;i=this.textAlign||(s.canvas.dir=="rtl"?"right":"left"),t=i=="right"?this.width:i=="center"?this.width/2|0:0,this._s.map((n,r)=>{s.textBaseline="top",s.textAlign=i,s.fillStyle=this.color,s.font=this.font,this.strokeColor&&(s.strokeStyle=this.strokeColor,s.lineWidth=this.lineWidth??1,s.strokeText(n,t,this._fs*this.lineHeight*r)),s.fillText(n,t,this._fs*this.lineHeight*r)})}}function St(){return new ye(...arguments)}let N=new WeakMap,Ct={},pt={},Yt={0:"left",1:"middle",2:"right"};function xe(e){let t=e._lf.length?e._lf:e._cf;for(let i=t.length-1;i>=0;i--){let s=t[i];if(s.collidesWithPointer?s.collidesWithPointer(e):te(e,s))return s}}function E(e,t){return parseFloat(e.getPropertyValue(t))||0}function Ee(e){let{canvas:t,_s:i}=e,s=t.getBoundingClientRect(),n=i.transform!="none"?i.transform.replace("matrix(","").split(","):[1,1,1,1],r=parseFloat(n[0]),h=parseFloat(n[3]),a=(E(i,"border-left-width")+E(i,"border-right-width"))*r,l=(E(i,"border-top-width")+E(i,"border-bottom-width"))*h,o=(E(i,"padding-left")+E(i,"padding-right"))*r,f=(E(i,"padding-top")+E(i,"padding-bottom"))*h;return{scaleX:(s.width-a-o)/t.width,scaleY:(s.height-l-f)/t.height,offsetX:s.left+(E(i,"border-left-width")+E(i,"padding-left"))*r,offsetY:s.top+(E(i,"border-top-width")+E(i,"padding-top"))*h}}function bt(e){let t=e.button!=null?Yt[e.button]:"left";pt[t]=!0,mt(e,"onDown")}function ht(e){let t=e.button!=null?Yt[e.button]:"left";pt[t]=!1,mt(e,"onUp")}function Tt(e){mt(e,"onOver")}function ve(e){let t=N.get(e.target);t._oo=null,pt={}}function At(e,t,i){let s=xe(e);s&&s[t]&&s[t](i),Ct[t]&&Ct[t](i,s),t=="onOver"&&(s!=e._oo&&e._oo&&e._oo.onOut&&e._oo.onOut(i),e._oo=s)}function mt(e,t){e.preventDefault();let i=e.target,s=N.get(i),{scaleX:n,scaleY:r,offsetX:h,offsetY:a}=Ee(s);e.type.includes("touch")?(Array.from(e.touches).map(({clientX:o,clientY:f,identifier:d})=>{let c=s.touches[d];c||(c=s.touches[d]={start:{x:(o-h)/n,y:(f-a)/r}},s.touches.length++),c.changed=!1}),Array.from(e.changedTouches).map(({clientX:o,clientY:f,identifier:d})=>{let c=s.touches[d];c.changed=!0,c.x=s.x=(o-h)/n,c.y=s.y=(f-a)/r,At(s,t,e),D("touchChanged",e,s.touches),t=="onUp"&&(delete s.touches[d],s.touches.length--,s.touches.length||D("touchEnd"))})):(s.x=(e.clientX-h)/n,s.y=(e.clientY-a)/r,At(s,t,e))}function Se({radius:e=5,canvas:t=P()}={}){let i=N.get(t);if(!i){let s=window.getComputedStyle(t);i={x:0,y:0,radius:e,touches:{length:0},canvas:t,_cf:[],_lf:[],_o:[],_oo:null,_s:s},N.set(t,i)}return t.addEventListener("mousedown",bt),t.addEventListener("touchstart",bt),t.addEventListener("mouseup",ht),t.addEventListener("touchend",ht),t.addEventListener("touchcancel",ht),t.addEventListener("blur",ve),t.addEventListener("mousemove",Tt),t.addEventListener("touchmove",Tt),i._t||(i._t=!0,z("tick",()=>{i._lf.length=0,i._cf.map(s=>{i._lf.push(s)}),i._cf.length=0})),i}function L(...e){e.flat().map(t=>{let i=t.context?t.context.canvas:P(),s=N.get(i);if(!s)throw new ReferenceError("Pointer events not initialized for the objects canvas");t.__r||(t.__r=t.render,t.render=function(){s._cf.push(this),this.__r()},s._o.push(t))})}function Ce(e){let t=e.canvas;e.clearRect(0,0,t.width,t.height)}function be({fps:e=60,clearCanvas:t=!0,update:i=V,render:s,context:n=C(),blur:r=!1}={}){if(!s)throw Error("You must provide a render() function");let h=0,a=1e3/e,l=1/e,o=t?Ce:V,f,d,c,w,u,p=!0;r||(window.addEventListener("focus",()=>{p=!0}),window.addEventListener("blur",()=>{p=!1})),z("init",()=>{u.context??(u.context=C())});function g(){if(d=requestAnimationFrame(g),!!p&&(c=performance.now(),w=c-f,f=c,!(w>1e3))){for(h+=w;h>=a;)D("tick"),u.update(l),h-=a;o(u.context),u.render()}}return u={update:i,render:s,isStopped:!0,context:n,start(){this.isStopped&&(f=performance.now(),this.isStopped=!1,requestAnimationFrame(g))},stop(){this.isStopped=!0,cancelAnimationFrame(d)},_frame:g,set _last(S){f=S}},u}let b;function $t(){b??(b=Date.now()),b|=0,b=b+2654435769|0;let e=b^b>>>16;return e=Math.imul(e,569420461),e=e^e>>>15,e=Math.imul(e,1935289751),((e=e^e>>>15)>>>0)/4294967296}function Wt(e=Date.now()){if(b=e,typeof e=="string"){for(var t=0,i=1779033703^e.length;t<e.length;t++)i=Math.imul(i^e.charCodeAt(t),3432918353),i=i<<13|i>>>19;i=Math.imul(i^i>>>16,2246822507),i=Math.imul(i^i>>>13,3266489909),b=(i^=i>>>16)>>>0}}function Te(e){if(+e==e)return e;let t=[],i=e.split(".."),s=+i[0],n=+i[1],r=s;if(s<n)for(;r<=n;r++)t.push(r);else for(;r>=n;r--)t.push(r);return t}class Ae{constructor({image:t,frameWidth:i,frameHeight:s,spacing:n=0,margin:r=0,animations:h}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:i,height:s,spacing:n,margin:r},this._f=(t.width-r)/i|0,this.createAnimations(h)}createAnimations(t){let i,s;for(s in t){let{frames:n,frameRate:r,loop:h}=t[s];if(i=[],n==null)throw Error("Animation "+s+" must provide a frames property");[].concat(n).map(a=>{i=i.concat(Te(a))}),this.animations[s]=ie({spriteSheet:this,frames:i,frameRate:r,loop:h,name:s})}}}function De(){return new Ae(...arguments)}let ke=2147483648,Oe=1073741824,Dt=536870912;function W(e,t){return e/t|0}function U(e,t){return e/t|0}class Le{constructor(t={}){let{width:i,height:s,tilewidth:n,tileheight:r,tilesets:h}=t,a=i*n,l=s*r,o=document.createElement("canvas");o.width=a,o.height=l,this._c=o,this._ctx=o.getContext("2d"),h.map(f=>{let{__k:d,location:c}=window,w=(d?d.dm.get(t):"")||c.href,{source:u}=f;if(u){if(!d)throw Error('You must use "load" or "loadData" to resolve tileset.source');let g=d.d[d.u(u,w)];if(!g)throw Error(`You must load the tileset source "${u}" before loading the tileset`);Object.keys(g).map(S=>{f[S]=g[S]})}let{image:p}=f;if(""+p===p){if(!d)throw Error('You must use "load" or "loadImage" to resolve tileset.image');let g=d.i[d.u(p,w)];if(!g)throw Error(`You must load the image "${p}" before loading the tileset`);f.image=g}}),Object.assign(this,{context:C(),layerMap:{},layerCanvases:{},mapwidth:a,mapheight:l,_sx:0,_sy:0,_o:[],...t}),this.context&&this._p(),z("init",()=>{this.context??(this.context=C()),this._p()})}get sx(){return this._sx}get sy(){return this._sy}set sx(t){let i=Math.max(0,this.mapwidth-P().width);this._sx=q(0,i,t)}set sy(t){let i=Math.max(0,this.mapheight-P().height);this._sy=q(0,i,t)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map(i=>{this._o.push(i),i.parent=this})}remove(...t){t.flat().map(i=>{Ht(this._o,i),i.parent=null})}getPosition(t){let i=P().getBoundingClientRect(),s=t.x-i.x,n=t.y-i.y;return s+=this.sx,n+=this.sy,{x:s,y:n,row:W(n,this.tileheight),col:U(s,this.tilewidth)}}setTileAtLayer(t,i,s){let{layerMap:n,tileheight:r,tilewidth:h,width:a}=this,{row:l,col:o,x:f,y:d}=i,c=l??W(d,r),w=o??U(f,h);n[t]&&(this._d=!0,n[t]._d=!0,n[t].data[c*a+w]=s)}setLayer(t,i){let{layerMap:s}=this;s[t]&&(this._d=!0,s[t]._d=!0,s[t].data=i)}layerCollidesWith(t,i){let{tilewidth:s,tileheight:n,layerMap:r}=this,{x:h,y:a,width:l,height:o}=Mt(i),f=W(a,n),d=U(h,s),c=W(a+o,n),w=U(h+l,s),u=r[t];for(let p=f;p<=c;p++)for(let g=d;g<=w;g++)if(u.data[g+p*this.width])return!0;return!1}tileAtLayer(t,i){let{layerMap:s,tileheight:n,tilewidth:r,width:h}=this,{row:a,col:l,x:o,y:f}=i,d=a??W(f,n),c=l??U(o,r);return s[t]?s[t].data[d*h+c]:-1}render(t=this._c,i=!0){let{_d:s,context:n,sx:r=0,sy:h=0}=this;s&&this._p();let{width:a,height:l}=P(),o=Math.min(t.width,a),f=Math.min(t.height,l);n.drawImage(t,r,h,o,f,0,0,o,f),i&&(n.save(),(r||h)&&n.translate(-r,-h),this.objects.map(d=>d.render&&d.render()),n.restore())}renderLayer(t){let{layerCanvases:i,layerMap:s}=this,n=s[t],r=i[t],h=r==null?void 0:r.getContext("2d");if(!r){let{mapwidth:a,mapheight:l}=this;r=document.createElement("canvas"),h=r.getContext("2d"),r.width=a,r.height=l,i[t]=r,this._rl(n,h)}n._d&&(n._d=!1,h.clearRect(0,0,r.width,r.height),this._rl(n,h)),this.render(r,!1)}_p(){let{_ctx:t,layers:i=[],layerMap:s}=this;this._d=!1,i.map(n=>{let{name:r,data:h,visible:a}=n;n._d=!1,s[r]=n,h&&a!=!1&&this._rl(n,t)})}_rl(t,i){let{opacity:s,data:n=[]}=t,{tilesets:r,width:h,tilewidth:a,tileheight:l}=this;i.save(),i.globalAlpha=s,n.map((o,f)=>{if(!o)return;let d=0,c=0,w=o&ke,u=o&Oe,p=0,g=0,S=0,Y=0,x=0;d=w||u,o&=1073741823,x=o&Dt,x&&(w&&u?S=1:w?p=1:u?g=1:Y=1,c=p||g||S||Y,o&=~Dt);let v;for(let nt=r.length-1;nt>=0&&(v=r[nt],!(o/v.firstgid>=1));nt--);let{image:y,spacing:m=0,margin:_=0,firstgid:Jt,columns:Qt}=v,xt=o-Jt,Et=Qt??y.width/(a+m)|0,k=f%h*a,O=(f/h|0)*l,Vt=_+xt%Et*(a+m),Zt=_+(xt/Et|0)*(l+m);c?(i.save(),i.translate(k+a/2,O+l/2),g||Y?i.rotate(-Math.PI/2):(p||S)&&i.rotate(Math.PI/2),(S||Y)&&i.scale(-1,1),k=-a/2,O=-l/2):d&&(i.save(),i.translate(k+(w?a:0),O+(u?l:0)),i.scale(w?-1:1,u?-1:1),k=d?0:k,O=d?0:O),i.drawImage(y,Vt,Zt,a,l,k,O,a,l),(d||c)&&i.restore()}),i.restore()}}function Re(){return new Le(...arguments)}function Pe(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var at={exports:{}},ot,kt;function Me(){return kt||(kt=1,ot=function(e,t){this.reset=function(){this.cards=e.slice(0),this.length=this.cards.length},this.shuffle=function(){i(this.cards)},this.reset(),this.shuffle(),this.deal=function(s,n){for(var r=0;r<s;r++)for(var h=0;h<n.length;h++){if(!n[h]||!n[h].push)throw new Error("Deck#deal | Undefined Hand");n[h].push(this.cards.pop())}this.length=this.cards.length},this.draw=function(s){if(!s||s<=1)return this.length=this.cards.length-1,this.cards.pop();for(var n=[],r=0;r<s;r++)n.push(this.cards.pop());return this.length=this.cards.length,n},this.drawFromBottomOfDeck=function(s){(!s||s<1)&&(s=1);for(var n=[],r=0;r<s;r++)n.push(this.cards.shift());return this.length=this.cards.length,n.length===1?n[0]:n},this.drawRandom=function(s){var n=function(){var a=Math.floor(t()*this.cards.length),l=this.cards[a];return this.cards.splice(a,1),this.length=this.cards.length,l};if(!s||s<=1)return n.apply(this);for(var r=[],h=0;h<s;h++)r.push(n.apply(this));return r},this.putOnTopOfDeck=function(s){if(!s instanceof Array)this.cards.push(s);else for(var n=0;n<s.length;n++)this.cards.push(s[n]);this.length=this.cards.length},this.putOnBottomOfDeck=function(s){if(!s instanceof Array)this.cards.unshift(s);else for(var n=0;n<s.length;n++)this.cards.unshift(s[n]);this.length=this.cards.length};function i(s){var n=s.length;if(n===0)return!1;for(;--n;){var r=Math.floor(t()*(n+1)),h=s[n],a=s[r];s[n]=a,s[r]=h}}}),ot}var lt,Ot;function He(){return Ot||(Ot=1,lt=function(e,t,i){this.suit=e,this.description=t,this.sort=i,this.toString=function(){return this.description+" of "+this.suit+"s"},this.toShortDisplayString=function(){var s=this.suit.substring(0,1),n;switch(this.sort){case 11:n="J";break;case 12:n="Q";break;case 13:n="K";break;case 14:n="A";break;default:n=this.sort}return n+s}}),lt}var dt,Lt;function Ie(){if(Lt)return dt;Lt=1;var e=He();return dt=function(){this.cards=[new e("Club","Two",2),new e("Club","Three",3),new e("Club","Four",4),new e("Club","Five",5),new e("Club","Six",6),new e("Club","Seven",7),new e("Club","Eight",8),new e("Club","Nine",9),new e("Club","Ten",10),new e("Club","Jack",11),new e("Club","Queen",12),new e("Club","King",13),new e("Club","Ace",14),new e("Diamond","Two",2),new e("Diamond","Three",3),new e("Diamond","Four",4),new e("Diamond","Five",5),new e("Diamond","Six",6),new e("Diamond","Seven",7),new e("Diamond","Eight",8),new e("Diamond","Nine",9),new e("Diamond","Ten",10),new e("Diamond","Jack",11),new e("Diamond","Queen",12),new e("Diamond","King",13),new e("Diamond","Ace",14),new e("Heart","Two",2),new e("Heart","Three",3),new e("Heart","Four",4),new e("Heart","Five",5),new e("Heart","Six",6),new e("Heart","Seven",7),new e("Heart","Eight",8),new e("Heart","Nine",9),new e("Heart","Ten",10),new e("Heart","Jack",11),new e("Heart","Queen",12),new e("Heart","King",13),new e("Heart","Ace",14),new e("Spade","Two",2),new e("Spade","Three",3),new e("Spade","Four",4),new e("Spade","Five",5),new e("Spade","Six",6),new e("Spade","Seven",7),new e("Spade","Eight",8),new e("Spade","Nine",9),new e("Spade","Ten",10),new e("Spade","Jack",11),new e("Spade","Queen",12),new e("Spade","King",13),new e("Spade","Ace",14)]},dt}var Rt;function Fe(){if(Rt)return at.exports;Rt=1;var e=Me(),t=Ie(),i=at.exports={},s={deck:new t().cards,numberOfDecks:1,random:function(){return Math.random()}};return i.playingCards=function(){return new t().cards},i.shuffle=function(n){if(n||(n=s),n.deck||(n.deck=s.deck),n.numberOfDecks)for(var r=n.deck,h=0;h<n.numberOfDecks-1;h++)n.deck=n.deck.concat(r);return n.random||(n.random=s.random),new e(n.deck,n.random)},at.exports}var Ye=Fe();const _t=Pe(Ye),Ut=1,Gt=2,Xt=3,qt=4,Nt=5,zt=6,Bt=""+new URL("spritesheet-Yod2c8eG.png",import.meta.url).href,Kt=""+new URL("tilesheet-C_zpU0l5.png",import.meta.url).href,$e=[Bt,Kt],We=e=>we(...$e),F=2,G=640*F,yt=320*F,Z=32*F,I=32*F,B=24*F,K=24*F,Ue="aqua",Ge="flood-deck",Xe="island-tiles-deck",j=1,tt=2,et=3,it=4,X=[{id:1,name:"Fools' Landing",flooded:!1,adventurer:zt},{id:2,name:"Cave of Shadows",flooded:!1,treasure:et},{id:3,name:"Temple of the Moon",flooded:!1,treasure:j},{id:4,name:"Copper Gate",flooded:!1,adventurer:Xt},{id:5,name:"Whispering Garden",flooded:!1,treasure:tt},{id:6,name:"Dunes of Deception",flooded:!1},{id:7,name:"Silver Gate",flooded:!1,adventurer:qt},{id:8,name:"Observatory",flooded:!1},{id:9,name:"Breakers Bridge",flooded:!1},{id:10,name:"Twilight Hollow",flooded:!1},{id:11,name:"Lost Lagoon",flooded:!1},{id:12,name:"Bronze Gate",flooded:!1,adventurer:Gt},{id:13,name:"Phantom Rock",flooded:!1},{id:14,name:"Watchtower",flooded:!1},{id:15,name:"Cliffs of Abandon",flooded:!1},{id:16,name:"Misty Marsh",flooded:!1},{id:17,name:"Coral Palace",flooded:!1,treasure:it},{id:18,name:"Howling Garden",flooded:!1,treasure:tt},{id:19,name:"Iron Gate",flooded:!1,adventurer:Ut},{id:20,name:"Gold Gate",flooded:!1,adventurer:Nt},{id:21,name:"Crimson Forest",flooded:!1},{id:22,name:"Temple of the Sun",flooded:!1,treasure:j},{id:23,name:"Cave of Embers",flooded:!1,treasure:et},{id:24,name:"Tidal Palace",flooded:!1,treasure:it}];Wt(Ge);const qe=_t.shuffle({deck:X,random:$t});function Ne(){const e=De({image:T[Bt],frameWidth:Z,frameHeight:I,animations:X.map((i,s)=>({[s]:{frames:s*2,frameRate:1},[`${s}-flooded`]:{frames:[s*2+1],frameRate:1}})).reduce((i,s)=>({...i,...s}))}),t=[];for(let i=0;i<X.length;++i){const s=H({animations:e.animations,id:1+i,flooded:X[i].flooded});s.playAnimation(i),t.push(s)}return t}async function ze(){try{const e=T[Kt];return Re({tilewidth:Z,tileheight:I,width:8,height:8,tilesets:[{firstgid:0,image:e}],layers:[{name:"ground",data:[0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,0,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0]}]})}catch(e){return console.error(e),null}}function Be(){const e=H({color:"brown",width:B,height:K,id:j}),t=H({color:"yellow",width:B,height:K,id:tt}),i=H({color:"red",width:B,height:K,id:et}),s=H({color:"blue",width:B,height:K,id:it});return{theCrystalOfFire:i,theEarthStone:e,theOceansChalice:s,theStatueOfTheWind:t}}function Ke(){return H({x:0,y:0,color:Ue,width:G,height:yt})}Wt(Xe);const Je=_t.shuffle({deck:X,random:$t});function Qe(e){return function(){const{innerWidth:t,innerHeight:i}=window,s=t/i,n=G/yt;s<n?(e.style.width=`${t}px`,e.style.height=`${t/n}px`):(e.style.width=`${i*n}px`,e.style.height=`${i}px`)}}const Ve=18,Ze="0.0.19",Pt={hours:Ve,version:Ze};async function je(){const{canvas:e,context:t}=ee();e.width=G,e.height=yt;const i=Qe(e);i(),window.addEventListener("resize",i),Se();const s=`v${Pt.version}`,n=`${Pt.hours}h`,r=St({text:`${s}
${n}`,font:`${I/4}px Courier`,color:"white",x:G-Z/4*Math.max(s.length,n.length),y:I/4}),h=St({font:`${I}px Arial`,color:"blue",x:G/2-Z,y:I});await We();const a=await ze();if(a===null)return 1;const l=Ke();l.onDown=l.onOver=()=>{h.text=""},L(l);const o=Ne(),f=a.layers.find(({name:x})=>x==="ground");if(f!==void 0){for(let x=0;x<a.height;++x)for(let v=0;v<a.width;++v)if(f.data[x*a.width+v]!==0){const y=Je.draw(),m=o[y.id-1];m.x=v*m.width,m.y=x*m.height,m.onDown=m.onOver=()=>{let _=y.name;if(m.flooded&&(_+=`
FLOODED!`),y.adventurer!==void 0)switch(y.adventurer){case Ut:_+=`
(Diver)`;break;case Gt:_+=`
(Engineer)`;break;case Xt:_+=`
(Explorer)`;break;case qt:_+=`
(Messenger)`;break;case Nt:_+=`
(Navigator)`;break;case zt:_+=`
(Pilot)`}if(y.treasure!==void 0)switch(y.treasure){case et:_+=`
(The Crystal of Fire)`;break;case j:_+=`
(The Earth Stone)`;break;case it:_+=`
(The Ocean's Chalice)`;break;case tt:_+=`
(The Statue of the Wind)`}h.text=_},L(m),a.add(m)}}const{theCrystalOfFire:d,theEarthStone:c,theOceansChalice:w,theStatueOfTheWind:u}=Be();c.x=o[0].width+(o[0].width-c.width)/2,c.y=o[0].height+(o[0].height-c.height)/2,c.onDown=c.onOver=()=>{h.text="The Earth Stone"},L(c),a.add(c),u.x=o[0].width+(o[0].width-u.width)/2,u.y=o[0].height*6+(o[0].height-u.height)/2,u.onDown=u.onOver=()=>{h.text="The Statue of the Wind"},L(u),a.add(u),d.x=o[0].width*6+(o[0].width-d.width)/2,d.y=o[0].height+(o[0].height-d.height)/2,d.onDown=d.onOver=()=>{h.text="The Crystal of Fire"},L(d),a.add(d),w.x=o[0].width*6+(o[0].width-w.width)/2,w.y=o[0].height*6+(o[0].height-w.height)/2,w.onDown=w.onOver=()=>{h.text="The Ocean's Chalice"},L(w),a.add(w);const p={...qe},g=[];for(let x=0;x<6;++x){const v=p.draw(),y=o.find(({id:m})=>m===v.id);y.flooded=!0,y.playAnimation(`${y.id-1}-flooded`),g.push(v)}return _t.shuffle({deck:[]}).putOnTopOfDeck(g),be({render(){l.render(),a.render(),t.fillStyle="black",t.fillRect(r.x,r.y,r.width,r.height),r.render(),h.render()},update(){}}).start(),0}je();
