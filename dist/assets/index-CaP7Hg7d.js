(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();/**
 * @preserve
 * Kontra.js v10.0.2
 */function ae(e,t){let n=Math.sin(t),i=Math.cos(t);return{x:e.x*i-e.y*n,y:e.x*n+e.y*i}}function q(e,t,n){return Math.min(Math.max(e,n),t)}function Vt(e){let{x:t=0,y:n=0,width:i,height:s,radius:r}=e.world||e;return e.mapwidth&&(i=e.mapwidth,s=e.mapheight),r&&(i=r.x*2,s=r.y*2),e.anchor&&(t-=i*e.anchor.x,n-=s*e.anchor.y),i<0&&(t+=i,i*=-1),s<0&&(n+=s,s*=-1),{x:t,y:n,width:i,height:s}}let gt=()=>{};function Zt(e,t){let n=e.indexOf(t);if(n!=-1)return e.splice(n,1),!0}function oe(e,t){let{x:n,y:i,width:s,height:r}=Vt(t);do n-=t.sx||0,i-=t.sy||0;while(t=t.parent);let a=e.x-Math.max(n,Math.min(e.x,n+s)),o=e.y-Math.max(i,Math.min(e.y,i+r));return a*a+o*o<e.radius*e.radius}let pt={};function ht(e,t){pt[e]=pt[e]||[],pt[e].push(t)}function X(e,...t){(pt[e]||[]).map(n=>n(...t))}let U,wt,Yt={get(e,t){return t=="_proxy"?!0:gt}};function N(){return U}function M(){return wt}function he(e,{contextless:t=!1}={}){if(U=document.getElementById(e)||e||document.querySelector("canvas"),t&&(U=U||new Proxy({},Yt)),!U)throw Error("You must provide a canvas element for the game");return wt=U.getContext("2d")||new Proxy({},Yt),wt.imageSmoothingEnabled=!1,X("init"),{canvas:U,context:wt}}class Lt{constructor({spriteSheet:t,frames:n,frameRate:i,loop:s=!0,name:r}){let{width:a,height:o,spacing:c=0,margin:u=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:n,frameRate:i,loop:s,name:r,width:a,height:o,spacing:c,margin:u,isStopped:!1,_f:0,_a:0})}clone(){return new Lt(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped){if(!this.loop&&this._f==this.frames.length-1){this.stop();return}for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}}render({x:t,y:n,width:i=this.width,height:s=this.height,context:r=M()}){let a=this.frames[this._f]/this.spriteSheet._f|0,o=this.frames[this._f]%this.spriteSheet._f|0;r.drawImage(this.spriteSheet.image,this.margin+o*this.width+(o*2+1)*this.spacing,this.margin+a*this.height+(a*2+1)*this.spacing,this.width,this.height,t,n,i,s)}}function le(){return new Lt(...arguments)}let de=/(jpeg|jpg|gif|png|webp)$/,ce=/(wav|mp3|ogg|aac)$/,fe=/^\//,ue=/\/$/,te=new WeakMap,pe="",we="",ge="";function Et(e,t){return new URL(e,t).href}function Ot(e,t){return[e.replace(ue,""),t].filter(n=>n).join("/")}function It(e){return e.split(".").pop()}function Mt(e){let t=e.replace("."+It(e),"");return t.split("/").length==2?t.replace(fe,""):t}function me(e){return{wav:e.canPlayType('audio/wav; codecs="1"'),mp3:e.canPlayType("audio/mpeg;"),ogg:e.canPlayType('audio/ogg; codecs="vorbis"'),aac:e.canPlayType("audio/aac;")}}let W={},nt={},z={};function Ht(){window.__k||(window.__k={dm:te,u:Et,d:z,i:W})}function ye(e){return Ht(),new Promise((t,n)=>{let i,s,r;if(i=Ot(pe,e),W[i])return t(W[i]);s=new Image,s.onload=function(){r=Et(i,window.location.href),W[Mt(e)]=W[i]=W[r]=this,X("assetLoaded",this,e),t(this)},s.onerror=function(){n("Unable to load image "+i)},s.src=i})}function _e(e){return new Promise((t,n)=>{let i=e,s,r,a,o;if(s=new Audio,r=me(s),e=[].concat(e).reduce((c,u)=>c||(r[It(u)]?u:null),0),!e)return n("cannot play any of the audio formats provided "+i);if(a=Ot(we,e),nt[a])return t(nt[a]);s.addEventListener("canplay",function(){o=Et(a,window.location.href),nt[Mt(e)]=nt[a]=nt[o]=this,X("assetLoaded",this,e),t(this)}),s.onerror=function(){n("Unable to load audio "+a)},s.src=a,s.load()})}function xe(e){Ht();let t,n;return t=Ot(ge,e),z[t]?Promise.resolve(z[t]):fetch(t).then(i=>{if(!i.ok)throw i;return i.clone().json().catch(()=>i.text())}).then(i=>(n=Et(t,window.location.href),typeof i=="object"&&te.set(i,n),z[Mt(e)]=z[t]=z[n]=i,X("assetLoaded",i,e),i))}function Ee(...e){return Ht(),Promise.all(e.map(t=>{let n=It([].concat(t)[0]);return n.match(de)?ye(t):n.match(ce)?_e(t):xe(t)}))}class K{constructor(t=0,n=0,i={}){t.x!=null?(this.x=t.x,this.y=t.y):(this.x=t,this.y=n),i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=n)}set(t){this.x=t.x,this.y=t.y}add(t){return new K(this.x+t.x,this.y+t.y,this)}subtract(t){return new K(this.x-t.x,this.y-t.y,this)}scale(t){return new K(this.x*t,this.y*t)}normalize(t=this.length()||1){return new K(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,n,i,s){this._c=!0,this._a=t,this._b=n,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?q(this._a,this._d,t):t}set y(t){this._y=this._c?q(this._b,this._e,t):t}}function Tt(){return new K(...arguments)}class ve{constructor(t){return this.init(t)}init(t={}){this.position=Tt(),this.velocity=Tt(),this.acceleration=Tt(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let n=this.acceleration;t&&(n=n.scale(t)),this.velocity=this.velocity.add(n);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}class ee extends ve{init({width:t=0,height:n=0,context:i=M(),render:s=this.draw,update:r=this.advance,children:a=[],anchor:o={x:0,y:0},opacity:c=1,rotation:u=0,drotation:f=0,ddrotation:d=0,scaleX:m=1,scaleY:p=1,...E}={}){this._c=[],super.init({width:t,height:n,context:i,anchor:o,opacity:c,rotation:u,drotation:f,ddrotation:d,scaleX:m,scaleY:p,...E}),this._di=!0,this._uw(),this.addChild(a),this._rf=s,this._uf=r,ht("init",()=>{this.context??=M()})}update(t){this._uf(t),this.children.map(n=>n.update&&n.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let n=this.width,i=this.height;this.radius&&(n=i=this.radius*2);let s=-n*this.anchor.x,r=-i*this.anchor.y;(s||r)&&t.translate(s,r),this.context.globalAlpha=this.opacity,this._rf(),(s||r)&&t.translate(-s,-r),this.children.map(o=>o.render&&o.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:n=0,_wo:i=1,_wrot:s=0,_wsx:r=1,_wsy:a=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this.radius&&(this._wrx=this.radius,this._wry=this.radius),this._wo=i*this.opacity,this._wsx=r*this.scaleX,this._wsy=a*this.scaleY,this._wx=this._wx*r,this._wy=this._wy*a,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this.radius&&(this._wrx=this.radius*this._wsx,this._wry=this.radius*this._wsy),this._wrot=s+this.rotation;let{x:o,y:c}=ae({x:this._wx,y:this._wy},s);this._wx=o,this._wy=c,this._wx+=t,this._wy+=n}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,radius:this.radius?{x:this._wrx,y:this._wry}:void 0,opacity:this._wo,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(n=>{this.children.push(n),n.parent=this,n._pc=n._pc||gt,n._pc()})}removeChild(...t){t.flat().map(n=>{Zt(this.children,n)&&(n.parent=null,n._pc())})}get radius(){return this._r}set radius(t){this._r=t,this._pc()}get opacity(){return this._opa}set opacity(t){this._opa=q(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}advance(t){super.advance(t),this.drotation+=this.ddrotation,this.rotation+=this.drotation}setScale(t,n=t){this.scaleX=t,this.scaleY=n}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class Ce extends ee{init({image:t,width:n=t?t.width:void 0,height:i=t?t.height:void 0,...s}={}){super.init({image:t,width:n,height:i,...s})}get animations(){return this._a}set animations(t){let n,i;this._a={};for(n in t)this._a[n]=t[n].clone(),i=i||this._a[n];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){this.currentAnimation?.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){super.advance(t),this.currentAnimation?.update(t)}draw(){if(this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color){if(this.context.fillStyle=this.color,this.radius){this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.context.fill();return}this.context.fillRect(0,0,this.width,this.height)}}}function P(){return new Ce(...arguments)}let Se=/(\d+)(\w+)/;function be(e){if(!e)return{computed:0};let t=e.match(Se),n=+t[1],i=t[2];return{size:n,unit:i,computed:n}}class Te extends ee{init({text:t="",textAlign:n="",lineHeight:i=1,font:s=M()?.font,...r}={}){t=""+t,super.init({text:t,textAlign:n,lineHeight:i,font:s,...r}),this.context&&this._p(),ht("init",()=>{this.font??=M().font,this._p()})}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=be(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context,n=[this.text];if(t.font=this.font,n=this.text.split(`
`),this._fw&&n.map(i=>{let s=i.split(" "),r=s.shift(),a=r;s.map(o=>{a+=" "+o,t.measureText(a).width>this._fw&&(this._s.push(r),a=o),r=a}),this._s.push(a)}),!this._s.length&&this.text.includes(`
`)){let i=0;n.map(s=>{this._s.push(s),i=Math.max(i,t.measureText(s).width)}),this._w=this._fw||i}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,n=this.textAlign,i=this.context;n=this.textAlign||(i.canvas.dir=="rtl"?"right":"left"),t=n=="right"?this.width:n=="center"?this.width/2|0:0,this._s.map((s,r)=>{i.textBaseline="top",i.textAlign=n,i.fillStyle=this.color,i.font=this.font,this.strokeColor&&(i.strokeStyle=this.strokeColor,i.lineWidth=this.lineWidth??1,i.strokeText(s,t,this._fs*this.lineHeight*r)),i.fillText(s,t,this._fs*this.lineHeight*r)})}}function Gt(){return new Te(...arguments)}let it=new WeakMap,Ut={},$t={},ie={0:"left",1:"middle",2:"right"};function De(e=N()){return it.get(e)}function ke(e){let t=e._lf.length?e._lf:e._cf;for(let n=t.length-1;n>=0;n--){let i=t[n];if(i.collidesWithPointer?i.collidesWithPointer(e):oe(e,i))return i}}function A(e,t){return parseFloat(e.getPropertyValue(t))||0}function Pe(e){let{canvas:t,_s:n}=e,i=t.getBoundingClientRect(),s=n.transform!="none"?n.transform.replace("matrix(","").split(","):[1,1,1,1],r=parseFloat(s[0]),a=parseFloat(s[3]),o=(A(n,"border-left-width")+A(n,"border-right-width"))*r,c=(A(n,"border-top-width")+A(n,"border-bottom-width"))*a,u=(A(n,"padding-left")+A(n,"padding-right"))*r,f=(A(n,"padding-top")+A(n,"padding-bottom"))*a;return{scaleX:(i.width-o-u)/t.width,scaleY:(i.height-c-f)/t.height,offsetX:i.left+(A(n,"border-left-width")+A(n,"padding-left"))*r,offsetY:i.top+(A(n,"border-top-width")+A(n,"padding-top"))*a}}function Nt(e){let t=e.button!=null?ie[e.button]:"left";$t[t]=!0,Ft(e,"onDown")}function Dt(e){let t=e.button!=null?ie[e.button]:"left";$t[t]=!1,Ft(e,"onUp")}function qt(e){Ft(e,"onOver")}function Ae(e){let t=it.get(e.target);t._oo=null,$t={}}function Xt(e,t,n){let i=ke(e);i&&i[t]&&i[t](n),Ut[t]&&Ut[t](n,i),t=="onOver"&&(i!=e._oo&&e._oo&&e._oo.onOut&&e._oo.onOut(n),e._oo=i)}function Ft(e,t){e.preventDefault();let n=e.target,i=it.get(n),{scaleX:s,scaleY:r,offsetX:a,offsetY:o}=Pe(i);e.type.includes("touch")?(Array.from(e.touches).map(({clientX:u,clientY:f,identifier:d})=>{let m=i.touches[d];m||(m=i.touches[d]={start:{x:(u-a)/s,y:(f-o)/r}},i.touches.length++),m.changed=!1}),Array.from(e.changedTouches).map(({clientX:u,clientY:f,identifier:d})=>{let m=i.touches[d];m.changed=!0,m.x=i.x=(u-a)/s,m.y=i.y=(f-o)/r,Xt(i,t,e),X("touchChanged",e,i.touches),t=="onUp"&&(delete i.touches[d],i.touches.length--,i.touches.length||X("touchEnd"))})):(i.x=(e.clientX-a)/s,i.y=(e.clientY-o)/r,Xt(i,t,e))}function Re({radius:e=5,canvas:t=N()}={}){let n=it.get(t);if(!n){let i=window.getComputedStyle(t);n={x:0,y:0,radius:e,touches:{length:0},canvas:t,_cf:[],_lf:[],_o:[],_oo:null,_s:i},it.set(t,n)}return t.addEventListener("mousedown",Nt),t.addEventListener("touchstart",Nt),t.addEventListener("mouseup",Dt),t.addEventListener("touchend",Dt),t.addEventListener("touchcancel",Dt),t.addEventListener("blur",Ae),t.addEventListener("mousemove",qt),t.addEventListener("touchmove",qt),n._t||(n._t=!0,ht("tick",()=>{n._lf.length=0,n._cf.map(i=>{n._lf.push(i)}),n._cf.length=0})),n}function k(...e){e.flat().map(t=>{let n=t.context?t.context.canvas:N(),i=it.get(n);if(!i)throw new ReferenceError("Pointer events not initialized for the objects canvas");t.__r||(t.__r=t.render,t.render=function(){i._cf.push(this),this.__r()},i._o.push(t))})}function Le(e){let t=e.canvas;e.clearRect(0,0,t.width,t.height)}function Oe({fps:e=60,clearCanvas:t=!0,update:n=gt,render:i,context:s=M(),blur:r=!1}={}){if(!i)throw Error("You must provide a render() function");let a=0,o=1e3/e,c=1/e,u=t?Le:gt,f,d,m,p,E,_=!0;r||(window.addEventListener("focus",()=>{_=!0}),window.addEventListener("blur",()=>{_=!1})),ht("init",()=>{E.context??=M()});function y(){if(d=requestAnimationFrame(y),!!_&&(m=performance.now(),p=m-f,f=m,!(p>1e3))){for(a+=p;a>=o;)X("tick"),E.update(c),a-=o;u(E.context),E.render()}}return E={update:n,render:i,isStopped:!0,context:s,start(){this.isStopped&&(f=performance.now(),this.isStopped=!1,requestAnimationFrame(y))},stop(){this.isStopped=!0,cancelAnimationFrame(d)},_frame:y,set _last(C){f=C}},E}let F;function vt(){F??=Date.now(),F|=0,F=F+2654435769|0;let e=F^F>>>16;return e=Math.imul(e,569420461),e=e^e>>>15,e=Math.imul(e,1935289751),((e=e^e>>>15)>>>0)/4294967296}function Ct(e=Date.now()){if(F=e,typeof e=="string"){for(var t=0,n=1779033703^e.length;t<e.length;t++)n=Math.imul(n^e.charCodeAt(t),3432918353),n=n<<13|n>>>19;n=Math.imul(n^n>>>16,2246822507),n=Math.imul(n^n>>>13,3266489909),F=(n^=n>>>16)>>>0}}function Ie(e){if(+e==e)return e;let t=[],n=e.split(".."),i=+n[0],s=+n[1],r=i;if(i<s)for(;r<=s;r++)t.push(r);else for(;r>=s;r--)t.push(r);return t}class Me{constructor({image:t,frameWidth:n,frameHeight:i,spacing:s=0,margin:r=0,animations:a}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:n,height:i,spacing:s,margin:r},this._f=(t.width-r)/n|0,this.createAnimations(a)}createAnimations(t){let n,i;for(i in t){let{frames:s,frameRate:r,loop:a}=t[i];if(n=[],s==null)throw Error("Animation "+i+" must provide a frames property");[].concat(s).map(o=>{n=n.concat(Ie(o))}),this.animations[i]=le({spriteSheet:this,frames:n,frameRate:r,loop:a,name:i})}}}function He(){return new Me(...arguments)}let $e=2147483648,Fe=1073741824,Bt=536870912;function st(e,t){return e/t|0}function rt(e,t){return e/t|0}class We{constructor(t={}){let{width:n,height:i,tilewidth:s,tileheight:r,tilesets:a}=t,o=n*s,c=i*r,u=document.createElement("canvas");u.width=o,u.height=c,this._c=u,this._ctx=u.getContext("2d"),a.map(f=>{let{__k:d,location:m}=window,p=(d?d.dm.get(t):"")||m.href,{source:E}=f;if(E){if(!d)throw Error('You must use "load" or "loadData" to resolve tileset.source');let y=d.d[d.u(E,p)];if(!y)throw Error(`You must load the tileset source "${E}" before loading the tileset`);Object.keys(y).map(C=>{f[C]=y[C]})}let{image:_}=f;if(""+_===_){if(!d)throw Error('You must use "load" or "loadImage" to resolve tileset.image');let y=d.i[d.u(_,p)];if(!y)throw Error(`You must load the image "${_}" before loading the tileset`);f.image=y}}),Object.assign(this,{context:M(),layerMap:{},layerCanvases:{},mapwidth:o,mapheight:c,_sx:0,_sy:0,_o:[],...t}),this.context&&this._p(),ht("init",()=>{this.context??=M(),this._p()})}get sx(){return this._sx}get sy(){return this._sy}set sx(t){let n=Math.max(0,this.mapwidth-N().width);this._sx=q(0,n,t)}set sy(t){let n=Math.max(0,this.mapheight-N().height);this._sy=q(0,n,t)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map(n=>{this._o.push(n),n.parent=this})}remove(...t){t.flat().map(n=>{Zt(this._o,n),n.parent=null})}getPosition(t){let n=N().getBoundingClientRect(),i=t.x-n.x,s=t.y-n.y;return i+=this.sx,s+=this.sy,{x:i,y:s,row:st(s,this.tileheight),col:rt(i,this.tilewidth)}}setTileAtLayer(t,n,i){let{layerMap:s,tileheight:r,tilewidth:a,width:o}=this,{row:c,col:u,x:f,y:d}=n,m=c??st(d,r),p=u??rt(f,a);s[t]&&(this._d=!0,s[t]._d=!0,s[t].data[m*o+p]=i)}setLayer(t,n){let{layerMap:i}=this;i[t]&&(this._d=!0,i[t]._d=!0,i[t].data=n)}layerCollidesWith(t,n){let{tilewidth:i,tileheight:s,layerMap:r}=this,{x:a,y:o,width:c,height:u}=Vt(n),f=st(o,s),d=rt(a,i),m=st(o+u,s),p=rt(a+c,i),E=r[t];for(let _=f;_<=m;_++)for(let y=d;y<=p;y++)if(E.data[y+_*this.width])return!0;return!1}tileAtLayer(t,n){let{layerMap:i,tileheight:s,tilewidth:r,width:a}=this,{row:o,col:c,x:u,y:f}=n,d=o??st(f,s),m=c??rt(u,r);return i[t]?i[t].data[d*a+m]:-1}render(t=this._c,n=!0){let{_d:i,context:s,sx:r=0,sy:a=0}=this;i&&this._p();let{width:o,height:c}=N(),u=Math.min(t.width,o),f=Math.min(t.height,c);s.drawImage(t,r,a,u,f,0,0,u,f),n&&(s.save(),(r||a)&&s.translate(-r,-a),this.objects.map(d=>d.render&&d.render()),s.restore())}renderLayer(t){let{layerCanvases:n,layerMap:i}=this,s=i[t],r=n[t],a=r?.getContext("2d");if(!r){let{mapwidth:o,mapheight:c}=this;r=document.createElement("canvas"),a=r.getContext("2d"),r.width=o,r.height=c,n[t]=r,this._rl(s,a)}s._d&&(s._d=!1,a.clearRect(0,0,r.width,r.height),this._rl(s,a)),this.render(r,!1)}_p(){let{_ctx:t,layers:n=[],layerMap:i}=this;this._d=!1,n.map(s=>{let{name:r,data:a,visible:o}=s;s._d=!1,i[r]=s,a&&o!=!1&&this._rl(s,t)})}_rl(t,n){let{opacity:i,data:s=[]}=t,{tilesets:r,width:a,tilewidth:o,tileheight:c}=this;n.save(),n.globalAlpha=i,s.map((u,f)=>{if(!u)return;let d=0,m=0,p=u&$e,E=u&Fe,_=0,y=0,C=0,T=0,dt=0;d=p||E,u&=1073741823,dt=u&Bt,dt&&(p&&E?C=1:p?_=1:E?y=1:T=1,m=_||y||C||T,u&=~Bt);let B;for(let g=r.length-1;g>=0&&(B=r[g],!(u/B.firstgid>=1));g--);let{image:bt,spacing:b=0,margin:L=0,firstgid:H,columns:$}=B,O=u-H,I=$??bt.width/(o+b)|0,D=f%a*o,Y=(f/a|0)*c,Wt=L+O%I*(o+b),l=L+(O/I|0)*(c+b);m?(n.save(),n.translate(D+o/2,Y+c/2),y||T?n.rotate(-Math.PI/2):(_||C)&&n.rotate(Math.PI/2),(C||T)&&n.scale(-1,1),D=-o/2,Y=-c/2):d&&(n.save(),n.translate(D+(p?o:0),Y+(E?c:0)),n.scale(p?-1:1,E?-1:1),D=d?0:D,Y=d?0:Y),n.drawImage(bt,Wt,l,o,c,D,Y,o,c),(d||m)&&n.restore()}),n.restore()}}function Ye(){return new We(...arguments)}function Ge(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var kt={exports:{}},Pt,zt;function Ue(){return zt||(zt=1,Pt=function(e,t){this.reset=function(){this.cards=e.slice(0),this.length=this.cards.length},this.shuffle=function(){n(this.cards)},this.reset(),this.shuffle(),this.deal=function(i,s){for(var r=0;r<i;r++)for(var a=0;a<s.length;a++){if(!s[a]||!s[a].push)throw new Error("Deck#deal | Undefined Hand");s[a].push(this.cards.pop())}this.length=this.cards.length},this.draw=function(i){if(!i||i<=1)return this.length=this.cards.length-1,this.cards.pop();for(var s=[],r=0;r<i;r++)s.push(this.cards.pop());return this.length=this.cards.length,s},this.drawFromBottomOfDeck=function(i){(!i||i<1)&&(i=1);for(var s=[],r=0;r<i;r++)s.push(this.cards.shift());return this.length=this.cards.length,s.length===1?s[0]:s},this.drawRandom=function(i){var s=function(){var o=Math.floor(t()*this.cards.length),c=this.cards[o];return this.cards.splice(o,1),this.length=this.cards.length,c};if(!i||i<=1)return s.apply(this);for(var r=[],a=0;a<i;a++)r.push(s.apply(this));return r},this.putOnTopOfDeck=function(i){if(!i instanceof Array)this.cards.push(i);else for(var s=0;s<i.length;s++)this.cards.push(i[s]);this.length=this.cards.length},this.putOnBottomOfDeck=function(i){if(!i instanceof Array)this.cards.unshift(i);else for(var s=0;s<i.length;s++)this.cards.unshift(i[s]);this.length=this.cards.length};function n(i){var s=i.length;if(s===0)return!1;for(;--s;){var r=Math.floor(t()*(s+1)),a=i[s],o=i[r];i[s]=o,i[r]=a}}}),Pt}var At,Kt;function Ne(){return Kt||(Kt=1,At=function(e,t,n){this.suit=e,this.description=t,this.sort=n,this.toString=function(){return this.description+" of "+this.suit+"s"},this.toShortDisplayString=function(){var i=this.suit.substring(0,1),s;switch(this.sort){case 11:s="J";break;case 12:s="Q";break;case 13:s="K";break;case 14:s="A";break;default:s=this.sort}return s+i}}),At}var Rt,jt;function qe(){if(jt)return Rt;jt=1;var e=Ne();return Rt=function(){this.cards=[new e("Club","Two",2),new e("Club","Three",3),new e("Club","Four",4),new e("Club","Five",5),new e("Club","Six",6),new e("Club","Seven",7),new e("Club","Eight",8),new e("Club","Nine",9),new e("Club","Ten",10),new e("Club","Jack",11),new e("Club","Queen",12),new e("Club","King",13),new e("Club","Ace",14),new e("Diamond","Two",2),new e("Diamond","Three",3),new e("Diamond","Four",4),new e("Diamond","Five",5),new e("Diamond","Six",6),new e("Diamond","Seven",7),new e("Diamond","Eight",8),new e("Diamond","Nine",9),new e("Diamond","Ten",10),new e("Diamond","Jack",11),new e("Diamond","Queen",12),new e("Diamond","King",13),new e("Diamond","Ace",14),new e("Heart","Two",2),new e("Heart","Three",3),new e("Heart","Four",4),new e("Heart","Five",5),new e("Heart","Six",6),new e("Heart","Seven",7),new e("Heart","Eight",8),new e("Heart","Nine",9),new e("Heart","Ten",10),new e("Heart","Jack",11),new e("Heart","Queen",12),new e("Heart","King",13),new e("Heart","Ace",14),new e("Spade","Two",2),new e("Spade","Three",3),new e("Spade","Four",4),new e("Spade","Five",5),new e("Spade","Six",6),new e("Spade","Seven",7),new e("Spade","Eight",8),new e("Spade","Nine",9),new e("Spade","Ten",10),new e("Spade","Jack",11),new e("Spade","Queen",12),new e("Spade","King",13),new e("Spade","Ace",14)]},Rt}var Jt;function Xe(){if(Jt)return kt.exports;Jt=1;var e=Ue(),t=qe(),n=kt.exports={},i={deck:new t().cards,numberOfDecks:1,random:function(){return Math.random()}};return n.playingCards=function(){return new t().cards},n.shuffle=function(s){if(s||(s=i),s.deck||(s.deck=i.deck),s.numberOfDecks)for(var r=s.deck,a=0;a<s.numberOfDecks-1;a++)s.deck=s.deck.concat(r);return s.random||(s.random=i.random),new e(s.deck,s.random)},kt.exports}var Be=Xe();const lt=Ge(Be),j=1,J=2,Q=3,V=4,Z=5,tt=6,mt=1,yt=2,_t=3,xt=4,et=[{id:1,name:"Fools' Landing",flooded:!1,adventurer:tt},{id:2,name:"Cave of Shadows",flooded:!1,treasure:_t},{id:3,name:"Temple of the Moon",flooded:!1,treasure:mt},{id:4,name:"Copper Gate",flooded:!1,adventurer:Q},{id:5,name:"Whispering Garden",flooded:!1,treasure:yt},{id:6,name:"Dunes of Deception",flooded:!1},{id:7,name:"Silver Gate",flooded:!1,adventurer:V},{id:8,name:"Observatory",flooded:!1},{id:9,name:"Breakers Bridge",flooded:!1},{id:10,name:"Twilight Hollow",flooded:!1},{id:11,name:"Lost Lagoon",flooded:!1},{id:12,name:"Bronze Gate",flooded:!1,adventurer:J},{id:13,name:"Phantom Rock",flooded:!1},{id:14,name:"Watchtower",flooded:!1},{id:15,name:"Cliffs of Abandon",flooded:!1},{id:16,name:"Misty Marsh",flooded:!1},{id:17,name:"Coral Palace",flooded:!1,treasure:xt},{id:18,name:"Howling Garden",flooded:!1,treasure:yt},{id:19,name:"Iron Gate",flooded:!1,adventurer:j},{id:20,name:"Gold Gate",flooded:!1,adventurer:Z},{id:21,name:"Crimson Forest",flooded:!1},{id:22,name:"Temple of the Sun",flooded:!1,treasure:mt},{id:23,name:"Cave of Embers",flooded:!1,treasure:_t},{id:24,name:"Tidal Palace",flooded:!1,treasure:xt}],ze=[{id:V,name:"Messenger",color:"silver",type:"adventurer"},{id:tt,name:"Pilot",color:"blue",type:"adventurer"},{id:J,name:"Engineer",color:"red",type:"adventurer"},{id:Q,name:"Explorer",color:"green",type:"adventurer"},{id:j,name:"Diver",color:"black",type:"adventurer"},{id:Z,name:"Navigator",color:"yellow",type:"adventurer"}],Ke=[{name:"Fools' Landing",type:"flood"},{name:"Cave of Shadows",type:"flood"},{name:"Temple of the Moon",type:"flood"},{name:"Copper Gate",type:"flood"},{name:"Whispering Garden",type:"flood"},{name:"Dunes of Deception",type:"flood"},{name:"Silver Gate",type:"flood"},{name:"Observatory",type:"flood"},{name:"Breakers Bridge",type:"flood"},{name:"Twilight Hollow",type:"flood"},{name:"Lost Lagoon",type:"flood"},{name:"Bronze Gate",type:"flood"},{name:"Phantom Rock",type:"flood"},{name:"Watchtower",type:"flood"},{name:"Cliffs of Abandon",type:"flood"},{name:"Misty Marsh",type:"flood"},{name:"Coral Palace",type:"flood"},{name:"Howling Garden",type:"flood"},{name:"Iron Gate",type:"flood"},{name:"Gold Gate",type:"flood"},{name:"Crimson Forest",type:"flood"},{name:"Temple of the Sun",type:"flood"},{name:"Cave of Embers",type:"flood"},{name:"Tidal Palace",type:"flood"}];function G(e,t){const n=[];for(let i=0;i<e;++i)n.push(t);return n}const je=[...G(5,{name:"The Earth Stone",type:"treasure"}),...G(5,{name:"The Statue of the Wind",type:"treasure"}),...G(5,{name:"The Crystal of Fire",type:"treasure"}),...G(5,{name:"The Ocean's Chalice",type:"treasure"}),...G(3,{name:"Waters Rise!",type:"treasure"}),...G(3,{name:"Helicopter Lift",type:"treasure"}),...G(3,{name:"Sandbags",type:"treasure"})],ne=[...ze,...Ke,...je],St=2,at=512,ot=256,R=32*St,v=32*St,ct=24*St,ft=24*St,S=R/4/2,Je="lime",Qe=2,Ve="aqua",Ze="adventurer-deck",ti="flood-deck",ei="island-tiles-deck",ii="treasure-deck",ni=6;Ct(Ze);const si=lt.shuffle({deck:ne.filter(({type:e})=>e==="adventurer"),random:vt}),se=""+new URL("spritesheet-Dm4BmPvg.png",import.meta.url).href,re=""+new URL("tilesheet-C_zpU0l5.png",import.meta.url).href,ri=[se,re],ai=e=>Ee(...ri);Ct(ti);const oi=lt.shuffle({deck:et,random:vt});function hi(){function e(){this.context.fillStyle=this.color,this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,2*Math.PI),this.context.fill(),this.context.lineWidth=2,this.context.strokeStyle="white",this.context.stroke()}const t=P({color:"black",id:j,radius:S,render(){e.call(this)}}),n=P({color:"red",id:J,radius:S,render(){e.call(this)}}),i=P({color:"green",id:Q,radius:S,render(){e.call(this)}}),s=P({color:"silver",id:V,radius:S,render(){e.call(this)}}),r=P({color:"yellow",id:Z,radius:S,render(){e.call(this)}}),a=P({color:"blue",id:tt,radius:S,render(){e.call(this)}});return{diverPawn:t,engineerPawn:n,explorerPawn:i,messengerPawn:s,navigatorPawn:r,pilotPawn:a}}function li(){return P({color:Je,render(){if(this.context.beginPath(),this.radius!==void 0)this.context.arc(this.radius,this.radius,this.radius,0,2*Math.PI);else if(this.width!==void 0&&this.height!==void 0)this.context.rect(0,0,this.width,this.height);else return;this.context.lineWidth=Qe,this.context.strokeStyle=this.color,this.context.stroke()}})}function di(){const e=He({image:W[se],frameWidth:R,frameHeight:v,animations:et.map((n,i)=>({[i]:{frames:i*2,frameRate:1},[`${i}-flooded`]:{frames:[i*2+1],frameRate:1}})).reduce((n,i)=>({...n,...i}))}),t=[];for(let n=0;n<et.length;++n){const i=P({animations:e.animations,id:1+n,flooded:et[n].flooded});i.playAnimation(n),t.push(i)}return t}async function ci(){try{const e=W[re];return Ye({tilewidth:R,tileheight:v,width:8,height:8,tilesets:[{firstgid:0,image:e}],layers:[{name:"ground",data:[0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,0,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0]}]})}catch(e){return console.error(e),null}}function fi(){const e=P({color:"brown",width:ct,height:ft,id:mt}),t=P({color:"yellow",width:ct,height:ft,id:yt}),n=P({color:"red",width:ct,height:ft,id:_t}),i=P({color:"blue",width:ct,height:ft,id:xt});return{theCrystalOfFire:n,theEarthStone:e,theOceansChalice:i,theStatueOfTheWind:t}}function ui(){return P({x:0,y:0,color:Ve,width:at,height:ot})}Ct(ei);const pi=lt.shuffle({deck:et,random:vt});function wi(e){return function(){const{innerWidth:t,innerHeight:n}=window,i=t/n,s=at/ot;i<s?(e.style.width=`${t}px`,e.style.height=`${t/s}px`):(e.style.width=`${n*s}px`,e.style.height=`${n}px`)}}Ct(ii);const ut=lt.shuffle({deck:ne.filter(({type:e})=>e==="treasure"),random:vt}),gi=25.25,mi="0.0.33",Qt={hours:gi,version:mi};async function yi(){const{canvas:e,context:t}=he();e.width=at,e.height=ot;const n=wi(e);n(),window.addEventListener("resize",n),Re();const i=`v${Qt.version}`,s=`${Qt.hours}h`,r=Gt({text:`${i}
${s}`,font:`${v/4}px Courier`,color:"white",x:at-R/4*Math.max(i.length,s.length),y:v/4}),a=Gt({font:`${v/4}px Arial`,color:"white",x:R/4,y:v/4});await ai();const o=await ci();if(o===null)return 1;o.sx=(R*8-at)/2,o.sy=(v*8-ot)/2;const c=()=>{const{y:l}=De();if(l<v){let g=o.sy-v;g=q(0,o.mapheight-v-1,g),o.sy=g}else if(l>ot-v-1){let g=o.sy+v;g=q(0,o.mapheight-v-1,g),o.sy=g}};o.onDown=()=>{c(),m(),a.text=""},k(o);const u=ui();u.onDown=()=>{c(),m(),a.text=""},k(u);const f=li(),d=l=>{f.x=l.x,f.y=l.y,l.radius?(f.radius=l.radius,f.width=f.height=void 0):(f.width=l.width,f.height=l.height,f.radius=void 0)},m=()=>{f.width=f.height=f.radius=void 0},p=di(),E=o.layers.find(({name:l})=>l==="ground");if(E!==void 0){for(let l=0;l<o.height;++l)for(let g=0;g<o.width;++g)if(E.data[l*o.width+g]!==0){const h=pi.draw(),x=p[h.id-1];x.x=g*x.width,x.y=l*x.height,x.onDown=()=>{c();let w=h.name;if(x.flooded&&(w+=`
FLOODED!`),h.adventurer!==void 0)switch(h.adventurer){case j:w+=`
(Diver)`;break;case J:w+=`
(Engineer)`;break;case Q:w+=`
(Explorer)`;break;case V:w+=`
(Messenger)`;break;case Z:w+=`
(Navigator)`;break;case tt:w+=`
(Pilot)`}if(h.treasure!==void 0)switch(h.treasure){case _t:w+=`
(The Crystal of Fire)`;break;case mt:w+=`
(The Earth Stone)`;break;case xt:w+=`
(The Ocean's Chalice)`;break;case yt:w+=`
(The Statue of the Wind)`}d(x),a.text=w},k(x),o.add(x)}}const{theCrystalOfFire:_,theEarthStone:y,theOceansChalice:C,theStatueOfTheWind:T}=fi();y.x=p[0].width+(p[0].width-y.width)/2,y.y=p[0].height+(p[0].height-y.height)/2,y.onDown=()=>{d(y),a.text="The Earth Stone"},k(y),o.add(y),T.x=p[0].width+(p[0].width-T.width)/2,T.y=p[0].height*6+(p[0].height-T.height)/2,T.onDown=()=>{d(T),a.text="The Statue of the Wind"},k(T),o.add(T),_.x=p[0].width*6+(p[0].width-_.width)/2,_.y=p[0].height+(p[0].height-_.height)/2,_.onDown=()=>{d(_),a.text="The Crystal of Fire"},k(_),o.add(_),C.x=p[0].width*6+(p[0].width-C.width)/2,C.y=p[0].height*6+(p[0].height-C.height)/2,C.onDown=()=>{d(C),a.text="The Ocean's Chalice"},k(C),o.add(C);const dt={...oi},B=[];for(let l=0;l<6;++l){const g=dt.draw(),h=p.find(({id:x})=>x===g.id);h.flooded=!0,h.playAnimation(`${h.id-1}-flooded`),B.push(g)}lt.shuffle({deck:[]}).putOnTopOfDeck(B);const b=[];for(let l=0;l<ni;++l)b.push({name:`Player ${l+1}`,adventurerCard:si.draw(),cards:[]});const{diverPawn:L,engineerPawn:H,explorerPawn:$,messengerPawn:O,navigatorPawn:I,pilotPawn:D}=hi();for(const l of p){const g=et.find(({id:h})=>h===l.id);if(g!==void 0&&!(g.adventurer!==void 0&&!b.map(({adventurerCard:h})=>h.id).includes(g.adventurer)))switch(g.adventurer){case j:L.x=l.x+(R-S*2)/2,L.y=l.y+(v-S*2)/2,L.onDown=()=>{d(L);const h=b.find(({adventurerCard:w})=>w.id===j);if(h===void 0)return;const x=`${h.name}: ${h.adventurerCard.name}
Cards: `+h.cards.map(({name:w})=>w).join(", ");a.text=x},k(L),o.add(L);break;case J:H.x=l.x+(R-S*2)/2,H.y=l.y+(v-S*2)/2,H.onDown=()=>{d(H);const h=b.find(({adventurerCard:w})=>w.id===J);if(h===void 0)return;const x=`${h.name}: ${h.adventurerCard.name}
Cards: `+h.cards.map(({name:w})=>w).join(", ");a.text=x},k(H),o.add(H);break;case Q:$.x=l.x+(R-S*2)/2,$.y=l.y+(v-S*2)/2,$.onDown=()=>{d($);const h=b.find(({adventurerCard:w})=>w.id===Q);if(h===void 0)return;const x=`${h.name}: ${h.adventurerCard.name}
Cards: `+h.cards.map(({name:w})=>w).join(", ");a.text=x},k($),o.add($);break;case V:O.x=l.x+(R-S*2)/2,O.y=l.y+(v-S*2)/2,O.onDown=()=>{d(O);const h=b.find(({adventurerCard:w})=>w.id===V);if(h===void 0)return;const x=`${h.name}: ${h.adventurerCard.name}
Cards: `+h.cards.map(({name:w})=>w).join(", ");a.text=x},k(O),o.add(O);break;case Z:I.x=l.x+(R-S*2)/2,I.y=l.y+(v-S*2)/2,I.onDown=()=>{d(I);const h=b.find(({adventurerCard:w})=>w.id===Z);if(h===void 0)return;const x=`${h.name}: ${h.adventurerCard.name}
Cards: `+h.cards.map(({name:w})=>w).join(", ");a.text=x},k(I),o.add(I);break;case tt:D.x=l.x+(R-S*2)/2,D.y=l.y+(v-S*2)/2,D.onDown=()=>{d(D);const h=b.find(({adventurerCard:w})=>w.id===tt);if(h===void 0)return;const x=`${h.name}: ${h.adventurerCard.name}
Cards: `+h.cards.map(({name:w})=>w).join(", ");a.text=x},k(D),o.add(D);break}}o.add(f),ut.deal(2,b.map(({cards:l})=>l));for(const l of b){let g=l.cards.filter(({name:h})=>h==="Waters Rise!").length;for(;g>0;){console.log("Waters Rise! Replacement card required");for(let h=0;h<l.cards.length;++h)if(l.cards[h].name==="Waters Rise!"){const x=l.cards[h],w=ut.draw();l.cards[h]=w,ut.putOnTopOfDeck(x),ut.shuffle()}g=l.cards.filter(({name:h})=>h==="Waters Rise!").length}}return(()=>{a.text=b.map(({name:l,adventurerCard:g})=>`${l}: ${g.name}`).join(`
`)})(),Oe({render(){u.render(),o.render(),t.fillStyle="rgba(0, 0, 0, 0.67)",t.fillRect(r.x,r.y,r.width,r.height),r.render(),t.fillStyle="rgba(0, 0, 0, 0.67)",t.fillRect(a.x,a.y,a.width,a.height),a.render()},update(){}}).start(),0}yi();
