(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function i(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=i(s);fetch(s.href,r)}})();/**
 * @preserve
 * Kontra.js v10.0.2
 */function he(e,t){let i=Math.sin(t),n=Math.cos(t);return{x:e.x*n-e.y*i,y:e.x*i+e.y*n}}function X(e,t,i){return Math.min(Math.max(e,i),t)}function te(e){let{x:t=0,y:i=0,width:n,height:s,radius:r}=e.world||e;return e.mapwidth&&(n=e.mapwidth,s=e.mapheight),r&&(n=r.x*2,s=r.y*2),e.anchor&&(t-=n*e.anchor.x,i-=s*e.anchor.y),n<0&&(t+=n,n*=-1),s<0&&(i+=s,s*=-1),{x:t,y:i,width:n,height:s}}let yt=()=>{};function ee(e,t){let i=e.indexOf(t);if(i!=-1)return e.splice(i,1),!0}function le(e,t){let{x:i,y:n,width:s,height:r}=te(t);do i-=t.sx||0,n-=t.sy||0;while(t=t.parent);let a=e.x-Math.max(i,Math.min(e.x,i+s)),o=e.y-Math.max(n,Math.min(e.y,n+r));return a*a+o*o<e.radius*e.radius}let gt={};function lt(e,t){gt[e]=gt[e]||[],gt[e].push(t)}function B(e,...t){(gt[e]||[]).map(i=>i(...t))}let N,mt,Nt={get(e,t){return t=="_proxy"?!0:yt}};function q(){return N}function F(){return mt}function de(e,{contextless:t=!1}={}){if(N=document.getElementById(e)||e||document.querySelector("canvas"),t&&(N=N||new Proxy({},Nt)),!N)throw Error("You must provide a canvas element for the game");return mt=N.getContext("2d")||new Proxy({},Nt),mt.imageSmoothingEnabled=!1,B("init"),{canvas:N,context:mt}}class Mt{constructor({spriteSheet:t,frames:i,frameRate:n,loop:s=!0,name:r}){let{width:a,height:o,spacing:l=0,margin:c=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:i,frameRate:n,loop:s,name:r,width:a,height:o,spacing:l,margin:c,isStopped:!1,_f:0,_a:0})}clone(){return new Mt(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped){if(!this.loop&&this._f==this.frames.length-1){this.stop();return}for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}}render({x:t,y:i,width:n=this.width,height:s=this.height,context:r=F()}){let a=this.frames[this._f]/this.spriteSheet._f|0,o=this.frames[this._f]%this.spriteSheet._f|0;r.drawImage(this.spriteSheet.image,this.margin+o*this.width+(o*2+1)*this.spacing,this.margin+a*this.height+(a*2+1)*this.spacing,this.width,this.height,t,i,n,s)}}function ce(){return new Mt(...arguments)}let fe=/(jpeg|jpg|gif|png|webp)$/,ue=/(wav|mp3|ogg|aac)$/,we=/^\//,pe=/\/$/,ie=new WeakMap,ge="",me="",ye="";function St(e,t){return new URL(e,t).href}function Ht(e,t){return[e.replace(pe,""),t].filter(i=>i).join("/")}function Ft(e){return e.split(".").pop()}function Wt(e){let t=e.replace("."+Ft(e),"");return t.split("/").length==2?t.replace(we,""):t}function _e(e){return{wav:e.canPlayType('audio/wav; codecs="1"'),mp3:e.canPlayType("audio/mpeg;"),ogg:e.canPlayType('audio/ogg; codecs="vorbis"'),aac:e.canPlayType("audio/aac;")}}let Y={},tt={},K={};function $t(){window.__k||(window.__k={dm:ie,u:St,d:K,i:Y})}function xe(e){return $t(),new Promise((t,i)=>{let n,s,r;if(n=Ht(ge,e),Y[n])return t(Y[n]);s=new Image,s.onload=function(){r=St(n,window.location.href),Y[Wt(e)]=Y[n]=Y[r]=this,B("assetLoaded",this,e),t(this)},s.onerror=function(){i("Unable to load image "+n)},s.src=n})}function Ee(e){return new Promise((t,i)=>{let n=e,s,r,a,o;if(s=new Audio,r=_e(s),e=[].concat(e).reduce((l,c)=>l||(r[Ft(c)]?c:null),0),!e)return i("cannot play any of the audio formats provided "+n);if(a=Ht(me,e),tt[a])return t(tt[a]);s.addEventListener("canplay",function(){o=St(a,window.location.href),tt[Wt(e)]=tt[a]=tt[o]=this,B("assetLoaded",this,e),t(this)}),s.onerror=function(){i("Unable to load audio "+a)},s.src=a,s.load()})}function ve(e){$t();let t,i;return t=Ht(ye,e),K[t]?Promise.resolve(K[t]):fetch(t).then(n=>{if(!n.ok)throw n;return n.clone().json().catch(()=>n.text())}).then(n=>(i=St(t,window.location.href),typeof n=="object"&&ie.set(n,i),K[Wt(e)]=K[t]=K[i]=n,B("assetLoaded",n,e),n))}function Se(...e){return $t(),Promise.all(e.map(t=>{let i=Ft([].concat(t)[0]);return i.match(fe)?xe(t):i.match(ue)?Ee(t):ve(t)}))}class V{constructor(t=0,i=0,n={}){t.x!=null?(this.x=t.x,this.y=t.y):(this.x=t,this.y=i),n._c&&(this.clamp(n._a,n._b,n._d,n._e),this.x=t,this.y=i)}set(t){this.x=t.x,this.y=t.y}add(t){return new V(this.x+t.x,this.y+t.y,this)}subtract(t){return new V(this.x-t.x,this.y-t.y,this)}scale(t){return new V(this.x*t,this.y*t)}normalize(t=this.length()||1){return new V(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,i,n,s){this._c=!0,this._a=t,this._b=i,this._d=n,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?X(this._a,this._d,t):t}set y(t){this._y=this._c?X(this._b,this._e,t):t}}function kt(){return new V(...arguments)}class Ce{constructor(t){return this.init(t)}init(t={}){this.position=kt(),this.velocity=kt(),this.acceleration=kt(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let i=this.acceleration;t&&(i=i.scale(t)),this.velocity=this.velocity.add(i);let n=this.velocity;t&&(n=n.scale(t)),this.position=this.position.add(n),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}class ne extends Ce{init({width:t=0,height:i=0,context:n=F(),render:s=this.draw,update:r=this.advance,children:a=[],anchor:o={x:0,y:0},opacity:l=1,rotation:c=0,drotation:d=0,ddrotation:f=0,scaleX:p=1,scaleY:u=1,..._}={}){this._c=[],super.init({width:t,height:i,context:n,anchor:o,opacity:l,rotation:c,drotation:d,ddrotation:f,scaleX:p,scaleY:u,..._}),this._di=!0,this._uw(),this.addChild(a),this._rf=s,this._uf=r,lt("init",()=>{this.context??=F()})}update(t){this._uf(t),this.children.map(i=>i.update&&i.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let i=this.width,n=this.height;this.radius&&(i=n=this.radius*2);let s=-i*this.anchor.x,r=-n*this.anchor.y;(s||r)&&t.translate(s,r),this.context.globalAlpha=this.opacity,this._rf(),(s||r)&&t.translate(-s,-r),this.children.map(o=>o.render&&o.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:i=0,_wo:n=1,_wrot:s=0,_wsx:r=1,_wsy:a=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this.radius&&(this._wrx=this.radius,this._wry=this.radius),this._wo=n*this.opacity,this._wsx=r*this.scaleX,this._wsy=a*this.scaleY,this._wx=this._wx*r,this._wy=this._wy*a,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this.radius&&(this._wrx=this.radius*this._wsx,this._wry=this.radius*this._wsy),this._wrot=s+this.rotation;let{x:o,y:l}=he({x:this._wx,y:this._wy},s);this._wx=o,this._wy=l,this._wx+=t,this._wy+=i}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,radius:this.radius?{x:this._wrx,y:this._wry}:void 0,opacity:this._wo,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(i=>{this.children.push(i),i.parent=this,i._pc=i._pc||yt,i._pc()})}removeChild(...t){t.flat().map(i=>{ee(this.children,i)&&(i.parent=null,i._pc())})}get radius(){return this._r}set radius(t){this._r=t,this._pc()}get opacity(){return this._opa}set opacity(t){this._opa=X(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}advance(t){super.advance(t),this.drotation+=this.ddrotation,this.rotation+=this.drotation}setScale(t,i=t){this.scaleX=t,this.scaleY=i}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class Te extends ne{init({image:t,width:i=t?t.width:void 0,height:n=t?t.height:void 0,...s}={}){super.init({image:t,width:i,height:n,...s})}get animations(){return this._a}set animations(t){let i,n;this._a={};for(i in t)this._a[i]=t[i].clone(),n=n||this._a[i];this.currentAnimation=n,this.width=this.width||n.width,this.height=this.height||n.height}playAnimation(t){this.currentAnimation?.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){super.advance(t),this.currentAnimation?.update(t)}draw(){if(this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color){if(this.context.fillStyle=this.color,this.radius){this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.context.fill();return}this.context.fillRect(0,0,this.width,this.height)}}}function A(){return new Te(...arguments)}let be=/(\d+)(\w+)/;function De(e){if(!e)return{computed:0};let t=e.match(be),i=+t[1],n=t[2];return{size:i,unit:n,computed:i}}class ke extends ne{init({text:t="",textAlign:i="",lineHeight:n=1,font:s=F()?.font,...r}={}){t=""+t,super.init({text:t,textAlign:i,lineHeight:n,font:s,...r}),this.context&&this._p(),lt("init",()=>{this.font??=F().font,this._p()})}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=De(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context,i=[this.text];if(t.font=this.font,i=this.text.split(`
`),this._fw&&i.map(n=>{let s=n.split(" "),r=s.shift(),a=r;s.map(o=>{a+=" "+o,t.measureText(a).width>this._fw&&(this._s.push(r),a=o),r=a}),this._s.push(a)}),!this._s.length&&this.text.includes(`
`)){let n=0;i.map(s=>{this._s.push(s),n=Math.max(n,t.measureText(s).width)}),this._w=this._fw||n}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,i=this.textAlign,n=this.context;i=this.textAlign||(n.canvas.dir=="rtl"?"right":"left"),t=i=="right"?this.width:i=="center"?this.width/2|0:0,this._s.map((s,r)=>{n.textBaseline="top",n.textAlign=i,n.fillStyle=this.color,n.font=this.font,this.strokeColor&&(n.strokeStyle=this.strokeColor,n.lineWidth=this.lineWidth??1,n.strokeText(s,t,this._fs*this.lineHeight*r)),n.fillText(s,t,this._fs*this.lineHeight*r)})}}function It(){return new ke(...arguments)}let Z=new WeakMap,qt={},Ut={},se={0:"left",1:"middle",2:"right"};function Pe(e=q()){return Z.get(e)}function Ae(e){let t=e._lf.length?e._lf:e._cf;for(let i=t.length-1;i>=0;i--){let n=t[i];if(n.collidesWithPointer?n.collidesWithPointer(e):le(e,n))return n}}function R(e,t){return parseFloat(e.getPropertyValue(t))||0}function Re(e){let{canvas:t,_s:i}=e,n=t.getBoundingClientRect(),s=i.transform!="none"?i.transform.replace("matrix(","").split(","):[1,1,1,1],r=parseFloat(s[0]),a=parseFloat(s[3]),o=(R(i,"border-left-width")+R(i,"border-right-width"))*r,l=(R(i,"border-top-width")+R(i,"border-bottom-width"))*a,c=(R(i,"padding-left")+R(i,"padding-right"))*r,d=(R(i,"padding-top")+R(i,"padding-bottom"))*a;return{scaleX:(n.width-o-c)/t.width,scaleY:(n.height-l-d)/t.height,offsetX:n.left+(R(i,"border-left-width")+R(i,"padding-left"))*r,offsetY:n.top+(R(i,"border-top-width")+R(i,"padding-top"))*a}}function Xt(e){let t=e.button!=null?se[e.button]:"left";Ut[t]=!0,Yt(e,"onDown")}function Pt(e){let t=e.button!=null?se[e.button]:"left";Ut[t]=!1,Yt(e,"onUp")}function Bt(e){Yt(e,"onOver")}function Le(e){let t=Z.get(e.target);t._oo=null,Ut={}}function zt(e,t,i){let n=Ae(e);n&&n[t]&&n[t](i),qt[t]&&qt[t](i,n),t=="onOver"&&(n!=e._oo&&e._oo&&e._oo.onOut&&e._oo.onOut(i),e._oo=n)}function Yt(e,t){e.preventDefault();let i=e.target,n=Z.get(i),{scaleX:s,scaleY:r,offsetX:a,offsetY:o}=Re(n);e.type.includes("touch")?(Array.from(e.touches).map(({clientX:c,clientY:d,identifier:f})=>{let p=n.touches[f];p||(p=n.touches[f]={start:{x:(c-a)/s,y:(d-o)/r}},n.touches.length++),p.changed=!1}),Array.from(e.changedTouches).map(({clientX:c,clientY:d,identifier:f})=>{let p=n.touches[f];p.changed=!0,p.x=n.x=(c-a)/s,p.y=n.y=(d-o)/r,zt(n,t,e),B("touchChanged",e,n.touches),t=="onUp"&&(delete n.touches[f],n.touches.length--,n.touches.length||B("touchEnd"))})):(n.x=(e.clientX-a)/s,n.y=(e.clientY-o)/r,zt(n,t,e))}function Oe({radius:e=5,canvas:t=q()}={}){let i=Z.get(t);if(!i){let n=window.getComputedStyle(t);i={x:0,y:0,radius:e,touches:{length:0},canvas:t,_cf:[],_lf:[],_o:[],_oo:null,_s:n},Z.set(t,i)}return t.addEventListener("mousedown",Xt),t.addEventListener("touchstart",Xt),t.addEventListener("mouseup",Pt),t.addEventListener("touchend",Pt),t.addEventListener("touchcancel",Pt),t.addEventListener("blur",Le),t.addEventListener("mousemove",Bt),t.addEventListener("touchmove",Bt),i._t||(i._t=!0,lt("tick",()=>{i._lf.length=0,i._cf.map(n=>{i._lf.push(n)}),i._cf.length=0})),i}function T(...e){e.flat().map(t=>{let i=t.context?t.context.canvas:q(),n=Z.get(i);if(!n)throw new ReferenceError("Pointer events not initialized for the objects canvas");t.__r||(t.__r=t.render,t.render=function(){n._cf.push(this),this.__r()},n._o.push(t))})}function Ie(e){let t=e.canvas;e.clearRect(0,0,t.width,t.height)}function Me({fps:e=60,clearCanvas:t=!0,update:i=yt,render:n,context:s=F(),blur:r=!1}={}){if(!n)throw Error("You must provide a render() function");let a=0,o=1e3/e,l=1/e,c=t?Ie:yt,d,f,p,u,_,y=!0;r||(window.addEventListener("focus",()=>{y=!0}),window.addEventListener("blur",()=>{y=!1})),lt("init",()=>{_.context??=F()});function g(){if(f=requestAnimationFrame(g),!!y&&(p=performance.now(),u=p-d,d=p,!(u>1e3))){for(a+=u;a>=o;)B("tick"),_.update(l),a-=o;c(_.context),_.render()}}return _={update:i,render:n,isStopped:!0,context:s,start(){this.isStopped&&(d=performance.now(),this.isStopped=!1,requestAnimationFrame(g))},stop(){this.isStopped=!0,cancelAnimationFrame(f)},_frame:g,set _last(E){d=E}},_}let U;function Ct(){U??=Date.now(),U|=0,U=U+2654435769|0;let e=U^U>>>16;return e=Math.imul(e,569420461),e=e^e>>>15,e=Math.imul(e,1935289751),((e=e^e>>>15)>>>0)/4294967296}function Tt(e=Date.now()){if(U=e,typeof e=="string"){for(var t=0,i=1779033703^e.length;t<e.length;t++)i=Math.imul(i^e.charCodeAt(t),3432918353),i=i<<13|i>>>19;i=Math.imul(i^i>>>16,2246822507),i=Math.imul(i^i>>>13,3266489909),U=(i^=i>>>16)>>>0}}function He(e){if(+e==e)return e;let t=[],i=e.split(".."),n=+i[0],s=+i[1],r=n;if(n<s)for(;r<=s;r++)t.push(r);else for(;r>=s;r--)t.push(r);return t}class Fe{constructor({image:t,frameWidth:i,frameHeight:n,spacing:s=0,margin:r=0,animations:a}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:i,height:n,spacing:s,margin:r},this._f=(t.width-r)/i|0,this.createAnimations(a)}createAnimations(t){let i,n;for(n in t){let{frames:s,frameRate:r,loop:a}=t[n];if(i=[],s==null)throw Error("Animation "+n+" must provide a frames property");[].concat(s).map(o=>{i=i.concat(He(o))}),this.animations[n]=ce({spriteSheet:this,frames:i,frameRate:r,loop:a,name:n})}}}function We(){return new Fe(...arguments)}let $e=2147483648,Ue=1073741824,Kt=536870912;function et(e,t){return e/t|0}function it(e,t){return e/t|0}class Ye{constructor(t={}){let{width:i,height:n,tilewidth:s,tileheight:r,tilesets:a}=t,o=i*s,l=n*r,c=document.createElement("canvas");c.width=o,c.height=l,this._c=c,this._ctx=c.getContext("2d"),a.map(d=>{let{__k:f,location:p}=window,u=(f?f.dm.get(t):"")||p.href,{source:_}=d;if(_){if(!f)throw Error('You must use "load" or "loadData" to resolve tileset.source');let g=f.d[f.u(_,u)];if(!g)throw Error(`You must load the tileset source "${_}" before loading the tileset`);Object.keys(g).map(E=>{d[E]=g[E]})}let{image:y}=d;if(""+y===y){if(!f)throw Error('You must use "load" or "loadImage" to resolve tileset.image');let g=f.i[f.u(y,u)];if(!g)throw Error(`You must load the image "${y}" before loading the tileset`);d.image=g}}),Object.assign(this,{context:F(),layerMap:{},layerCanvases:{},mapwidth:o,mapheight:l,_sx:0,_sy:0,_o:[],...t}),this.context&&this._p(),lt("init",()=>{this.context??=F(),this._p()})}get sx(){return this._sx}get sy(){return this._sy}set sx(t){let i=Math.max(0,this.mapwidth-q().width);this._sx=X(0,i,t)}set sy(t){let i=Math.max(0,this.mapheight-q().height);this._sy=X(0,i,t)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map(i=>{this._o.push(i),i.parent=this})}remove(...t){t.flat().map(i=>{ee(this._o,i),i.parent=null})}getPosition(t){let i=q().getBoundingClientRect(),n=t.x-i.x,s=t.y-i.y;return n+=this.sx,s+=this.sy,{x:n,y:s,row:et(s,this.tileheight),col:it(n,this.tilewidth)}}setTileAtLayer(t,i,n){let{layerMap:s,tileheight:r,tilewidth:a,width:o}=this,{row:l,col:c,x:d,y:f}=i,p=l??et(f,r),u=c??it(d,a);s[t]&&(this._d=!0,s[t]._d=!0,s[t].data[p*o+u]=n)}setLayer(t,i){let{layerMap:n}=this;n[t]&&(this._d=!0,n[t]._d=!0,n[t].data=i)}layerCollidesWith(t,i){let{tilewidth:n,tileheight:s,layerMap:r}=this,{x:a,y:o,width:l,height:c}=te(i),d=et(o,s),f=it(a,n),p=et(o+c,s),u=it(a+l,n),_=r[t];for(let y=d;y<=p;y++)for(let g=f;g<=u;g++)if(_.data[g+y*this.width])return!0;return!1}tileAtLayer(t,i){let{layerMap:n,tileheight:s,tilewidth:r,width:a}=this,{row:o,col:l,x:c,y:d}=i,f=o??et(d,s),p=l??it(c,r);return n[t]?n[t].data[f*a+p]:-1}render(t=this._c,i=!0){let{_d:n,context:s,sx:r=0,sy:a=0}=this;n&&this._p();let{width:o,height:l}=q(),c=Math.min(t.width,o),d=Math.min(t.height,l);s.drawImage(t,r,a,c,d,0,0,c,d),i&&(s.save(),(r||a)&&s.translate(-r,-a),this.objects.map(f=>f.render&&f.render()),s.restore())}renderLayer(t){let{layerCanvases:i,layerMap:n}=this,s=n[t],r=i[t],a=r?.getContext("2d");if(!r){let{mapwidth:o,mapheight:l}=this;r=document.createElement("canvas"),a=r.getContext("2d"),r.width=o,r.height=l,i[t]=r,this._rl(s,a)}s._d&&(s._d=!1,a.clearRect(0,0,r.width,r.height),this._rl(s,a)),this.render(r,!1)}_p(){let{_ctx:t,layers:i=[],layerMap:n}=this;this._d=!1,i.map(s=>{let{name:r,data:a,visible:o}=s;s._d=!1,n[r]=s,a&&o!=!1&&this._rl(s,t)})}_rl(t,i){let{opacity:n,data:s=[]}=t,{tilesets:r,width:a,tilewidth:o,tileheight:l}=this;i.save(),i.globalAlpha=n,s.map((c,d)=>{if(!c)return;let f=0,p=0,u=c&$e,_=c&Ue,y=0,g=0,E=0,b=0,ct=0;f=u||_,c&=1073741823,ct=c&Kt,ct&&(u&&_?E=1:u?y=1:_?g=1:b=1,p=y||g||E||b,c&=~Kt);let z;for(let ft=r.length-1;ft>=0&&(z=r[ft],!(c/z.firstgid>=1));ft--);let{image:Dt,spacing:L=0,margin:I=0,firstgid:W,columns:$}=z,M=c-W,H=$??Dt.width/(o+L)|0,D=d%a*o,k=(d/a|0)*l,Gt=I+M%H*(o+L),O=I+(M/H|0)*(l+L);p?(i.save(),i.translate(D+o/2,k+l/2),g||b?i.rotate(-Math.PI/2):(y||E)&&i.rotate(Math.PI/2),(E||b)&&i.scale(-1,1),D=-o/2,k=-l/2):f&&(i.save(),i.translate(D+(u?o:0),k+(_?l:0)),i.scale(u?-1:1,_?-1:1),D=f?0:D,k=f?0:k),i.drawImage(Dt,Gt,O,o,l,D,k,o,l),(f||p)&&i.restore()}),i.restore()}}function Ge(){return new Ye(...arguments)}function Ne(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var At={exports:{}},Rt,Vt;function qe(){return Vt||(Vt=1,Rt=function(e,t){this.reset=function(){this.cards=e.slice(0),this.length=this.cards.length},this.shuffle=function(){i(this.cards)},this.reset(),this.shuffle(),this.deal=function(n,s){for(var r=0;r<n;r++)for(var a=0;a<s.length;a++){if(!s[a]||!s[a].push)throw new Error("Deck#deal | Undefined Hand");s[a].push(this.cards.pop())}this.length=this.cards.length},this.draw=function(n){if(!n||n<=1)return this.length=this.cards.length-1,this.cards.pop();for(var s=[],r=0;r<n;r++)s.push(this.cards.pop());return this.length=this.cards.length,s},this.drawFromBottomOfDeck=function(n){(!n||n<1)&&(n=1);for(var s=[],r=0;r<n;r++)s.push(this.cards.shift());return this.length=this.cards.length,s.length===1?s[0]:s},this.drawRandom=function(n){var s=function(){var o=Math.floor(t()*this.cards.length),l=this.cards[o];return this.cards.splice(o,1),this.length=this.cards.length,l};if(!n||n<=1)return s.apply(this);for(var r=[],a=0;a<n;a++)r.push(s.apply(this));return r},this.putOnTopOfDeck=function(n){if(!n instanceof Array)this.cards.push(n);else for(var s=0;s<n.length;s++)this.cards.push(n[s]);this.length=this.cards.length},this.putOnBottomOfDeck=function(n){if(!n instanceof Array)this.cards.unshift(n);else for(var s=0;s<n.length;s++)this.cards.unshift(n[s]);this.length=this.cards.length};function i(n){var s=n.length;if(s===0)return!1;for(;--s;){var r=Math.floor(t()*(s+1)),a=n[s],o=n[r];n[s]=o,n[r]=a}}}),Rt}var Lt,Jt;function Xe(){return Jt||(Jt=1,Lt=function(e,t,i){this.suit=e,this.description=t,this.sort=i,this.toString=function(){return this.description+" of "+this.suit+"s"},this.toShortDisplayString=function(){var n=this.suit.substring(0,1),s;switch(this.sort){case 11:s="J";break;case 12:s="Q";break;case 13:s="K";break;case 14:s="A";break;default:s=this.sort}return s+n}}),Lt}var Ot,Qt;function Be(){if(Qt)return Ot;Qt=1;var e=Xe();return Ot=function(){this.cards=[new e("Club","Two",2),new e("Club","Three",3),new e("Club","Four",4),new e("Club","Five",5),new e("Club","Six",6),new e("Club","Seven",7),new e("Club","Eight",8),new e("Club","Nine",9),new e("Club","Ten",10),new e("Club","Jack",11),new e("Club","Queen",12),new e("Club","King",13),new e("Club","Ace",14),new e("Diamond","Two",2),new e("Diamond","Three",3),new e("Diamond","Four",4),new e("Diamond","Five",5),new e("Diamond","Six",6),new e("Diamond","Seven",7),new e("Diamond","Eight",8),new e("Diamond","Nine",9),new e("Diamond","Ten",10),new e("Diamond","Jack",11),new e("Diamond","Queen",12),new e("Diamond","King",13),new e("Diamond","Ace",14),new e("Heart","Two",2),new e("Heart","Three",3),new e("Heart","Four",4),new e("Heart","Five",5),new e("Heart","Six",6),new e("Heart","Seven",7),new e("Heart","Eight",8),new e("Heart","Nine",9),new e("Heart","Ten",10),new e("Heart","Jack",11),new e("Heart","Queen",12),new e("Heart","King",13),new e("Heart","Ace",14),new e("Spade","Two",2),new e("Spade","Three",3),new e("Spade","Four",4),new e("Spade","Five",5),new e("Spade","Six",6),new e("Spade","Seven",7),new e("Spade","Eight",8),new e("Spade","Nine",9),new e("Spade","Ten",10),new e("Spade","Jack",11),new e("Spade","Queen",12),new e("Spade","King",13),new e("Spade","Ace",14)]},Ot}var jt;function ze(){if(jt)return At.exports;jt=1;var e=qe(),t=Be(),i=At.exports={},n={deck:new t().cards,numberOfDecks:1,random:function(){return Math.random()}};return i.playingCards=function(){return new t().cards},i.shuffle=function(s){if(s||(s=n),s.deck||(s.deck=n.deck),s.numberOfDecks)for(var r=s.deck,a=0;a<s.numberOfDecks-1;a++)s.deck=s.deck.concat(r);return s.random||(s.random=n.random),new e(s.deck,s.random)},At.exports}var Ke=ze();const dt=Ne(Ke),nt=1,st=2,rt=3,at=4,ot=5,ht=6,_t=1,xt=2,Et=3,vt=4,J=[{id:1,name:"Fools' Landing",flooded:!1,adventurer:ht},{id:2,name:"Cave of Shadows",flooded:!1,treasure:Et},{id:3,name:"Temple of the Moon",flooded:!1,treasure:_t},{id:4,name:"Copper Gate",flooded:!1,adventurer:rt},{id:5,name:"Whispering Garden",flooded:!1,treasure:xt},{id:6,name:"Dunes of Deception",flooded:!1},{id:7,name:"Silver Gate",flooded:!1,adventurer:at},{id:8,name:"Observatory",flooded:!1},{id:9,name:"Breakers Bridge",flooded:!1},{id:10,name:"Twilight Hollow",flooded:!1},{id:11,name:"Lost Lagoon",flooded:!1},{id:12,name:"Bronze Gate",flooded:!1,adventurer:st},{id:13,name:"Phantom Rock",flooded:!1},{id:14,name:"Watchtower",flooded:!1},{id:15,name:"Cliffs of Abandon",flooded:!1},{id:16,name:"Misty Marsh",flooded:!1},{id:17,name:"Coral Palace",flooded:!1,treasure:vt},{id:18,name:"Howling Garden",flooded:!1,treasure:xt},{id:19,name:"Iron Gate",flooded:!1,adventurer:nt},{id:20,name:"Gold Gate",flooded:!1,adventurer:ot},{id:21,name:"Crimson Forest",flooded:!1},{id:22,name:"Temple of the Sun",flooded:!1,treasure:_t},{id:23,name:"Cave of Embers",flooded:!1,treasure:Et},{id:24,name:"Tidal Palace",flooded:!1,treasure:vt}],Ve=[{id:at,name:"Messenger",color:"silver",type:"adventurer"},{id:ht,name:"Pilot",color:"blue",type:"adventurer"},{id:st,name:"Engineer",color:"red",type:"adventurer"},{id:rt,name:"Explorer",color:"green",type:"adventurer"},{id:nt,name:"Diver",color:"black",type:"adventurer"},{id:ot,name:"Navigator",color:"yellow",type:"adventurer"}],Je=[{name:"Fools' Landing",type:"flood"},{name:"Cave of Shadows",type:"flood"},{name:"Temple of the Moon",type:"flood"},{name:"Copper Gate",type:"flood"},{name:"Whispering Garden",type:"flood"},{name:"Dunes of Deception",type:"flood"},{name:"Silver Gate",type:"flood"},{name:"Observatory",type:"flood"},{name:"Breakers Bridge",type:"flood"},{name:"Twilight Hollow",type:"flood"},{name:"Lost Lagoon",type:"flood"},{name:"Bronze Gate",type:"flood"},{name:"Phantom Rock",type:"flood"},{name:"Watchtower",type:"flood"},{name:"Cliffs of Abandon",type:"flood"},{name:"Misty Marsh",type:"flood"},{name:"Coral Palace",type:"flood"},{name:"Howling Garden",type:"flood"},{name:"Iron Gate",type:"flood"},{name:"Gold Gate",type:"flood"},{name:"Crimson Forest",type:"flood"},{name:"Temple of the Sun",type:"flood"},{name:"Cave of Embers",type:"flood"},{name:"Tidal Palace",type:"flood"}];function G(e,t){const i=[];for(let n=0;n<e;++n)i.push(t);return i}const Qe=[...G(5,{name:"The Earth Stone",type:"treasure"}),...G(5,{name:"The Statue of the Wind",type:"treasure"}),...G(5,{name:"The Crystal of Fire",type:"treasure"}),...G(5,{name:"The Ocean's Chalice",type:"treasure"}),...G(3,{name:"Waters Rise!",type:"treasure"}),...G(3,{name:"Helicopter Lift",type:"treasure"}),...G(3,{name:"Sandbags",type:"treasure"})],re=[...Ve,...Je,...Qe],bt=2,Q=512,j=256,P=32*bt,x=32*bt,ut=24*bt,wt=24*bt,v=P/4/2,je="lime",Ze=2,ti="aqua",ei="adventurer-deck",ii="flood-deck",ni="island-tiles-deck",si="treasure-deck",ri=6,ai=2;Tt(ei);const oi=dt.shuffle({deck:re.filter(({type:e})=>e==="adventurer"),random:Ct}),ae=""+new URL("spritesheet-Dm4BmPvg.png",import.meta.url).href,oe=""+new URL("tilesheet-C_zpU0l5.png",import.meta.url).href,hi=[ae,oe],li=e=>Se(...hi);Tt(ii);const di=dt.shuffle({deck:J,random:Ct});function ci(){function e(){this.context.fillStyle=this.color,this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,2*Math.PI),this.context.fill(),this.context.lineWidth=2,this.context.strokeStyle="white",this.context.stroke()}const t=A({color:"black",id:nt,radius:v,render(){e.call(this)}}),i=A({color:"red",id:st,radius:v,render(){e.call(this)}}),n=A({color:"green",id:rt,radius:v,render(){e.call(this)}}),s=A({color:"silver",id:at,radius:v,render(){e.call(this)}}),r=A({color:"yellow",id:ot,radius:v,render(){e.call(this)}}),a=A({color:"blue",id:ht,radius:v,render(){e.call(this)}});return{diverPawn:t,engineerPawn:i,explorerPawn:n,messengerPawn:s,navigatorPawn:r,pilotPawn:a}}function fi(){return A({color:je,render(){if(this.context.beginPath(),this.radius!==void 0)this.context.arc(this.radius,this.radius,this.radius,0,2*Math.PI);else if(this.width!==void 0&&this.height!==void 0)this.context.rect(0,0,this.width,this.height);else return;this.context.lineWidth=Ze,this.context.strokeStyle=this.color,this.context.stroke()}})}function ui(){const e=We({image:Y[ae],frameWidth:P,frameHeight:x,animations:J.map((i,n)=>({[n]:{frames:n*2,frameRate:1},[`${n}-flooded`]:{frames:[n*2+1],frameRate:1}})).reduce((i,n)=>({...i,...n}))}),t=[];for(let i=0;i<J.length;++i){const n=A({animations:e.animations,id:1+i,flooded:J[i].flooded});n.playAnimation(i),t.push(n)}return t}async function wi(){try{const e=Y[oe];return Ge({tilewidth:P,tileheight:x,width:8,height:8,tilesets:[{firstgid:0,image:e}],layers:[{name:"ground",data:[0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,0,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0]}]})}catch(e){return console.error(e),null}}function pi(){const e=A({color:"brown",width:ut,height:wt,id:_t}),t=A({color:"yellow",width:ut,height:wt,id:xt}),i=A({color:"red",width:ut,height:wt,id:Et}),n=A({color:"blue",width:ut,height:wt,id:vt});return{theCrystalOfFire:i,theEarthStone:e,theOceansChalice:n,theStatueOfTheWind:t}}function gi(){return A({x:0,y:0,color:ti,width:Q,height:j})}function mi(e=ai){return It({text:`${e}`,font:`${x/2}px Arial`,color:"white",x:Q-P/2*`${e}`.length,y:j-x/2,waterLevel:e})}Tt(ni);const yi=dt.shuffle({deck:J,random:Ct});function _i(e){return function(){const{innerWidth:t,innerHeight:i}=window,n=t/i,s=Q/j;n<s?(e.style.width=`${t}px`,e.style.height=`${t/s}px`):(e.style.width=`${i*s}px`,e.style.height=`${i}px`)}}function xi(e,t=`
`){const i={};for(const s of e)i[s.name]===void 0?i[s.name]=1:++i[s.name];const n=[];for(const[s,r]of Object.entries(i))n.push(`${r} x ${s}`);return n.join(t)}Tt(si);const pt=dt.shuffle({deck:re.filter(({type:e})=>e==="treasure"),random:Ct}),Ei=26.25,vi="0.0.36",Zt={hours:Ei,version:vi};async function Si(){const{canvas:e,context:t}=de();e.width=Q,e.height=j;const i=_i(e);i(),window.addEventListener("resize",i),Oe();const n=`v${Zt.version}`,s=`${Zt.hours}h`,r=It({text:`${n}
${s}`,font:`${x/4}px Courier`,color:"white",x:Q-P/4*Math.max(n.length,s.length),y:x/4}),a=It({font:`${x/4}px Arial`,color:"white",x:P/4,y:x/4});await li();const o=await wi();if(o===null)return 1;o.sx=(P*8-Q)/2,o.sy=(x*8-j)/2;const l=()=>{const{y:h}=Pe();if(h<x){let w=o.sy-x;w=X(0,o.mapheight-x-1,w),o.sy=w}else if(h>j-x-1){let w=o.sy+x;w=X(0,o.mapheight-x-1,w),o.sy=w}};o.onDown=()=>{l(),p(),a.text=""},T(o);const c=gi();c.onDown=()=>{l(),p(),a.text=""},T(c);const d=fi(),f=h=>{d.x=h.x,d.y=h.y,h.radius?(d.radius=h.radius,d.width=d.height=void 0):(d.width=h.width,d.height=h.height,d.radius=void 0)},p=()=>{d.width=d.height=d.radius=void 0},u=ui(),_=o.layers.find(({name:h})=>h==="ground");if(_!==void 0){for(let h=0;h<o.height;++h)for(let w=0;w<o.width;++w)if(_.data[h*o.width+w]!==0){const m=yi.draw(),S=u[m.id-1];S.x=w*S.width,S.y=h*S.height,S.onDown=()=>{l();let C=m.name;if(S.flooded&&(C+=`
FLOODED!`),m.adventurer!==void 0)switch(m.adventurer){case nt:C+=`
(Diver)`;break;case st:C+=`
(Engineer)`;break;case rt:C+=`
(Explorer)`;break;case at:C+=`
(Messenger)`;break;case ot:C+=`
(Navigator)`;break;case ht:C+=`
(Pilot)`}if(m.treasure!==void 0)switch(m.treasure){case Et:C+=`
(The Crystal of Fire)`;break;case _t:C+=`
(The Earth Stone)`;break;case vt:C+=`
(The Ocean's Chalice)`;break;case xt:C+=`
(The Statue of the Wind)`}f(S),a.text=C},T(S),o.add(S)}}const{theCrystalOfFire:y,theEarthStone:g,theOceansChalice:E,theStatueOfTheWind:b}=pi();g.x=u[0].width+(u[0].width-g.width)/2,g.y=u[0].height+(u[0].height-g.height)/2,g.onDown=()=>{f(g),a.text="The Earth Stone"},T(g),o.add(g),b.x=u[0].width+(u[0].width-b.width)/2,b.y=u[0].height*6+(u[0].height-b.height)/2,b.onDown=()=>{f(b),a.text="The Statue of the Wind"},T(b),o.add(b),y.x=u[0].width*6+(u[0].width-y.width)/2,y.y=u[0].height+(u[0].height-y.height)/2,y.onDown=()=>{f(y),a.text="The Crystal of Fire"},T(y),o.add(y),E.x=u[0].width*6+(u[0].width-E.width)/2,E.y=u[0].height*6+(u[0].height-E.height)/2,E.onDown=()=>{f(E),a.text="The Ocean's Chalice"},T(E),o.add(E);const ct={...di},z=[];for(let h=0;h<6;++h){const w=ct.draw(),m=u.find(({id:S})=>S===w.id);m.flooded=!0,m.playAnimation(`${m.id-1}-flooded`),z.push(w)}dt.shuffle({deck:[]}).putOnTopOfDeck(z);const L=[];for(let h=0;h<ri;++h)L.push({name:`Player ${h+1}`,adventurerCard:oi.draw(),cards:[]});const I=h=>()=>{f(h);const w=L.find(({adventurerCard:S})=>S.id===h.id);if(w===void 0)return;const m=`${w.name}: ${w.adventurerCard.name}
Cards:
${xi(w.cards)}`;a.text=m},{diverPawn:W,engineerPawn:$,explorerPawn:M,messengerPawn:H,navigatorPawn:D,pilotPawn:k}=ci();for(const h of u){const w=J.find(({id:m})=>m===h.id);if(w!==void 0&&!(w.adventurer!==void 0&&!L.map(({adventurerCard:m})=>m.id).includes(w.adventurer)))switch(w.adventurer){case nt:W.x=h.x+(P-v*2)/2,W.y=h.y+(x-v*2)/2,W.onDown=I(W),T(W),o.add(W);break;case st:$.x=h.x+(P-v*2)/2,$.y=h.y+(x-v*2)/2,$.onDown=I($),T($),o.add($);break;case rt:M.x=h.x+(P-v*2)/2,M.y=h.y+(x-v*2)/2,M.onDown=I(M),T(M),o.add(M);break;case at:H.x=h.x+(P-v*2)/2,H.y=h.y+(x-v*2)/2,H.onDown=I(H),T(H),o.add(H);break;case ot:D.x=h.x+(P-v*2)/2,D.y=h.y+(x-v*2)/2,D.onDown=I(D),T(D),o.add(D);break;case ht:k.x=h.x+(P-v*2)/2,k.y=h.y+(x-v*2)/2,k.onDown=I(k),T(k),o.add(k);break}}o.add(d),pt.deal(2,L.map(({cards:h})=>h));for(const h of L){let w=h.cards.filter(({name:m})=>m==="Waters Rise!").length;for(;w>0;){console.log("Waters Rise! Replacement card required");for(let m=0;m<h.cards.length;++m)if(h.cards[m].name==="Waters Rise!"){const S=h.cards[m],C=pt.draw();h.cards[m]=C,pt.putOnTopOfDeck(S),pt.shuffle()}w=h.cards.filter(({name:m})=>m==="Waters Rise!").length}}(()=>{a.text=L.map(({name:h,adventurerCard:w})=>`${h}: ${w.name}`).join(`
`)})();const O=mi();return O.onDown=()=>{a.text=`Water level: ${O.waterLevel}`},T(O),Me({render(){c.render(),o.render(),t.fillStyle="teal",t.fillRect(O.x,O.y,O.width,O.height),O.render(),t.fillStyle="rgba(0, 0, 0, 0.67)",t.fillRect(r.x,r.y,r.width,r.height),r.render(),t.fillStyle="rgba(0, 0, 0, 0.67)",t.fillRect(a.x,a.y,a.width,a.height),a.render()},update(){}}).start(),0}Si();
