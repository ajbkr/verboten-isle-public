(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();/**
 * @preserve
 * Kontra.js v10.0.2
 */function Pe(t,e){let n=Math.sin(e),r=Math.cos(e);return{x:t.x*r-t.y*n,y:t.x*n+t.y*r}}function st(t,e,n){return Math.min(Math.max(t,n),e)}function xe(t){let{x:e=0,y:n=0,width:r,height:s,radius:i}=t.world||t;return t.mapwidth&&(r=t.mapwidth,s=t.mapheight),i&&(r=i.x*2,s=i.y*2),t.anchor&&(e-=r*t.anchor.x,n-=s*t.anchor.y),r<0&&(e+=r,r*=-1),s<0&&(n+=s,s*=-1),{x:e,y:n,width:r,height:s}}let Ft=()=>{};function ve(t,e){let n=t.indexOf(e);if(n!=-1)return t.splice(n,1),!0}function Fe(t,e){let{x:n,y:r,width:s,height:i}=xe(e);do n-=e.sx||0,r-=e.sy||0;while(e=e.parent);let o=t.x-Math.max(n,Math.min(t.x,n+s)),a=t.y-Math.max(r,Math.min(t.y,r+i));return o*o+a*a<t.radius*t.radius}let Rt={};function Ct(t,e){Rt[t]=Rt[t]||[],Rt[t].push(e)}function it(t,...e){(Rt[t]||[]).map(n=>n(...e))}let et,Pt,ae={get(t,e){return e=="_proxy"?!0:Ft}};function nt(){return et}function j(){return Pt}function Ie(t,{contextless:e=!1}={}){if(et=document.getElementById(t)||t||document.querySelector("canvas"),e&&(et=et||new Proxy({},ae)),!et)throw Error("You must provide a canvas element for the game");return Pt=et.getContext("2d")||new Proxy({},ae),Pt.imageSmoothingEnabled=!1,it("init"),{canvas:et,context:Pt}}class te{constructor({spriteSheet:e,frames:n,frameRate:r,loop:s=!0,name:i}){let{width:o,height:a,spacing:l=0,margin:h=0}=e.frame;Object.assign(this,{spriteSheet:e,frames:n,frameRate:r,loop:s,name:i,width:o,height:a,spacing:l,margin:h,isStopped:!1,_f:0,_a:0})}clone(){return new te(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(e=1/60){if(!this.isStopped){if(!this.loop&&this._f==this.frames.length-1){this.stop();return}for(this._a+=e;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}}render({x:e,y:n,width:r=this.width,height:s=this.height,context:i=j()}){let o=this.frames[this._f]/this.spriteSheet._f|0,a=this.frames[this._f]%this.spriteSheet._f|0;i.drawImage(this.spriteSheet.image,this.margin+a*this.width+(a*2+1)*this.spacing,this.margin+o*this.height+(o*2+1)*this.spacing,this.width,this.height,e,n,r,s)}}function Ne(){return new te(...arguments)}let $e=/(jpeg|jpg|gif|png|webp)$/,He=/(wav|mp3|ogg|aac)$/,Ge=/^\//,We=/\/$/,ke=new WeakMap,qe="",ze="",Be="";function Gt(t,e){return new URL(t,e).href}function ee(t,e){return[t.replace(We,""),e].filter(n=>n).join("/")}function ne(t){return t.split(".").pop()}function re(t){let e=t.replace("."+ne(t),"");return e.split("/").length==2?e.replace(Ge,""):e}function Ue(t){return{wav:t.canPlayType('audio/wav; codecs="1"'),mp3:t.canPlayType("audio/mpeg;"),ogg:t.canPlayType('audio/ogg; codecs="vorbis"'),aac:t.canPlayType("audio/aac;")}}let Z={},wt={},ht={};function se(){window.__k||(window.__k={dm:ke,u:Gt,d:ht,i:Z})}function Ye(t){return se(),new Promise((e,n)=>{let r,s,i;if(r=ee(qe,t),Z[r])return e(Z[r]);s=new Image,s.onload=function(){i=Gt(r,window.location.href),Z[re(t)]=Z[r]=Z[i]=this,it("assetLoaded",this,t),e(this)},s.onerror=function(){n("Unable to load image "+r)},s.src=r})}function Xe(t){return new Promise((e,n)=>{let r=t,s,i,o,a;if(s=new Audio,i=Ue(s),t=[].concat(t).reduce((l,h)=>l||(i[ne(h)]?h:null),0),!t)return n("cannot play any of the audio formats provided "+r);if(o=ee(ze,t),wt[o])return e(wt[o]);s.addEventListener("canplay",function(){a=Gt(o,window.location.href),wt[re(t)]=wt[o]=wt[a]=this,it("assetLoaded",this,t),e(this)}),s.onerror=function(){n("Unable to load audio "+o)},s.src=o,s.load()})}function je(t){se();let e,n;return e=ee(Be,t),ht[e]?Promise.resolve(ht[e]):fetch(e).then(r=>{if(!r.ok)throw r;return r.clone().json().catch(()=>r.text())}).then(r=>(n=Gt(e,window.location.href),typeof r=="object"&&ke.set(r,n),ht[re(t)]=ht[e]=ht[n]=r,it("assetLoaded",r,t),r))}function Ke(...t){return se(),Promise.all(t.map(e=>{let n=ne([].concat(e)[0]);return n.match($e)?Ye(e):n.match(He)?Xe(e):je(e)}))}class ct{constructor(e=0,n=0,r={}){e.x!=null?(this.x=e.x,this.y=e.y):(this.x=e,this.y=n),r._c&&(this.clamp(r._a,r._b,r._d,r._e),this.x=e,this.y=n)}set(e){this.x=e.x,this.y=e.y}add(e){return new ct(this.x+e.x,this.y+e.y,this)}subtract(e){return new ct(this.x-e.x,this.y-e.y,this)}scale(e){return new ct(this.x*e,this.y*e)}normalize(e=this.length()||1){return new ct(this.x/e,this.y/e)}dot(e){return this.x*e.x+this.y*e.y}length(){return Math.hypot(this.x,this.y)}distance(e){return Math.hypot(this.x-e.x,this.y-e.y)}angle(e){return Math.acos(this.dot(e)/(this.length()*e.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(e,n,r,s){this._c=!0,this._a=e,this._b=n,this._d=r,this._e=s}get x(){return this._x}get y(){return this._y}set x(e){this._x=this._c?st(this._a,this._d,e):e}set y(e){this._y=this._c?st(this._b,this._e,e):e}}function Bt(){return new ct(...arguments)}class Ve{constructor(e){return this.init(e)}init(e={}){this.position=Bt(),this.velocity=Bt(),this.acceleration=Bt(),this.ttl=1/0,Object.assign(this,e)}update(e){this.advance(e)}advance(e){let n=this.acceleration;e&&(n=n.scale(e)),this.velocity=this.velocity.add(n);let r=this.velocity;e&&(r=r.scale(e)),this.position=this.position.add(r),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(e){this.velocity.x=e}set dy(e){this.velocity.y=e}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(e){this.acceleration.x=e}set ddy(e){this.acceleration.y=e}isAlive(){return this.ttl>0}_pc(){}}class Me extends Ve{init({width:e=0,height:n=0,context:r=j(),render:s=this.draw,update:i=this.advance,children:o=[],anchor:a={x:0,y:0},opacity:l=1,rotation:h=0,drotation:d=0,ddrotation:u=0,scaleX:g=1,scaleY:p=1,...b}={}){this._c=[],super.init({width:e,height:n,context:r,anchor:a,opacity:l,rotation:h,drotation:d,ddrotation:u,scaleX:g,scaleY:p,...b}),this._di=!0,this._uw(),this.addChild(o),this._rf=s,this._uf=i,Ct("init",()=>{this.context??=j()})}update(e){this._uf(e),this.children.map(n=>n.update&&n.update(e))}render(){let e=this.context;e.save(),(this.x||this.y)&&e.translate(this.x,this.y),this.rotation&&e.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&e.scale(this.scaleX,this.scaleY);let n=this.width,r=this.height;this.radius&&(n=r=this.radius*2);let s=-n*this.anchor.x,i=-r*this.anchor.y;(s||i)&&e.translate(s,i),this.context.globalAlpha=this.opacity,this._rf(),(s||i)&&e.translate(-s,-i),this.children.map(a=>a.render&&a.render()),e.restore()}draw(){}_pc(){this._uw(),this.children.map(e=>e._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(e){this.position.x=e,this._pc()}set y(e){this.position.y=e,this._pc()}get width(){return this._w}set width(e){this._w=e,this._pc()}get height(){return this._h}set height(e){this._h=e,this._pc()}_uw(){if(!this._di)return;let{_wx:e=0,_wy:n=0,_wo:r=1,_wrot:s=0,_wsx:i=1,_wsy:o=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this.radius&&(this._wrx=this.radius,this._wry=this.radius),this._wo=r*this.opacity,this._wsx=i*this.scaleX,this._wsy=o*this.scaleY,this._wx=this._wx*i,this._wy=this._wy*o,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this.radius&&(this._wrx=this.radius*this._wsx,this._wry=this.radius*this._wsy),this._wrot=s+this.rotation;let{x:a,y:l}=Pe({x:this._wx,y:this._wy},s);this._wx=a,this._wy=l,this._wx+=e,this._wy+=n}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,radius:this.radius?{x:this._wrx,y:this._wry}:void 0,opacity:this._wo,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}set children(e){this.removeChild(this._c),this.addChild(e)}get children(){return this._c}addChild(...e){e.flat().map(n=>{this.children.push(n),n.parent=this,n._pc=n._pc||Ft,n._pc()})}removeChild(...e){e.flat().map(n=>{ve(this.children,n)&&(n.parent=null,n._pc())})}get radius(){return this._r}set radius(e){this._r=e,this._pc()}get opacity(){return this._opa}set opacity(e){this._opa=st(0,1,e),this._pc()}get rotation(){return this._rot}set rotation(e){this._rot=e,this._pc()}advance(e){super.advance(e),this.drotation+=this.ddrotation,this.rotation+=this.drotation}setScale(e,n=e){this.scaleX=e,this.scaleY=n}get scaleX(){return this._scx}set scaleX(e){this._scx=e,this._pc()}get scaleY(){return this._scy}set scaleY(e){this._scy=e,this._pc()}}class Je extends Me{init({image:e,width:n=e?e.width:void 0,height:r=e?e.height:void 0,...s}={}){super.init({image:e,width:n,height:r,...s})}get animations(){return this._a}set animations(e){let n,r;this._a={};for(n in e)this._a[n]=e[n].clone(),r=r||this._a[n];this.currentAnimation=r,this.width=this.width||r.width,this.height=this.height||r.height}playAnimation(e){this.currentAnimation?.stop(),this.currentAnimation=this.animations[e],this.currentAnimation.start()}advance(e){super.advance(e),this.currentAnimation?.update(e)}draw(){if(this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color){if(this.context.fillStyle=this.color,this.radius){this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.context.fill();return}this.context.fillRect(0,0,this.width,this.height)}}}function N(){return new Je(...arguments)}let Ze=/(\d+)(\w+)/;function Qe(t){if(!t)return{computed:0};let e=t.match(Ze),n=+e[1],r=e[2];return{size:n,unit:r,computed:n}}class tn extends Me{init({text:e="",textAlign:n="",lineHeight:r=1,font:s=j()?.font,...i}={}){e=""+e,super.init({text:e,textAlign:n,lineHeight:r,font:s,...i}),this.context&&this._p(),Ct("init",()=>{this.font??=j().font,this._p()})}get width(){return this._w}set width(e){this._d=!0,this._w=e,this._fw=e}get text(){return this._t}set text(e){this._d=!0,this._t=""+e}get font(){return this._f}set font(e){this._d=!0,this._f=e,this._fs=Qe(e).computed}get lineHeight(){return this._lh}set lineHeight(e){this._d=!0,this._lh=e}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let e=this.context,n=[this.text];if(e.font=this.font,n=this.text.split(`
`),this._fw&&n.map(r=>{let s=r.split(" "),i=s.shift(),o=i;s.map(a=>{o+=" "+a,e.measureText(o).width>this._fw&&(this._s.push(i),o=a),i=o}),this._s.push(o)}),!this._s.length&&this.text.includes(`
`)){let r=0;n.map(s=>{this._s.push(s),r=Math.max(r,e.measureText(s).width)}),this._w=this._fw||r}this._s.length||(this._s.push(this.text),this._w=this._fw||e.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let e=0,n=this.textAlign,r=this.context;n=this.textAlign||(r.canvas.dir=="rtl"?"right":"left"),e=n=="right"?this.width:n=="center"?this.width/2|0:0,this._s.map((s,i)=>{r.textBaseline="top",r.textAlign=n,r.fillStyle=this.color,r.font=this.font,this.strokeColor&&(r.strokeStyle=this.strokeColor,r.lineWidth=this.lineWidth??1,r.strokeText(s,e,this._fs*this.lineHeight*i)),r.fillText(s,e,this._fs*this.lineHeight*i)})}}function le(){return new tn(...arguments)}let gt=new WeakMap,he={},ie={},Ee={0:"left",1:"middle",2:"right"};function en(t=nt()){return gt.get(t)}function nn(t){let e=t._lf.length?t._lf:t._cf;for(let n=e.length-1;n>=0;n--){let r=e[n];if(r.collidesWithPointer?r.collidesWithPointer(t):Fe(t,r))return r}}function W(t,e){return parseFloat(t.getPropertyValue(e))||0}function rn(t){let{canvas:e,_s:n}=t,r=e.getBoundingClientRect(),s=n.transform!="none"?n.transform.replace("matrix(","").split(","):[1,1,1,1],i=parseFloat(s[0]),o=parseFloat(s[3]),a=(W(n,"border-left-width")+W(n,"border-right-width"))*i,l=(W(n,"border-top-width")+W(n,"border-bottom-width"))*o,h=(W(n,"padding-left")+W(n,"padding-right"))*i,d=(W(n,"padding-top")+W(n,"padding-bottom"))*o;return{scaleX:(r.width-a-h)/e.width,scaleY:(r.height-l-d)/e.height,offsetX:r.left+(W(n,"border-left-width")+W(n,"padding-left"))*i,offsetY:r.top+(W(n,"border-top-width")+W(n,"padding-top"))*o}}function ce(t){let e=t.button!=null?Ee[t.button]:"left";ie[e]=!0,oe(t,"onDown")}function Ut(t){let e=t.button!=null?Ee[t.button]:"left";ie[e]=!1,oe(t,"onUp")}function de(t){oe(t,"onOver")}function sn(t){let e=gt.get(t.target);e._oo=null,ie={}}function ue(t,e,n){let r=nn(t);r&&r[e]&&r[e](n),he[e]&&he[e](n,r),e=="onOver"&&(r!=t._oo&&t._oo&&t._oo.onOut&&t._oo.onOut(n),t._oo=r)}function oe(t,e){t.preventDefault();let n=t.target,r=gt.get(n),{scaleX:s,scaleY:i,offsetX:o,offsetY:a}=rn(r);t.type.includes("touch")?(Array.from(t.touches).map(({clientX:h,clientY:d,identifier:u})=>{let g=r.touches[u];g||(g=r.touches[u]={start:{x:(h-o)/s,y:(d-a)/i}},r.touches.length++),g.changed=!1}),Array.from(t.changedTouches).map(({clientX:h,clientY:d,identifier:u})=>{let g=r.touches[u];g.changed=!0,g.x=r.x=(h-o)/s,g.y=r.y=(d-a)/i,ue(r,e,t),it("touchChanged",t,r.touches),e=="onUp"&&(delete r.touches[u],r.touches.length--,r.touches.length||it("touchEnd"))})):(r.x=(t.clientX-o)/s,r.y=(t.clientY-a)/i,ue(r,e,t))}function on({radius:t=5,canvas:e=nt()}={}){let n=gt.get(e);if(!n){let r=window.getComputedStyle(e);n={x:0,y:0,radius:t,touches:{length:0},canvas:e,_cf:[],_lf:[],_o:[],_oo:null,_s:r},gt.set(e,n)}return e.addEventListener("mousedown",ce),e.addEventListener("touchstart",ce),e.addEventListener("mouseup",Ut),e.addEventListener("touchend",Ut),e.addEventListener("touchcancel",Ut),e.addEventListener("blur",sn),e.addEventListener("mousemove",de),e.addEventListener("touchmove",de),n._t||(n._t=!0,Ct("tick",()=>{n._lf.length=0,n._cf.map(r=>{n._lf.push(r)}),n._cf.length=0})),n}function I(...t){t.flat().map(e=>{let n=e.context?e.context.canvas:nt(),r=gt.get(n);if(!r)throw new ReferenceError("Pointer events not initialized for the objects canvas");e.__r||(e.__r=e.render,e.render=function(){r._cf.push(this),this.__r()},r._o.push(e))})}function an(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}function ln({fps:t=60,clearCanvas:e=!0,update:n=Ft,render:r,context:s=j(),blur:i=!1}={}){if(!r)throw Error("You must provide a render() function");let o=0,a=1e3/t,l=1/t,h=e?an:Ft,d,u,g,p,b,_=!0;i||(window.addEventListener("focus",()=>{_=!0}),window.addEventListener("blur",()=>{_=!1})),Ct("init",()=>{b.context??=j()});function m(){if(u=requestAnimationFrame(m),!!_&&(g=performance.now(),p=g-d,d=g,!(p>1e3))){for(o+=p;o>=a;)it("tick"),b.update(l),o-=a;h(b.context),b.render()}}return b={update:n,render:r,isStopped:!0,context:s,start(){this.isStopped&&(d=performance.now(),this.isStopped=!1,requestAnimationFrame(m))},stop(){this.isStopped=!0,cancelAnimationFrame(u)},_frame:m,set _last(k){d=k}},b}let J;function Wt(){J??=Date.now(),J|=0,J=J+2654435769|0;let t=J^J>>>16;return t=Math.imul(t,569420461),t=t^t>>>15,t=Math.imul(t,1935289751),((t=t^t>>>15)>>>0)/4294967296}function qt(t=Date.now()){if(J=t,typeof t=="string"){for(var e=0,n=1779033703^t.length;e<t.length;e++)n=Math.imul(n^t.charCodeAt(e),3432918353),n=n<<13|n>>>19;n=Math.imul(n^n>>>16,2246822507),n=Math.imul(n^n>>>13,3266489909),J=(n^=n>>>16)>>>0}}function hn(t){if(+t==t)return t;let e=[],n=t.split(".."),r=+n[0],s=+n[1],i=r;if(r<s)for(;i<=s;i++)e.push(i);else for(;i>=s;i--)e.push(i);return e}class cn{constructor({image:e,frameWidth:n,frameHeight:r,spacing:s=0,margin:i=0,animations:o}={}){if(!e)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=e,this.frame={width:n,height:r,spacing:s,margin:i},this._f=(e.width-i)/n|0,this.createAnimations(o)}createAnimations(e){let n,r;for(r in e){let{frames:s,frameRate:i,loop:o}=e[r];if(n=[],s==null)throw Error("Animation "+r+" must provide a frames property");[].concat(s).map(a=>{n=n.concat(hn(a))}),this.animations[r]=Ne({spriteSheet:this,frames:n,frameRate:i,loop:o,name:r})}}}function dn(){return new cn(...arguments)}let un=2147483648,fn=1073741824,fe=536870912;function mt(t,e){return t/e|0}function _t(t,e){return t/e|0}class pn{constructor(e={}){let{width:n,height:r,tilewidth:s,tileheight:i,tilesets:o}=e,a=n*s,l=r*i,h=document.createElement("canvas");h.width=a,h.height=l,this._c=h,this._ctx=h.getContext("2d"),o.map(d=>{let{__k:u,location:g}=window,p=(u?u.dm.get(e):"")||g.href,{source:b}=d;if(b){if(!u)throw Error('You must use "load" or "loadData" to resolve tileset.source');let m=u.d[u.u(b,p)];if(!m)throw Error(`You must load the tileset source "${b}" before loading the tileset`);Object.keys(m).map(k=>{d[k]=m[k]})}let{image:_}=d;if(""+_===_){if(!u)throw Error('You must use "load" or "loadImage" to resolve tileset.image');let m=u.i[u.u(_,p)];if(!m)throw Error(`You must load the image "${_}" before loading the tileset`);d.image=m}}),Object.assign(this,{context:j(),layerMap:{},layerCanvases:{},mapwidth:a,mapheight:l,_sx:0,_sy:0,_o:[],...e}),this.context&&this._p(),Ct("init",()=>{this.context??=j(),this._p()})}get sx(){return this._sx}get sy(){return this._sy}set sx(e){let n=Math.max(0,this.mapwidth-nt().width);this._sx=st(0,n,e)}set sy(e){let n=Math.max(0,this.mapheight-nt().height);this._sy=st(0,n,e)}set objects(e){this.remove(this._o),this.add(e)}get objects(){return this._o}add(...e){e.flat().map(n=>{this._o.push(n),n.parent=this})}remove(...e){e.flat().map(n=>{ve(this._o,n),n.parent=null})}getPosition(e){let n=nt().getBoundingClientRect(),r=e.x-n.x,s=e.y-n.y;return r+=this.sx,s+=this.sy,{x:r,y:s,row:mt(s,this.tileheight),col:_t(r,this.tilewidth)}}setTileAtLayer(e,n,r){let{layerMap:s,tileheight:i,tilewidth:o,width:a}=this,{row:l,col:h,x:d,y:u}=n,g=l??mt(u,i),p=h??_t(d,o);s[e]&&(this._d=!0,s[e]._d=!0,s[e].data[g*a+p]=r)}setLayer(e,n){let{layerMap:r}=this;r[e]&&(this._d=!0,r[e]._d=!0,r[e].data=n)}layerCollidesWith(e,n){let{tilewidth:r,tileheight:s,layerMap:i}=this,{x:o,y:a,width:l,height:h}=xe(n),d=mt(a,s),u=_t(o,r),g=mt(a+h,s),p=_t(o+l,r),b=i[e];for(let _=d;_<=g;_++)for(let m=u;m<=p;m++)if(b.data[m+_*this.width])return!0;return!1}tileAtLayer(e,n){let{layerMap:r,tileheight:s,tilewidth:i,width:o}=this,{row:a,col:l,x:h,y:d}=n,u=a??mt(d,s),g=l??_t(h,i);return r[e]?r[e].data[u*o+g]:-1}render(e=this._c,n=!0){let{_d:r,context:s,sx:i=0,sy:o=0}=this;r&&this._p();let{width:a,height:l}=nt(),h=Math.min(e.width,a),d=Math.min(e.height,l);s.drawImage(e,i,o,h,d,0,0,h,d),n&&(s.save(),(i||o)&&s.translate(-i,-o),this.objects.map(u=>u.render&&u.render()),s.restore())}renderLayer(e){let{layerCanvases:n,layerMap:r}=this,s=r[e],i=n[e],o=i?.getContext("2d");if(!i){let{mapwidth:a,mapheight:l}=this;i=document.createElement("canvas"),o=i.getContext("2d"),i.width=a,i.height=l,n[e]=i,this._rl(s,o)}s._d&&(s._d=!1,o.clearRect(0,0,i.width,i.height),this._rl(s,o)),this.render(i,!1)}_p(){let{_ctx:e,layers:n=[],layerMap:r}=this;this._d=!1,n.map(s=>{let{name:i,data:o,visible:a}=s;s._d=!1,r[i]=s,o&&a!=!1&&this._rl(s,e)})}_rl(e,n){let{opacity:r,data:s=[]}=e,{tilesets:i,width:o,tilewidth:a,tileheight:l}=this;n.save(),n.globalAlpha=r,s.map((h,d)=>{if(!h)return;let u=0,g=0,p=h&un,b=h&fn,_=0,m=0,k=0,A=0,K=0;u=p||b,h&=1073741823,K=h&fe,K&&(p&&b?k=1:p?_=1:b?m=1:A=1,g=_||m||k||A,h&=~fe);let Y;for(let at=i.length-1;at>=0&&(Y=i[at],!(h/Y.firstgid>=1));at--);let{image:ot,spacing:$=0,margin:H=0,firstgid:U,columns:B}=Y,G=h-U,P=B??ot.width/(a+$)|0,M=d%o*a,R=(d/o|0)*l,Tt=H+G%P*(a+$),V=H+(G/P|0)*(l+$);g?(n.save(),n.translate(M+a/2,R+l/2),m||A?n.rotate(-Math.PI/2):(_||k)&&n.rotate(Math.PI/2),(k||A)&&n.scale(-1,1),M=-a/2,R=-l/2):u&&(n.save(),n.translate(M+(p?a:0),R+(b?l:0)),n.scale(p?-1:1,b?-1:1),M=u?0:M,R=u?0:R),n.drawImage(ot,Tt,V,a,l,M,R,a,l),(u||g)&&n.restore()}),n.restore()}}function gn(){return new pn(...arguments)}function wn(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Yt={exports:{}},Xt,pe;function mn(){return pe||(pe=1,Xt=function(t,e){this.reset=function(){this.cards=t.slice(0),this.length=this.cards.length},this.shuffle=function(){n(this.cards)},this.reset(),this.shuffle(),this.deal=function(r,s){for(var i=0;i<r;i++)for(var o=0;o<s.length;o++){if(!s[o]||!s[o].push)throw new Error("Deck#deal | Undefined Hand");s[o].push(this.cards.pop())}this.length=this.cards.length},this.draw=function(r){if(!r||r<=1)return this.length=this.cards.length-1,this.cards.pop();for(var s=[],i=0;i<r;i++)s.push(this.cards.pop());return this.length=this.cards.length,s},this.drawFromBottomOfDeck=function(r){(!r||r<1)&&(r=1);for(var s=[],i=0;i<r;i++)s.push(this.cards.shift());return this.length=this.cards.length,s.length===1?s[0]:s},this.drawRandom=function(r){var s=function(){var a=Math.floor(e()*this.cards.length),l=this.cards[a];return this.cards.splice(a,1),this.length=this.cards.length,l};if(!r||r<=1)return s.apply(this);for(var i=[],o=0;o<r;o++)i.push(s.apply(this));return i},this.putOnTopOfDeck=function(r){if(!r instanceof Array)this.cards.push(r);else for(var s=0;s<r.length;s++)this.cards.push(r[s]);this.length=this.cards.length},this.putOnBottomOfDeck=function(r){if(!r instanceof Array)this.cards.unshift(r);else for(var s=0;s<r.length;s++)this.cards.unshift(r[s]);this.length=this.cards.length};function n(r){var s=r.length;if(s===0)return!1;for(;--s;){var i=Math.floor(e()*(s+1)),o=r[s],a=r[i];r[s]=a,r[i]=o}}}),Xt}var jt,ge;function _n(){return ge||(ge=1,jt=function(t,e,n){this.suit=t,this.description=e,this.sort=n,this.toString=function(){return this.description+" of "+this.suit+"s"},this.toShortDisplayString=function(){var r=this.suit.substring(0,1),s;switch(this.sort){case 11:s="J";break;case 12:s="Q";break;case 13:s="K";break;case 14:s="A";break;default:s=this.sort}return s+r}}),jt}var Kt,we;function yn(){if(we)return Kt;we=1;var t=_n();return Kt=function(){this.cards=[new t("Club","Two",2),new t("Club","Three",3),new t("Club","Four",4),new t("Club","Five",5),new t("Club","Six",6),new t("Club","Seven",7),new t("Club","Eight",8),new t("Club","Nine",9),new t("Club","Ten",10),new t("Club","Jack",11),new t("Club","Queen",12),new t("Club","King",13),new t("Club","Ace",14),new t("Diamond","Two",2),new t("Diamond","Three",3),new t("Diamond","Four",4),new t("Diamond","Five",5),new t("Diamond","Six",6),new t("Diamond","Seven",7),new t("Diamond","Eight",8),new t("Diamond","Nine",9),new t("Diamond","Ten",10),new t("Diamond","Jack",11),new t("Diamond","Queen",12),new t("Diamond","King",13),new t("Diamond","Ace",14),new t("Heart","Two",2),new t("Heart","Three",3),new t("Heart","Four",4),new t("Heart","Five",5),new t("Heart","Six",6),new t("Heart","Seven",7),new t("Heart","Eight",8),new t("Heart","Nine",9),new t("Heart","Ten",10),new t("Heart","Jack",11),new t("Heart","Queen",12),new t("Heart","King",13),new t("Heart","Ace",14),new t("Spade","Two",2),new t("Spade","Three",3),new t("Spade","Four",4),new t("Spade","Five",5),new t("Spade","Six",6),new t("Spade","Seven",7),new t("Spade","Eight",8),new t("Spade","Nine",9),new t("Spade","Ten",10),new t("Spade","Jack",11),new t("Spade","Queen",12),new t("Spade","King",13),new t("Spade","Ace",14)]},Kt}var me;function bn(){if(me)return Yt.exports;me=1;var t=mn(),e=yn(),n=Yt.exports={},r={deck:new e().cards,numberOfDecks:1,random:function(){return Math.random()}};return n.playingCards=function(){return new e().cards},n.shuffle=function(s){if(s||(s=r),s.deck||(s.deck=r.deck),s.numberOfDecks)for(var i=s.deck,o=0;o<s.numberOfDecks-1;o++)s.deck=s.deck.concat(i);return s.random||(s.random=r.random),new t(s.deck,s.random)},Yt.exports}var xn=bn();const St=wn(xn),bt=1,xt=2,vt=3,kt=4,Mt=5,Et=6,It=1,Nt=2,$t=3,Ht=4,dt=[{id:1,name:"Fools' Landing",flooded:!1,adventurer:Et},{id:2,name:"Cave of Shadows",flooded:!1,treasure:$t},{id:3,name:"Temple of the Moon",flooded:!1,treasure:It},{id:4,name:"Copper Gate",flooded:!1,adventurer:vt},{id:5,name:"Whispering Garden",flooded:!1,treasure:Nt},{id:6,name:"Dunes of Deception",flooded:!1},{id:7,name:"Silver Gate",flooded:!1,adventurer:kt},{id:8,name:"Observatory",flooded:!1},{id:9,name:"Breakers Bridge",flooded:!1},{id:10,name:"Twilight Hollow",flooded:!1},{id:11,name:"Lost Lagoon",flooded:!1},{id:12,name:"Bronze Gate",flooded:!1,adventurer:xt},{id:13,name:"Phantom Rock",flooded:!1},{id:14,name:"Watchtower",flooded:!1},{id:15,name:"Cliffs of Abandon",flooded:!1},{id:16,name:"Misty Marsh",flooded:!1},{id:17,name:"Coral Palace",flooded:!1,treasure:Ht},{id:18,name:"Howling Garden",flooded:!1,treasure:Nt},{id:19,name:"Iron Gate",flooded:!1,adventurer:bt},{id:20,name:"Gold Gate",flooded:!1,adventurer:Mt},{id:21,name:"Crimson Forest",flooded:!1},{id:22,name:"Temple of the Sun",flooded:!1,treasure:It},{id:23,name:"Cave of Embers",flooded:!1,treasure:$t},{id:24,name:"Tidal Palace",flooded:!1,treasure:Ht}],vn=[{id:kt,name:"Messenger",color:"silver",type:"adventurer"},{id:Et,name:"Pilot",color:"blue",type:"adventurer"},{id:xt,name:"Engineer",color:"red",type:"adventurer"},{id:vt,name:"Explorer",color:"green",type:"adventurer"},{id:bt,name:"Diver",color:"black",type:"adventurer"},{id:Mt,name:"Navigator",color:"yellow",type:"adventurer"}],kn=[{name:"Fools' Landing",type:"flood"},{name:"Cave of Shadows",type:"flood"},{name:"Temple of the Moon",type:"flood"},{name:"Copper Gate",type:"flood"},{name:"Whispering Garden",type:"flood"},{name:"Dunes of Deception",type:"flood"},{name:"Silver Gate",type:"flood"},{name:"Observatory",type:"flood"},{name:"Breakers Bridge",type:"flood"},{name:"Twilight Hollow",type:"flood"},{name:"Lost Lagoon",type:"flood"},{name:"Bronze Gate",type:"flood"},{name:"Phantom Rock",type:"flood"},{name:"Watchtower",type:"flood"},{name:"Cliffs of Abandon",type:"flood"},{name:"Misty Marsh",type:"flood"},{name:"Coral Palace",type:"flood"},{name:"Howling Garden",type:"flood"},{name:"Iron Gate",type:"flood"},{name:"Gold Gate",type:"flood"},{name:"Crimson Forest",type:"flood"},{name:"Temple of the Sun",type:"flood"},{name:"Cave of Embers",type:"flood"},{name:"Tidal Palace",type:"flood"}];function tt(t,e){const n=[];for(let r=0;r<t;++r)n.push(e);return n}const Mn=Object.freeze([...tt(5,{name:"The Earth Stone",type:"treasure"}),...tt(5,{name:"The Statue of the Wind",type:"treasure"}),...tt(5,{name:"The Crystal of Fire",type:"treasure"}),...tt(5,{name:"The Ocean's Chalice",type:"treasure"}),...tt(3,{name:"Waters Rise!",type:"treasure"}),...tt(3,{name:"Helicopter Lift",type:"treasure"}),...tt(3,{name:"Sandbags",type:"treasure"})]),Ce=Object.freeze([...vn,...kn,...Mn]),Se=0,En=1,Cn=2,Sn=3,zt=2,rt=512,ut=256,q=32*zt,v=32*zt,Dt=24*zt,At=24*zt,S=q/4/2,Tn="lime",Dn=2,An="aqua",Ln="adventurer-deck",On="flood-deck",Rn="island-tiles-deck",Pn="treasure-deck",Fn=6,In=Se;qt(Ln);const Nn=St.shuffle({deck:Ce.filter(({type:t})=>t==="adventurer"),random:Wt}),Te=""+new URL("spritesheet-Dm4BmPvg.png",import.meta.url).href,De=""+new URL("tilesheet-C_zpU0l5.png",import.meta.url).href,$n=[Te,De],Hn=t=>Ke(...$n),z={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Ae=Object.create(null);for(const t in z)Object.hasOwn(z,t)&&(Ae[z[t]]=t);const C={to:{},get:{}};C.get=function(t){const e=t.slice(0,3).toLowerCase();let n,r;switch(e){case"hsl":{n=C.get.hsl(t),r="hsl";break}case"hwb":{n=C.get.hwb(t),r="hwb";break}default:{n=C.get.rgb(t),r="rgb";break}}return n?{model:r,value:n}:null};C.get.rgb=function(t){if(!t)return null;const e=/^#([a-f\d]{3,4})$/i,n=/^#([a-f\d]{6})([a-f\d]{2})?$/i,r=/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[\s,|/]\s*([+-]?[\d.]+)(%?)\s*)?\)$/,s=/^rgba?\(\s*([+-]?[\d.]+)%\s*,?\s*([+-]?[\d.]+)%\s*,?\s*([+-]?[\d.]+)%\s*(?:[\s,|/]\s*([+-]?[\d.]+)(%?)\s*)?\)$/,i=/^(\w+)$/;let o=[0,0,0,1],a,l,h;if(a=t.match(n)){for(h=a[2],a=a[1],l=0;l<3;l++){const d=l*2;o[l]=Number.parseInt(a.slice(d,d+2),16)}h&&(o[3]=Number.parseInt(h,16)/255)}else if(a=t.match(e)){for(a=a[1],h=a[3],l=0;l<3;l++)o[l]=Number.parseInt(a[l]+a[l],16);h&&(o[3]=Number.parseInt(h+h,16)/255)}else if(a=t.match(r)){for(l=0;l<3;l++)o[l]=Number.parseInt(a[l+1],10);a[4]&&(o[3]=a[5]?Number.parseFloat(a[4])*.01:Number.parseFloat(a[4]))}else if(a=t.match(s)){for(l=0;l<3;l++)o[l]=Math.round(Number.parseFloat(a[l+1])*2.55);a[4]&&(o[3]=a[5]?Number.parseFloat(a[4])*.01:Number.parseFloat(a[4]))}else return(a=t.match(i))?a[1]==="transparent"?[0,0,0,0]:Object.hasOwn(z,a[1])?(o=z[a[1]],o[3]=1,o):null:null;for(l=0;l<3;l++)o[l]=Q(o[l],0,255);return o[3]=Q(o[3],0,1),o};C.get.hsl=function(t){if(!t)return null;const e=/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d.]+)%\s*,?\s*([+-]?[\d.]+)%\s*(?:[,|/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/,n=t.match(e);if(n){const r=Number.parseFloat(n[4]),s=(Number.parseFloat(n[1])%360+360)%360,i=Q(Number.parseFloat(n[2]),0,100),o=Q(Number.parseFloat(n[3]),0,100),a=Q(Number.isNaN(r)?1:r,0,1);return[s,i,o,a]}return null};C.get.hwb=function(t){if(!t)return null;const e=/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*[\s,]\s*([+-]?[\d.]+)%\s*[\s,]\s*([+-]?[\d.]+)%\s*(?:[\s,]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/,n=t.match(e);if(n){const r=Number.parseFloat(n[4]),s=(Number.parseFloat(n[1])%360+360)%360,i=Q(Number.parseFloat(n[2]),0,100),o=Q(Number.parseFloat(n[3]),0,100),a=Q(Number.isNaN(r)?1:r,0,1);return[s,i,o,a]}return null};C.to.hex=function(...t){return"#"+Lt(t[0])+Lt(t[1])+Lt(t[2])+(t[3]<1?Lt(Math.round(t[3]*255)):"")};C.to.rgb=function(...t){return t.length<4||t[3]===1?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"};C.to.rgb.percent=function(...t){const e=Math.round(t[0]/255*100),n=Math.round(t[1]/255*100),r=Math.round(t[2]/255*100);return t.length<4||t[3]===1?"rgb("+e+"%, "+n+"%, "+r+"%)":"rgba("+e+"%, "+n+"%, "+r+"%, "+t[3]+")"};C.to.hsl=function(...t){return t.length<4||t[3]===1?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"};C.to.hwb=function(...t){let e="";return t.length>=4&&t[3]!==1&&(e=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+e+")"};C.to.keyword=function(...t){return Ae[t.slice(0,3)]};function Q(t,e,n){return Math.min(Math.max(e,t),n)}function Lt(t){const e=Math.round(t).toString(16).toUpperCase();return e.length<2?"0"+e:e}const Le={};for(const t of Object.keys(z))Le[z[t]]=t;const c={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},oklab:{channels:3,labels:["okl","oka","okb"]},lch:{channels:3,labels:"lch"},oklch:{channels:3,labels:["okl","okc","okh"]},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}},X=(6/29)**3;function ft(t){const e=t>.0031308?1.055*t**.4166666666666667-.055:t*12.92;return Math.min(Math.max(0,e),1)}function pt(t){return t>.04045?((t+.055)/1.055)**2.4:t/12.92}for(const t of Object.keys(c)){if(!("channels"in c[t]))throw new Error("missing channels property: "+t);if(!("labels"in c[t]))throw new Error("missing channel labels property: "+t);if(c[t].labels.length!==c[t].channels)throw new Error("channel and label counts mismatch: "+t);const{channels:e,labels:n}=c[t];delete c[t].channels,delete c[t].labels,Object.defineProperty(c[t],"channels",{value:e}),Object.defineProperty(c[t],"labels",{value:n})}c.rgb.hsl=function(t){const e=t[0]/255,n=t[1]/255,r=t[2]/255,s=Math.min(e,n,r),i=Math.max(e,n,r),o=i-s;let a,l;switch(i){case s:{a=0;break}case e:{a=(n-r)/o;break}case n:{a=2+(r-e)/o;break}case r:{a=4+(e-n)/o;break}}a=Math.min(a*60,360),a<0&&(a+=360);const h=(s+i)/2;return i===s?l=0:h<=.5?l=o/(i+s):l=o/(2-i-s),[a,l*100,h*100]};c.rgb.hsv=function(t){let e,n,r,s,i;const o=t[0]/255,a=t[1]/255,l=t[2]/255,h=Math.max(o,a,l),d=h-Math.min(o,a,l),u=function(g){return(h-g)/6/d+1/2};if(d===0)s=0,i=0;else{switch(i=d/h,e=u(o),n=u(a),r=u(l),h){case o:{s=r-n;break}case a:{s=1/3+e-r;break}case l:{s=2/3+n-e;break}}s<0?s+=1:s>1&&(s-=1)}return[s*360,i*100,h*100]};c.rgb.hwb=function(t){const e=t[0],n=t[1];let r=t[2];const s=c.rgb.hsl(t)[0],i=1/255*Math.min(e,Math.min(n,r));return r=1-1/255*Math.max(e,Math.max(n,r)),[s,i*100,r*100]};c.rgb.oklab=function(t){const e=pt(t[0]/255),n=pt(t[1]/255),r=pt(t[2]/255),s=Math.cbrt(.4122214708*e+.5363325363*n+.0514459929*r),i=Math.cbrt(.2119034982*e+.6806995451*n+.1073969566*r),o=Math.cbrt(.0883024619*e+.2817188376*n+.6299787005*r),a=.2104542553*s+.793617785*i-.0040720468*o,l=1.9779984951*s-2.428592205*i+.4505937099*o,h=.0259040371*s+.7827717662*i-.808675766*o;return[a*100,l*100,h*100]};c.rgb.cmyk=function(t){const e=t[0]/255,n=t[1]/255,r=t[2]/255,s=Math.min(1-e,1-n,1-r),i=(1-e-s)/(1-s)||0,o=(1-n-s)/(1-s)||0,a=(1-r-s)/(1-s)||0;return[i*100,o*100,a*100,s*100]};function Gn(t,e){return(t[0]-e[0])**2+(t[1]-e[1])**2+(t[2]-e[2])**2}c.rgb.keyword=function(t){const e=Le[t];if(e)return e;let n=Number.POSITIVE_INFINITY,r;for(const s of Object.keys(z)){const i=z[s],o=Gn(t,i);o<n&&(n=o,r=s)}return r};c.keyword.rgb=function(t){return z[t]};c.rgb.xyz=function(t){const e=pt(t[0]/255),n=pt(t[1]/255),r=pt(t[2]/255),s=e*.4124564+n*.3575761+r*.1804375,i=e*.2126729+n*.7151522+r*.072175,o=e*.0193339+n*.119192+r*.9503041;return[s*100,i*100,o*100]};c.rgb.lab=function(t){const e=c.rgb.xyz(t);let n=e[0],r=e[1],s=e[2];n/=95.047,r/=100,s/=108.883,n=n>X?n**(1/3):7.787*n+16/116,r=r>X?r**(1/3):7.787*r+16/116,s=s>X?s**(1/3):7.787*s+16/116;const i=116*r-16,o=500*(n-r),a=200*(r-s);return[i,o,a]};c.hsl.rgb=function(t){const e=t[0]/360,n=t[1]/100,r=t[2]/100;let s,i;if(n===0)return i=r*255,[i,i,i];const o=r<.5?r*(1+n):r+n-r*n,a=2*r-o,l=[0,0,0];for(let h=0;h<3;h++)s=e+1/3*-(h-1),s<0&&s++,s>1&&s--,6*s<1?i=a+(o-a)*6*s:2*s<1?i=o:3*s<2?i=a+(o-a)*(2/3-s)*6:i=a,l[h]=i*255;return l};c.hsl.hsv=function(t){const e=t[0];let n=t[1]/100,r=t[2]/100,s=n;const i=Math.max(r,.01);r*=2,n*=r<=1?r:2-r,s*=i<=1?i:2-i;const o=(r+n)/2,a=r===0?2*s/(i+s):2*n/(r+n);return[e,a*100,o*100]};c.hsv.rgb=function(t){const e=t[0]/60,n=t[1]/100;let r=t[2]/100;const s=Math.floor(e)%6,i=e-Math.floor(e),o=255*r*(1-n),a=255*r*(1-n*i),l=255*r*(1-n*(1-i));switch(r*=255,s){case 0:return[r,l,o];case 1:return[a,r,o];case 2:return[o,r,l];case 3:return[o,a,r];case 4:return[l,o,r];case 5:return[r,o,a]}};c.hsv.hsl=function(t){const e=t[0],n=t[1]/100,r=t[2]/100,s=Math.max(r,.01);let i,o;o=(2-n)*r;const a=(2-n)*s;return i=n*s,i/=a<=1?a:2-a,i=i||0,o/=2,[e,i*100,o*100]};c.hwb.rgb=function(t){const e=t[0]/360;let n=t[1]/100,r=t[2]/100;const s=n+r;let i;s>1&&(n/=s,r/=s);const o=Math.floor(6*e),a=1-r;i=6*e-o,(o&1)!==0&&(i=1-i);const l=n+i*(a-n);let h,d,u;switch(o){default:case 6:case 0:{h=a,d=l,u=n;break}case 1:{h=l,d=a,u=n;break}case 2:{h=n,d=a,u=l;break}case 3:{h=n,d=l,u=a;break}case 4:{h=l,d=n,u=a;break}case 5:{h=a,d=n,u=l;break}}return[h*255,d*255,u*255]};c.cmyk.rgb=function(t){const e=t[0]/100,n=t[1]/100,r=t[2]/100,s=t[3]/100,i=1-Math.min(1,e*(1-s)+s),o=1-Math.min(1,n*(1-s)+s),a=1-Math.min(1,r*(1-s)+s);return[i*255,o*255,a*255]};c.xyz.rgb=function(t){const e=t[0]/100,n=t[1]/100,r=t[2]/100;let s,i,o;return s=e*3.2404542+n*-1.5371385+r*-.4985314,i=e*-.969266+n*1.8760108+r*.041556,o=e*.0556434+n*-.2040259+r*1.0572252,s=ft(s),i=ft(i),o=ft(o),[s*255,i*255,o*255]};c.xyz.lab=function(t){let e=t[0],n=t[1],r=t[2];e/=95.047,n/=100,r/=108.883,e=e>X?e**(1/3):7.787*e+16/116,n=n>X?n**(1/3):7.787*n+16/116,r=r>X?r**(1/3):7.787*r+16/116;const s=116*n-16,i=500*(e-n),o=200*(n-r);return[s,i,o]};c.xyz.oklab=function(t){const e=t[0]/100,n=t[1]/100,r=t[2]/100,s=Math.cbrt(.8189330101*e+.3618667424*n-.1288597137*r),i=Math.cbrt(.0329845436*e+.9293118715*n+.0361456387*r),o=Math.cbrt(.0482003018*e+.2643662691*n+.633851707*r),a=.2104542553*s+.793617785*i-.0040720468*o,l=1.9779984951*s-2.428592205*i+.4505937099*o,h=.0259040371*s+.7827717662*i-.808675766*o;return[a*100,l*100,h*100]};c.oklab.oklch=function(t){return c.lab.lch(t)};c.oklab.xyz=function(t){const e=t[0]/100,n=t[1]/100,r=t[2]/100,s=(.999999998*e+.396337792*n+.215803758*r)**3,i=(1.000000008*e-.105561342*n-.063854175*r)**3,o=(1.000000055*e-.089484182*n-1.291485538*r)**3,a=1.227013851*s-.55779998*i+.281256149*o,l=-.040580178*s+1.11225687*i-.071676679*o,h=-.076381285*s-.421481978*i+1.58616322*o;return[a*100,l*100,h*100]};c.oklab.rgb=function(t){const e=t[0]/100,n=t[1]/100,r=t[2]/100,s=(e+.3963377774*n+.2158037573*r)**3,i=(e-.1055613458*n-.0638541728*r)**3,o=(e-.0894841775*n-1.291485548*r)**3,a=ft(4.0767416621*s-3.3077115913*i+.2309699292*o),l=ft(-1.2684380046*s+2.6097574011*i-.3413193965*o),h=ft(-.0041960863*s-.7034186147*i+1.707614701*o);return[a*255,l*255,h*255]};c.oklch.oklab=function(t){return c.lch.lab(t)};c.lab.xyz=function(t){const e=t[0],n=t[1],r=t[2];let s,i,o;i=(e+16)/116,s=n/500+i,o=i-r/200;const a=i**3,l=s**3,h=o**3;return i=a>X?a:(i-16/116)/7.787,s=l>X?l:(s-16/116)/7.787,o=h>X?h:(o-16/116)/7.787,s*=95.047,i*=100,o*=108.883,[s,i,o]};c.lab.lch=function(t){const e=t[0],n=t[1],r=t[2];let s;s=Math.atan2(r,n)*360/2/Math.PI,s<0&&(s+=360);const o=Math.sqrt(n*n+r*r);return[e,o,s]};c.lch.lab=function(t){const e=t[0],n=t[1],s=t[2]/360*2*Math.PI,i=n*Math.cos(s),o=n*Math.sin(s);return[e,i,o]};c.rgb.ansi16=function(t,e=null){const[n,r,s]=t;let i=e===null?c.rgb.hsv(t)[2]:e;if(i=Math.round(i/50),i===0)return 30;let o=30+(Math.round(s/255)<<2|Math.round(r/255)<<1|Math.round(n/255));return i===2&&(o+=60),o};c.hsv.ansi16=function(t){return c.rgb.ansi16(c.hsv.rgb(t),t[2])};c.rgb.ansi256=function(t){const e=t[0],n=t[1],r=t[2];return e>>4===n>>4&&n>>4===r>>4?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(n/255*5)+Math.round(r/255*5)};c.ansi16.rgb=function(t){t=t[0];let e=t%10;if(e===0||e===7)return t>50&&(e+=3.5),e=e/10.5*255,[e,e,e];const n=(Math.trunc(t>50)+1)*.5,r=(e&1)*n*255,s=(e>>1&1)*n*255,i=(e>>2&1)*n*255;return[r,s,i]};c.ansi256.rgb=function(t){if(t=t[0],t>=232){const i=(t-232)*10+8;return[i,i,i]}t-=16;let e;const n=Math.floor(t/36)/5*255,r=Math.floor((e=t%36)/6)/5*255,s=e%6/5*255;return[n,r,s]};c.rgb.hex=function(t){const n=(((Math.round(t[0])&255)<<16)+((Math.round(t[1])&255)<<8)+(Math.round(t[2])&255)).toString(16).toUpperCase();return"000000".slice(n.length)+n};c.hex.rgb=function(t){const e=t.toString(16).match(/[a-f\d]{6}|[a-f\d]{3}/i);if(!e)return[0,0,0];let n=e[0];e[0].length===3&&(n=[...n].map(a=>a+a).join(""));const r=Number.parseInt(n,16),s=r>>16&255,i=r>>8&255,o=r&255;return[s,i,o]};c.rgb.hcg=function(t){const e=t[0]/255,n=t[1]/255,r=t[2]/255,s=Math.max(Math.max(e,n),r),i=Math.min(Math.min(e,n),r),o=s-i;let a;const l=o<1?i/(1-o):0;return o<=0?a=0:s===e?a=(n-r)/o%6:s===n?a=2+(r-e)/o:a=4+(e-n)/o,a/=6,a%=1,[a*360,o*100,l*100]};c.hsl.hcg=function(t){const e=t[1]/100,n=t[2]/100,r=n<.5?2*e*n:2*e*(1-n);let s=0;return r<1&&(s=(n-.5*r)/(1-r)),[t[0],r*100,s*100]};c.hsv.hcg=function(t){const e=t[1]/100,n=t[2]/100,r=e*n;let s=0;return r<1&&(s=(n-r)/(1-r)),[t[0],r*100,s*100]};c.hcg.rgb=function(t){const e=t[0]/360,n=t[1]/100,r=t[2]/100;if(n===0)return[r*255,r*255,r*255];const s=[0,0,0],i=e%1*6,o=i%1,a=1-o;let l=0;switch(Math.floor(i)){case 0:{s[0]=1,s[1]=o,s[2]=0;break}case 1:{s[0]=a,s[1]=1,s[2]=0;break}case 2:{s[0]=0,s[1]=1,s[2]=o;break}case 3:{s[0]=0,s[1]=a,s[2]=1;break}case 4:{s[0]=o,s[1]=0,s[2]=1;break}default:s[0]=1,s[1]=0,s[2]=a}return l=(1-n)*r,[(n*s[0]+l)*255,(n*s[1]+l)*255,(n*s[2]+l)*255]};c.hcg.hsv=function(t){const e=t[1]/100,n=t[2]/100,r=e+n*(1-e);let s=0;return r>0&&(s=e/r),[t[0],s*100,r*100]};c.hcg.hsl=function(t){const e=t[1]/100,r=t[2]/100*(1-e)+.5*e;let s=0;return r>0&&r<.5?s=e/(2*r):r>=.5&&r<1&&(s=e/(2*(1-r))),[t[0],s*100,r*100]};c.hcg.hwb=function(t){const e=t[1]/100,n=t[2]/100,r=e+n*(1-e);return[t[0],(r-e)*100,(1-r)*100]};c.hwb.hcg=function(t){const e=t[1]/100,r=1-t[2]/100,s=r-e;let i=0;return s<1&&(i=(r-s)/(1-s)),[t[0],s*100,i*100]};c.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]};c.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]};c.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]};c.gray.hsl=function(t){return[0,0,t[0]]};c.gray.hsv=c.gray.hsl;c.gray.hwb=function(t){return[0,100,t[0]]};c.gray.cmyk=function(t){return[0,0,0,t[0]]};c.gray.lab=function(t){return[t[0],0,0]};c.gray.hex=function(t){const e=Math.round(t[0]/100*255)&255,r=((e<<16)+(e<<8)+e).toString(16).toUpperCase();return"000000".slice(r.length)+r};c.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]};function Wn(){const t={},e=Object.keys(c);for(let{length:n}=e,r=0;r<n;r++)t[e[r]]={distance:-1,parent:null};return t}function qn(t){const e=Wn(),n=[t];for(e[t].distance=0;n.length>0;){const r=n.pop(),s=Object.keys(c[r]);for(let{length:i}=s,o=0;o<i;o++){const a=s[o],l=e[a];l.distance===-1&&(l.distance=e[r].distance+1,l.parent=r,n.unshift(a))}}return e}function zn(t,e){return function(n){return e(t(n))}}function Bn(t,e){const n=[e[t].parent,t];let r=c[e[t].parent][t],s=e[t].parent;for(;e[s].parent;)n.unshift(e[s].parent),r=zn(c[e[s].parent][s],r),s=e[s].parent;return r.conversion=n,r}function Un(t){const e=qn(t),n={},r=Object.keys(e);for(let{length:s}=r,i=0;i<s;i++){const o=r[i];e[o].parent!==null&&(n[o]=Bn(o,e))}return n}const D={},Yn=Object.keys(c);function Xn(t){const e=function(...n){const r=n[0];return r==null?r:(r.length>1&&(n=r),t(n))};return"conversion"in t&&(e.conversion=t.conversion),e}function jn(t){const e=function(...n){const r=n[0];if(r==null)return r;r.length>1&&(n=r);const s=t(n);if(typeof s=="object")for(let{length:i}=s,o=0;o<i;o++)s[o]=Math.round(s[o]);return s};return"conversion"in t&&(e.conversion=t.conversion),e}for(const t of Yn){D[t]={},Object.defineProperty(D[t],"channels",{value:c[t].channels}),Object.defineProperty(D[t],"labels",{value:c[t].labels});const e=Un(t),n=Object.keys(e);for(const r of n){const s=e[r];D[t][r]=jn(s),D[t][r].raw=Xn(s)}}const Oe=["keyword","gray","hex"],Vt={};for(const t of Object.keys(D))Vt[[...D[t].labels].sort().join("")]=t;const Jt={};function T(t,e){if(!(this instanceof T))return new T(t,e);if(e&&e in Oe&&(e=null),e&&!(e in D))throw new Error("Unknown model: "+e);let n,r;if(t==null)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof T)this.model=t.model,this.color=[...t.color],this.valpha=t.valpha;else if(typeof t=="string"){const s=C.get(t);if(s===null)throw new Error("Unable to parse color from string: "+t);this.model=s.model,r=D[this.model].channels,this.color=s.value.slice(0,r),this.valpha=typeof s.value[r]=="number"?s.value[r]:1}else if(t.length>0){this.model=e||"rgb",r=D[this.model].channels;const s=Array.prototype.slice.call(t,0,r);this.color=Zt(s,r),this.valpha=typeof t[r]=="number"?t[r]:1}else if(typeof t=="number")this.model="rgb",this.color=[t>>16&255,t>>8&255,t&255],this.valpha=1;else{this.valpha=1;const s=Object.keys(t);"alpha"in t&&(s.splice(s.indexOf("alpha"),1),this.valpha=typeof t.alpha=="number"?t.alpha:0);const i=s.sort().join("");if(!(i in Vt))throw new Error("Unable to parse color from object: "+JSON.stringify(t));this.model=Vt[i];const{labels:o}=D[this.model],a=[];for(n=0;n<o.length;n++)a.push(t[o[n]]);this.color=Zt(a)}if(Jt[this.model])for(r=D[this.model].channels,n=0;n<r;n++){const s=Jt[this.model][n];s&&(this.color[n]=s(this.color[n]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}T.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(t){let e=this.model in C.to?this:this.rgb();e=e.round(typeof t=="number"?t:1);const n=e.valpha===1?e.color:[...e.color,this.valpha];return C.to[e.model](...n)},percentString(t){const e=this.rgb().round(typeof t=="number"?t:1),n=e.valpha===1?e.color:[...e.color,this.valpha];return C.to.rgb.percent(...n)},array(){return this.valpha===1?[...this.color]:[...this.color,this.valpha]},object(){const t={},{channels:e}=D[this.model],{labels:n}=D[this.model];for(let r=0;r<e;r++)t[n[r]]=this.color[r];return this.valpha!==1&&(t.alpha=this.valpha),t},unitArray(){const t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,this.valpha!==1&&t.push(this.valpha),t},unitObject(){const t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,this.valpha!==1&&(t.alpha=this.valpha),t},round(t){return t=Math.max(t||0,0),new T([...this.color.map(Vn(t)),this.valpha],this.model)},alpha(t){return t!==void 0?new T([...this.color,Math.max(0,Math.min(1,t))],this.model):this.valpha},red:x("rgb",0,E(255)),green:x("rgb",1,E(255)),blue:x("rgb",2,E(255)),hue:x(["hsl","hsv","hsl","hwb","hcg"],0,t=>(t%360+360)%360),saturationl:x("hsl",1,E(100)),lightness:x("hsl",2,E(100)),saturationv:x("hsv",1,E(100)),value:x("hsv",2,E(100)),chroma:x("hcg",1,E(100)),gray:x("hcg",2,E(100)),white:x("hwb",1,E(100)),wblack:x("hwb",2,E(100)),cyan:x("cmyk",0,E(100)),magenta:x("cmyk",1,E(100)),yellow:x("cmyk",2,E(100)),black:x("cmyk",3,E(100)),x:x("xyz",0,E(95.047)),y:x("xyz",1,E(100)),z:x("xyz",2,E(108.833)),l:x("lab",0,E(100)),a:x("lab",1),b:x("lab",2),keyword(t){return t!==void 0?new T(t):D[this.model].keyword(this.color)},hex(t){return t!==void 0?new T(t):C.to.hex(...this.rgb().round().color)},hexa(t){if(t!==void 0)return new T(t);const e=this.rgb().round().color;let n=Math.round(this.valpha*255).toString(16).toUpperCase();return n.length===1&&(n="0"+n),C.to.hex(...e)+n},rgbNumber(){const t=this.rgb().color;return(t[0]&255)<<16|(t[1]&255)<<8|t[2]&255},luminosity(){const t=this.rgb().color,e=[];for(const[n,r]of t.entries()){const s=r/255;e[n]=s<=.04045?s/12.92:((s+.055)/1.055)**2.4}return .2126*e[0]+.7152*e[1]+.0722*e[2]},contrast(t){const e=this.luminosity(),n=t.luminosity();return e>n?(e+.05)/(n+.05):(n+.05)/(e+.05)},level(t){const e=this.contrast(t);return e>=7?"AAA":e>=4.5?"AA":""},isDark(){const t=this.rgb().color;return(t[0]*2126+t[1]*7152+t[2]*722)/1e4<128},isLight(){return!this.isDark()},negate(){const t=this.rgb();for(let e=0;e<3;e++)t.color[e]=255-t.color[e];return t},lighten(t){const e=this.hsl();return e.color[2]+=e.color[2]*t,e},darken(t){const e=this.hsl();return e.color[2]-=e.color[2]*t,e},saturate(t){const e=this.hsl();return e.color[1]+=e.color[1]*t,e},desaturate(t){const e=this.hsl();return e.color[1]-=e.color[1]*t,e},whiten(t){const e=this.hwb();return e.color[1]+=e.color[1]*t,e},blacken(t){const e=this.hwb();return e.color[2]+=e.color[2]*t,e},grayscale(){const t=this.rgb().color,e=t[0]*.3+t[1]*.59+t[2]*.11;return T.rgb(e,e,e)},fade(t){return this.alpha(this.valpha-this.valpha*t)},opaquer(t){return this.alpha(this.valpha+this.valpha*t)},rotate(t){const e=this.hsl();let n=e.color[0];return n=(n+t)%360,n=n<0?360+n:n,e.color[0]=n,e},mix(t,e){if(!t||!t.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof t);const n=t.rgb(),r=this.rgb(),s=e===void 0?.5:e,i=2*s-1,o=n.alpha()-r.alpha(),a=((i*o===-1?i:(i+o)/(1+i*o))+1)/2,l=1-a;return T.rgb(a*n.red()+l*r.red(),a*n.green()+l*r.green(),a*n.blue()+l*r.blue(),n.alpha()*s+r.alpha()*(1-s))}};for(const t of Object.keys(D)){if(Oe.includes(t))continue;const{channels:e}=D[t];T.prototype[t]=function(...n){return this.model===t?new T(this):n.length>0?new T(n,t):new T([...Jn(D[this.model][t].raw(this.color)),this.valpha],t)},T[t]=function(...n){let r=n[0];return typeof r=="number"&&(r=Zt(n,e)),new T(r,t)}}function Kn(t,e){return Number(t.toFixed(e))}function Vn(t){return function(e){return Kn(e,t)}}function x(t,e,n){t=Array.isArray(t)?t:[t];for(const r of t)(Jt[r]||=[])[e]=n;return t=t[0],function(r){let s;return r!==void 0?(n&&(r=n(r)),s=this[t](),s.color[e]=r,s):(s=this[t]().color[e],n&&(s=n(s)),s)}}function E(t){return function(e){return Math.max(0,Math.min(t,e))}}function Jn(t){return Array.isArray(t)?t:[t]}function Zt(t,e){for(let n=0;n<e;n++)typeof t[n]!="number"&&(t[n]=0);return t}/**
 * @author Markus Ekholm
 * @copyright 2012-2023 (c) Markus Ekholm <markus at botten dot org >
 * @license Copyright (c) 2012-2023, Markus Ekholm
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *    * Redistributions of source code must retain the above copyright
 *      notice, this list of conditions and the following disclaimer.
 *    * Redistributions in binary form must reproduce the above copyright
 *      notice, this list of conditions and the following disclaimer in the
 *      documentation and/or other materials provided with the distribution.
 *    * Neither the name of the author nor the
 *      names of its contributors may be used to endorse or promote products
 *      derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL MARKUS EKHOLM BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */function _e(t,e){e=Qt(e||{R:255,G:255,B:255}),t=Qt(t);let n=t;return t.A!==void 0&&(n={R:e.R+(t.R-e.R)*t.A,G:e.G+(t.G-e.G)*t.A,B:e.B+(t.B-e.B)*t.A}),Qn(Zn(n))}function Zn(t){let e=t.R/255,n=t.G/255,r=t.B/255;e>.04045?e=Math.pow((e+.055)/1.055,2.4):e=e/12.92,n>.04045?n=Math.pow((n+.055)/1.055,2.4):n=n/12.92,r>.04045?r=Math.pow((r+.055)/1.055,2.4):r=r/12.92,e*=100,n*=100,r*=100;const s=e*.4124+n*.3576+r*.1805,i=e*.2126+n*.7152+r*.0722,o=e*.0193+n*.1192+r*.9505;return{X:s,Y:i,Z:o}}function Qn(t){let s=t.Y/100,i=t.Z/108.883,o=t.X/95.047;o>.008856?o=Math.pow(o,1/3):o=7.787*o+16/116,s>.008856?s=Math.pow(s,1/3):s=7.787*s+16/116,i>.008856?i=Math.pow(i,1/3):i=7.787*i+16/116;const a=116*s-16,l=500*(o-s),h=200*(s-i);return{L:a,a:l,b:h}}function Qt(t){let e,n,r,s;"R"in t?(e=t.R,n=t.G,r=t.B,s=t.A):(e=t.r,n=t.g,r=t.b,s=t.a);const i={R:e,G:n,B:r};return s!==void 0&&(i.A=s),i}/**
 * @author Markus Ekholm
 * @copyright 2012-2023 (c) Markus Ekholm <markus at botten dot org >
 * @license Copyright (c) 2012-2023, Markus Ekholm
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *    * Redistributions of source code must retain the above copyright
 *      notice, this list of conditions and the following disclaimer.
 *    * Redistributions in binary form must reproduce the above copyright
 *      notice, this list of conditions and the following disclaimer in the
 *      documentation and/or other materials provided with the distribution.
 *    * Neither the name of the author nor the
 *      names of its contributors may be used to endorse or promote products
 *      derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL MARKUS EKHOLM BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */function tr(t,e,n){("R"in t||"r"in t)&&(t=_e(t,n)),("R"in e||"r"in e)&&(e=_e(e,n));const r=t.L,s=t.a,i=t.b,o=e.L,a=e.a,l=e.b,h=1,d=1,u=1,g=Math.sqrt(Math.pow(s,2)+Math.pow(i,2)),p=Math.sqrt(Math.pow(a,2)+Math.pow(l,2)),b=(g+p)/2,_=.5*(1-Math.sqrt(Math.pow(b,7)/(Math.pow(b,7)+Math.pow(25,7)))),m=(1+_)*s,k=(1+_)*a,A=Math.sqrt(Math.pow(m,2)+Math.pow(i,2)),K=Math.sqrt(Math.pow(k,2)+Math.pow(l,2)),Y=ye(i,m),ot=ye(l,k),$=o-r,H=K-A,U=nr(g,p,Y,ot),B=2*Math.sqrt(A*K)*Math.sin(lt(U)/2),G=(r+o)/2,P=(A+K)/2,M=rr(g,p,Y,ot),R=1-.17*Math.cos(lt(M-30))+.24*Math.cos(lt(2*M))+.32*Math.cos(lt(3*M+6))-.2*Math.cos(lt(4*M-63)),Tt=30*Math.exp(-Math.pow((M-275)/25,2)),V=Math.sqrt(Math.pow(P,7)/(Math.pow(P,7)+Math.pow(25,7))),at=1+.015*Math.pow(G-50,2)/Math.sqrt(20+Math.pow(G-50,2)),f=1+.045*P,w=1+.015*P*R,y=-2*V*Math.sin(lt(2*Tt));return Math.sqrt(Math.pow($/(at*h),2)+Math.pow(H/(f*d),2)+Math.pow(B/(w*u),2)+y*(H/(f*d))*(B/(w*u)))}function er(t){return t*(180/Math.PI)}function lt(t){return t*(Math.PI/180)}function ye(t,e){if(t===0&&e===0)return 0;{const n=er(Math.atan2(t,e));return n>=0?n:n+360}}function nr(t,e,n,r){if(t*e===0)return 0;if(Math.abs(r-n)<=180)return r-n;if(r-n>180)return r-n-360;if(r-n<-180)return r-n+360;throw new Error}function rr(t,e,n,r){if(t*e===0)return n+r;if(Math.abs(n-r)<=180)return(n+r)/2;if(Math.abs(n-r)>180&&n+r<360)return(n+r+360)/2;if(Math.abs(n-r)>180&&n+r>=360)return(n+r-360)/2;throw new Error}/**
 * @author Markus Ekholm
 * @copyright 2012-2023 (c) Markus Ekholm <markus at botten dot org >
 * @license Copyright (c) 2012-2023, Markus Ekholm
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *    * Redistributions of source code must retain the above copyright
 *      notice, this list of conditions and the following disclaimer.
 *    * Redistributions in binary form must reproduce the above copyright
 *      notice, this list of conditions and the following disclaimer in the
 *      documentation and/or other materials provided with the distribution.
 *    * Neither the name of the author nor the
 *      names of its contributors may be used to endorse or promote products
 *      derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL MARKUS EKHOLM BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */function Re(t){return t=Qt(t),t.A!==1?`rgba(${t.R}, ${t.G}, ${t.B}, ${t.A})`:`rgb(${t.R}, ${t.G}, ${t.B})`}function sr(t,e,n,r){const s={};r=r||{R:255,G:255,B:255},n=n||"closest";for(let i=0;i<t.length;i+=1){const o=t[i];let a,l;for(let h=0;h<e.length;h+=1){const d=e[h],u=tr(o,d,r);if(!a){a=d,l=u;continue}if(l!==void 0&&n==="closest"&&u<l){a=d,l=u;continue}if(l!==void 0&&n==="furthest"&&u>l){a=d,l=u;continue}}a&&(s[Re(o)]=a)}return s}function ir(t,e,n){const r=Re(t);return n=n||{R:255,G:255,B:255},sr([t],e,"closest",n)[r]}const or=Object.freeze(["#ecebe7","#cbc6c1","#b28b78","#847066","#695b59","#4f4240","#352f2e","#723012","#845425","#a76343","#dc6a36","#f682bf","#d74060","#c5452b","#b02222","#8d1931","#6a1325","#3e1909","#406a3b","#76771d","#939446","#d3bd46","#99e0a8","#399a4d","#204f1a","#0f2c0c","#1a0a01","#14266a","#194f80","#2067a7","#49a3b4","#1de9de"]);function L(t){if(!Object.keys(z).includes(t))throw new Error("Invalid CSS color name");const[e,n,r]=z[t],s=ir({R:e,G:n,B:r},or.map(i=>{const o=T(i).object();return{R:o.r,G:o.g,B:o.b}}));return`rgb(${s.R}, ${s.G}, ${s.B})`}qt(On);const ar=St.shuffle({deck:dt,random:Wt});function lr(){function t(){this.context.fillStyle=this.color,this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,2*Math.PI),this.context.fill(),this.context.lineWidth=2,this.context.strokeStyle=L("white"),this.context.stroke()}const e=N({color:L("black"),id:bt,radius:S,render(){t.call(this)}}),n=N({color:L("red"),id:xt,radius:S,render(){t.call(this)}}),r=N({color:L("green"),id:vt,radius:S,render(){t.call(this)}}),s=N({color:L("silver"),id:kt,radius:S,render(){t.call(this)}}),i=N({color:L("yellow"),id:Mt,radius:S,render(){t.call(this)}}),o=N({color:L("blue"),id:Et,radius:S,render(){t.call(this)}});return{diverPawn:e,engineerPawn:n,explorerPawn:r,messengerPawn:s,navigatorPawn:i,pilotPawn:o}}function hr(){return N({color:L(Tn),render(){if(this.context.beginPath(),this.radius!==void 0)this.context.arc(this.radius,this.radius,this.radius,0,2*Math.PI);else if(this.width!==void 0&&this.height!==void 0)this.context.rect(0,0,this.width,this.height);else return;this.context.lineWidth=Dn,this.context.strokeStyle=this.color,this.context.stroke()}})}function cr(){const t=dn({image:Z[Te],frameWidth:q,frameHeight:v,animations:dt.map((n,r)=>({[r]:{frames:r*2,frameRate:1},[`${r}-flooded`]:{frames:[r*2+1],frameRate:1}})).reduce((n,r)=>({...n,...r}))}),e=[];for(let n=0;n<dt.length;++n){const r=N({animations:t.animations,id:1+n,flooded:dt[n].flooded});r.playAnimation(n),e.push(r)}return e}async function dr(){try{const t=Z[De];return gn({tilewidth:q,tileheight:v,width:8,height:8,tilesets:[{firstgid:0,image:t}],layers:[{name:"ground",data:[0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,0,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0]}]})}catch(t){return console.error(t),null}}function ur(){const t=N({color:L("brown"),width:Dt,height:At,id:It}),e=N({color:L("yellow"),width:Dt,height:At,id:Nt}),n=N({color:L("red"),width:Dt,height:At,id:$t}),r=N({color:L("blue"),width:Dt,height:At,id:Ht});return{theCrystalOfFire:n,theEarthStone:t,theOceansChalice:r,theStatueOfTheWind:e}}function fr(){return N({x:0,y:0,color:L(An),width:rt,height:ut})}const yt=Object.freeze([{cardsToDraw:2,difficultyLevel:Se},{cardsToDraw:2,difficultyLevel:En},{cardsToDraw:3,difficultyLevel:Cn},{cardsToDraw:3,difficultyLevel:Sn},{cardsToDraw:3},{cardsToDraw:4},{cardsToDraw:4},{cardsToDraw:5},{cardsToDraw:5}]);function pr(t=In){const e=yt.findIndex(r=>r.difficultyLevel===t);if(e===-1)throw new Error("Invalid starting water level");return N({color:L("white"),x:-rt,backgroundColor:L("teal"),font:`${v/2}px Arial`,startingWaterLevel:e,text:`${yt[e].cardsToDraw}`,waterLevel:e,render(){const r=this.text.split(`
`);if(r.length===0)return;this.context.font=this.font,this.context.textBaseline="top";let s=-1;for(let i=0;i<r.length;++i){const o=this.context.measureText(r[i]),a=o.actualBoundingBoxRight+o.actualBoundingBoxLeft;a>s&&(s=a)}this.width=Math.ceil(s),this.height=r.length*v/2,this.x=rt-this.width,this.y=ut-this.height,this.context.fillStyle=this.backgroundColor,this.context.fillRect(0,0,this.width,this.height),this.context.fillStyle=this.color;for(let i=0;i<r.length;++i)this.context.fillText(r[i],0,i*v/2)},increment(){this.waterLevel<yt.length-1&&(++this.waterLevel,this.text=`${yt[this.waterLevel].cardsToDraw}`)},reset(){this.waterLevel=this.startingWaterLevel,this.text=`${yt[this.waterLevel].cardsToDraw}`}})}qt(Rn);const gr=St.shuffle({deck:dt,random:Wt});function wr(t){return function(){const{innerWidth:e,innerHeight:n}=window,r=e/n,s=rt/ut;r<s?(t.style.width=`${e}px`,t.style.height=`${e/s}px`):(t.style.width=`${n*s}px`,t.style.height=`${n}px`)}}function mr(t,e=`
`){const n={};for(const s of t)n[s.name]===void 0?n[s.name]=1:++n[s.name];const r=[];for(const[s,i]of Object.entries(n))r.push(`${i} x ${s}`);return r.join(e)}qt(Pn);const Ot=St.shuffle({deck:Ce.filter(({type:t})=>t==="treasure"),random:Wt}),_r=30,yr="0.0.40",be={hours:_r,version:yr};async function br(){const{canvas:t,context:e}=Ie();t.width=rt,t.height=ut;const n=wr(t);n(),window.addEventListener("resize",n),on();const r=`v${be.version}`,s=`${be.hours}h`,i=le({text:`${r}
${s}`,font:`${v/4}px Courier`,color:L("white"),x:rt-q/4*Math.max(r.length,s.length),y:v/4}),o=le({font:`${v/4}px Arial`,color:L("white"),x:q/4,y:v/4});await Hn();const a=await dr();if(a===null)return 1;a.sx=(q*8-rt)/2,a.sy=(v*8-ut)/2;const l=()=>{const{y:f}=en();if(f<v){let w=a.sy-v;w=st(0,a.mapheight-v-1,w),a.sy=w}else if(f>ut-v-1){let w=a.sy+v;w=st(0,a.mapheight-v-1,w),a.sy=w}};a.onDown=()=>{g(),o.text=""},I(a);const h=fr();h.onDown=()=>{g(),o.text=""},I(h);const d=hr(),u=f=>{d.x=f.x,d.y=f.y,f.radius?(d.radius=f.radius,d.width=d.height=void 0):(d.width=f.width,d.height=f.height,d.radius=void 0)},g=()=>{d.width=d.height=d.radius=void 0},p=cr(),b=a.layers.find(({name:f})=>f==="ground");if(b!==void 0){for(let f=0;f<a.height;++f)for(let w=0;w<a.width;++w)if(b.data[f*a.width+w]!==0){const y=gr.draw(),O=p[y.id-1];O.x=w*O.width,O.y=f*O.height,O.onDown=()=>{l();let F=y.name;if(O.flooded&&(F+=`
FLOODED!`),y.adventurer!==void 0)switch(y.adventurer){case bt:F+=`
(Diver)`;break;case xt:F+=`
(Engineer)`;break;case vt:F+=`
(Explorer)`;break;case kt:F+=`
(Messenger)`;break;case Mt:F+=`
(Navigator)`;break;case Et:F+=`
(Pilot)`}if(y.treasure!==void 0)switch(y.treasure){case $t:F+=`
(The Crystal of Fire)`;break;case It:F+=`
(The Earth Stone)`;break;case Ht:F+=`
(The Ocean's Chalice)`;break;case Nt:F+=`
(The Statue of the Wind)`}u(O),o.text=F},I(O),a.add(O)}}const{theCrystalOfFire:_,theEarthStone:m,theOceansChalice:k,theStatueOfTheWind:A}=ur();m.x=p[0].width+(p[0].width-m.width)/2,m.y=p[0].height+(p[0].height-m.height)/2,m.onDown=()=>{u(m),o.text="The Earth Stone"},I(m),a.add(m),A.x=p[0].width+(p[0].width-A.width)/2,A.y=p[0].height*6+(p[0].height-A.height)/2,A.onDown=()=>{u(A),o.text="The Statue of the Wind"},I(A),a.add(A),_.x=p[0].width*6+(p[0].width-_.width)/2,_.y=p[0].height+(p[0].height-_.height)/2,_.onDown=()=>{u(_),o.text="The Crystal of Fire"},I(_),a.add(_),k.x=p[0].width*6+(p[0].width-k.width)/2,k.y=p[0].height*6+(p[0].height-k.height)/2,k.onDown=()=>{u(k),o.text="The Ocean's Chalice"},I(k),a.add(k);const K={...ar},Y=[];for(let f=0;f<6;++f){const w=K.draw(),y=p.find(({id:O})=>O===w.id);y.flooded=!0,y.playAnimation(`${y.id-1}-flooded`),Y.push(w)}St.shuffle({deck:[]}).putOnTopOfDeck(Y);const $=[];for(let f=0;f<Fn;++f)$.push({name:`Player ${f+1}`,adventurerCard:Nn.draw(),cards:[]});const H=f=>()=>{u(f);const w=$.find(({adventurerCard:O})=>O.id===f.id);if(w===void 0)return;const y=`${w.name}: ${w.adventurerCard.name}
Cards:
${mr(w.cards)}`;o.text=y},{diverPawn:U,engineerPawn:B,explorerPawn:G,messengerPawn:P,navigatorPawn:M,pilotPawn:R}=lr();for(const f of p){const w=dt.find(({id:y})=>y===f.id);if(w!==void 0&&!(w.adventurer!==void 0&&!$.map(({adventurerCard:y})=>y.id).includes(w.adventurer)))switch(w.adventurer){case bt:U.x=f.x+(q-S*2)/2,U.y=f.y+(v-S*2)/2,U.onDown=H(U),I(U),a.add(U);break;case xt:B.x=f.x+(q-S*2)/2,B.y=f.y+(v-S*2)/2,B.onDown=H(B),I(B),a.add(B);break;case vt:G.x=f.x+(q-S*2)/2,G.y=f.y+(v-S*2)/2,G.onDown=H(G),I(G),a.add(G);break;case kt:P.x=f.x+(q-S*2)/2,P.y=f.y+(v-S*2)/2,P.onDown=H(P),I(P),a.add(P);break;case Mt:M.x=f.x+(q-S*2)/2,M.y=f.y+(v-S*2)/2,M.onDown=H(M),I(M),a.add(M);break;case Et:R.x=f.x+(q-S*2)/2,R.y=f.y+(v-S*2)/2,R.onDown=H(R),I(R),a.add(R);break}}a.add(d),Ot.deal(2,$.map(({cards:f})=>f));for(const f of $){let w=f.cards.filter(({name:y})=>y==="Waters Rise!").length;for(;w>0;){console.log("Waters Rise! Replacement card required");for(let y=0;y<f.cards.length;++y)if(f.cards[y].name==="Waters Rise!"){const O=f.cards[y],F=Ot.draw();f.cards[y]=F,Ot.putOnTopOfDeck(O),Ot.shuffle()}w=f.cards.filter(({name:y})=>y==="Waters Rise!").length}}(()=>{o.text=$.map(({name:f,adventurerCard:w})=>`${f}: ${w.name}`).join(`
`)})();const V=pr();return V.onDown=()=>{g(),o.text=`Water level: ${V.waterLevel}`},I(V),ln({render(){h.render(),a.render(),V.render(),e.fillStyle="rgba(0, 0, 0, 0.67)",e.fillRect(i.x,i.y,i.width,i.height),i.render(),e.fillStyle="rgba(0, 0, 0, 0.67)",e.fillRect(o.x,o.y,o.width,o.height),o.render()},update(){}}).start(),0}br();
