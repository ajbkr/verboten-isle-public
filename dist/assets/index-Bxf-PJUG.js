(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function i(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=i(r);fetch(r.href,s)}})();/**
 * @preserve
 * Kontra.js v10.0.2
 */function ee(e,t){let i=Math.sin(t),n=Math.cos(t);return{x:e.x*n-e.y*i,y:e.x*i+e.y*n}}function V(e,t,i){return Math.min(Math.max(e,i),t)}function Kt(e){let{x:t=0,y:i=0,width:n,height:r,radius:s}=e.world||e;return e.mapwidth&&(n=e.mapwidth,r=e.mapheight),s&&(n=s.x*2,r=s.y*2),e.anchor&&(t-=n*e.anchor.x,i-=r*e.anchor.y),n<0&&(t+=n,n*=-1),r<0&&(i+=r,r*=-1),{x:t,y:i,width:n,height:r}}let ct=()=>{};function Jt(e,t){let i=e.indexOf(t);if(i!=-1)return e.splice(i,1),!0}function ie(e,t){let{x:i,y:n,width:r,height:s}=Kt(t);do i-=t.sx||0,n-=t.sy||0;while(t=t.parent);let a=e.x-Math.max(i,Math.min(e.x,i+r)),o=e.y-Math.max(n,Math.min(e.y,n+s));return a*a+o*o<e.radius*e.radius}let lt={};function st(e,t){lt[e]=lt[e]||[],lt[e].push(t)}function G(e,...t){(lt[e]||[]).map(i=>i(...t))}let Y,dt,It={get(e,t){return t=="_proxy"?!0:ct}};function N(){return Y}function M(){return dt}function ne(e,{contextless:t=!1}={}){if(Y=document.getElementById(e)||e||document.querySelector("canvas"),t&&(Y=Y||new Proxy({},It)),!Y)throw Error("You must provide a canvas element for the game");return dt=Y.getContext("2d")||new Proxy({},It),dt.imageSmoothingEnabled=!1,G("init"),{canvas:Y,context:dt}}class Tt{constructor({spriteSheet:t,frames:i,frameRate:n,loop:r=!0,name:s}){let{width:a,height:o,spacing:l=0,margin:h=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:i,frameRate:n,loop:r,name:s,width:a,height:o,spacing:l,margin:h,isStopped:!1,_f:0,_a:0})}clone(){return new Tt(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped){if(!this.loop&&this._f==this.frames.length-1){this.stop();return}for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}}render({x:t,y:i,width:n=this.width,height:r=this.height,context:s=M()}){let a=this.frames[this._f]/this.spriteSheet._f|0,o=this.frames[this._f]%this.spriteSheet._f|0;s.drawImage(this.spriteSheet.image,this.margin+o*this.width+(o*2+1)*this.spacing,this.margin+a*this.height+(a*2+1)*this.spacing,this.width,this.height,t,i,n,r)}}function re(){return new Tt(...arguments)}let se=/(jpeg|jpg|gif|png|webp)$/,ae=/(wav|mp3|ogg|aac)$/,oe=/^\//,he=/\/$/,Qt=new WeakMap,le="",de="",ce="";function gt(e,t){return new URL(e,t).href}function Dt(e,t){return[e.replace(he,""),t].filter(i=>i).join("/")}function kt(e){return e.split(".").pop()}function Pt(e){let t=e.replace("."+kt(e),"");return t.split("/").length==2?t.replace(oe,""):t}function fe(e){return{wav:e.canPlayType('audio/wav; codecs="1"'),mp3:e.canPlayType("audio/mpeg;"),ogg:e.canPlayType('audio/ogg; codecs="vorbis"'),aac:e.canPlayType("audio/aac;")}}let W={},z={},U={};function At(){window.__k||(window.__k={dm:Qt,u:gt,d:U,i:W})}function ue(e){return At(),new Promise((t,i)=>{let n,r,s;if(n=Dt(le,e),W[n])return t(W[n]);r=new Image,r.onload=function(){s=gt(n,window.location.href),W[Pt(e)]=W[n]=W[s]=this,G("assetLoaded",this,e),t(this)},r.onerror=function(){i("Unable to load image "+n)},r.src=n})}function pe(e){return new Promise((t,i)=>{let n=e,r,s,a,o;if(r=new Audio,s=fe(r),e=[].concat(e).reduce((l,h)=>l||(s[kt(h)]?h:null),0),!e)return i("cannot play any of the audio formats provided "+n);if(a=Dt(de,e),z[a])return t(z[a]);r.addEventListener("canplay",function(){o=gt(a,window.location.href),z[Pt(e)]=z[a]=z[o]=this,G("assetLoaded",this,e),t(this)}),r.onerror=function(){i("Unable to load audio "+a)},r.src=a,r.load()})}function we(e){At();let t,i;return t=Dt(ce,e),U[t]?Promise.resolve(U[t]):fetch(t).then(n=>{if(!n.ok)throw n;return n.clone().json().catch(()=>n.text())}).then(n=>(i=gt(t,window.location.href),typeof n=="object"&&Qt.set(n,i),U[Pt(e)]=U[t]=U[i]=n,G("assetLoaded",n,e),n))}function ge(...e){return At(),Promise.all(e.map(t=>{let i=kt([].concat(t)[0]);return i.match(se)?ue(t):i.match(ae)?pe(t):we(t)}))}class X{constructor(t=0,i=0,n={}){t.x!=null?(this.x=t.x,this.y=t.y):(this.x=t,this.y=i),n._c&&(this.clamp(n._a,n._b,n._d,n._e),this.x=t,this.y=i)}set(t){this.x=t.x,this.y=t.y}add(t){return new X(this.x+t.x,this.y+t.y,this)}subtract(t){return new X(this.x-t.x,this.y-t.y,this)}scale(t){return new X(this.x*t,this.y*t)}normalize(t=this.length()||1){return new X(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,i,n,r){this._c=!0,this._a=t,this._b=i,this._d=n,this._e=r}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?V(this._a,this._d,t):t}set y(t){this._y=this._c?V(this._b,this._e,t):t}}function xt(){return new X(...arguments)}class me{constructor(t){return this.init(t)}init(t={}){this.position=xt(),this.velocity=xt(),this.acceleration=xt(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let i=this.acceleration;t&&(i=i.scale(t)),this.velocity=this.velocity.add(i);let n=this.velocity;t&&(n=n.scale(t)),this.position=this.position.add(n),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}class Vt extends me{init({width:t=0,height:i=0,context:n=M(),render:r=this.draw,update:s=this.advance,children:a=[],anchor:o={x:0,y:0},opacity:l=1,rotation:h=0,drotation:f=0,ddrotation:d=0,scaleX:c=1,scaleY:w=1,...p}={}){this._c=[],super.init({width:t,height:i,context:n,anchor:o,opacity:l,rotation:h,drotation:f,ddrotation:d,scaleX:c,scaleY:w,...p}),this._di=!0,this._uw(),this.addChild(a),this._rf=r,this._uf=s,st("init",()=>{this.context??(this.context=M())})}update(t){this._uf(t),this.children.map(i=>i.update&&i.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let i=this.width,n=this.height;this.radius&&(i=n=this.radius*2);let r=-i*this.anchor.x,s=-n*this.anchor.y;(r||s)&&t.translate(r,s),this.context.globalAlpha=this.opacity,this._rf(),(r||s)&&t.translate(-r,-s),this.children.map(o=>o.render&&o.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:i=0,_wo:n=1,_wrot:r=0,_wsx:s=1,_wsy:a=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this.radius&&(this._wrx=this.radius,this._wry=this.radius),this._wo=n*this.opacity,this._wsx=s*this.scaleX,this._wsy=a*this.scaleY,this._wx=this._wx*s,this._wy=this._wy*a,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this.radius&&(this._wrx=this.radius*this._wsx,this._wry=this.radius*this._wsy),this._wrot=r+this.rotation;let{x:o,y:l}=ee({x:this._wx,y:this._wy},r);this._wx=o,this._wy=l,this._wx+=t,this._wy+=i}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,radius:this.radius?{x:this._wrx,y:this._wry}:void 0,opacity:this._wo,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(i=>{this.children.push(i),i.parent=this,i._pc=i._pc||ct,i._pc()})}removeChild(...t){t.flat().map(i=>{Jt(this.children,i)&&(i.parent=null,i._pc())})}get radius(){return this._r}set radius(t){this._r=t,this._pc()}get opacity(){return this._opa}set opacity(t){this._opa=V(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}advance(t){super.advance(t),this.drotation+=this.ddrotation,this.rotation+=this.drotation}setScale(t,i=t){this.scaleX=t,this.scaleY=i}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class ye extends Vt{init({image:t,width:i=t?t.width:void 0,height:n=t?t.height:void 0,...r}={}){super.init({image:t,width:i,height:n,...r})}get animations(){return this._a}set animations(t){let i,n;this._a={};for(i in t)this._a[i]=t[i].clone(),n=n||this._a[i];this.currentAnimation=n,this.width=this.width||n.width,this.height=this.height||n.height}playAnimation(t){var i;(i=this.currentAnimation)==null||i.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){var i;super.advance(t),(i=this.currentAnimation)==null||i.update(t)}draw(){if(this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color){if(this.context.fillStyle=this.color,this.radius){this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.context.fill();return}this.context.fillRect(0,0,this.width,this.height)}}}function T(){return new ye(...arguments)}let _e=/(\d+)(\w+)/;function xe(e){if(!e)return{computed:0};let t=e.match(_e),i=+t[1],n=t[2];return{size:i,unit:n,computed:i}}class ve extends Vt{init({text:t="",textAlign:i="",lineHeight:n=1,font:r=(a=>(a=M())==null?void 0:a.font)(),...s}={}){t=""+t,super.init({text:t,textAlign:i,lineHeight:n,font:r,...s}),this.context&&this._p(),st("init",()=>{this.font??(this.font=M().font),this._p()})}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=xe(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context,i=[this.text];if(t.font=this.font,i=this.text.split(`
`),this._fw&&i.map(n=>{let r=n.split(" "),s=r.shift(),a=s;r.map(o=>{a+=" "+o,t.measureText(a).width>this._fw&&(this._s.push(s),a=o),s=a}),this._s.push(a)}),!this._s.length&&this.text.includes(`
`)){let n=0;i.map(r=>{this._s.push(r),n=Math.max(n,t.measureText(r).width)}),this._w=this._fw||n}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,i=this.textAlign,n=this.context;i=this.textAlign||(n.canvas.dir=="rtl"?"right":"left"),t=i=="right"?this.width:i=="center"?this.width/2|0:0,this._s.map((r,s)=>{n.textBaseline="top",n.textAlign=i,n.fillStyle=this.color,n.font=this.font,this.strokeColor&&(n.strokeStyle=this.strokeColor,n.lineWidth=this.lineWidth??1,n.strokeText(r,t,this._fs*this.lineHeight*s)),n.fillText(r,t,this._fs*this.lineHeight*s)})}}function Ft(){return new ve(...arguments)}let Z=new WeakMap,Wt={},Ot={},Zt={0:"left",1:"middle",2:"right"};function Ee(e){let t=e._lf.length?e._lf:e._cf;for(let i=t.length-1;i>=0;i--){let n=t[i];if(n.collidesWithPointer?n.collidesWithPointer(e):ie(e,n))return n}}function S(e,t){return parseFloat(e.getPropertyValue(t))||0}function Se(e){let{canvas:t,_s:i}=e,n=t.getBoundingClientRect(),r=i.transform!="none"?i.transform.replace("matrix(","").split(","):[1,1,1,1],s=parseFloat(r[0]),a=parseFloat(r[3]),o=(S(i,"border-left-width")+S(i,"border-right-width"))*s,l=(S(i,"border-top-width")+S(i,"border-bottom-width"))*a,h=(S(i,"padding-left")+S(i,"padding-right"))*s,f=(S(i,"padding-top")+S(i,"padding-bottom"))*a;return{scaleX:(n.width-o-h)/t.width,scaleY:(n.height-l-f)/t.height,offsetX:n.left+(S(i,"border-left-width")+S(i,"padding-left"))*s,offsetY:n.top+(S(i,"border-top-width")+S(i,"padding-top"))*a}}function $t(e){let t=e.button!=null?Zt[e.button]:"left";Ot[t]=!0,Rt(e,"onDown")}function vt(e){let t=e.button!=null?Zt[e.button]:"left";Ot[t]=!1,Rt(e,"onUp")}function Yt(e){Rt(e,"onOver")}function Ce(e){let t=Z.get(e.target);t._oo=null,Ot={}}function Gt(e,t,i){let n=Ee(e);n&&n[t]&&n[t](i),Wt[t]&&Wt[t](i,n),t=="onOver"&&(n!=e._oo&&e._oo&&e._oo.onOut&&e._oo.onOut(i),e._oo=n)}function Rt(e,t){e.preventDefault();let i=e.target,n=Z.get(i),{scaleX:r,scaleY:s,offsetX:a,offsetY:o}=Se(n);e.type.includes("touch")?(Array.from(e.touches).map(({clientX:h,clientY:f,identifier:d})=>{let c=n.touches[d];c||(c=n.touches[d]={start:{x:(h-a)/r,y:(f-o)/s}},n.touches.length++),c.changed=!1}),Array.from(e.changedTouches).map(({clientX:h,clientY:f,identifier:d})=>{let c=n.touches[d];c.changed=!0,c.x=n.x=(h-a)/r,c.y=n.y=(f-o)/s,Gt(n,t,e),G("touchChanged",e,n.touches),t=="onUp"&&(delete n.touches[d],n.touches.length--,n.touches.length||G("touchEnd"))})):(n.x=(e.clientX-a)/r,n.y=(e.clientY-o)/s,Gt(n,t,e))}function be({radius:e=5,canvas:t=N()}={}){let i=Z.get(t);if(!i){let n=window.getComputedStyle(t);i={x:0,y:0,radius:e,touches:{length:0},canvas:t,_cf:[],_lf:[],_o:[],_oo:null,_s:n},Z.set(t,i)}return t.addEventListener("mousedown",$t),t.addEventListener("touchstart",$t),t.addEventListener("mouseup",vt),t.addEventListener("touchend",vt),t.addEventListener("touchcancel",vt),t.addEventListener("blur",Ce),t.addEventListener("mousemove",Yt),t.addEventListener("touchmove",Yt),i._t||(i._t=!0,st("tick",()=>{i._lf.length=0,i._cf.map(n=>{i._lf.push(n)}),i._cf.length=0})),i}function C(...e){e.flat().map(t=>{let i=t.context?t.context.canvas:N(),n=Z.get(i);if(!n)throw new ReferenceError("Pointer events not initialized for the objects canvas");t.__r||(t.__r=t.render,t.render=function(){n._cf.push(this),this.__r()},n._o.push(t))})}function Te(e){let t=e.canvas;e.clearRect(0,0,t.width,t.height)}function De({fps:e=60,clearCanvas:t=!0,update:i=ct,render:n,context:r=M(),blur:s=!1}={}){if(!n)throw Error("You must provide a render() function");let a=0,o=1e3/e,l=1/e,h=t?Te:ct,f,d,c,w,p,_=!0;s||(window.addEventListener("focus",()=>{_=!0}),window.addEventListener("blur",()=>{_=!1})),st("init",()=>{p.context??(p.context=M())});function g(){if(d=requestAnimationFrame(g),!!_&&(c=performance.now(),w=c-f,f=c,!(w>1e3))){for(a+=w;a>=o;)G("tick"),p.update(l),a-=o;h(p.context),p.render()}}return p={update:i,render:n,isStopped:!0,context:r,start(){this.isStopped&&(f=performance.now(),this.isStopped=!1,requestAnimationFrame(g))},stop(){this.isStopped=!0,cancelAnimationFrame(d)},_frame:g,set _last(k){f=k}},p}let F;function Lt(){F??(F=Date.now()),F|=0,F=F+2654435769|0;let e=F^F>>>16;return e=Math.imul(e,569420461),e=e^e>>>15,e=Math.imul(e,1935289751),((e=e^e>>>15)>>>0)/4294967296}function Mt(e=Date.now()){if(F=e,typeof e=="string"){for(var t=0,i=1779033703^e.length;t<e.length;t++)i=Math.imul(i^e.charCodeAt(t),3432918353),i=i<<13|i>>>19;i=Math.imul(i^i>>>16,2246822507),i=Math.imul(i^i>>>13,3266489909),F=(i^=i>>>16)>>>0}}function ke(e){if(+e==e)return e;let t=[],i=e.split(".."),n=+i[0],r=+i[1],s=n;if(n<r)for(;s<=r;s++)t.push(s);else for(;s>=r;s--)t.push(s);return t}class Pe{constructor({image:t,frameWidth:i,frameHeight:n,spacing:r=0,margin:s=0,animations:a}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:i,height:n,spacing:r,margin:s},this._f=(t.width-s)/i|0,this.createAnimations(a)}createAnimations(t){let i,n;for(n in t){let{frames:r,frameRate:s,loop:a}=t[n];if(i=[],r==null)throw Error("Animation "+n+" must provide a frames property");[].concat(r).map(o=>{i=i.concat(ke(o))}),this.animations[n]=re({spriteSheet:this,frames:i,frameRate:s,loop:a,name:n})}}}function Ae(){return new Pe(...arguments)}let Oe=2147483648,Re=1073741824,Ut=536870912;function K(e,t){return e/t|0}function J(e,t){return e/t|0}class Le{constructor(t={}){let{width:i,height:n,tilewidth:r,tileheight:s,tilesets:a}=t,o=i*r,l=n*s,h=document.createElement("canvas");h.width=o,h.height=l,this._c=h,this._ctx=h.getContext("2d"),a.map(f=>{let{__k:d,location:c}=window,w=(d?d.dm.get(t):"")||c.href,{source:p}=f;if(p){if(!d)throw Error('You must use "load" or "loadData" to resolve tileset.source');let g=d.d[d.u(p,w)];if(!g)throw Error(`You must load the tileset source "${p}" before loading the tileset`);Object.keys(g).map(k=>{f[k]=g[k]})}let{image:_}=f;if(""+_===_){if(!d)throw Error('You must use "load" or "loadImage" to resolve tileset.image');let g=d.i[d.u(_,w)];if(!g)throw Error(`You must load the image "${_}" before loading the tileset`);f.image=g}}),Object.assign(this,{context:M(),layerMap:{},layerCanvases:{},mapwidth:o,mapheight:l,_sx:0,_sy:0,_o:[],...t}),this.context&&this._p(),st("init",()=>{this.context??(this.context=M()),this._p()})}get sx(){return this._sx}get sy(){return this._sy}set sx(t){let i=Math.max(0,this.mapwidth-N().width);this._sx=V(0,i,t)}set sy(t){let i=Math.max(0,this.mapheight-N().height);this._sy=V(0,i,t)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map(i=>{this._o.push(i),i.parent=this})}remove(...t){t.flat().map(i=>{Jt(this._o,i),i.parent=null})}getPosition(t){let i=N().getBoundingClientRect(),n=t.x-i.x,r=t.y-i.y;return n+=this.sx,r+=this.sy,{x:n,y:r,row:K(r,this.tileheight),col:J(n,this.tilewidth)}}setTileAtLayer(t,i,n){let{layerMap:r,tileheight:s,tilewidth:a,width:o}=this,{row:l,col:h,x:f,y:d}=i,c=l??K(d,s),w=h??J(f,a);r[t]&&(this._d=!0,r[t]._d=!0,r[t].data[c*o+w]=n)}setLayer(t,i){let{layerMap:n}=this;n[t]&&(this._d=!0,n[t]._d=!0,n[t].data=i)}layerCollidesWith(t,i){let{tilewidth:n,tileheight:r,layerMap:s}=this,{x:a,y:o,width:l,height:h}=Kt(i),f=K(o,r),d=J(a,n),c=K(o+h,r),w=J(a+l,n),p=s[t];for(let _=f;_<=c;_++)for(let g=d;g<=w;g++)if(p.data[g+_*this.width])return!0;return!1}tileAtLayer(t,i){let{layerMap:n,tileheight:r,tilewidth:s,width:a}=this,{row:o,col:l,x:h,y:f}=i,d=o??K(f,r),c=l??J(h,s);return n[t]?n[t].data[d*a+c]:-1}render(t=this._c,i=!0){let{_d:n,context:r,sx:s=0,sy:a=0}=this;n&&this._p();let{width:o,height:l}=N(),h=Math.min(t.width,o),f=Math.min(t.height,l);r.drawImage(t,s,a,h,f,0,0,h,f),i&&(r.save(),(s||a)&&r.translate(-s,-a),this.objects.map(d=>d.render&&d.render()),r.restore())}renderLayer(t){let{layerCanvases:i,layerMap:n}=this,r=n[t],s=i[t],a=s==null?void 0:s.getContext("2d");if(!s){let{mapwidth:o,mapheight:l}=this;s=document.createElement("canvas"),a=s.getContext("2d"),s.width=o,s.height=l,i[t]=s,this._rl(r,a)}r._d&&(r._d=!1,a.clearRect(0,0,s.width,s.height),this._rl(r,a)),this.render(s,!1)}_p(){let{_ctx:t,layers:i=[],layerMap:n}=this;this._d=!1,i.map(r=>{let{name:s,data:a,visible:o}=r;r._d=!1,n[s]=r,a&&o!=!1&&this._rl(r,t)})}_rl(t,i){let{opacity:n,data:r=[]}=t,{tilesets:s,width:a,tilewidth:o,tileheight:l}=this;i.save(),i.globalAlpha=n,r.map((h,f)=>{if(!h)return;let d=0,c=0,w=h&Oe,p=h&Re,_=0,g=0,k=0,H=0,O=0;d=w||p,h&=1073741823,O=h&Ut,O&&(w&&p?k=1:w?_=1:p?g=1:H=1,c=_||g||k||H,h&=~Ut);let P;for(let _t=s.length-1;_t>=0&&(P=s[_t],!(h/P.firstgid>=1));_t--);let{image:R,spacing:A=0,margin:L=0,firstgid:I,columns:at}=P,yt=h-I,u=at??R.width/(o+A)|0,m=f%a*o,y=(f/a|0)*l,E=L+yt%u*(o+A),v=L+(yt/u|0)*(l+A);c?(i.save(),i.translate(m+o/2,y+l/2),g||H?i.rotate(-Math.PI/2):(_||k)&&i.rotate(Math.PI/2),(k||H)&&i.scale(-1,1),m=-o/2,y=-l/2):d&&(i.save(),i.translate(m+(w?o:0),y+(p?l:0)),i.scale(w?-1:1,p?-1:1),m=d?0:m,y=d?0:y),i.drawImage(R,E,v,o,l,m,y,o,l),(d||c)&&i.restore()}),i.restore()}}function Me(){return new Le(...arguments)}function He(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Et={exports:{}},St,Nt;function Ie(){return Nt||(Nt=1,St=function(e,t){this.reset=function(){this.cards=e.slice(0),this.length=this.cards.length},this.shuffle=function(){i(this.cards)},this.reset(),this.shuffle(),this.deal=function(n,r){for(var s=0;s<n;s++)for(var a=0;a<r.length;a++){if(!r[a]||!r[a].push)throw new Error("Deck#deal | Undefined Hand");r[a].push(this.cards.pop())}this.length=this.cards.length},this.draw=function(n){if(!n||n<=1)return this.length=this.cards.length-1,this.cards.pop();for(var r=[],s=0;s<n;s++)r.push(this.cards.pop());return this.length=this.cards.length,r},this.drawFromBottomOfDeck=function(n){(!n||n<1)&&(n=1);for(var r=[],s=0;s<n;s++)r.push(this.cards.shift());return this.length=this.cards.length,r.length===1?r[0]:r},this.drawRandom=function(n){var r=function(){var o=Math.floor(t()*this.cards.length),l=this.cards[o];return this.cards.splice(o,1),this.length=this.cards.length,l};if(!n||n<=1)return r.apply(this);for(var s=[],a=0;a<n;a++)s.push(r.apply(this));return s},this.putOnTopOfDeck=function(n){if(!n instanceof Array)this.cards.push(n);else for(var r=0;r<n.length;r++)this.cards.push(n[r]);this.length=this.cards.length},this.putOnBottomOfDeck=function(n){if(!n instanceof Array)this.cards.unshift(n);else for(var r=0;r<n.length;r++)this.cards.unshift(n[r]);this.length=this.cards.length};function i(n){var r=n.length;if(r===0)return!1;for(;--r;){var s=Math.floor(t()*(r+1)),a=n[r],o=n[s];n[r]=o,n[s]=a}}}),St}var Ct,Xt;function Fe(){return Xt||(Xt=1,Ct=function(e,t,i){this.suit=e,this.description=t,this.sort=i,this.toString=function(){return this.description+" of "+this.suit+"s"},this.toShortDisplayString=function(){var n=this.suit.substring(0,1),r;switch(this.sort){case 11:r="J";break;case 12:r="Q";break;case 13:r="K";break;case 14:r="A";break;default:r=this.sort}return r+n}}),Ct}var bt,qt;function We(){if(qt)return bt;qt=1;var e=Fe();return bt=function(){this.cards=[new e("Club","Two",2),new e("Club","Three",3),new e("Club","Four",4),new e("Club","Five",5),new e("Club","Six",6),new e("Club","Seven",7),new e("Club","Eight",8),new e("Club","Nine",9),new e("Club","Ten",10),new e("Club","Jack",11),new e("Club","Queen",12),new e("Club","King",13),new e("Club","Ace",14),new e("Diamond","Two",2),new e("Diamond","Three",3),new e("Diamond","Four",4),new e("Diamond","Five",5),new e("Diamond","Six",6),new e("Diamond","Seven",7),new e("Diamond","Eight",8),new e("Diamond","Nine",9),new e("Diamond","Ten",10),new e("Diamond","Jack",11),new e("Diamond","Queen",12),new e("Diamond","King",13),new e("Diamond","Ace",14),new e("Heart","Two",2),new e("Heart","Three",3),new e("Heart","Four",4),new e("Heart","Five",5),new e("Heart","Six",6),new e("Heart","Seven",7),new e("Heart","Eight",8),new e("Heart","Nine",9),new e("Heart","Ten",10),new e("Heart","Jack",11),new e("Heart","Queen",12),new e("Heart","King",13),new e("Heart","Ace",14),new e("Spade","Two",2),new e("Spade","Three",3),new e("Spade","Four",4),new e("Spade","Five",5),new e("Spade","Six",6),new e("Spade","Seven",7),new e("Spade","Eight",8),new e("Spade","Nine",9),new e("Spade","Ten",10),new e("Spade","Jack",11),new e("Spade","Queen",12),new e("Spade","King",13),new e("Spade","Ace",14)]},bt}var Bt;function $e(){if(Bt)return Et.exports;Bt=1;var e=Ie(),t=We(),i=Et.exports={},n={deck:new t().cards,numberOfDecks:1,random:function(){return Math.random()}};return i.playingCards=function(){return new t().cards},i.shuffle=function(r){if(r||(r=n),r.deck||(r.deck=n.deck),r.numberOfDecks)for(var s=r.deck,a=0;a<r.numberOfDecks-1;a++)r.deck=r.deck.concat(s);return r.random||(r.random=n.random),new e(r.deck,r.random)},Et.exports}var Ye=$e();const mt=He(Ye),j=1,tt=2,et=3,it=4,nt=5,rt=6,ft=1,ut=2,pt=3,wt=4,q=[{id:1,name:"Fools' Landing",flooded:!1,adventurer:rt},{id:2,name:"Cave of Shadows",flooded:!1,treasure:pt},{id:3,name:"Temple of the Moon",flooded:!1,treasure:ft},{id:4,name:"Copper Gate",flooded:!1,adventurer:et},{id:5,name:"Whispering Garden",flooded:!1,treasure:ut},{id:6,name:"Dunes of Deception",flooded:!1},{id:7,name:"Silver Gate",flooded:!1,adventurer:it},{id:8,name:"Observatory",flooded:!1},{id:9,name:"Breakers Bridge",flooded:!1},{id:10,name:"Twilight Hollow",flooded:!1},{id:11,name:"Lost Lagoon",flooded:!1},{id:12,name:"Bronze Gate",flooded:!1,adventurer:tt},{id:13,name:"Phantom Rock",flooded:!1},{id:14,name:"Watchtower",flooded:!1},{id:15,name:"Cliffs of Abandon",flooded:!1},{id:16,name:"Misty Marsh",flooded:!1},{id:17,name:"Coral Palace",flooded:!1,treasure:wt},{id:18,name:"Howling Garden",flooded:!1,treasure:ut},{id:19,name:"Iron Gate",flooded:!1,adventurer:j},{id:20,name:"Gold Gate",flooded:!1,adventurer:nt},{id:21,name:"Crimson Forest",flooded:!1},{id:22,name:"Temple of the Sun",flooded:!1,treasure:ft},{id:23,name:"Cave of Embers",flooded:!1,treasure:pt},{id:24,name:"Tidal Palace",flooded:!1,treasure:wt}],Ge=[{id:it,name:"Messenger",color:"silver",type:"adventurer"},{id:rt,name:"Pilot",color:"blue",type:"adventurer"},{id:tt,name:"Engineer",color:"red",type:"adventurer"},{id:et,name:"Explorer",color:"green",type:"adventurer"},{id:j,name:"Diver",color:"black",type:"adventurer"},{id:nt,name:"Navigator",color:"yellow",type:"adventurer"}],Ue=[{name:"Fools' Landing",type:"flood"},{name:"Cave of Shadows",type:"flood"},{name:"Temple of the Moon",type:"flood"},{name:"Copper Gate",type:"flood"},{name:"Whispering Garden",type:"flood"},{name:"Dunes of Deception",type:"flood"},{name:"Silver Gate",type:"flood"},{name:"Observatory",type:"flood"},{name:"Breakers Bridge",type:"flood"},{name:"Twilight Hollow",type:"flood"},{name:"Lost Lagoon",type:"flood"},{name:"Bronze Gate",type:"flood"},{name:"Phantom Rock",type:"flood"},{name:"Watchtower",type:"flood"},{name:"Cliffs of Abandon",type:"flood"},{name:"Misty Marsh",type:"flood"},{name:"Coral Palace",type:"flood"},{name:"Howling Garden",type:"flood"},{name:"Iron Gate",type:"flood"},{name:"Gold Gate",type:"flood"},{name:"Crimson Forest",type:"flood"},{name:"Temple of the Sun",type:"flood"},{name:"Cave of Embers",type:"flood"},{name:"Tidal Palace",type:"flood"}];function $(e,t){const i=[];for(let n=0;n<e;++n)i.push(t);return i}const Ne=[...$(5,{name:"The Earth Stone",type:"treasure"}),...$(5,{name:"The Statue of the Wind",type:"treasure"}),...$(5,{name:"The Crystal of Fire",type:"treasure"}),...$(5,{name:"The Ocean's Chalice",type:"treasure"}),...$(3,{name:"Waters Rise!",type:"treasure"}),...$(3,{name:"Helicopter Lift",type:"treasure"}),...$(3,{name:"Sandbags",type:"treasure"})],Xe=[...Ge,...Ue,...Ne],B=2,Q=640*B,Ht=320*B,D=32*B,b=32*B,ot=24*B,ht=24*B,x=D/4/2,qe="aqua",Be="adventurer-deck",ze="flood-deck",Ke="island-tiles-deck",Je=6;Mt(Be);const Qe=mt.shuffle({deck:Xe.filter(({type:e})=>e==="adventurer"),random:Lt}),jt=""+new URL("spritesheet-nzAuwZib.png",import.meta.url).href,te=""+new URL("tilesheet-C_zpU0l5.png",import.meta.url).href,Ve=[jt,te],Ze=e=>ge(...Ve);Mt(ze);const je=mt.shuffle({deck:q,random:Lt});function ti(){function e(){this.context.fillStyle=this.color,this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,2*Math.PI),this.context.fill(),this.context.lineWidth=2,this.context.strokeStyle="white",this.context.stroke()}const t=T({color:"black",id:j,radius:x,render(){e.call(this)}}),i=T({color:"red",id:tt,radius:x,render(){e.call(this)}}),n=T({color:"green",id:et,radius:x,render(){e.call(this)}}),r=T({color:"silver",id:it,radius:x,render(){e.call(this)}}),s=T({color:"yellow",id:nt,radius:x,render(){e.call(this)}}),a=T({color:"blue",id:rt,radius:x,render(){e.call(this)}});return{diverPawn:t,engineerPawn:i,explorerPawn:n,messengerPawn:r,navigatorPawn:s,pilotPawn:a}}function ei(){const e=Ae({image:W[jt],frameWidth:D,frameHeight:b,animations:q.map((i,n)=>({[n]:{frames:n*2,frameRate:1},[`${n}-flooded`]:{frames:[n*2+1],frameRate:1}})).reduce((i,n)=>({...i,...n}))}),t=[];for(let i=0;i<q.length;++i){const n=T({animations:e.animations,id:1+i,flooded:q[i].flooded});n.playAnimation(i),t.push(n)}return t}async function ii(){try{const e=W[te];return Me({tilewidth:D,tileheight:b,width:8,height:8,tilesets:[{firstgid:0,image:e}],layers:[{name:"ground",data:[0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0,0,0,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0]}]})}catch(e){return console.error(e),null}}function ni(){const e=T({color:"brown",width:ot,height:ht,id:ft}),t=T({color:"yellow",width:ot,height:ht,id:ut}),i=T({color:"red",width:ot,height:ht,id:pt}),n=T({color:"blue",width:ot,height:ht,id:wt});return{theCrystalOfFire:i,theEarthStone:e,theOceansChalice:n,theStatueOfTheWind:t}}function ri(){return T({x:0,y:0,color:qe,width:Q,height:Ht})}Mt(Ke);const si=mt.shuffle({deck:q,random:Lt});function ai(e){return function(){const{innerWidth:t,innerHeight:i}=window,n=t/i,r=Q/Ht;n<r?(e.style.width=`${t}px`,e.style.height=`${t/r}px`):(e.style.width=`${i*r}px`,e.style.height=`${i}px`)}}const oi=21.25,hi="0.0.25",zt={hours:oi,version:hi};async function li(){const{canvas:e,context:t}=ne();e.width=Q,e.height=Ht;const i=ai(e);i(),window.addEventListener("resize",i),be();const n=`v${zt.version}`,r=`${zt.hours}h`,s=Ft({text:`${n}
${r}`,font:`${b/4}px Courier`,color:"white",x:Q-D/4*Math.max(n.length,r.length),y:b/4}),a=Ft({font:`${b}px Arial`,color:"blue",x:Q/2-D,y:b});await Ze();const o=await ii();if(o===null)return 1;const l=ri();l.onDown=l.onOver=()=>{a.text=""},C(l);const h=ei(),f=o.layers.find(({name:u})=>u==="ground");if(f!==void 0){for(let u=0;u<o.height;++u)for(let m=0;m<o.width;++m)if(f.data[u*o.width+m]!==0){const y=si.draw(),E=h[y.id-1];E.x=m*E.width,E.y=u*E.height,E.onDown=E.onOver=()=>{let v=y.name;if(E.flooded&&(v+=`
FLOODED!`),y.adventurer!==void 0)switch(y.adventurer){case j:v+=`
(Diver)`;break;case tt:v+=`
(Engineer)`;break;case et:v+=`
(Explorer)`;break;case it:v+=`
(Messenger)`;break;case nt:v+=`
(Navigator)`;break;case rt:v+=`
(Pilot)`}if(y.treasure!==void 0)switch(y.treasure){case pt:v+=`
(The Crystal of Fire)`;break;case ft:v+=`
(The Earth Stone)`;break;case wt:v+=`
(The Ocean's Chalice)`;break;case ut:v+=`
(The Statue of the Wind)`}a.text=v},C(E),o.add(E)}}const{theCrystalOfFire:d,theEarthStone:c,theOceansChalice:w,theStatueOfTheWind:p}=ni();c.x=h[0].width+(h[0].width-c.width)/2,c.y=h[0].height+(h[0].height-c.height)/2,c.onDown=c.onOver=()=>{a.text="The Earth Stone"},C(c),o.add(c),p.x=h[0].width+(h[0].width-p.width)/2,p.y=h[0].height*6+(h[0].height-p.height)/2,p.onDown=p.onOver=()=>{a.text="The Statue of the Wind"},C(p),o.add(p),d.x=h[0].width*6+(h[0].width-d.width)/2,d.y=h[0].height+(h[0].height-d.height)/2,d.onDown=d.onOver=()=>{a.text="The Crystal of Fire"},C(d),o.add(d),w.x=h[0].width*6+(h[0].width-w.width)/2,w.y=h[0].height*6+(h[0].height-w.height)/2,w.onDown=w.onOver=()=>{a.text="The Ocean's Chalice"},C(w),o.add(w);const _={...je},g=[];for(let u=0;u<6;++u){const m=_.draw(),y=h.find(({id:E})=>E===m.id);y.flooded=!0,y.playAnimation(`${y.id-1}-flooded`),g.push(m)}mt.shuffle({deck:[]}).putOnTopOfDeck(g);const H=[];for(let u=0;u<Je;++u)H.push({name:`Player ${u+1}`,adventurerCard:Qe.draw(),cards:[]});const{diverPawn:O,engineerPawn:P,explorerPawn:R,messengerPawn:A,navigatorPawn:L,pilotPawn:I}=ti();for(const u of h){const m=q.find(({id:y})=>y===u.id);if(m!==void 0&&!(m.adventurer!==void 0&&!H.map(({adventurerCard:y})=>y.id).includes(m.adventurer)))switch(m.adventurer){case j:O.x=u.x+(D-x*2)/2,O.y=u.y+(b-x*2)/2,O.onDown=O.onOver=()=>{a.text="Diver"},C(O),o.add(O);break;case tt:P.x=u.x+(D-x*2)/2,P.y=u.y+(b-x*2)/2,P.onDown=P.onOver=()=>{a.text="Engineer"},C(P),o.add(P);break;case et:R.x=u.x+(D-x*2)/2,R.y=u.y+(b-x*2)/2,R.onDown=R.onOver=()=>{a.text="Explorer"},C(R),o.add(R);break;case it:A.x=u.x+(D-x*2)/2,A.y=u.y+(b-x*2)/2,A.onDown=A.onOver=()=>{a.text="Messenger"},C(A),o.add(A);break;case nt:L.x=u.x+(D-x*2)/2,L.y=u.y+(b-x*2)/2,L.onDown=L.onOver=()=>{a.text="Navigator"},C(L),o.add(L);break;case rt:I.x=u.x+(D-x*2)/2,I.y=u.y+(b-x*2)/2,I.onDown=I.onOver=()=>{a.text="Pilot"},C(I),o.add(I);break}}const at=()=>{a.text=H.map(({name:u,adventurerCard:m})=>`${u}: ${m.name}`).join(`
`)};return at(),l.onDown=l.onOver=at,De({render(){l.render(),o.render(),t.fillStyle="black",t.fillRect(s.x,s.y,s.width,s.height),s.render(),a.render()},update(){}}).start(),0}li();
